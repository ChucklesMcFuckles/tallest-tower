<body><script language="decker">
{deck}
version:1
card:0
size:[512,342]
name:"tallestTower.deck"
author:"James Hall"

{fonts}
deckbuilder:"%%FNT0GCABAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADgAADgAAAAAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAA2AAA2AAA2AAA2AAA2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAABmAABmAABmAABmAADMAADMAAP/AAP/AAP/AADMAADMAADMAAP/AAP/AAP/AAGYAAGYAAGYAAGYAAMwAAMwAAMwAAMwAAAAAAAAAAAAAAAAAAAAAAAAAAAsEAAAEAAAEAAA/gAB/wAD/4AD/4AD14AD14AD14AD94AD8AAB+AAA/AAAfgAAPwAAHwAD34AD14AD14AD14AD14AD14AD/4AB/wAA/gAAEAAAEAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAeDAA/HAA7GAA7GAA7MAA7MAA7MAA7YAA/YAAeYAAAwAAAwAABgAABngADPwADOwADOwAGOwAGOwAGOwAMOwAMPwAMHgAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAAAAAAAAB8AAD+AAH+AAHuAAHuAAHuAAH+AAD+AAD8AAB44AD44AH44AH94AP94APfwAOPwAOPgAPHwAPPwAP/4AH/4AD84AB44AAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAADgAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGDAAAHAAAOAAAOAAAcAAAcAAAcAAA8AAA8AAA8AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA8AAA8AAAcAAAcAAAcAAAOAAAOAAAOAAAHAAADAAAAAAAAAAAAAAABsAAAOAAAHAAAHAAADgAADgAADgAADwAADwAADwAABwAABwAABwAABwAABwAABwAABwAABwAABwAADwAADwAADgAADgAADgAAHAAAHAAAHAAAOAAAMAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAC0AAB4AAB4AAB4AAC0AAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAHAAAHAAA/4AA/4AA/4AAHAAAHAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAGAAAGAAAEAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAD4AAD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAA8AAA8AAAAAAAAAAAAAAAAAAAAAAAAAAABgwAAAwAAAwAABwAABwAABgAABgAABgAABgAADgAADgAADgAADAAADAAADAAAHAAAHAAAHAAAGAAAGAAAGAAAGAAAOAAAOAAAMAAAMAAAMAAAMAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAA/AAB/gAD/wAD/wADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwAD/wAD/wAB/gAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAAAAAAAAHAAAPAAA/AAA/AAA/AAA/AAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAD8AAH+AAP/AAPPAAPPAAPPAAPPAAAPAAAfAAAeAAA+AAB8AAD4AADwAAHgAAHvAAPPAAPPAAPPAAP/AAP/AAP/AAP/AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAA/AAB/gAD/wADzwADzwADzwADzwAADwAADwAAPgAAPwAAPwAADwAADwADzwADzwADzwADzwADzwAD/wAD/wAB/gAA/AAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAB4AAB4AAD4AAD4AAD4AAH4AAH4AAH4AAP4AAP4AAO4AAe4AAc4AAc4AA/+AA/+AA/+AA/+AAB4AAB4AAB4AAB4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAP/AAP/AAP/AAP/AAPAAAPAAAPcAAP+AAP/AAP/AAPPAAOPAAAPAAAPAAPPAAPPAAPPAAPPAAPPAAP/AAP/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAA/AAB/gAD/wAD7wADzwADzwADzwADwAAD3gAD/wAD/wADzwADzwADzwADzwADzwADzwADzwADzwAD/wAD/wAB/gAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAA/8AA/8AA/8AA88AA88AA84AA84AAB4AAB4AABwAABwAADwAADwAADwAADwAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAD8AAH+AAP/AAPPAAPPAAPPAAPPAAPPAAPPAAH+AAH+AAH+AAP/AAPPAAPPAAPPAAPPAAPPAAPPAAPPAAP/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAAB/AAD/gAD/wADzwADzwADzwADzwADzwADzwADzwAD/wAD/wAD/wAB7wAADwAADwADzwADzwADzwADzwAD/wAB/gAA/AAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAA4AAA4AAA4AAAAAAAAAAAAAAAAAAAAAAA4AAA4AAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAGAAAGAAAEAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAHgAAfgAB+AAD4AAB+AAAfgAAHgAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/4AA/4AA/4AAAAAA/4AA/4AA/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAPAAAPwAAD8AAA+AAD8AAPwAAPAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAB/AAD/gAD/gADngADngADngADngADngAAHgAAPAAAPAAAfAAAeAAAeAAAeAAAeAAAeAAAeAAAAAAAeAAAeAAAeAAAeAAAAAAAAAAAAAAAAAAAAAAAAAAARAAAAA/AAD/wAH/4APA8AOAcAcAOAc7uAd/mA5/mA5zmA5zmA5zmA5zmA5zmA5zmA5zmA5zmA5zuA53sA5/8Ad94Ac4wAcAAAOAYAPh4AH/wAB/AAAAAAAAAAAAAAAAAACgAAAAAAAB4AAB4AAB4AAB8AAD8AAD8AAD8AAD8AADcAADcAAHeAAHeAAHOAAHOAAHOAAHOAAP/AAP/AAP/AAP/AAPPAAPPAAPPAAPPAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAD/AAD/gAD/wAD/wADzwADzwADzwADzwADzwADzgAD/AAD/gAD/wAD/wADzwADzwADzwADzwADzwADzwAD/wAD/wAD/gAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAPwAAf4AA/8AA/8AA88AA88AA88AA88AA88AA8AAA8AAA8AAA8AAA88AA88AA88AA88AA88AA88AA88AA/8AA/8AAf4AAPwAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAP8AAP+AAP/AAP/AAPfAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAP/AAP/AAP+AAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAD/gAD/gAD/gAD/gADwAADwAADwAADwAADwAADwAAD+AAD+AAD+AAD+AADwAADwAADwAADwAADwAADwAAD/gAD/gAD/gAD/gAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAA/4AA/4AA/4AA/4AA8AAA8AAA8AAA8AAA8AAA8AAA/wAA/wAA/wAA/wAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAD8AAH+AAP/AAP/AAPPAAPPAAPPAAPPAAPAAAPAAAPfAAPfAAPfAAPfAAPPAAPPAAPPAAPPAAPPAAPPAAP/AAP/AAH7AADzAAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAADzwADzwADzwADzwADzwADzwADzwADzwADzwAD/wAD/wAD/wAD/wAD/wADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAPPAAPPAAPPAAPPAAPPAAPPAAPPAAP/AAP/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAADx4ADx4ADzwADzwADzgAD3gAD3gAD3AAD/AAD/AAD+AAD+AAD+AAD/AAD/AAD/AAD3gAD3gAD3gADzwADzwADzwADx4ADx4AAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA/4AA/4AA/4AA/4AAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAPh8APh8APh8APh8APx8APx8APz8APz8AP78AP78AP78AP78AP/8AP/8APe8APe8APe8APe8APe8APe8APM8APM8APM8APM8AAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAADx4ADx4ADx4AD54AD54AD54AD94AD94AD94AD/4AD/4AD/4AD/4AD/4AD34AD34AD34ADz4ADz4ADz4ADx4ADx4ADx4ADx4AAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAPwAAf4AA/8AA/8AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA/8AA/8AAf4AAPwAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAP8AAP+AAP/AAP/AAPPAAPPAAPPAAPPAAPPAAPPAAP/AAP/AAP+AAP8AAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAA/AAB/gAD/wAD/wADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwADzwAD/wAD/wAB/wAA/gAAOAAAPAAAPAAAPgAAAAAAAAAAKAAAAAAAA/wAA/4AA/8AA/8AA88AA88AA88AA88AA88AA94AA/wAA/4AA/8AA/8AA88AA88AA88AA88AA88AA88AA88AA88AA88AA8+AAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAD8AAH+AAP/AAP/AAPPAAPPAAPPAAPPAAPgAAPwAAH4AAD8AAB+AAA+AAAfAAPPAAPPAAPPAAPPAAPPAAP/AAP/AAH+AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAD/wAD/wAD/wAD/wAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAeAAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA88AA/8AA/8AAf4AAPwAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAPngAPngAPngAPngAPngAHngAHngAHnAAHvAAHvAAHvAAHvAAHvAAD/AAD+AAD+AAD+AAB8AAB8AAB8AAB8AAB4AAB4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAABEAAAAAAADx54Dx54Dx54Dx54Dx54Bx5wBx5wBx5wB79wB79wB79wB79wB79wA/fgA/fgA/fgA/fgA/fgA/fgA/fgAePAAePAAePAAePAAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAA88AA88AA88AA84AA94AAd4AAfwAAfwAAfwAAPgAAPgAAPgAAPgAAfwAAfwAAfwAAfwAAdwAA94AA94AA94AA44AA44AA44AAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAOPAAOPAAOPAAPOAAPOAAHeAAHeAAHcAAH8AAD8AAD8AAD4AAD4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAD/gAD/gAD/gAD/gAAHgAAHgAAPAAAPAAAPAAAeAAAeAAAeAAA8AAA8AAA8AAB4AAB4AAB4AADwAADwAAD/gAD/gAD/gAD/gAAAAAAAAAAAAAAAAAAAAAAAAAAF+AAA+AAA+AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA+AAA+AAA+AAAAAAAAAAAAAAAAAAABsAAAMAAAMAAAOAAAOAAAGAAAGAAAGAAAGAAAHAAAHAAAHAAADAAADAAADAAADgAADgAADgAABgAABgAABgAABgAABwAABwAAAwAAAwAAAwAAAwAAAAAAAAAAAAAAAAAAAX4AAD4AAD4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAD4AAD4AAD4AAAAAAAAAAAAAAAAAAAGAAAAAAAAMAAAeAAAeAAAeAAAeAAA/AAAzAAAzAAAzAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/AAP/AAP/AAAAAAAAAAAUAAAAAAADgAADwAABwAAB4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfgAA/wAA/wAA5wAA5wAABwAAHwAAfwAA/wAA9wAA5wAA5wAA5wAA54AA/4AA/4AAd4AAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAO4AAP8AAP8AAP8AAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAP8AAP8AAP8AAN4AAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8AAD+AAD/AAD/AADnAADnAADnAADgAADgAADgAADnAADnAADnAADnAAD/AAD/AAB+AAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAABwAABwAABwAABwAABwAABwAAdwAA/wAA/wAA/wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA/wAA/wAA/wAAewAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAH4AAP8AAOcAAOcAAOcAAP8AAP8AAP8AAOAAAOAAAOcAAOcAAOcAAP8AAP4AAHwAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAeAAA+AAA+AAA4AAA4AAA4AAD+AAD+AAD+AAD+AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAewAA/wAA/wAA/wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA7wAA/wAA/wAAdwAABwAA5wAA5wAA/wAA/gAAfAAACAAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAO4AAP8AAP8AAP8AAPcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAADgAADgAADgAAAAAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAA+AAA+AAA8AAACQAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAOOAAOeAAOcAAO8AAO4AAP4AAPwAAPwAAPwAAP4AAP4AAO4AAO8AAOcAAOeAAOOAAOOAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADgAADwAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA73AA//gA//gA//gA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgA5zgAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAO4AAP8AAP8AAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+AAD/AAD/AADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAAD/AAD/AAB+AAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7gAA/wAA/wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA5wAA/wAA/wAA7gAA4AAA4AAA4AAA4AAA4AAA4AAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHcAAP8AAP8AAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAOcAAP8AAP8AAHcAAAcAAAcAAAcAAAcAAAcAAAcAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADuAAD/AAD/AADnAADnAADnAADnAADnAADgAADgAADgAADgAADgAADgAADgAADgAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfgAA/wAA/wAA5wAA5wAA8AAA+AAAfAAAPgAAHwAADwAA5wAA5wAA5wAA/wAA/wAAfgAAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAAAAAAAADgAADgAADgAADgAADgAAP4AAP4AAP4AAP4AADgAADgAADgAADgAADgAADgAADgAADgAADgAAD4AAD4AAD4AAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAADnAAD/AAD/AAD/AAB7AAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA84AA84AA84AA84AA84AAd4AAd4AAdwAAdwAAfwAAPwAAPwAAPgAAPgAAHgAAHgAAHAAAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPPOAPPOAPPOAPPOAPPOAHfeAHfcAHfcAH/8AH/8AD78AD78AD74AD74AB54AB54AB54AAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADjgADjgAD3gAB3AAB/AAB/AAA+AAA+AAA+AAA+AAA+AAB/AAB/AAB3AAD3gADjgADjgAAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA44AA44AA44AA44AA9wAAdwAAdwAAfwAAfwAAfwAAPgAAPgAAPgAAPgAAPgAAPgAAHAAAHAAAHAAAPAAA/AAA+AAA8AAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAP8AAP8AAAcAAA4AAA4AABwAABwAADgAADgAAHAAAHAAAPAAAOAAAP8AAP8AAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAY8AAB8AAB8AABwAABwAABwAABwAABwAAB4AAA4AAA4AAA4AAA4AAD4AADwAAD4AAA4AAA4AAA4AAA4AAB4AAB4AABwAABwAABwAABwAAB8AAB8AAA8AAAAAAAAAAAAAAAD4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAA4AAAAAAAAAAAAAAABvAAAPgAAPgAADgAADgAADgAADgAADgAAHgAAHAAAHAAAHAAAHAAAHwAADwAAHwAAHAAAHAAAHAAAHAAAHgAAHgAADgAADgAADgAADgAAPgAAPgAAPAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABzAAD7AAD/AAD/AADfAADOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA2wAA2wAA2wAA2wAAAAAAAAAAAAAAAAAAAAAAAAAA"
olympiad_title:"%%FNT0EigBEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAGAAAGAAAGAAAGAAAGAAAGAAAAAAAAAAAAAAAGAAAPAAAPAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADhwAHz4AHz4AHz4ADhwADhwABAgABAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAPPAAPPAAPPAAPPAAMMAAMMAAMMAAMMAD//gD//gD//gAYYAAYYAAYYAAYYAH//AH//AH//AAwwAAwwAAwwAAwwADzwADzwADzwADzwAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAwAAAwAAAwAAD8AAP/AAezgA8xwA8zwA8zwAexgAfwAAPwAAHwAAD4AAB8AAA+AAA/AAA/gAA3gAY3wA8zwA8zwA4zwAc3gAP/gAD+AAAwAAAwAAAwAAAwAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAHAAAeAAB+AD/8APw8AOx4Acx4AczwAczwAd3gAfngAPPAAAPAAAeAAAeOAA8/AA87AB5zAB5zADxzADx3AHh+AHg8APAAAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAfwAA9wAA44AB44AB44AB44AA4wAA9wAAfgAAPAAAPAAAfPwA/vwB7jgB5zADx2ADw+ADw8ADwcADw+QB5/wB/3wAfDgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAAD4AAD4AAB4AAA4AAAwAAAwAAAgAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAA4AAAwAABwAADgAADgAAHAAAHAAAHAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAHAAAHAAAHAAADgAADgAABwAAAwAAA4AAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAcAAAMAAAOAAAHAAAHAAADgAADgAADgAABwAABwAABwAABwAABwAABwAABwAABwAADgAADgAADgAAHAAAHAAAOAAAMAAAcAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGDAAPHgAPHgAHvAAB8AAc5wA//4A//4Ac5wAB8AAHvAAPHgAPHgAGDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAP/+AP/+AP/+AAOAAAOAAAOAAAOAAAOAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAA+AAA+AAAeAAAOAAAMAAAMAAAIAAAQAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//4A//4A//4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAA+AAA+AAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgAAHgAAPAAAPAAAeAAAeAAA8AAA8AAB4AAB4AADwAADwAAHgAAHgAAPAAAPAAAeAAAeAAA8AAA8AAB4AAB4AADwAADwAAHgAAHgAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAD/AAHngAHDgAPDwAPDwAPDwAeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4APDwAPDwAPDwAHDgAHngAD/AAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAHAAAPAAAfAAA/AAB/AAB/AAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAfgAB/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH4AAf+AA8fAA4PAB4PgB4HgAAHgAAHgAAHgAAPAAAPAAAeAAAeAAA8AAB4AABwAADgAAHAAAOAgAcBgA//gB//gD//gD//gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAP/AAPHgAeDwAeDwAADwAADwAAHgAAHgAAfAAB+AAB/gAAPwAADwAAD4AAB4AAB4AAB4AAB4AeDwAeDwAPHgAP/AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwAADwAAHwAAHwAAPwAAPwAAbwAAbwAAzwAAzwABjwABjwADDwADDwAGDwAGDwAP//AP//AADwAADwAADwAADwAAH4AAf+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//gA//AA/+AA/8AA4AAA4AAA4AAA4AAA44AA7+AA//AA8fAA4PgAwPgAAHgAAHgAAHgAAHgAAHgB4HAB4HAB8OAA/8AAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAOAAAcAAA4AABwAADwAAHgAAHgAAPAAAPAAAPAAAeeAAf/gAfnwAfDwAfD4AeB4AeB4AeB4AOB4APB4APDwAHjwAD/gAA+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB//AB/+AD/+AD/8AGAMAEAcAAAYAAA4AAAwAABwAABwAADgAADgAAHgAAHAAAPAAAPAAAeAAAeAAA+AAA+AAB8AAB8AAD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgAAf4AA/8AA4cABwOABwOAB4OAB4OAA8cAA+cAAf4AAPwAAPwAAf4AA98AB4+AB4eADwfADwPADwPADwPABweAB4+AA/8AAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAP+AAePAAeHgA8HgA8DgA8DwA8DwA8DwA+HwAeHwAfPwAP/wADzwAADgAAHgAAHgAAPAAAPAAAeAAAcAAA4AABwAADgAAGAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAAD4AAD4AABwAAAAAAAAAAAAAAAAAAAAAAAAAABwAAD4AAD4AABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAA+AAA+AAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAcAAA+AAA+AAAeAAAOAAAMAAAMAAAIAAAQAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAPwAA/AAD8AAPwAA/AAD8AAA/AAAPwAAD8AAA/AAAPwAAD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf/8Af/8Af/8AAAAAAAAAf/8Af/8Af/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHwAAD8AAA/AAAPwAAD8AAA/AAAPwAA/AAD8AAPwAA/AAD8AAHwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAP/AAMPAAYHgAeHgAeHgAMHgAAHgAAPAAAPAAAeAAAcAAA4AAA4AAAwAAAwAAAwAAAwAAAAAAAAAAAAAAAwAAB4AAB4AAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/AAD/wAHh4AOAcAMAMAcduAc/uAZzmAZhmAZhmAZhmAZhmAZjmAc+8Acc4AMAAAOAcAHh4AD/wAA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAABgAABgAABgAADwAADwAADwAAH4AAH4AAH4AAH4AAM8AAM8AAM8AAM8AAYeAAYeAAf+AAf+AAYeAAwPAAwPAAwPAAwPAB4fgD8/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/8AAf/AAPHgAPDgAPDwAPDwAPDwAPDwAPDgAPHgAP/AAP/AAPHgAPDwAPBwAPB4APB4APB4APB4APB4APBwAPDwAf/gA/+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfMAB/8ADw8ADgcAHgMAHgMAHgEAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgEADgMADwcAB/4AAfwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4AB/+AA8PAA8HAA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HAA8PAB/+AD/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//4Af/4APA4APAYAPAIAPAAAPAAAPAAAPBAAPDAAP/AAP/AAPDAAPBAAPAAAPAAAPAAAPAAAPAAAPAIAPAYAPA4Af/4A//4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/+AH/+ADwOADwGADwCADwAADwAADwAADwQADwwAD/wAD/wADwwADwQADwAADwAADwAADwAADwAADwAADwAADwAAH4AAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPmAA/+AB4eABwOADwGADwGADwCADwAADwAADwAADwAADwAADw/wDwfgDwPADwPADwPADwPADwPADwPABwfAB4/AA/3AAPDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/n8Afn4APDwAPDwAPDwAPDwAPDwAPDwAPDwAPDwAP/wAP/wAPDwAPDwAPDwAPDwAPDwAPDwAPDwAPDwAPDwAPDwAfn4A/n8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB/4AAfgAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAfgAB/4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH/AAB+AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAw8AB48AB48AB48ABx4AA/4AAfgAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/38Afj4APBwAPDgAPDgAPHAAPOAAPOAAPcAAP8AAP8AAP+AAPeAAPeAAPPAAPPAAPPAAPHgAPHgAPHgAPDwAPDwAfj4A/z8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8AAH4AADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwAADwBADwDADwHAH//AP//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwHwBwHgA4PAA4PAA8fAA8fAA+/AA+/AA//AA//AA33AA33AAznAAznAAxHAAxHAAwHAAwHAAwHAAwHAAwHAAwHAB4PgD8fwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+D8AfB4APAwAPgwAPgwAPwwAPwwAN4wAN4wAM8wAM8wAMewAMewAMPwAMPwAMHwAMHwAMDwAMDwAMBwAMBwAMAwAeAwA/AQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfgAB/4ADw8ADgcAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeAHgeADgcADw8AB/4AAfgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/8AB//AA8PAA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8PAA//AA/8AA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAB+AAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+AAH/gAPDwAOBwAeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AeB4AOBwAPDwAH/gAB+AAAMAAAOAAAPwAAHgAADAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP/wAH/8ADw8ADweADweADweADweADweADweADweADweADw8AD/8AD/wAD3gAD3gADzwADzwADx4ADx4ADw8ADw8AH4+AP8/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPxgA/9gA8fgB4HgB4DgB4DgB4BgA8AgA+AAAfAAAPgAAHwAAD4AAB8AAA+AAAfABAPABgPgBgHgBwHgB4HgB8PABv/ABj8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8A//8A48cAw8MAg8EAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAA8AAB+AAD/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP8/AH4eADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMADwMAB4YAB/4AAfgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/PwB+HgA8DAA8DAA8DAAeGAAeGAAeGAAeGAAPMAAPMAAPMAAPMAAHYAAHYAAH4AAH4AAD4AADwAADwAADwAABgAABgAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/j8AfB4AOAwAOAwAOAwAOAwAOAwAOIwAOIwAOcwAOcwAO+wAO+wAP/wAPnwAPnwAPDwAPDwAOBwAOBwAMAwAMAwAIAQAIAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPw/AHgeAHgMADwMADwYAB4YAB4wAA8wAA9gAAfgAAfAAAPAAAPAAAPgAAfgAAbwAAzwAAx4ABh4ABg8ADA8ADAeAHgeAPw/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD+HwB8DgA8DAA8DAAcGAAeGAAeGAAOMAAPMAAPMAAH4AAH4AAD4AADwAADwAADwAADwAADwAADwAADwAADwAADwAAH4AAP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf/wAf/wAcDwAYDwAQHgAAHgAAPAAAPAAAeAAA8AAA8AAB4AAB4AADwAAHgAAHgAAPAAAPAAAeAAAeAQA8AwA8BwA//wA//wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAH/gAH/gAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAHAAAH/gAH/gAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAABwAABwAAA4AAA4AAAcAAAcAAAOAAAOAAAHAAAHAAADgAADgAABwAABwAAA4AAA4AAAcAAAcAAAOAAAOAAAHAAAHAAADgAADgAABwAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAf+AAf+AAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAf+AAf+AAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAMAAAeAAA/AABzgADAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//wP//wBIAAAAAAAAAAAAAAAAAAAAAAAAAIAAAQAAAwAAAwAABwAAB4AAB8AAB8AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+AAD/gAHjwAHhwAAB4AAB4AA/4AD/4AHh4APB4APB4APB4APB4AHj4AD++AA8cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8AAB8AAA8AAA8AAA8AAA8AAA8AAA8AAA94AA/+AA/eAA+PAA8PAA8HgA8HgA8HgA8HgA8HgA8HgA8PAA+PAA/eAD7+ABx4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAP+AAfPAAeHgA+HgA8AAA8AAA8AAA8AAA8AAA8AAA+AAAeDgAfHAAP+AAD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAD4AAB4AAB4AAB4AAB4AAB4AAB4AA94AD/4AD34AHj4AHh4APB4APB4APB4APB4APB4APB4AHh4AHj4AD34AD++AA8cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPgAA/4AB48AB4cADweADweADweAD/+AD/+ADwAADwAAB4AAB4OAA8cAAf4AAHgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+AAD/AADzgAHngAHngAHjAAHgAAHgAAHgAAHgAAP+AAf8AAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAPwAAf4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAA4AD94AP/4APPIAeHgAeHgAeHgAeHgAPPAAP/AAH8AAPAAAeAAAf+AAf/gAP/wAP/wAcA4AYAYAcA4AeB4AP/wAD/AAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAD4AAB4AAB4AAB4AAB4AAB4AAB4AAB5wAB78AB/8AB8+AB4eAB4eAB4eAB4eAB4eAB4eAB4eAB4eAB4eAB4eAD8/AH+/gAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAAD4AAD4AABwAAAAAAAAAAAAAAAAAAH4AAH4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAD8AAP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAfAAAfAAAOAAAAAAAAAAAAAAAAAAA/AAA/AAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAGPAAPPAAPPAAOeAAH+AAD4AAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8AAB8AAA8AAA8AAA8AAA8AAA8AAA8AAA8fgA8PAA8OAA8cAA84AA9wAA/gAA/gAA/gAA/wAA94AA88AA8eAA8PAB+PgD/fgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAD4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAB4AAD8AAP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7zwA//8Ae+8AeeeAeeeAeeeAeeeAeeeAeeeAeeeAeeeAeeeAeeeAeeeA/e+A/e+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADw4AD7+AA/+AA+fAA8PAA8PAA8PAA8PAA8PAA8PAA8PAA8PAA8PAA8PAB+fgD/fwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD4AAP+AAePAAcHAA8HgA8HgA8HgA8HgA8HgA8HgA8HgA8HgAcHAAePAAP+AAD4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOPAAffwAH7wAHx4AHh4AHg8AHg8AHg8AHg8AHg8AHg8AHh4AHx4AH7wAH/wAHvAAHgAAHgAAHgAAHgAAPwAAf4AAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPGAA/uAA9+AB4+AB4eADweADweADweADweADweADweAB4eAB4+AA9+AA/+AAPeAAAeAAAeAAAeAAAeAAA/AAB/gAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAfjgAfnwAHvwAH7gAHwAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAHgAAPwAAf4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB8wAH/wAHjwAPBwAPAwAPgQAH4AAH+AAB/gAAfgAIHwAMDwAODwAPHgAP/gAM+AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAADAAAHAAAPAAAfAAA/8AB/4AAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPAAAPCAAPCAAHmAAH8AAB4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB+fgA+PgAeHgAeHgAeHgAeHgAeHgAeHgAeHgAeHgAeHgAeHgAfPgAP/gAP74ADhwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/z8Afh4APAwAHhgAHhgAHhgADzAADzAADzAAB2AAB+AAB8AAA8AAA8AAAYAAAYAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP4fwHwPgDgHADgHADgHADgHADgHADjHADjHAB3uAB3uAB/+AB/+AA+8AA4cAAwMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+HwAeHgAPHAAHOAAHsAAD8AAD4AAB4AAB4AAB8AAD8AADeAAHOAAOPAAeHgA+HwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP4/AHweADwMAB4MAB4MAA8YAA8YAAeYAAewAAPwAAPwAAHgAAHgAADAAADAAAGAAAGAAAMAADcAAH4AAHwAADgAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB//AB//ABwPABgPABAeAAA8AAB4AADwAAHgAAPAAAeAAA8BAB4DADwHAD//AD//AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPAAA/AABwAADgAADgAADgAADgAADgAADgAADgAADgAAHAAAOAAAcAAAOAAAHAAADgAADgAADgAADgAADgAADgAADgAABgAABwAAA/AAAPAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAAAAAAAAAAAAAAAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAA/AAADgAABgAABwAABwAABwAABwAABwAABwAABwAAA4AAAcAAAOAAAcAAA4AABwAABwAABwAABwAABwAABwAABwAABgAADgAA/AAA8AAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAHBAAP3AAd+AAQcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYxgA97wA97wAYxgAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"

{sounds}
sosumi:"%%SND0DAwMDAwMDA0PERUTCQYEAgQJDxYaIBEBBQgLDxIWGBoZAgAABQsSGB0eHxcAAAAABQ4WHB4fEgAABAwWHyUfGhkEAAAHFxgNFBkgJBEAAQAAAA4cJi4oEQAAAAcSGCEoKhEAAAACFic1PjIPAAAAAAYWJCQRFhkOBQoPEQkABBgeFgoDDA8CDBAYIychDwAAAAAIJDtBQSUAAAAABx8uKiILAAAADxkZISENBgcAAAADFyQdGh8VDgYBBgkAAAAGIDM3KxcAAAAAECo8Oh0AAAAAEigwLioSAAAAAAADGy0tIBcHAAAFFiAWAgAAAQkSIiodBAAHDhcZEgAAAAAIKT9BORgAAAAAABAeLjkyFgAAAAADGiorHAYAAAAHGiksGwUAAAQLFBcKAAAAEygvJxMAAAAADxweFg4CAAAADhsnMTMhAgAAAAAHLEBBOhcAAAAABxsgFAYFCxMcHxcHAAAAChccFAkEAQAGEhwfHRcNAAAAAAAPJDIxHwIAAAAIJjs6IQAAAAADITY6KxYGAAAAAAAABxAbJislFggAAAAAAAYQHCUnHw8AAAADGSkqGQAAAAAOLT8+KAUAAAAAESInIhYJAgABBAgPFxsZEwsAAAACDhQWFRMWGx4YCgAAAAAJKz9BMhAAAAAADyInHgwAAAALGiIiHRMGAAAAAAIWKTEsHAgAAAAFEBQQCQYKFB0gGAcAAAALIzEvGgAAAAAEHzM4LxwHAAAAAAESISkmGgoAAAAOGx8XBgAAAAccKywgDgAAAgkNCgEAAAUZLDQtGQEAAAAADyApKSESAgAAAAQYKTAnEgAAAAAMJTMvHQgAAAAMFBMKAQAEEBwiHhMHAAAGDhIRCwUBAwgQGR8iIBkLAAAAAAAcNkE6IAAAAAADHCooGAYAAAQRGRsVDQgICg0MCAMCBg0VGxwYEgwHAwAAAAYRHCMhFQQAAAASJCsjDQAAAAASKjUxIQwAAAAAAgoQFhodGxYNBQEBBgsODw0MDRASEQ0IBQgPFxsYDQAAAAASIysmFwUAAAAIFBsaFA0HBAUIDBEVGBcSCwMAAAILFRsbFxEMCgoKCAQBAQcRHCIfFQgAAAAJFBoZEgkDAgYNFBgYFA8JBAEBBAsTGRsYEAgCAgYNEhQSDQgHCQ4REQ4LCQsPExUSCwMAAAYQGR4cFg0FAAACBw0TFhcUDwoGBQkOExQRCwUCBAsSGBkVDgkGBwoMDQwKCg0QFBUSDggFBQgMERMTEQ4KCAcICw8UFxYSCgMAAAYPFxsZEwsFBAcLDxAODAoKDRAREQ8NCwoLDA0MCwoLDA4QEREQDw0KCAUFBwwSFxkVDwcBAQYNFBcVEAkFBQgNERMSEA0LCwoKCgsLDQ4QEBAPDQwMCwsKCgsMDxERDwwKCQsPEhMQCwYDBAkQFxkXEQoFAwUIDRASEhEPDQwLCgsMDg8ODQwLCwwODg4NDAwNDxAQDQkGBgkOExUUEAsHBggMEBIRDgsJCAoMDxESEhANCQcGBwoPEhQTEA0KCQoLDAwMCwwOEBISDwwIBwkMEBIRDwsJCAoNEBISEA4LCQgJCg0PERIQDQoICQsOERIQDAkICQsPEREQDgwMDQ0NCwoJCQwPEhMSDwwJBwgJDA4QEREPDQsJCgsOEBEPDAkHCAsPEhMRDgsJCQsNDg4NDAwNDg4ODQwLDAwNDg4NDAsLCwwNDg8QERAOCgcGBwoPExQTDwsIBwkMDxAPDQwLDA0ODw8ODQwMDAwMDAwNDg4PDg4NDAwMCwsLDA0ODxAODQsJCgsNDxAPDQsKCgsNDg4ODQwMDAwMDAwMDAwMDAwM"
buffer:"%%SND00NPZ4/D/DBokLC8uKSATBfjq3tbR0dXe6fcFEx8pLi8sJRoN//Hk2dPR09nj8P4MGSQsLy4pIBQG+Ore1tHR1d7p9wQTHyguLywlGg3/8eTa09HT2ePw/gsZJCwvLikgFAb46t/W0dHV3en2BBIfKC4vLCUaDQDx5NrT0dLZ4u/9CxkkLC8vKSAUBvnr39bR0dXd6PYEEh4oLi8tJRsOAPLl2tPR0tji7/0LGCQrLy8qIRUH+evf1tHR1d3o9gMSHiguLy0mGw4A8uXa09HS2OLu/QoYIysvLyohFQf569/W0dHV3Oj1AxEeKC4vLSYbDgDy5dvT0dLY4u78ChgjKy8vKiEVB/rs4NfR0dTc5/UDER4nLi8tJhwPAPPm29TR0tjh7vwKFyMrLy8qIRYI+uzg19LR1Nzn9QIQHSctLy0mHA8B8+bb1NHS2OHt/AkXIisvLyoiFgj67ODX0tHU3Of0AhAdJy0vLSccDwHz5tvU0dLX4e37CRciKy8vKiIWCPvt4NfS0dTc5vQBEB0nLTAtJx0QAfTm3NTR0tfg7fsIFiIqLy8rIhcJ++3h19LR1Nvm8wEPHCctLy0nHRAC9Ofc1NHS1+Ds+ggWIiovLysiFwn87eHY0tHU2+bzAQ8cJi0vLScdEAL159zU0dLX4Oz6CBYhKi8vKyMXCvzu4djS0dTb5vMADxwmLS8uJx4RA/Xn3NTR0dfg7PoHFSEqLy8rIxgK/O7i2NLR09vl8gAOGyYtLy4oHhED9ejc1dHR1t/r+QcVISovLysjGAr97uLY0tHT2uXyAA4bJi0vLigeEgP26N3V0dHW3+v5BxUhKi8vKyQYC/3v4tjS0dPa5fIADhslLS8uKB4SBPbo3dXR0dbf6/kGFCApLy8sJBkL/e/i2dLR09rk8QANGiUsLy4oHxIE9und1dHR1t/q+AYUICkuLywkGQv+8OPZ09HT2uTx/w0aJSwvLigfEwT36d7V0dHW3ur4BhQgKS4vLCQZDP7w49nT0dPZ5PH/DRolLC8uKR8TBffp3tXR0dbe6vgFEyApLi8sJBoM//Dj2dPQ09nj8P8MGiQsLy4pIBMF+Ore1tHR1d7p9wUTHykuLywlGg3/8eTZ09HT2ePw/gwZJCwvLikgFAb46t7W0dHV3un3BBMfKC4vLCUaDf/x5NrT0dPZ4/D+CxkkLC8uKSAUBvjq39bR0dXd6fYEEh8oLi8sJRoNAPHk2tPR0tni7/0LGSQsLy8pIBQG+evf1tHR1d3o9gQSHiguLy0lGw4A8uXa09HS2OLv/QsYJCsvLyohFQf569/W0dHV3ej2AxIeKC4vLSYbDg=="
walking_1:"%%SND0AP/+/wAA////AAEAAAD//wAAAQD/AAEBAQECAgEAAP8A/wAAAAABAQIBAQAAAAD//////////v7+/v8AAAD///8AAAAAAQECAQEBAAEBAf///wD//wAAAAD//wABAAEBAQEBAgIBAQAAAP///wD///8AAQEAAQEA////AAAAAAABAAD//v8AAAEBAQEBAQECAgIBAQD//wD/////AAECAgECAgIBAQEAAAD//////wAAAAAA////AAAAAQEBAQEAAAEBAQD//wAAAAD///8AAAD/AAAAAAABAQEAAAAAAAAA////AAAAAAD/AAEBAQD/AOEP/gkjHPf76foAEPgTzgAW7e0G3aaj4JzrMzBKABYiswsBzfHN/hEFBBoTDO0H5eYC7foIBBAD/wMR9uP7AvwOBvP6+Pv8Ag8VCf3y7QMKBAgBCAX7BQX8BAwI/PH3AwwNCQUBAf/0+P/8AwX8/vcFBwgM/fv+7/z/AQcG9/357vcCBhD7+AAA/P77BAf9/f/++vUBBgoCAAAC//b/BgL8+/7//PcABwj+/AICAv7+/vn6Avn7BQEA+fz2+gL+BQL9/gUBCPf8+/4HBf35/wcE/gECAQUHAvr9/QkM//P4Aw0GBAH/Awv+/fj7CQD9+v0ECQT2Af77+gL6AAYDDfftAwQGA/v7+v4C9PT/BwsJ/vX7ABARCAD18gH9/QL/BQAAAwD5/gMBAP8DB//+B/37AAUIAgL+BAECAgQFAPoBAf8HCgb79wMFAgIFAAAHBgL8+v4CBAUB/gAB/AUC/QMD/PoABQMB/f3//P39/AQFCQf8+vcBBgT+/wECAwL//P0EDAoDBAH+AAL/APv/AwEDBgcD/P8E/fz7AAcGBgABAfoCBAAAAgL+//78/gMIBPj4/AMK/v4A/QAABQcA/gYFBAQEAgEAAQABAwMDBgUCBQEBBAECAgMFAv8AAP8CAwP9/QABAQQBAf4AAfv8AwEFAv8CAgACAQEC//3//v8BCAIDAwECAgADAwIFAgMDAgMGAwD/AQUB/f4CBgH9/AIFAwIAAwH+//79/fv7/gP+/gME//r7BAYFAf7/AQACAgH8AAQEA/75AQMF//79AgEAAfz9AQAB/vv6AQEA/vz5+//+/fkBAAD//P/9APz+/fz//wD8/gID/vz5+fv8AAEB/voAAwH/BAP//P39///49wAEA/r7/gD9/gIC/Pr9//37/AAB/f37+wD//QAC/v0CAf7+/f3+/f/9/f7/APz+/v8BAf78+/0CAP38/QAEAP4CAv/9/fv9/wEE/fr9AAL//P3/AwMC//v9AQIB/v3/AgH/Af4AAQEA/fwAAP7/Af8A/v4AAP/9//z8/wEB/v3/AQMA/v8BAgL///0BBAD9//8AAAIA/v0AAwP/AQMC/gABAf//AQMDAf4BAQEA//78/QICAgEAAAAAAQD///8A/gABAP77/f///v39AQL/AP///wAAAAH+/P3+/wAB//79/wH//v79/QEA/v79/wIB//7+AAD//////wAAAP/9///+//38/v39/f7+/fwAAP79/fz8/f/+//7+/v/9/f///v///v4A///+/////wD+/wEBAwIA//8BAQH///7//wAAAQABAAH//v8DBQMB/wD/Af7+AQAB/wAA////AQAAAP8CAgIDBQIBAAABAwIBAf8AAgH//wACAgD/////AQIA/wADAgD+/wABAf/+/wD/AAEBAP4A/v/+/v8BAP39AAD+////AP8A//8AAQEAAP8BAwIBAQABAgIB//8BAQEAAQIBAgEBAgICAwQBAAECAgICBAQDAwMDAwMBAQIDBAQCAAICAgQFAgIDBAQEAwMCAwMCAwMDBAYGBQQEBQUHBgUDAwMDAQIEAwMCAwMDAwQFBAMDBAMDAQICAwABAQICAgEAAAECAwMCAQMCAQABAQEAAf/+////AP/+////////AQEBAf//AAEBAAD/AAEAAP/+///////+/f8AAf///wAAAP///////v38/gD//v7/AQEAAP///wAAAP/+/wD//wD//v79/f7//v/+//8AAgIBAQEAAP8BAP///wD//wAAAAICAgAAAAAAAQIDAwIBAQEBAgIB/wABAgICAQAA/wEBAQAAAQEA////AAIBAAEAAAAAAQEBAQECAwICBAQCAgICAgEBAgICAQEA/wAAAP8AAQIDAwIBAAECAQICAQEBAQD///8AAQEBAQAAAQEAAAACAgIAAAAAAQD//v4AAQMDAwQEAgIBAAAA/wAAAAAAAAEAAAABAQAB//8AAQECAQECAQECAgIBAAAAAP8AAAAAAQEAAAD/AQD//wAA//////7//wAAAP//////AP8AAQEBAQEBAP///////////////v7+/wAAAf///////v79/v///////v7+/v///wAA//////7+/f7+/fz+/v7+/f39/v7/AAEBAAAA//8A///+/v7///////////////7////+/v7+/wD+/v//AAABAP//AAD/////AAD///8AAAAAAAD////+/////wD/AAECAgEAAAEBAAAAAQEBAAAA//8AAP////////7+/v8AAAAAAAAAAAAA////AAAAAAAAAAAAAAD//v////////7+////AP8AAQEBAQECAgICAgEBAQAA///+//8AAQAAAAAAAAD//gABAQIAAAAAAAABAQEBAAEBAAAA/wAAAQEAAAABAQEBAQEAAQAA//79/wAAAAABAQECAgEBAQEAAQAA//8AAf///v/+/wAAAAEBAwMCAgIBAQAAAQEBAQEAAQEAAP8AAAABAQEBAQICAgICAQAA///+//8AAQAAAAEBAQICAgECAgIBAf//////AAEBAQEBAgEBAQEBAAAAAQEAAQAA////AAAAAQEBAQEBAQAAAAAAAAECAgEAAP////8A//8AAAEBAQEC5+UGHAEF+ujxGyoOBuH+vw338xP8ERr5ExneDsr1FB0I+PLs5tbt7wPxEhMmHwX+0tf48f8GDwgJ+f79/v8I+/n37/wJ/P8MDRvm9wn/HBIA7Qrp//8FDQ4BBgryAAcFBgwK//n+9gD6BQP/APYBCBESCv7z8/z7+Af9Bvn//fz69/wDAv759/4DAQsIAf3z/Pz/BwcG/vr8/QcBAwICBAMB/AACCAIG//v7/PcE//37AAEJ/wAEDPjy8PP/AgkFAvb//wH9Af3+Afr98v0ECAD8+PwFBwMB/f8JBgD2+PoHBwX2Bv0HBvz8/wEN+e8BBgkG/PX5//MA/PsJ+/399vwHDAIA+vz1+fsC+gD8APwA/AEEBQMD/vf9/vv6AQQB+v4F/f4G/vn8/QgKAAMG//4DAgL/+f0A+/wDBgL7/gD9AAoJ+vP3/f8BAgQC//37+PwCBgb//P8BAAAE/gABAgH6/PwABgT7/f7++P//AgMBA/39/wECAPwB/QH9/wEBAgP+AP4FBP7++wMAAAAD/v0CBv4BAQEB/v0CAwIB+wH8/wP7+v0D//v7/v7/BAMA+fX9AQEBA/wB+/wBAgYEAwD9AwIB/AEB//wAAwMGAAICBQAB//wBBAD/+wH+AAIABAH8Av0FBQICAQEA/wADBAD7/fsABAICAf3//vv+AgYB/v8CBQIDBP8F/wEBAgABAgQDBP8C/P7//wQB/gH8AwACA/8BAQAA/gAC/v38/P8BBQD/+vn+AQIB/QIDAv8GAAMB/Pj+/v8GBQP+AAAEBgX//wICBP/9/QAFBP///v3+/v3+AQMEA/z9/gEA/wIA/P7+/P0CBQMA/P3//v4CAwH+/QEDAwEEAQD9//4DAf39/gL///8AAAH/AQEA/f78/wICAf3+Av/+/f/+/wABAAH7AP8BAgEB/fz+AAMC//0A/wD/Av//AAUB//8CAwD//gEC//39/gADBP/9/wABAP4AAgUCAgIBAAIEAQH/AAIC/v8AAAEB/wD9/QH+/v8CBQIB//7//QEB//8DAgH/AQID//8A/wL//gD/AAIC/wABAwH//gH//wECAAAAAAD/BAUCAAACAgH//wEBAQEA//4BAAD/AwEA//8DAQL/AAD/AQMC/v38/wEAAAAB//8BAAL/Af7/AAH//v7/AQH//f4BAP8AAwIBAgIDAQQDA/8AAQUDAQAAAQIDAgEBAP8CAQEBAP////4B/wD/Af/+/f//AQAA//4AAgEA//8AAQEBAQD//v8A/wEAAP3+/wADAwECAgMBAgMDAP7+/v7+AAABAP/9/v8AAAEB//39/QAB/v////3+/QAAAgAB/gEBAwEDAgABAP7+AAADAgIAAQIC/f3/AQH//v4AAgMCAv7+AAEBAAD//gAA/v7+AQD//v8AAP7//wD/AAD//f//AQEAAf8BAAAAAAECAAD//wD/AAAA//7+AP/////+/v3+AAAAAQABAgIDAwIAAQICAQEAAP8AAAEAAAABAAAAAP8AAAEAAAD/AQABAQIBAgIBAAECAgEAAQAAAQICAwAA/wAAAQAAAQAAAP8BAgICAAEBAQECAgEBAgAA//8AAP///v8AAAAAAP////7/AAEBAQIB/v8AAAD///////3/AQEAAQIAAQAB/wAAAAAAAQD///3+////AAAAAAEAAQICAgABAAAAAP///gABAQIAAgH///8AAQICAP/+/v8AAAEBAAD+//7+AAABAQAAAQIBAgICAgEBAQAAAQEB//7/AAEBAgICAAECAQICAwIBAP////8AAP////////////////8AAAD/AAABAAAAAP//AAEAAAABAQECAwIAAAABAP/////+/v8AAAABAP8AAAAAAAAA////AQD//wAA//8AAP8A/wD/AP8A/v//AAECAgEBAgEBAP//////AAD/AP8AAP///////wAA//7+/gD//v7+////////AQEBAQIBAgAAAAIBAQAAAP8A///+///+/v7+/v3+/gABAAABAAEBAQD+/wAAAP////8AAAAA//8AAQAAAQAAAAECAQD//wAAAQEBAAECAQIBAgIBAAD/AAAAAP///wAA/v7+/wD///4AAQEBAQEBAQICAAD//wD///7//wABAQEAAQEBAAAAAAEAAP///v79/v8AAAEBAAD///8AAAEBAAD/////AAEAAQABAQD/////AAAAAAAAAAAAAAD///8AAAEAAAAAAP//AAAAAAAAAP///wAAAAAAAAABAQEAAQIBAQICAgMCAgEAAAEBAAAA///////+////AAEBAP//AAAAAAABAP8AAAAAAAABAQAAAQECAQABAQEAAQICAQEBAQEA/wAAAAAAAQEAAAEBAQEBAAAAAAD+/v7/AAD//v7/AAAAAAAAAQEAAAABAgICAQEBAQEBAgEBAAEBAQAAAAAAAAAAAQAAAAEAAAD//////v7+/wAAAAECAgEBAQAAAP/+/v/////+AAABAQABAAEBAQEBAQEBAAAAAAD/AAAA/wAAAAABAAAAAAEBAP///wAAAP8AAAAAAAAAAAEBAgEBAQICAQEBAAAAAAD/////////AAEBAAEBAQEBAQEBAP///////wABAQEBAAAAAAEBAQEBAQEBAQEBAQAAAAEAAP//AAAAAQEAAAAAAAEBAQAAAAD///7+/v8A/wAAAP8A/wEBAQEBAQAA/////wD//wABAQEBAQEBAQEBAQD/////AAAAAP8AAP//AAAAAAECBNDnAyUGBfzjpv5uEHIMH+1P/vbLvALA+xtQ5AME1FvU3yQdE+nK1kvg/yP+EBbj/PXl8PL7DggGECIODevH2tj+/QEP/RgNHxH75N38BCMeEQAJ6P4A/ggV9fX+CvgEBA4QDvz5+gn3BwP7BO3/AAsYDwPl9/Xx/Qr//RDy/wL/7/kACAby9gP9EwcSCebl7AUXBv77BQMGAxET+vj/CQkA+voCAQEAAQD/9AEH///57/wAEA4H/P7w8eb4CfwKBwT2CPj+AwX0/fsLCggDB/4D/Pj5Af8GCAQGAf7/7ez/CgoUAQYCAAT/BPH5/wP9EA759PACCf3r/wL///4ECP75+hIIBffz/fr8BPf9/gACDgAFBvwIBff69vz6CgsL9O4AD/8HAv4AAP8MCwAABgD/+/cFAvb8/AcB/QgE+QIAAP77Cf30/f7/CQEHBf8CBf0EBfwA+gP/BAL7//3+/QMC+gD+AAL++fz8AvYFAvz5A/sFAgAGBQP9+vkDBQQBAvwBAQwICvv2+wAEB/sC/wADCAMC+/kABv75/QL9/fwF//z3+/j6AP3+AQABBwj8AvbwAQP9A///AAEEDQIB/f8CCggCBfwAA/36+wMDBf8CBQABAQH8+wL8Af8B/PkEAAEE+AL9BQMB+QH//f8D/AX7/f8BBgL/BAQE9/3//v4A/vz7BAH+/gUBBgIFBgD9/gMGAPz4/wAF/f0B/ff9AwsJ/vf+/f7+AgD+/fwABgABAAL+/Pz+AgYCAP0GAQQCA/v+/wQCBAD8/QUHAgD/+gME+wMC/wD/AP0D/gX/Afv4/AAABP8CAgYABf8G+vz//f79AfwBCAAE/P/7/AP/BQIA+fwFCgUBA/3//voFB/749gAJ/v8BAQP//AAA//gAAQkDAQD/AAH+//7++gD9/AEFAQAAAf37BAACBAMAAAD+AgEBAwL+/P4BAf8A/gQB//4AAv79/QEBAAL/Afz/AQMA//8CAwADAP0AAQAD/v4BAwQEAAD5/fwAAP79+v8FBQf+/v8CAP8C/v38/wQFAP3+Af3//wMA/P4CAAAAAP8DAgEB//0A/P8BBwEA/wAB/gIDAAD/AwMD/f/+AAACA//8/f4CAAMAAAH/AwEC+/8AAAED/vz6/f0A/f7+AQD/AgQD/wAAAwIA+/v/AAAB/f39AAIEAgD8/v8BBf//AAMHAwACAP8AAQAC//z+AAD//AAA/v//AAH+//7//P8BAwH//f//AP////7/AQQB/wEBAf3+////AP4BAP7/AP4B/QECBQMEAAECAgEA/v//AAMCAf36/gAA////AAH+/v4A//4A/wH9AgADAAD+/wECAQQAAwEDAgH9//8CAgMB/v//AwH//P///v4DAQL/AAL//P8BBQP//f8AAQD///7+//8BAP///wL//wABAf8BAAD/AQEBAgD+//8AAQIB/wABAQICAv//AAEB/v3+/wEAAAH//v//AgEA/wACAQEBAgAAAQD//v/+/wD+//7///8AAAAAAQEA/wECAAEDAgAAAP8BAQH/AQACAQIDAAH/AP8AAAEBAAIB/wD/Av8A/f/+/wABBAQBAwACAAEAAv////8AAP4AAQH/AAECAAABAAD///8BAAEAAP4AAAEAAAEB/wAAAQEBAQECAgAAAQEBAAH+AAABAQL/AAEBAQH/AAAAAgQCAgAAAP7/AAD/AP8B/wAAAP///QAAAP7/AP/+AAIBAAD//wEBAQEBAAEDAQH//wD/Av/+///+//7/AAAB//8AAAABAgEBAAECAQAA//8AAAD//f7/AQAB/wD+//8BAQABAAEBAAAAAQD///8BAAH/AQICAAIBAAABAAD+AP8BAP8AAQH/AQAAAAABAQEAAAEBAQEB/wD//wAA////AP8A////AP8AAAEBAQEA/wAAAAEA/wD/AAAA/v7+AQEBAAAAAQEAAQH///8C//79////AP/+/v8AAQEAAAEBAgEBAAD/AgH///8BAQD///79//8BAP//AQH/AP8AAP8A/////wABAAECAgIAAP4AAAEA/wEBAgEB/////gAA///+AAAAAQECAgIBAAD///8BAAH//wAA////AAAAAAEAAP8AAAAAAAABAQEBAQAA/wABAAABAAEBAQEBAgEBAAAA/wD/AP8AAP8AAQABAQEBAQIBAQECAQAA/wEA/wAAAP//AAD/AP////8AAAEAAAAAAAAAAAAAAQEBAQEBAgIBAAAAAQIBAQD//wAAAQD/AP8AAQAA/v/+/wAAAAABAQAAAAD/AAAAAAH////9/v7//wAAAQEAAAEBAQEAAP8AAAAAAQD/AP8AAAAAAAABAAAA/wD/AP8A//////8A////AAEAAAEBAAEBAQAA//8A/wAA//8AAQEBAQEBAAEAAP8AAAEAAP8A////AP8AAAEAAP8AAAAAAAEBAAAAAQEAAQEB//7+//////8AAAAAAAABAgEAAAABAAD//////wH5Cc8B8ucd8y1g5C4l9QnWyg/PGzINLdL2UykvAvoAGh/x5dj/4u7xBfPm9vgEPwPj0Mr49vkNIxEGERH2++8O/OLm9xz5+wgQK/rm5QnsHu0THC398QP4ABz0FBP6CAX/+v74Bfb7A/kB+PwD+fLw+wADCvMG/fv1A/r/CfH/APcD+v////L5DQMJBAwSAAX9A/UFAAMOBgEC/QAA+wMMCQkC//z/+/n48/v7+/oRBAn5AALx/fYICwj48Pf7Af/6AfoDAgT6B/oDAgQKBg8DBfP/+Q0GEAEM/goHB/jy9P0LBA4G/QEBDPv0+Qrv8ecMEQoE9AT39vHv+BIODgL0/wT8/gIIAwD9AgD/Cvv++vkJBPkEBg8E/foF+QD//QIABv779/cG/PsHBgL+/AkEA/oJAff8/f8AAAUMAfn9+gD8CA4D/fT7AAIPAQoC/wH/AgQFAf72Afz5APr8+fcBAfsCAAcCBP39BPj/+/4D+wYGAP3//AP8BAcB/P7+A/cD/wr8BQIG+wD/BQcBBfv9AwALBAYFAP3++gL9AQf6Afv4A/f7AgAD/Pj+/f39BwUA/vwEAQMFAPn+/v4IAgT9AP4JBQgA/wH7/PsEBgMB/QUECAQC+f/0Bf/+Af0C+f0B/AX8APwAB/7//f79/f/8//f5//8CBQj9CP/8+/4AAQL+AAIEAwD4AgMEAwAEAf77AwACAf7//P8AAv///P0A/gIAAAIA/AL6BP0AAgEE/gP/APr+/AEDAwH++QEBAgL/BwD+/P4ABQMBBwQG/gEAAQH6APr9Af8E+wUAAf8A//3+/vz9AQAH//4B/wH8AQL8/Pz4/v4MBwMB//77Af4JAgH4+/0CAQIAAAT+BQAG+/79+QIBAv////77AAH//vz8AQIHAQQAAP76Av4D/AD/Afv+AQMCAP3+/QABBgf//gACAwEBA///AgAA/QT8+vv8AP8CAAL8AQMEAv8B/wD/AQH8AgEDAAH+/wEDAQAFAgICAgT+AP7+Af4D/QD9/wMCAwP//f0A/gMBBAH//P79AP7//f3+/v8BAf7/Av8BAQMFAAACBAQA//8EAP/+/f4BBf8A+wEB/wD9Av4DAf8A/QMBAP8BAwD9/v3+/f3+A/8B/wH///4A/v7+/gH/////AQEB/fwCAgb+AwAEAv8A/QMDAQD+AQAC/gABAgP//P7+/wL///7/AAD//gEC/QD/BAL//vz//wEBAP4AAQADAgMB/gD9//z//f3+//8BAQAB/v//AQADAwIB///+/wEAAgEB///+AAECAf39/f8BAQECAP7+/QD+AwEA/wD/AQL/AP8AAwABAQH///8A/gD9/v3+AAIB//7+/v8CAwICAwIA/v8AAgD//QAAAAD////+/f//Af8BAAIBAP0A//8B/wEBAAD+/v39/wAAAgMCAAH/AQH/Af3+AAEB/v39AP4AAAEB/gD/AgEBAAEAAAEBAAAA////AAAAAP/+//8BAQAA/gD+/v///wD/AAAB/wABAwADAAEAAQH/AQECAv8A/gD9//8AAAAA/wABAgD//wEBAgICAgQCAgACAAH+AP7/AAAA//8A/wD+AAEBAv8BAAIA////AAAB/wEBAQEAAgIBAQABAgAB/wD//wD/AQABAQH//wAB/wEAAgADAQMCAwABAQH//vv//v4AAAEA//8AAQMDAwH//wADAgECAf///gABAQEA/v//AQIAAQEDAQH/AQECA/8B///+/wAAAAAAAAABAAEBAQICAQIAAQECAgIA//7+/////wABAAAAAAICAQH///7/AAAAAQAA/gABAAAAAQMCAQEBAgEBAQH/AP//AAABAQAAAQEAAAEBAQAAAQECAgEBAAEAAQEAAQAAAAAAAQAAAAABAAEAAQEBAAAAAAH/AP//AAECAAEBAQIBAAD///7//wEAAQAAAQAAAf7+AAD/AP8AAQABAAABAQD/AAAAAAD/AAAB//7////+//4BAAD/AAEAAf/+/wAAAAD/AAAAAAABAAAAAAAAAQEAAAEBAQEBAAD//wAAAQEAAP8AAgIDAgL/AAEBAP///////v7/AP8AAAD//wEAAf8AAAEAAAEBAQAAAAAA/v//AP8A/wEAAQAAAAAA/wD/AAAAAP8A////////AAAAAAD/AP8AAAD//wAAAP///v7+//////7/AAD/AP8AAAAAAAD+//7//wD/AQEBAAABAQAA/wABAAD/AAD/////AP8A/////wAAAQECAQEBAQABAP////8A/wABAAD//wAAAP//////AAAAAQEBAAAAAAAAAP//AAABAP8AAAACAAD/AQAA/wAA//7///7//wABAgICAQEBAQIBAQABAP/+/wAA///+//8A/wD/AAABAQEBAAABAAABAP///wAAAAEAAQICAQABAQEA/wAAAAAA/wAAAP8AAAAAAAABAQEAAAAAAP8AAAEAAP7//v79/v8A//7+/v8AAP8AAAEA//8AAQEBAAAA////////AAAAAAAA//////8ABtQGyhPOCQD/f2EO/YFslJ9/bGdmA4GDgRJTbxoIP6kV7xYzpay0zuL9EyBGOaE3scEFxdIxyAUJ+x5CKx3t6cXH8Abt9Q36H/Ts99X6/QAdBvYk+RcfFw4J9h8E+PL++wI+I+cLCufUAenjC/QYBRoV9gTx8efr9PL+DCD8Cf/29v8OAez7AfoKEPYBAPP6+P0BCAEJDAT0CP/8DQT0DPvp/PIFCvv9CAD5DwT/AfL5+AUK+QYK/BH65v3z/wIYBf30/vEBEfUHCAkHAgAHAPHx+PoABAgTBQQJ/fv45//uAwcSFAcEAvLxA/0RAfMLDAgDCPcB9fb96QIKBAYN8/r1BBYIDQXy8Pj++Q8G6//7DAf7CQoF+AYL7vf3BQn2/vj9/gUIAf/+CAoQEgcH+ezw+AbuAQr1BgoSCwsEBgn79gkI+f7/+vgEDQkS/gD//QgLCwQA7vzz//76/v3vDv/5CAAMCvkA9/f7BfoH/+4EBPwSAAgE+QYC8ff//P4ABwb7CggGBwX9+gAG/wAM+PwCAAABAQEB+fYA8v0ECQL/A/z19wYD+PQA/vwIDQoI/gIBAQIC9v7+APUIDfj9BAH+BAT7BAYC/Pb8AwMIBQYGAwoQCf0D+/X5//34APX4+voI/AgGAAb9Bf73AvsB+v8ABQgDBfgFDAED+fb08f75APoG//4HBgP9AgL+/wEAAgIIBAYAAf/5/AL7/f8DAP0C/fwG//wA+/n//QQG+/8JBQP/+Pv//QUH/wT9/wECAQL6Afz9AgL+BgMJAvwA+QEC/AD2+v//AgMD//0BAwH5BQL5AwEABf8BCQABBvj++/z8+QIAAv4A//v9/wH9CQz2/QEE+wQDBQADA/n/Avv9/f0A/PsD/f/9/wD4/AT9/gX9A/8CA/7/Af75AAIDAwEG/wUB//77/v38/wIC/AMBAgT+BPz9Af7/AAIGBAP9+vr8/QH9+wAF+gUCAf0EAPwA/AAEAgcBAP7/+/0DAv8ABAb+/gH6/QQAAgD//gACCQcBA//9+/4D/f0BAAD+AgIAAAP/+wH+/QIAAPv5AAMCBgABAv4C/QEFBAQFBvz//AMB/AX9/QL+AgL+/AP8BQMBBgH/BQEEAgD//f7//AD9/QECAAMB//77AAH+AwH/BAMCBP8ABv4B/f7+/Qf+/f79/QEGBgAAAf77Av/7AAABAQEGAP4CAgMFAP8CAQEB/AABAAL9AAD+BAD+/AABAQP///4BAP4D////AAACAgD9/v3/AAEA/wIBAf/+/gADAgIDAwECAQIAAgD8AAD8/gH//QAB//8CBAEDAgH//f/+/f8AAv8AAAEB/wH9/gAEAgEB/QH/A//+Af4AAgEC/f7///8CAQL+/f4B/QABAP8BAfwCBP//Af78Af8CBgABAf8BAf//Af3+/gD///8BAP39//0CAQMAAQABAAECAf4A/wAA///+/f/+/gABAgEAAf3/Af8CAQIB/v4A//8DAQECAAD///4BAAP//wD/AP4AAf7+/gD+AP//AAECAQIBAAAAAwD//v7//gAA///8/v0AAAADAgMCAgMDA/8DAQAA/AH/AQD9/fv9/f0D/wH/////AAAA/wABAAH/AQEB/wAA+wD+/gD+/v38/v0A/wIA/wABAgEBAf8CAv8A/wEBAQEC/wABAQP/AP/9////AP3+/f7+AwEA//4AAQEDAwICAP4A/wABAAH8/fz+//7+//7/AP8BAAECAQICAv8C/wEA/wH+////AP7/Av8BAgABBP8BAP7///8B/v8BAgIBAf//AAD///3/Af8BAQD/AAAAAf/+/wAB//8AAf/+/v///wIBAgECAgEBAQABAAECAQEBAv8AAAEBBAIEAwICAQAB/v/+/vz+/v7+AAEEAQQDAQABAP7+AP8AAQAAAQABAP8B//7/AP7+/wAAAP8A/wAB//////8AAgH/AQEAAP7//v8BAQD/AP8A/wAA/v/+/////wD/AAD/////AQEA//4AAAD///7+/wAB/wAA/f4AAAEA/wEAAAEBAP8BAgEC/////v///gABAQECAAAAAf///wD///8AAP7/AAAAAQABAQAB/wAA/gEBAQAA/wEAAQEA//////7///39/v7/AAABAQABAAD//wEAAQH/AAEBAgMDAgIAAP//Af8AAf7///8BAAAAAAAAAAIBAAL/AQEBAAAAAP//AP8A////AAD//v4A/wABAQEAAQIBAAIAAQEBAQEAAP8A//8AAP////8AAQIBAf///wAAAf8A/wAAAAD//wAAAP///v7//gABAAEAAP8A///+/v7+AAAAAQABAQEBAQEBAP8A//////8AAAEBAQEBAAECAAABAQEBAQEAAQEAAP8A////////////AgMCAQIDAgICAgIBAQAAAAABAQEAAAABAQAAAQEBAQIA/wD/AQACAP//AAEBAgIBAQICAgEBAQD/AAD//v//AAEBAP8A/wAAAAEBAQECAgICAQEAAP/////+////AAABAAABAAEBAQH/AP7//wD/AQECAQIBAQECAwEAAQAAAAD/////AQEBAP////7/AP8AAQABAAEBAQEBAQAAAAAA/wABAQAAAQAAAAAB"
walking_2:"%%SND0AQEAAAEAAQAAAQABAgEBAP/+/v8AAQEBAQEBAAEBAAEBAQEBAQAAAAD//v///wAA/////////wAAAAEA/wAAAAAAAAABAAAAAQAAAAD//v////////8AAAABAAAAAAAAAAAAAAAAAP////////8AAAAAAAEBAQAAAAABAP//////AAAAAQEBAgEBAQAAAAH//wABAAD//v8AAAAAAAEBAQEBAP//AP//AP8AAAEBAAEBAQEBAAAAAAD///7/AAAAAAAA//7+/wD///8A/wAAAAABAQAAAQEAAAABAQEBAAAAAAAA///+/wD/AAEBAAD//////wABAQEBAQEBAQAAAAAAAAD/AAAAAAAAAQEBAQD///7+/f7//wABAQICAgIBAQEBAQEAAAD/AAABAAD///8AAAAAAQEB/wAA/////gAAAAEBAAABAAABAP/+/v38/P3+/v8AAAAAAAAAAAAAAAABAAAAAQACAgICAgIBAgEA/wAAAAAAAP///v7+AAEBAQEA////AAAAAAAAAQIDAgEAAAAAAAD///4AAAECAQEBAAEAAAAAAAAAAAABAQMDAwIBAQAAAAEAAf////7+/f79/v8A//8AAP///v7/AP8AAQEBAQICAwMBAP///////v7+/v8AAAIBAQAAAAD//f39/f3+/wAAAQECAgIDAwEBAQD//v7+/v7/AAAAAAD/AAEAAQABAQIBAQEBAAECAgECAgIBAQEA////AP///v8AAAEAAAD//wD//////wABAQEBAgEBAQEB/wD//wD///7///7/AAABAf8BAAEAAAABAQAAAgICAAABAgICAf7+/v/+/v7/AQEAAAACAAAA//8A//7+/wAAAQEBBAQBAQABAAAAAAH+/////f7/AAABAQABAQEBAAD//f7+/v8AAQECAQABAQEBAQEA////////AAAAAAAAAAABAQAA/v7///7/AAAAAP///wAAAAAAAAAAAP/+/wD///8A//8AAAAAAQAAAAAAAAP+BQQEAgL/AwEA/v8AAAABAQIDAQD+/wEAAf8AAQEA//8AAAEBAAABAAAAAQIBAAEBAgEA////AAEAAAABAgICAQD/Af0A/wYFCwQDAwQCAv7+AAMDAwD//gD+AP8BAQEAAAEBAAD/AAD//v///v7+/v7+/wEAAAUE//7+/v7///7/AAAA////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AQIBAQMAAP8BAf39Af/9//z//gH///4E9/8D/v4DAQEBAv8EAQEAAQIAAv8CAAIA//4AAgD9//8BAAL/Av8AAf8AAQEA/wH9/QAAAv8CAQMEBf////79/wH/AgL/AQAAAf8A/gD//wEAAAMBAQMDAP/+Av0A///+/f8A/f8AAQH//gAAAgABAP79//8DAgcDBAEC/gMCAgABAQACAQL/AP///v//AAABAQEC/wD9///+/v39/v//AQAA/v8AAgH//wIBAAD//wH///8A/wEAAAABAP8CAgEAAP/+AAMCAQEBAAD/AQQDAgD///79/wD/AAEBAv7/AQIAAAD/AQD/AP8A/wEBAwICAQD/AAAA/gD/AQIBAwMAAP76AgIB/gICAf4BAP3//gAA/gABAv7+AAMA//4A//7+AP8A/f8AAgD/AAD+//8AAgACBAEBAQL/AAEA/wEBAf//AQEAAA0F/AAG+fv8/gIAAAEBAQABAAH+/wEB/wMB/gUDBAIDAQEAAf/+AP///v/+/gEBAAEBAAAB/wEAAAD+Af//Af//AQABAQQBAQD//v7///4B+vv6Af///v4B//wA/wL///3//wMCAf8CAf//AQAAAAABAAEAAf8CAAAAAAABAAD/AQEAAAICAv////7/AAEAAAH//wH//gD+/fz//wD+AAH///7//gADBw0JAwQEAgIA/wAA/wEAAQABAAD/AgECAQAAAQIB/wABAAD///7+//8AAAAEAwAABAACBAD+/v//AAD+/AIA+wD//wD//v8BAAEAAQIA/woMEAcHBQkEA////v4AAf8BAf/9/v8C///+AP4BAQAAAP8CAQEAAQEAAe73+fP4BwgAAf0AAwT//QL9/gAB/P0CAAEAAAIAAwIDAQADAgH+Af8AAgABAgH//v7///z8+v7//v79AP//AAD/AAABAP////8A/wAAAAAAAP7//gAA/wABAQD/AAH/+/z9Af3+////AAECBAH+BAEDAQMBAAAA//7+AP7+AQEBBgYIBAABBgYDCg4B7/0EBQUD//z+//79//8BBAQA/wAA/v8AAP8AAP4AAAABAgP7/f8DAP///QEEAP0AAAAAAgICAAIDAQIDAf///P/9////AwD//wABAAAD/wAAAf8AAf8AAAAAAQD/Af////8A/wD//v8AAQAAAAD/A/wAAAEAAwIAAAAA/wIBAgIAAf0B/gD8AAAA//8A//3////8/QABAQIAAgUDAg0JBgoD/v78AP35+P/9/v38//39AAT/AP8BBPv+Afz//gUCA/4A/AEAAwIA9fwDBPsCBPsAAPr/AAEDAP38AP/9/wT9AgEBCQUD+gP9AP8CBP32/Pj+/f37+/4BAf7+AAD/AwMCAgQBAAcJAwMCA/8BAP8BAP8A/f4A/gUHAAICAwAA/QAAAP0HAvwAAAEEAQAG/gEBAAD/AQD+//8AAP7+/f////8AAP//BAH//gECAf4A/wIBAAIAAQAAAAABAQAAAAEA/v7//v8AAQEBAv3+Awf+Af0ABAACAAEB9wABAPsAAgD/AAD//QD//v8CAAEAAAIB//4AAf///wECAgECAgD/+v/9/v8A/v7//wEAAQAAAgECAgMCAAIAAgAAAQEAAQD//wEAAAIB//8A/v/+/v3//wD+/gABAQD/AAH/AAAAAAL8/fr//AD7AAD/AQD//wAA//8D/gH/AgEBAAH/AAD+////AAAAAAEBAQAA/////////v8A/wD///3+/gAAAQAAAAAAAQEBAQEDAf8AAP8AAAUB//8BAP8A//7/AAH8+/D1/vsFBff4/gECAv0DBgYBAgEDAQEA//8BAP8AAP////7//v///wEBAwADAvz+AAECAQEA/wD7Af4JBQkBAgIA/v39//0AAfsC/P4AAgACAQD/BAIBAgIB/f4KAfwBAgD/AQb//f8DCQH7DBIHC/379P39AwIDAQH9AAEBAv0A//0AAv7+/wD9AQAA/wD9APz6/vYFAAAAA/UFBeX/9/ECA/cBAf72BvMG/ff8CQQH/wcB/wwA/P3/CwDz/A0SD/cC+hAD/QcC/gX+//4B9wMBAP4AAv0C+f4G/AD8+/b59fn9/vwI+QgH/ff39wwY8PQHFQYK+hID/wQF+P8V4vUHAAkE8gsJA/0F/wH/BAMFCwIBBf8LBPb9/vz7C/P68OfyFvsLAQ34/Qb+AvoC+A7x/PwIBvcA+Bb2+gEMBv0A/gAD9wPx+wb/+O/n9Qj38fT/Egvu4vARCAwRFwEK9PAHEfkDB/oRC/f9AgL9+/r48fQFCAby7QkZBPwC+gUIBAgG+AD9+OwAFQvgBgAHAQH9/gAACQ0F/AAEBgD0CP4AEQ76CATy+/AABxD+Cvsy/ewADv8d+f0J8/UEAu/x+vsNBvsD9wH+BgsPAQEIAf3/+fb+AAMBCvwICgYGCv3+/vcIBwHuAPYADQEB//sBBP4EBgsB/QD59RIEAfvuCQH+AwgKCQMBDgIC/gkEAfn8Af0J8wULBf34BwkC+/cFA/YB/vf5Avn8Awb7Avv8/Pz6+wYBAAL8Af3+///7/wEK/fn8//v++/4CAOv8AQHp7fX8/QYPDgX6Av0BAAAFBAP8/f0AAgL9/f78AP4AAfz+AAQH/vf8/f39+f0EAP8EAP8BAP4CAP3+A/4BBAH8BwME+QEB/f3//AD++gD+Af4B//0BAAIGAgH+BAH8/f4B/v0AAQH//wEAAv0CAQ74/AQDAwb9/v74AAADAQP8BQQAAAMEAgH/BAEDAQQAAAD//P////8BAP4AAgD+/wH/AAECAP0AAAECAAEAAf8A/QAA//0BAQD/AAEBAgH/AgECAP///wIAAgAAAP8BAgIBAAD/AQEAAf3+/wAAAP8AAf8A//3/Af8AAP3+/v8BAAAAAf8BAQD///8CAQABBQH7+P0AAf8A/gL9//0BAP8BAf8AAwMBAQACA/8AAf/////9+v79/P4BAAACAAICAf///wAAAAIAAP7/AAIDAv8AAQIAAQEAAP8AAAABAgEB///9/f7//wABAf////8BAAD/AQEAAAAA////////AP//AAEAAAD/AAIBAP8AAQD/AAAAAP7/AQIAAv/++///AAABAAEA/gH//wD/AP7///8A/wABAv4DAQIAAf4AAAMDAAD6+/cB/QP6////AP4B/wD//wD/AP//AP8EAgIBAgD//gAAAQAA///+/wABAgEBAf8BAP///v/+/v7+/f3+/wEA//8BAQICAgEAAQD+/f7+/v0AAP8BAAAAAf4BAAD//wACAgAAAf7///8BAAAA//7+////AAAAAAABAAH//v////38/gEBAAQCAP8D/wAAAP8AAAH/AwIE/wAAAQL//gABAAAAAQD//v8AAQEBAgMDAwIBAAEA/wD+/f7/AAAAAAAAAAEBAQEA/v7//f39//8AAAAAAQEAAAAAAQD///8AAAAAAAEAAgEBAQAA//4AAf///gAAAQABAQABAf8CAv4BAAAAAAAAAQABAQcC+voB+v3+/v79/P7///8CAQIBAwMBAQICAf8BAAIAAQABAAEA//8A////AP7+/gABAgEBAQICAf//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"
walking_3:"%%SND0AQEBAP///wEBAgAA/wAAAAAAAP//////AAAAAAAAAAABAQAAAQAA//7+/f3+//8AAAAAAQEBAQEBAP/+/v//AQEBAQICAQEAAgEBAP//AAABAQAA//7+/wD//wAAAAD/AAEBAAEBAAAAAAABAAAAAAEB/wAAAAAAAQEBAP///wD///7/AAEBAAEBAQEBAAABAQEA////AAAA/wAAAgEBAQEAAAAAAP////7/AAEBAQAA/wABAQAAAP////8A/wABAQAAAAAAAAAA///+/v4AAQEAAQICAgEBAAEBAP/+/v3+/wABAgEBAgIBAgMCAQEA/////v//AAD//wAAAQEBAQEA//8AAQD//////wAAAQICAQEA////AAAAAQICAgIBAAAA///+//8A////AAEBAQAAAP/////+/v///wAAAAEAAAAAAAECAgIBAP8AAAEAAAD/AAEBAQEBAAD///7+/v4AAQIBAQEBAQECAAAA/////wAAAAABAAAAAP8AAAD/AP//AAD/AAIDAgMCAgICAwIB///+/v7///8AAAAAAQICAAEA//////7+////AAEBAQABAgEBAP///v8AAAIBAQEA//7+////AAAAAAAAAAABAQICAAAA/wAAAAD/////AAEAAAD/AAAAAAAA///+/fz9/f8BAQEAAQICAgIBAQAED/cB+wIA/wABAQAB/gEAAAH/Af///v8A/gD//wEAAQABAgEBAP///v//AAAAAAAAAAEBAQABAP8A//79/f7/AP8AAAAAAQABAAEBAAAAAAAAAP/+//8AAQEBAQEBAAEC/wEA/wD//v7/AAECAQEBAQAAAAAAAP8B/////wAAAAD//wD///////8AAAEAAQEBAAAAAQD/AAEBAQEAAQAAAAECAQEA/wAAAAD/AAD//wABAgT/BQUAAgD9/f/+//////7+/v7//wD///////////7+AAAAAQr+/QIFAQAAAgECAgAAAf8AAAEAAQAAAf8AAAAA///+//7/AP8BAgIBAf///wAAAQD////+/v//AAABAAEBAQABAgECAAAAAQEB////AQECAQIDAgIBAQD//v7/Cfr+/QIB/wACAQEBAAEB///+AQAA/v7//f8GBvsCAgIA/wAAAAECAAEBAAD/AAAAAAAA/wABAQEAAQAAAQAAAP0V//39BP8A+wP+/QH//wH/Av8A/wEA/wEAAQEBAAABAAAAAQEBAQEBAf8AAAAC//8A/////v/+AQACAgEAAAAA/wABAAAA//8EAvoFBAL+/wD9/f//AAEAAAEBAAEB///8AP79AAL/AQABAQIBBP0CAQEAAP///////////v7//wABAgIBAgT+Av8CAf8C//8B/wEAAQIBAAAAAf8B/f///v7/AAAAAAECAQH/AgEBAQIAAQEBAQEAAQECAQEA//8AAP//AAEA////////AAD///8AAAD/AAEBAAD6AgD8AgD9/v///wD/AAABAAIBAQABAQEBAQL///8CAQH/AAEBAQAAAP8AAAD//wD//wD///7//wABAAIA////AAAAAQEAAQABAwECAQIAAQIBAAEAAQEA//8AAQECAgICBP8AAAABAP//AQIBAgEBAP8AAP7/AP/////+/wD/AP7+/gAAAf3/AgAAAwEB/wICAQEF/fwFAP7//f79/v///wAAAAEA//4F+gEB+f4AAP4A/wH/AQL/AQECAAAA///+/f//AP//AAEA/wIBAAABAP7///8AAAAA/wMDAgIBAgIAAQH8/AH+AP0B/wABAQICAAAAAf8A/v4AAQEBAQEAAAAA//8A/f79/f///P4A////AP8A//0AAP//AAICAgECAgEBAAD//wAAAAAAAAAAAAAAAAEBAAAAAP////39/v/+/wAAAAIBAQEA//7/AAD/AAD//gABAwICAgUB/AAAAAD///8AAAABAQIEAAMBAAIAAAH///7/AP///wD///7//v/+////AAAAAQAAAAEBAQABAP/+AP8AAQD8/gAB/wEAAwAAAP///v//////AAAAAwEAAAAB//8A/v8A//79/f7//vz+/v8AAAAAAQAD/wEDAAEBAQMCAgAAAf8A//78AAD+AAEDA/8B/wAB//8C+wD/AQH+/QH/AAIBAwACAAH/AQL+AQAB/gD/AP8AAQIA/wH+/wD/AP4A/wABAP8B//oK/fMBAP79AAD+Afr9/AEB/v0C/gAAAvsBA//+AAEB/wEA/AP+//8WHgEK/vgGAPr8+v4DBP0H/PkAAAL8/v8D/gH+Av//AAIEAwEAAP///wP/AAEDAQT/Av0AAv4EAgEBAQD//v3+/wEAAf7yBgy2BAL83h2/BAQPCAnuBgX5Ef8O+gHuAfL4BfED+QHzDdn8BBcN//L99gIE//caCQLz/xL2+PsCAwPwAPoKAP3//PcBBQH9/Pz9//4DAAIA/wQAABQD/gD7AP8AAQIBAP4AAwMABAABAgIA+QX6AAcHBwT9A/4D/QP9AAkK9QEEAQT+AQD+/AH9/v7//v3/Av/5B/j9/wT9/QT+A/78AgAABgECAwAEAf8B+QDm+PcG9gb+BgQECAP+BQISAAwHGxYVAfcLBP0DAAAD9wX9/QD9/vz8/fsAAf/8A/wFAgEEAQIB/wAC/wEA/hwJBgAZ7wf+CwUD9v4BBfQCBPMDA/4B/QACAf78APz///sO/BMK+wMH/QP1/P7/+wEM+//xAwznAh/xAQP++/z3Av4DBPr8CvkH+AEMJfjzBfoB+vr7/wEaDaDY37zX9YuBsLvcve755fQL2yT3/gvZJgRQBoT1f0defzJXJzwpE/rLDuYLDykVwQ+Bp87CmgLi8dAE2//sB/XsB9YFBLjs/BjtAg4y5/qyFpmOhJmm6gfbCRX1FOwF7wL29esG7Qj9+NDU6C0X518A+v3fEwEoFRL8AQUM6Az0FfsJAPL9Exof/vvYxv/vOBczCMbkI/TvwMwP9//++xTtAwDmGhgIGt8XEhML/gYK+w7t+wb4BQoRBQ3wJCQMGRMOHzD94TIO984cB/zvGfbw5OEB+vEMDvU3HI7b6PXvCRD45Pr7Ixf79hvwE/UJRTISHvH40/z79vgD7+4GFyQHFBXt4trdBPsCAdsaFs718fYKvv3z+v/8EA8WCAgE8xED5zEl57/Hf39MPWASIwQ2F+Lq9gXsG+AOBc4P+Pj/9gYQ+en87vr8/QH1/QUEC/TjAvz8VLoV+O4L8u0U3PH68/sJ+gUN+P//AuPm9w3r/gj+BAf4Bfv5/fwDJfEPEer//PkLCBD0AA308PYD9fsI+AcE/AAC/QEFBP3/+/sFAAD1BvkDBf0GAf39/gL+BQv7Agv7BPQGDvoD+gEG/QIF/Ant/wb+DAEE/wL/+QoCAv8B7Q0P9QDW2eEHCAX5Agn5APT8B//t+gIG+vrw+/zjDvr5/xEDFPj+B//8AvQJAgH//v8DBgMCAfv8BP8DBAT+/v7+AAECBP4A/vkB/gD6BgMBAf4ABfwAAwD4BPsFAQb9BwP4Ef3//wP8A//8AgIBAgH9/wD+AwQIBQXlGuQC+PkGBfMHAAH9BAL6Bvz9BvkEAQP8/wUG/wL6AAIA+QL8AQD/A/4AAP0DAv0ABP7+8AIBAPoC/QD//f/+A/4DAQT/AQIF/QAD+wL9+gIBAQIBAgL6Bf7/AwACAAf3+AACAhfwBv3+A/34A/78/gEH/QP9Bf4B/AAA/wT8Bh7lGe/8BQQC/gAF/QYF+QT+/gP7A////wD3A/3pCwr2Bff5Bv4A/fkAABUS8fYB8wj79wEC+AD/AAb+/QMBAAUM/A7+/AMFAAH8AP4AAPwB/v7//wD//P8A//3+AQL+AQAAAP/+/QH//wD//gEA/wAA/v7///4AAAIAAQAC/gL//wEAAAf6DQP2AAb7AwX9AQP8Av4CAP3+/////f7+AgABAf4C/wACAAH/AAEAAwEBAgAB/wEAAfwBAAAAAwACA/4B/gD9///9//79AP0AAQABAQEAAwADAQID+gf9/QAA+/4BAwL/AwD/AQAA//8B/gAAAAEBAQD//wEAAAAC/gABAf8AAQECAAAA/wH+AP//Av0BAP4AAAD/AgEBAAEA/wD//wD+AQL/AQEAAQACAAEA//8B/gH+/gD///z/AAAB/gIAAQAA/v///gH+AP7/AP8A/wEAAv////4A/f8A//8AAgEDAAIDAQEDAQAB//////4A//8BAQECAgEAAP8B/wD/AQAA/gEBAgQBAwABAv//AvwA///+//0A/wL/AgAB/wL+AAD+///+AAACAgICAwICAgMC/f0A///+AP8B/v8A/AH/AAAAAv8BAP/+Af8CAQMBAQH////+//3//v7///8AAAIBAwIBAAL///7+/f7+AAABAgICAwIDAwAA/v///v/+//8AAf8AAP8A/wABAAEB/gD/AAAAAQECAgEBAQEA/////v8A/wD///7/AQIDAgEB//7+/v/+////AAEBAQD+AP8AAP///f7+/wAA/wD/AAABAP//AAACAAH/AAAAAAD/AgECAQAA//4AAP8BAAABAAEBAQIBAQAA/v/9/v7/AAAAAAEBAgMDAwEAAQD/AQABAAICAQEDAgMCAAACAf8B/////gD//wAAAQICAgABAAD/Af//////AP8AAAAAAAAB///+/v79/f7//wABAgUEAwICAgEA///////+AP///gEBAAH//wD////+/f38//7//wABAgEAAAAB///+/v3+/wABAgIBAQAAAP8A/v//AAEBAAAAAQIBAQICAgEBAQAA/wAAAAAAAAABAgABAAAAAP7+/fz9/f8AAAEAAgIDBAICAf////////8A//8AAAECAgMBAQAA//7+/f3/AAIBAgIBAgEBAQEB/wABAQAAAQD+//7//v7+AP///gABAQEAAQEAAQAAAv8BAQMBAf///f8AAAEB/wAAAAEBAwMAAQD//wD/AP///gAA/wAAAQEBAgEEAAAD/wAAAP///wD//wAAAP////8AAP/+/wABAQECAQEAAQEAAP8AAAEAAAAAAP8AAAAA/wD//v7+AP//AQAAAAAAAAAAAAAAAP////7+/v7/AAD/AQICAQMCAgAA////Af0CAQEDAgMDAgEDAQAAAAAA///+/v/9AP7//wADAf0CAP7/AgEC/wAB/wABAgACAgEBAQIAAAABAgAA/wAAAQAAAP8AAAACAQEAAQD/AAAAAAD//v7/////AAABAAD//wD/AP8A//79/fz9/wABAQEBAQABAQECAQAA//8AAAEBAQD//wD/AQD/AP/+/v////7/AAECAgICAQEBAQIBAQD///8AAQEBAP8AAAEBAgMCAgEBAQEAAAAAAAD//v8AAQEBAAAAAAD////////////+/wAAAAAAAAEBAP////8BAQIBAQH/AAACAQEAAAABAQEA//////8AAAAAAAD//v7//wD/AAAA/wAAAAAA//8AAQEBAAEAAP8BAAAAAAEAAQEBAQEAAAECAgECAgEA//////7/AAD/////AAAAAAD////////+/v7+//8AAAAAAAAAAQAAAQEA//8AAAEBAQEBAQEAAAD///8AAQAAAAAAAAD//////wAAAQECAgEBAP/////+/v7+/v8AAAEA////AAABAQEBAQEB////AAEBAQEBAgICAgIBAQEAAQD///8AAQAAAAAA//8AAAAAAAAA//8AAAEBAAD/AAAAAAAA/////wAAAAD///7//v7+//8AAAAAAQEBAQEAAP////8AAAAAAP/+/v7/AAAAAAD//v//AP//////AAEBAQEBAQAAAAD//v7+/v8A//8BAQICAgEAAP//////AAAAAAECAQIDAwICAgEBAAD//v7+/v//AAEBAQECAQEBAQEBAAAA/wAAAAAAAAAAAAAAAAAAAP//AP8AAAECAQEBAP/+/v4A//8AAAAAAgEBAQAAAAAA//7+/////v7+/wAAAAAAAQEBAAAAAAAAAAAAAAABAgMCAQAAAAAAAP8A//8AAAAAAP8A/////wAA////AAH/AAAAAQECAgICAQEAAP///v7//v8AAAECAgMCAQECAQEA//39/f3/AAAAAAECAwICAgEBAP////7+/v//////AAABAQAAAP//AAAA////AQEBAQABAQICAQAAAAAAAAAAAAABAQEAAAEBAAAAAP//AAECAQEBAQECAQABAP//AP////8AAAABAgICAP8A////////////AAEBAgEBAQEAAP/////+////AAEAAAEBAQEA////////AAAAAQIDAgD////////+/f7+//8AAAEBAgEBAQAA/////wAA/wAAAQECAQICAgEAAAD//wD//wAA//8AAAAAAAABAQEBAQEBAQECAgEAAAAAAAD/AAAAAQECAQEBAgICAQD///79/v7//wAAAAAAAAAAAP///wD/AP/+/v7///8AAAEBAQECAgIBAP///////wABAQAAAQEBAP/+/v7/////////////AAAA//7//v/+/f39/f3+/wAAAQEBAgIBAQAAAQECAgEBAQABAAABAQABAQICAQEA//8AAAEA//8AAQEAAP////8AAAD///8AAAAAAAEAAAAA/////wABAQEBAgMDAgECAQECAgICAgICAQEB/wAAAAAA/////v7+/f7+/v7//wAAAP//AAEBAQEAAP/+//79/f7//wACAgICAgEBAAD/AAAAAQECAQIBAgIBAQAAAAD//wAA//8AAAAAAAAAAP/+/f7//v7+AAABAgECAgEBAP/////9/v7+/wAAAAAAAAEBAP///v//////AAABAQEAAAAAAQEAAAEBAQD///4AAAAAAAD//v7///////8AAQAAAgIDAwIBAQEA///+////AAEBAgIDAgIBAAD+/v79/f7/AAEDBAQFBAMDAgIBAQAAAAD///8AAAEAAAEBAP//AAD//////wAAAQEBAQIBAQEA//8A/wABAQAAAAEBAP////////7+/v////8BAQECAgEA/////////////wAAAAD///7+/v7+/v7/AAEBAQAAAAEAAQD//wD//wAAAAAAAAEBAQIBAAEAAAEB//79/f7+/v7/AAEBAgMCAgECAQAAAAAA/wAAAAABAQEAAAD/AAAAAAAA//8AAAEBAgICAwEBAgEB//7///7+/wABAAEBAQECAgEA//////8AAP8AAQEAAAAAAQICAgEBAAABAQEBAQH////////+//4AAQEBAQEAAQIBAQAAAAAA/wAAAAABAgEAAP//AAAAAP//AAD///8AAP8AAQEA/wAAAAAA////////AAEBAP8AAQAA//////7+/wAAAQEAAAAAAQEBAQD+/v8AAP//AAAB//////7//wAAAP/+/v//AAD/AAAAAQEA/wABAQEBAQEBAgIBAAAA////AP8AAQEBAQIBAQIBAP//AAAAAAEBAQEAAQEAAAAAAP8AAP///wABAQEAAP///wAA/////wAAAQEBAQEBAAAAAAABAgIBAAAAAAAAAP////7+/v8AAQAAAAD//wEBAQEAAQAAAP////7////+/v8AAAAAAP///////////v7/AQIDAwMDAgEBAP//AP//AAABAAABAQEBAQH//v7+AAAAAQEAAQEAAQABAQEAAAAAAAAAAAD//wAAAP//////AAABAAEBAAAAAAAAAAD/AAEBAgICAgIBAQAAAAAA//////8AAP/+/v//AP/+//8BAQICAgEBAP/+/f3//v7/AAAAAAAA////AP8AAP/+/v7/////AAEBAgIBAQAAAAEBAQAAAAD/AAAAAAAAAP////7+/v8AAP/+////AAEDAwIBAAAA///+/v7+/v8AAQECAwMCAQEA/////v7/AAEBAQIBAQAAAQEBAQAAAQD///8AAQECAgH///8AAP8A//8AAAD///8AAQEBAAAAAQECAgEB//8BAQAA/wABAQEA/wEAAP//////AAECAgEBAQIDAgEAAP7+/v///wAAAQEBAP8AAAEBAQD///8AAQAAAQEBAAEA/wAAAAAA/wD//wAA/////wAAAAD///////8A///+/wEAAAABAQEAAAAA//7//////v///wAA/wAAAAEBAQAA/wABAQABAQEBAgICAQH/AP/+/v7+/wABAAAAAAABAAD//////wD//wEBAgMCAQEBAAABAQEAAAAAAAAAAQEBAQEAAP//AAABAQECAgICAQICAgEBAQD///3+//7+/f//AAEAAAD///8AAP///v7+/wD/AAEBAQICAgEBAAEBAP8AAAD//wABAAAAAQEBAAD/AAAAAAD/////AAEAAAEBAQAAAAEA/////v/+/v7//wAAAAAAAAABAQAAAQEBAQEBAQAAAQICAgIDAgH//v8AAAAAAAAAAAEBAP////8A//8AAAEBAQICAQAAAAD//wAA/wAAAAAAAP////////7+/////wAAAQEBAQAA/wABAgEBAQEAAAAAAAAAAQICAQAA/////wD///8AAQEBAQECAgEAAP///////v//////////////AP/+/v8AAQEBAQEBAQEBAQAAAAABAAAAAQEBAAAAAAAAAAAA/wD+/////v7//wAAAQECAQEBAQD+/////wAAAP//AAECAgIAAP/+/v7//v8AAQEBAQEAAAABAQECAQABAQECAQEAAQECAgEA/////////v3+/wAAAAEBAQEBAQEAAAABAQD//wABAAEBAQEBAQIBAP//AP//////AAABAQEBAAAAAAD/AAAAAAABAP//////////AAABAQIBAAAAAAAAAAAAAAAA///+////AAAAAAD/AP/9/v3+/v/+/v8AAAAAAgEBAAD//////wABAAABAQECAQEBAQEBAQEAAAAAAQEAAQEA/wAAAP//AAAAAgICAgEAAP////8AAAD//wAAAP7+/wAA//8BAgEBAQICAgEBAQEBAAAAAAABAgIBAP/+/v7/AAABAQAAAP//AAD///7/AAAAAAAAAAAAAAEBAAEBAgEB///+/wD/AAAAAP8AAAAAAP////8A////AAEBAQIDAgEBAQEA//7+///+/v7/////AAEBAQAAAAD/AAABAQEBAQAAAAAAAAAA/////wD////+/wABAP/+/////v8AAAAAAAABAQEBAQEAAAAAAAAA///+/wEBAQEBAQICAQAA//8A/wABAQEAAQAAAQIBAAAAAAD///8AAQH/AAAAAAAAAAAAAAAAAQICAQABAQICAgICAQEBAQEAAP////////8A//8AAQABAQD//v7+/wABAAAAAQEBAAD//wABAQAAAAD////+/v///v4AAAD//wAAAAAAAAEBAQEBAgAAAAAAAAEBAP////8A/wAAAAAAAAAAAAD/////AAEBAAD/AAAAAAD/AAEBAAECAQEAAAD///////8AAAAAAQAAAAABAQEBAQAAAAAAAAAAAQECAAAAAP///wAA////AAAA////AAAAAP//AP//////////AAAAAAAAAQEA//7///7/AP8AAAEBAQEBAQIBAQEA/////wAAAAAAAQIBAAD//wD//v7+//8AAAAAAAAAAAABAQIBAAAAAAD//wAAAQEBAQECAgEA//7+/wAA/////wD/AAABAQEAAQEAAAABAQEBAAD///8AAAAAAAD//wAAAAAA//8AAQAAAQAAAAAA/wD///7+/wAAAQECAQD//v3+/v7/AAABAQEBAQEBAQEBAQAAAQECAQAAAAAAAAABAAAAAAABAQEBAQEBAAAAAAEBAAAA////AAABAQEBAAAAAQIBAQAA///+/v///v7/AAAAAQICAgEBAQEBAAAAAAAAAAAA///+//////////8BAQAAAQAA/wD//v7+/v8AAQEAAQEBAQEAAQEA//7//v////4AAAAAAQD/AAEBAgEBAQABAAEAAQECAQEAAAEAAAECAQIBAP8AAAD/AP8A//7/AAEBAQEAAQEBAAD//wAAAQAAAQAAAAEBAQAAAQEBAAD///8AAQEBAQEAAAABAQECAQEBAQEBAP////////8A////AP8AAAAA/v7/AAAAAQECAAEBAQEA/////////v//AAECAwIBAQABAQD/AAABAQEBAQEBAQECAQAAAAD//wAAAAED/v/+////AP8AAAAAAP///wH//wIBAgIAAf7/AAEBAQEBAQEAAAAAAQAA/v///v3///////7//v8AAQEA/wAAAP///wD+/v8AAAD+/wAAAQIBAAACAP8BAAACAP4AA/4BAgD/AAD/AQD//wD/AP///gEAAAABAP/////+/v//AAABAQEBAQIDAgIAAQEA////AAD/AAAAAQEBAgICAQEAAP//AAAAAAAA/wD/AAEAAP///////v/+/gD+Af7///7////+//4B/wAAAAABAQEDAv8DAQEBAgIB/wABAAAAAQAAAAD//wH///4B/wD9Af4AAQEBAQAAAP8AAAAA////AAAAAQEAAAH/A///Av3///8BAQEBAQMCAAEAAAD//wAAAP8AAAAAAAAAAP//AP/+AAAAAP8AAf8DAgACAf8B/wAB/f///f//AAAA//7+/v8BAv4AAP8AAAEBAQD/AAABAQAA//8AAQAA/wEC/wL/AQD+Af//AAAAAAAAAQEAAQACAgEAAQAAAAEAAQD/AQIBAAABAgEAAAAA/gAAAQH/AP4A/wABAwICAQICAgMCAv////7+/v7/////AAD/AAD/AP//AP8AAAEAAQEBAQD///8B///+AAAAAQEBAAECAAD//wD+/v//AP///wH/AAABAgD/AP/+/gAAAAP6AP4BAQACAQABAv8BAAD//v7//wABBf0ABwECAwICAQAA//7/AAEBAgEDBwX6C/3/AAD+Af7+//8B/wAB/wAAAAICAQIDAQL/AP////7///8AAAEAAAD/AAAA/wABAAD/Av8AAAEAAQEBAAD////+//8AAAH/AAABAgECA/0D/wAA/wAAAAEBAAAAAf8BAgH+A////wIAAQEBAQEBAAAA/v4A/wD/Af//AAIBAQECAQEBAgIB//8AAAD+AAEBAQAAAAAA//4A//79/v7/AP8AAAEAAQEA//4A/gH/AAD//gkO9wEF/vcD+/8AAgMBAQABAAABAv0CAQAAAAL///8A////AP///v7+AAAAAf8AAP3+/v77/fQAAQH8AwABAQECAgP/AwAAAAAD/wEAAwEBAQIDAQEDAgEHAQb6/AEBBPYCAf0E/AAA/f8A/AD//v4AAAL+AAIA/f7/Afr7AfwC/gACAAABAgQCAwABAf79AP0G+AMCBf8CAAIBAAAB//8A//3/Afz/AAEBA/8BAAABAQD/AP7/Af79/f8AAAABAf8A/wICAvj//v8A/AMBBAMABQIBAwAAAP8AAAL//gD//wEG/AIBAQAA//3//f7//gD9//4BAAEC/wEC/f3+Afv9//0A/gAA//8A/P3///7/AAD//wEAAAD/AwAAAQUABPcECPwA+wEA/QEEBfwE/P//APv9/f/9/gH/Af8AAv8AAgAAAQIC/QAAAAD/AQABAAP//f4DAQH/AQAAAv8CAAECAwAEAwMCAQIAAQP+/gL9/v4B/wAAAP8BAgT+/gEA/wD/AP8BAAID/gEBAgIDAQAAAQECAAEA/wEAAQMBBAb1/A4BBPkH8wL/Av8DAQD/AAEBAf//Af//AP4A//8AAAEAAgICAf4BAQH/AgH/AP0E//4BAQH/AP8A//8AAAICAAEA///9BwAC/v8C+/79/P4B/wEAAQQBAgMAAgAAAfwA/v///gEAAgL+BgMB8wv6+fwEAQH/AQIA/v/+//8AAAH+AgEA/wADAQAA/wEBAAECAQED/v7+//8A//0C//8BAAEAAQEBAP8BAAAAAgABA/3///8C/f8AAP8BAgIAAP8D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/v0C//79//4A/wH/AAAAAQECAwIBAQEAAAAAAP3+////AAEAAQEBAgEAAP8A//8A///+//////8BAf8BAAD+/////wD/AQEAAP8BAgIAAQAB/wEA/gD7AwEAAwICAwMCAQH////+//7+/wAA//8BAAEBAAD//////wAA//8AAP8AAf8AAAEAAAEBAAABEPf1AfYHBvr5Av4F+wP//wACAQMAAgAA/gEBAAAA///+AQEBAAAAAAAB/wD/AP8AAP8AAAABAAAAAAAAAQEBAQEBAQD//v4AAAEBAQICAQIAAQD//wEAAP8A//8AAAABAAABAQEBAQEAAAH//v/+/v3+/v///wAAAgEB/////////wIA/wD+AQMB/wEAAf//////AP///wAAAAAAAQEAAf/+/f39/v///wEAAQICAQIAAAICAAD9/v7+/wEAAAD//wABAgEBAAEAAQD+/v//AAAAAAACAQAAAAAAAAAAAAEAAQEBAgD////+/////////wEAAQIBAAIDAwAA///+////AAAAAAABAAABAQEAAP/////+/wECAgEBAgIBAQAA//7+/v4AAAAAAQECAgIBAf///v7+/v///v7//wEAAQEBAgICAgAAAAEB/v8AAP///wAAAAEAAAEAAAEAAAAAAQD///8BAQIBAAAA//8AAAD/AP///wAA//////////////8AAAAAAQEDAgAAAP////////8AAAAAAQAAAAEAAAAAAAAAAgEBAAEBAAAAAQEAAQD///7+/v7+/v8A////AAECAgEAAAAA////AAAAAAABAgMDAgEBAgEBAQH///7///8AAQICAgEBAAAA/wEBAAAAAP7+//8AAQAAAAAA//8AAAD//////////////wABAAAAAAEAAAEBAQAAAAEBAQEA//7+/////wAAAAD/AP///gABAQIDAgEBAQAA//8AAP/+/v/+/v4AAQEBAQEAAAABAQEAAAAA//7+/v8AAAEBAAAAAAABAQEAAQEBAAAAAAEAAAAAAAAAAP//AP8BAgIBAgAA///////+//8AAAEAAAAAAAD/AP//AAD/AAAAAP//////AAAAAAAAAQEBAQICAgECAgICAQABAQD///7+/f7//wD//wABAQEBAQD+/wAA/wD//wAAAAAAAAEBAQIBAAAAAAAA////////AAAAAAEBAP//AAAAAQAAAAAAAQEBAQEBAQEB/////wD///7+/////gABAQEBAgIBAQEAAP///wABAAAAAQEBAQD//wAAAAD///7/AAAAAAAAAQEBAP8AAAAAAAEBAAD//wAA////AAAA/wEBAAEBAQEBAQECAAAAAAAAAAABAQEBAAEBAAAAAAAAAAD///////////8AAAABAQEAAAD/AAEBAQEAAAEBAQEBAQEAAAAA/v7+/wAAAQAAAgICAgEBAP///wAA/wAAAP8AAAECAAD///7//wAAAAD///7+/v7/AAAAAAEAAQIBAQAAAAAA////AAAAAP8A//7//wAAAAEBAQEBAQEBAgEAAAD/AAAAAAEBAAACAgEBAP////8AAQEBAQD+/v7+////AAAAAAABAQECAgEAAAABAQAAAQABAQAAAQAAAAECAgEBAQABAAD///////8AAAAAAAAAAAAAAAD//////wD//////////////wAAAAAAAAEBAgICAAAAAAEBAP////8AAQEA/wAAAP////8AAAEBAAABAQAAAQAAAAEBAQEBAQAAAAD+/wAA////AAD//wAA////AP8AAAAAAQEBAQEBAgICAgD+/v7+/v7+//8AAAEBAgIBAQAA///+/v7+/v4AAAAAAgEAAP/////////+////AAABAAEB//////8BAQICAgIBAQEBAQABAQEBAP///v7//wAAAAAAAQEBAAEBAQEA/v7/AAABAgIBAQEBAf///wAAAP8AAAAAAAEBAAD//wD///8AAAAAAQEAAQECAgIBAQEBAQAA/////v7+/v7+//8BAgEBAQH//wD///8AAAAAAAAAAQEBAgEBAQAAAQD/AAEAAAAAAAD///8AAAAAAQEBAgICAQEBAQEBAAABAQEAAP///v3+/v7///8AAQEAAAD///8A//8AAQAAAAECAgIBAAD//v8AAAAAAAEBAAAAAP/////+/v////7+/wABAQEBAQEAAP////8AAAD+/f7///8AAAAAAP///wABAgEBAAAAAAAAAQEAAAAA//8AAAEBAAEBAAAA/wABAQABAP//AAAAAQECAgECAgIDAgIBAAACAQEAAAAA//8AAgIBAQEAAQAAAAABAQEAAQAAAQEBAgIBAf/+AAABAQEAAP/+/v8BAQD//v7//wAAAP8A////AAAAAAABAQICAQICAQD//v7+/v7+//4AAAAA//8AAQEAAAAAAQEA///+/v7+AP///v8AAAD/////////AAD//////v7+////AAABAQEBAAAAAAAAAAAA//8AAQEBAAAAAAD//////////////v//AAEBAAAAAAABAf/++wX+Av8A/QD+//7///8AAAD///7+AAABAQEBAQEBAQABAQECAgICAQD/AAD/AP4B/wAAAQEBAAEDAgEBAQEA////AP4AAQAB//////8AAAAAAAD/////AQEBAAABAQEAAQEBAQIDAwMBAQABAAAAAAD//wAAAP////8A///+//8A////AAAA//////8AAAAAAP//AAAAAP///wABAQEBAQEAAAAA//8AAQEBAgIDAwIBAQD/////AP/+/v79/f3+/v////7/////AAEAAAEAAQAAAQICAgICAgIBAQICAgMDAgEBAAEBAQECAQECAwMDAwMDAgEAAQEBAAAAAAD/AAAAAAD//v///v7//wD////+/wABAAEAAQEBAAAAAQIBAAAAAAACAgEBAQD//wABAQAA/wAAAAAAAAD//wABAQEAAQAAAAAAAP8AAAEA//7//v7+/v7/AAAAAP//AAD///7/AAD+/v8AAAABAQICAQEBAQEBAAAAAAD//wAAAQEBAQIDAgICAf//AQEBAQEAAQAAAQABAQIBAQD//vz9/v7+/v7+/wABAQIBAgEAAAEBAgEAAAAAAQMCAgEBAgIBAgICAgEAAAD///8AAQEBAQEBAQEAAAEAAAABAAAAAAEA//7+/v7+/v3+//////////8A/wAA/wAAAAEAAAAAAAAAAP/+///+/f39/v7//v7+//7+/////v/////+/f3+/v8AAP/////+/v7+/v7/////////AAD///7///8A//////////8BAQABAQAAAQAAAAD////////+//8AAQEBAQAAAAEAAQEBAQEBAQECAQEBAAABAQIBAQAAAQAAAQEAAP///gAAAQEAAAEBAgICAQEBAAD/////AAAAAAABAQEBAgIAAP/////////+//8AAAD/AAEBAAABAQEAAP///v3+//8AAAABAgD+/v/////////+/v8AAAAA/wABAQAAAAAAAAAAAQAA/wD///39/f7///8AAQEAAAECAQEBAAAA//8BAQEBAQAA/wAA/////wAA/////wAAAAEAAAAAAAEBAQEBAAAA////AQEBAQABAQAAAQEBAAAAAP///v7/AAIDAwMCAgICAgICAQEBAQABAQECAwMCAgEA/////wAAAAEDAwMDAgICAQEA/wAAAAEAAAEBAQECAgICAQECAQEAAAD/AAD/AAABAgIBAgIDAQECAgIBAgECAgEAAAD/////////AAD//gAAAAD//wAAAP8A/////v//////AAAAAAABAQECAQAAAP////7///8AAAAAAAABAP//AAEBAAAAAAEBAQAAAAAAAQEBAQD///79/f7+////AAD/AQEBAAAAAQEA/////wECAgEAAQECAgIBAP//////////AAEBAgEBAQEBAAAAAAAAAQEBAf////////8AAP8A//8A/wABAAAAAAAAAAEBAP///wD//wABAAAAAQEBAP///v/+/v7+/gABAQEBAgICAAAA/wD///8AAP8AAAAAAAAAAAAAAQEAAP8AAAAAAQAAAP///////wAAAAD/AAD/AP8AAQABAQEA/wAA/v39/v79/v7+/wABAgIBAAAA///+/v7////+/v///v//AP/+/v7//////wAAAAD///8AAAAAAAAAAAAAAQIBAP///wAA//7/AAD//////////v//////AAD///8AAAEBAQEBAAEBAQECAQEBAQEBAQEBAQEAAAAAAQEBAQEBAQABAQD//wAAAAEBAQD/AP/+///////+/v7+/v8AAQEBAQEBAQAA/wABAQIBAwMCAgICAgICAQEA/wAAAAEBAQAAAAABAQD///8AAAAAAQAAAAAA//7+/v///wAAAAEAAAEBAAAAAAEBAQABAAEBAQEBAgICAgIBAQAAAAD//////v//AQEBAAD//////////wD/AQEBAP///////wD//wD///7//v8AAAD//////wAAAAAAAAEBAQEBAAAA//7+/v7/AAEBAQD/AAAAAAD///7///7+/wABAQABAgIBAQEAAAEAAAAAAAAAAQIBAQEAAAEBAQAA//7+/wAAAAECAwQEAwMCAQEAAQEBAQAAAAAA////AAABAQABAQEBAgEBAQAA//////8AAAAA////AAEAAAAA/wEBAgIBAQAAAAD//v7+/v7/AQEBAQEBAAAA/wABAAAAAAEAAAAAAAEAAP////8AAAEBAQAAAAABAAD/AP//////AAAAAgECAQD/AQEBAAD///8AAP///v7+/wEBAQECAgEAAAAAAAAAAAAA/////wAAAAAAAAAAAAAAAP//AAAA/wAAAAEBAgEBAAAAAAAAAAD+/v7//wABAgICAQECAQEBAQEAAQECAQEBAQIBAAAAAAABAAIBAAAAAAD//wABAQIBAAEBAP//AAEBAgEBAQEA////AAEBAgICAgICAf///////////////wAA/v7/AP8AAAEBAQAAAAD//////wD//v7/////AAD/////AAAAAAAAAAD/////////AAAA/wAAAAAA/wAA/wAAAP/////+//////79/f8AAP8AAQEA/wABAQECAgEB/////wAAAAABAAECAgEBAAAAAQAA//////8AAQEAAAEAAQD/////AP///////wD///8AAAAAAAEA/v8AAQEAAP////8AAQEBAAAA/wABAQAAAP///wAA////////////////AAABAQEB///+AAABAAAAAQEA////AAD//wD+/v7//wAA/gAAAQECAgEBAQEBAQAAAP8AAAAA////AAEBAQEB//7/AAD+//4AAQEAAAAAAQABAAAAAAAAAP//////AAAA//7+/f39/v//AQEBAAABAQECAQEAAAEBAQEBAQAAAAEBAP//AAEBAQABAQABAAEBAQEBAAEAAAEAAAAAAAEBAQIBAAEBAQEAAQAA/v//AAD/AAABAQICAwMDAwMBAQAAAQECAgIB//8AAAD//////wAAAAAAAQEBAQEBAP//AAAAAP/+/v3+/v///wAAAAEBAQEBAP/+/v3+/v//AP8AAAECAwIBAP/+/wD//wAAAAAAAAD/AAD/AAECAgICAgEBAQH//////wACAAEAAQABAAIAAgEAAQEBAQEBAQD//////wAAAf8AAAIDAwMAAQEAAP//AAAAAQEAAAABAAAAAQEBAQEBAf8AAAAAAQAAAAAAAAAA///+/v/+/gAAAQEBAAD/AP////////////7/AAAAAQECAgECAgICAgEBAQEAAP///wAAAAD//v//AAAA//8AAAAA////AAABAgEAAP////7+/v7//wAAAAABAQEBAQD/////AAAAAQEBAQIBAQIBAAD//wAA///+/////////v//AAD+/f7+/v7///8AAAAAAAEBAQIBAP8AAAAA/wD//wAAAQAA///+/v7+/////wAAAAEAAQECAgL/BAAA/wACAP4A//8C/gAD/QECAQABAQIAAAD//wAAAQABAQAAAAABAAEBAQEA/v/+/v8AAAAAAf7+Af7/Afv7Af8AAAH/9wT/AwD+AQP+AgH/AP7/Av3/AAAB/wAAAAACAAACAQEA/wAA///+///+AP8AAf8AAAEBAQABAQAA/v7+//7+/wAAAQIBAQAAAQIBAQAAAAABAf0CAvIAAgIC/wECAAEDAAEB/wABAQAAAP8AAQACAf8DCP0B/QEA//8A/wD//v7+///////+/v79/f7+/wAAAQEBAQACAgIBAP8A//8A///+/wEBAQEAAQIAAAD/AAD//wAAAAAAAAABAAEBAAAA//0A//7/AQEAAQEAAAAAAP///wD/AAEAAQABAgEBAgEDAwMDAgICAQH/AP8A////AAAA/wAAAP////8AAAAAAQEBAQABAQH//v7+/v7+/wABAQAAAQAAAAEA////AAD/AAABAQABAQEBAAEAAP/////+/v7+//8AAAAAAQIBAAD///8AAAH++QoBAf4CAv0CAQAA/wH//wD//gD+AP//AQABAgEA/wABAQAAAAH//wEBAQEBAQEA/wABAAAAAP8AAAAA///+AAEBAgIBAQD///////////7/AAABAQEBAQACBgEB/QEBAQD///7//v//AQAAAAEBAgQDAgIBAwICAwIAAQEAAQIAAP///wEAAQEBAQEBAQABAP7///4A/gABAQABAQEAAQICAgIAAAAAAAEAAQAAAP8AAAAAAgEBAQABAQACAQIBAQICAgEBAf8BAQD//fz8/f7+/f7///8AAf8AAAD/AQAA////AP7+AAAAAAEAAAD///8BAAAA//7///7+/v8A/wAA/wD/AAACAQAAAAAA////Af8B///+AP8AAAAAAAAAAAABAAAA/wAAAQICAgIBAgEAAAAA////AP8AAAAAAAAAAAD/AQD+Af//AAEBAAIBAgEBAQABAQEBAQAB/gD+AP3/AAIAAQAAAAAA//8AAAD//wAAAAABAQAAAAABAQEAAP8AAP8AAAD//wAAAAEBAAAAAQAAAAEAAAAAAAAAAAAAAQAAAAAAAP/+/wAA//8AAAABAAAAAAAAAQIBAQEAAQAA/wAAAP////7+/v7//////wABA/r7/QL+APz//wAB/wIBAAEBAgEBAP8A/////v8AAQABAAAAAAAAAP8A//////8AAQEBAQEBAQAB//8E/wH8AQD///7+AP8BAAEAAAEA/wD/AAABAgIDAQH/Af8BAwICAwICAgIBAQECAAAA//////8AAAD/AAEBAQABAgICAQEA/wAAAf/+/v7/AAEBAP8A/wAAAQIBAQAAAP//AAD+//8AAQEAAQAC//////7/////AAD//wAAAAEBAf8AAAD///8AAAEBAgIAAAAA///+/////v//AgL/AAEBAwT/AgAA/gD8AP4B/gECAQEBAQEBAAICAAAAAQIB/wD+AP//AAABAQIBAgICAQUE/gL+AP8C/wEB/wAAAP8A//8A//8AAAIAAQEA/wAB/f/+////AP8AAAEBAQICAQEBAAEAAAD//wEAAP//AP8A/////wH//////v8AAAP/Bf8DAAL/Af///wD///8AAQICAQIAAf4AAQD//v39//7//wABAQABAgMBAQACAAEAAQEBAgD//v79/gEAAAEBAAEBAQAA/wEAAQEBAAAAAAAAAP3//v7+/v///v//////AAECAQAAAQICAwED/wEA/v8BAgEAAwECAgICAQMEAP8CAP//AP8AAfwCAP8CAQH/AQEAAv8BAQABAP8A/v//AP/+AP8B//4BAAECAgIBAAH/AAEB/wD/AAEBAAD/AAAA//8AAQH/AAAA/wH6/P/6AP39/f79APwA/v/+/f//APsEBwEEA//+////Af7+AAEBAAD//wD/AP8AAP///wD//////wD+//8AAgAB///+AAD/Bv4D+gP+/wECAAEAAwMB/wD+AQH/AQEBAQD///8BAQECAAEAAAAB8QAAA/4D+gAD/gD+/v75AwEABf8BAAH/AAABAAAAAv8BAAAAAAD//wIAAgABAAAIBPT5/vr6/AIAAQIBAAEBAP/+AP4B/f7/BQT7/AL9+vsA/////v0AAAH//v7+Af8AAwABAf8BAAICAwECAP8B//8A/wAAAAEBAQAAAgH/AAH//wD+Av8A/wT/AAD+/f//Af//AP4A//7+AwLtzBUSNTv2+vvnBgwFAfcI/AT69wD8AwYC+wL++P3+AAH+/gH+/f78/gACAQAC//8C/P/+/gD////+9gMGCAACAvPrEPL6AQABBQIEAgIEAf/+/gT8//4EAQn9BQADAgECAf8BBP39Af4B/v8A/f7/AAABAgEDBP77AgEBAQAA/wECAwID/PkE3uARAw/7Dvv5BQcH9//9/gIAAQAC//8CAAbr/f4R9fj/AAT9APwA/gH7APoB+//8/f//A/38B/4BAQACAQFUB0YuLQwA9gQGDQL6CQIF/gH+BPsQ/P8D9f4AAgvw+kvq9vwK+xkXCw77BwAGBfv4BR3pk38fG38mV2oRRR3/Afn9+Qj2CwUGGQcZBwgDCgUnerJ/e/B2HjZWAwEg8Q0FDAAVBgUM/wn//gMD8gD78gH2BPsC/P3+AgP6BwP/on8IJUaBQcrwM+IMD8xO1izx6Cj2AyXnAgH3CPUAAPoOM9dSJPzTuyXDQ/vuO9gJGt0f8AIOx8gO+wYBOOYg+Snn/QEF9w7NSwXhLq0U5BjVf/sQbtYiFNkKAt8S+ADhFuMXEgAR9wf0HPMZOqAJULpL0pUJDbqoCX+Bf83XKr/kFM7fLBz3J+jtFf0MC/MI+/IL/vX9BPEV8fUQ1gT5+QYBDSfd5BT28RsH7goCxh0Y6j3D+AnyCvD4+usI/+bq7SQqO/AJKt0cGdy3V/YG/ScEG/fx9xDgIe/87vAQ/UaO23yBG/D5JRUKOsYTIf8SLDUY/vbZ8A33+Pjr8RMF6QvpE/boECDTHwX4BgX+BfkO+/oG8evy//wDBvkF9ysQ2BYs5CnzGhIlgX+B9kq0xxIAOQv5wOgEMQ3vGeERCN3KIO3n/+oHCfwACvkOBPQTGPEPCfoK8/ss5fYT0fPUAwDkxwMB+gYo+NDuG9oo/esX+ukg+fUT9O40HewJLfUMB+YM9AIEAf8X4eX/8fMe3/ce2SIP7gMR9f3/BtwlvQcv++MTCusMFNwd9fIOBgsT7vkECAL++fn49/gVB/QGBAcG9wj7CfAUAvch5icf2i4C7SEY+xfd+CMV5/4BAuQy1f0E+9cQAw0RE+wlPP0QDAT1Bu7jLYnnf5QnOe4T9O0p2foOCe/u+vH//PsH/esU+foGBQL6CgT+BAMB//oH8wPv5Qn86wXzBxvVDQ36CwTu5u/j9AL09fn8EgIN/gz7CPvyBf35E+7Q6fft/RoG/Pr7/QcD+Avx+RPw+Q/x+hLnBgbwCgP5CvsE/fgC+AAE/v4E+gIE8vX1AwAA/QYB/vMK7v/+//gR+AT+BAsQ+Q8E+AL8+Pz/+/wC/gL/+Av4/wX//P4A/f78/PsD+wf9/wX+BAD+AAL8/QP8AQH6AwL+/vgRAv0G8u8L+u8QAv4FDgX7BwP9CQ75BAYEAf0B+gL+BfoC/QEAAAAFAP8BAfwAAf8CAgL+AgEAAQP/AgX/AP/8AvwCCQH7AAQABv7+/wD9//3////+/gD/AAAAAv4AAAH/Af0A/P/7AfoA/QEA/QD+APkC/v77AP4BAAABBAIBAwMDAAH+AQIBAAAEAAD/Af4D/wH//gH+AP0AAAH9AQAA//8CAQL/AAH/AAEAAQIAAgD8AP//Af0CAAECAQT/AQH9AgAC/wAA/QD/Af4D+ggD9wL9+/8D/AL9Av3+//0A+/z+/gD/AgIB//8C/wIBAgEAAf8B/wL/AAECAAH/AQEA/v8BAQQBAf8CAQABAf/+/gH/AgACAQQAAQD///8A/v/+AP7++vr+AwH+Av8AAQAA//4AAQEHEA7/BQICAP//AwIAAwIBAP///wAA/f////8C//4B/v///gIA/wEA/wT/Av7+//7//v/9AP/+AP7/AQIAAAD+Af4CAQICAQIDAQMBAf8BAP8A/gAA/wIC/wIBAQAC/wD+/f7+A/sB//8DAQEAA/0A/wAAAP8AAP8BAQAAAAD/Av4AAP4A/f7//////wABAgIDAAMCAgEAAwIAAQABAP8B/f////////8AAAAA///9AP4A///+//7//v8AAP8AAP8AAAEAAAABAQACAAD/AP8AAAAA/wD///8AAAMAAf8B/wL/Af8BAgMBAf7//f//AgH/Af8AAgH/Af8BAAH/Av8AAf4A//7/AAABAAIBAwMDAAIA/wEAAQMAAQAB/wAA/v/+AAEAAQEAAAAB/wH+//7//v//AP/+AP8AAAH9Af8AAQAAAAAB/wAA/wAAAgABAAEBAgEAAgEA//8BAAD9/v7/AP8AAAH/AP8BAAAAAf8A//8A/wEBAgIAAQABAQMCAQABAP8A//8AAQACAQIBAAAAAAEBAQEAAP8A//8AAAABAAAA/wEAAP/////9/////v3//v8AAAEAAQABAQIAAQABAQD/AAEB/gH/Af///v/9/v//AAABAQIBAP///wAA/wAAAAEAAAEAAQABAAEAAAAAAAABAQEAAQABAAEAAAAAAP8BAAEAAAABAQECAQECAQEBAQAAAAEAAAABAgEBAAABAAAAAP////7///4A/gEBAAECAf8A////AAD//v79//3//wABAAD//wAAAAEAAAABAQABAAIBAgECAgAB/wH///4A////AAAA//8AAQD/AAH//v7///8A/wAA/wD//wABAQAAAAAAAAAA//8AAQAB/wAAAAEBAAEAAP8AAAECAgICAQIA/wD+//7+/v4A////AQECAAD/AQAA////AP8A////AAECAQIB+wX+//sA+gD+AAD///8AAQAAAP//AAEAAP//AAABAQECAQEBAQEAAAD+////////AAEAAQABAAEAAAABAAEBAAEAAAD/AAEAAQAB/wD/AAAAAQAAAAEBAQAA///+/wAAAAABAQECAgIBAQMBAgEB////AP8AAgEBAAAAAQEAA////QD+AAAAAf8AAAAAAP7//////v7+/v4AAQECAQEBAAAAAAD//v7+/gABAgICAgICAgICAQEAAP8A////AP8AAAEBAQICAgH//v3+/f7+AAABAP////8AAAAAAP8AAAEBAQEBAQABAQD//wAAAAABAgIBAQEBAQABAf///wAA//8BAQ=="
walking_4:"%%SND0AP8C/QIAAgIDAAAA/wH/AAAA/////wAAAAH/AAAAAAAA/wAA//0A/v//AQADAQIBAgD/AgEAAQIBAgEAAAEBAgIBAQH/Af/+AP8A/wD/AP/9BwIBAwMAAgACAAIA/v8AAAAA/wABAQEAAQEAAP8AAf/+/v7///4AAP8BAQAA//8BAAAAAAD//f7+//39/f//AQD//wD/AP8B/wAB/wAC/wEAAf8B/wEBAAAA//8A////AP8AAAD////+/f3+/gAAAAECAAD//wEBAAIAAAABAQIBAQEBAQEAAQAA//7//gEAAQEAAQEBAQICAQIBAP///v77+wT/Af4BAAABAgL///7///8BAAD+//8AAAEBAQICAgAAAQECAgAA/wABAQAAAAH/AAH//wD///4AAAAAAP8BAQAA/wAA//8AAAAAAP//AAAAAQEBAQAAAAABAP///wABAQEBAQAAAAAA//7/AAEBAAD//wAA/wEAAP8A//7+/v7/AP///gP+Av0AAAAB/wD/AgEBAP8A/wH//wAAAAD/AP/+/f39/v7//v/+AAAAAQEBAQECAQEAAAAAAQEBAQACAAAAAAAA/wIAAgAA/////AIAAwABAgACAAABAQMDAgEAAP7+/f79//8CAQIB////Av8B/gABAQECAQIA/wAAAgEBAgICAf8A/gD9Av/+/wD/AP0D/wABAQEBAgECAAIBAQAA///9Af8AAAEAAgICAQEA/gD//////wD/AAEAAP8AAAAAAAEAAAABAQEAAAD///////7///8AAAECAQIA/gD+AQECAAEAAP////8A///+AAAA///////+////AAABAAAAAP//AP//AAAAAAECAQEAAAAAAQEBAQD///v1Dvb3DPsCA/4F//8D/gEB/wL8/f/9//wB/gICAQL/A/8BAv4AAf4A/f7+/P/+Af8AAAEBAQD9AwP/AP8AAgABAQEBAAIC/wL//wD+//7+//4A/QD+AAH/AgMCBAEB/gD/AQEAAQAB//8AAAD//wH///8A/wAD/wMAAf//AP8AAQEEAf8B/P//AAMAAQT7CQEDAAAA/gAB/wMAAQEBAQAC/gL9Af8B/wEDAAAD/gL8APn9/wAB/wH/+QkC+QD+AwcI/wAH/+/9Av36+wD/+wX//AAABQMDAQQUDwcP+Q/2Awf9C/UHB/YM9QYB/Af7/wL7A/8A/gIBAAP8A/4CAfz/Af4BAP4BAAAB/gAA/gEA/v0A+w0I9f4LAQH9/fMH/fMIB/8EAgDw8wgDDQX9Af4D+gD8/f/+AvsCBfsQBv4L/QUH/fgJ9v4H/v8AA/8D/v8B/gEB/QX09gEA+vv3+/77AP8J3ujrAAUFD/wOAPMJ+/8G8wb5BAUCAP72/Av8AP/8AwABBfwC/AEBAP4D/QEB/AD8/vn3AQUACP4AAP3+AvwA//YAAwECAAAD/wL//QTwBAT3A/kB9/sE/gP+9Mn2IwgaEdMM9e0K6P7/AwoM9wHn/gMDAwP6Cf/1//wA+/b+9wAF9wgBCP/69P31+gEAAP/2AAII+P0X/+f+/ff69/H1Av3++foDDv748fUGCLrovQgL8A7y+RUhPAjoCPjzFPTz+/4FBfkA9gYZBvkFDgP6CwEC9PPn7w/xEAfo7PoNCAEVDycYAe7/BwM0Og/r8egLAf4VC/z8Egb/AgPurg4j3jLmAQQB7IHe9ckxIQUgIfsoMgPbAdAT4yAU4eoG/zvOHk4L588N6ixJNPgcOBQn97mBl4Hx9dddDQwP4gLo7OzeGxzi5gzz6wAAMgoh8f/1BAcW9vn6+fMFAAb3CAb9C4HqA1cSDxHw7fPn7/zDLJjIbzwaE7zY/u8S8/4mCPjgA/X0E/4ZLewsN8n+uwb39O8JFPcXuEDM9jYQPTb+9+zAgQDi+PwU9gf39AHnGwIFJxH48Agm6f3p9B/t/Pn3Cv0I+P0b/Pz59QcC+hMCBwH/+QP49PgH/e7+AgAGAPr0/gn68/f2G/7/APn2/v36BwMLAwED+/79+v/4Av/6BAYDBAL+/wP4/v4D/wD+AQcE+gH8Av4D//v8/Qb/A/gG/gEFBPkNBwAC/fn5/wABAAH/AAD/Av//AAYA9gL+BQD+Afr9AAEK9gUJ+wkA+/79/QD+AQID/AX6//0AAgED/gH9/wL//wT/AAEAAv4AAPTw8AQMDgMGAP3+Bv4BAf79Af/+Af8EAv8BAv///P3//v3+/f0BAQIA/wD/AQICBQMB/wD/AwABAv7/AAEA+wH9/AT/AgQABQMAAQIBAAQB/gIBAf7+//4B8PoHBgYE/gP+/wAA//z//fz/BQAE/wEB/gAE/QD+AQEFAQUB/wIAAwEDAQME/wP+/QICAgACBgcEBgH/AQABAQEAAwABAAAAAfr/BfoC/fkE/QEBAf7//P39CwQDBQD9AAIEAwEA/gL9AP/+AAIDAwAFAAIABAIFAAEBAAL/AP0A/QD+/wABAQEBAgL+Av8AAQr0APz9/f0B/f8BAf/+AwEBAv8CB/4EBf8F/gEDAQP/AAICAwABAAAAAP/9//7+//79/f3+AQEAAP4AAf0A8gX6AAb6AwT4APL3AAUFBgP//gP//wH//gAB/wAAAQAA/v4A/BACBgYGBP0AAPgG+wABAQcDBAQDAAH/+//9//z//gEBAAL/AQADAgMABP8CAAEC/v/+AP8AAAECAgIAAP///wD7CQABAAED/wIC/wIAAAABAgECAQIBAgIA/v8A/wAAAAD//v//AQECAQEAAAEBAQEAAf7///4BAQICAgP/AP8AAAD/AQMA/v7/AP8AAAICAwMCAwH/AP8AAQABAQEDAgMCAwEAAQAA//8BAP0B/v//////AQABAv7/AP7/////AQAA/wABAQH/AAEA/wAAAP3+/f7+/v/+//7+///+/wECAf//AAAB/wAAAQEAAAD//v7+/f7/AP78/gABAQECAQEBAgEBAQABAQAAAP//AAH//v79//4A/v7//wD/AAEAAP/+//8AAQEBAP//AAEBAAEABAcB/wH//////vz9/f////8A/wD/AQH/AQD/Af/+AAAAAP/+/f3//v7+/v/+/wEBAQAA//////7+/wABAAEAAP//AAABAQEBAgIBAP///v4B//7+/v79/v4AAAAA//8A//8A/wAAAAABAAEAAAAAAQAAAP8A///+AAAA/wABAf//AAABAAAAAf/+/v7//wECAgEBAgEBAQEA/v79/v8BAQABAgEBAQEBAAECAQEBAAAAAAABAAAAAAEBAQEBAQEAAAD///8A/wD///4EAwH+AAEBAAEAAQABAAACAQABAQEBAgIBAQEAAgICAAEAAAAA////AP8A/wAAAQICAQMCAQD+//7//wAAAP//AP8BAP8AAQD///7/AAAAAAEBAQAA////AAEA+gb9AgH+AAD+A/wC/QH9AP79Af3/AP////3/AP8A/v7+/v4B/wD//wEA//////8AAf////8A/wD//wAAAQH/AAAAAP8B////AAICAgEA////AAABAQEB/v4A/f7+AAEAAAAAAQECAgEBAQEBAP/+/wD//PwBAv7/AQICAAEBAQD//v///Pz9/wABAgMCAgEBAQEBAQEBAAAA///+/v7//wAA//8A/wAAAP7+BgIEAQECAgACAQEAAQD/AAAAAAD///8ABAMGAwIDAv7+//7+/wABAgAAAf8BAAAB/wABAQIBAv8AAQABAAABAAH/AP///////////wACAwQC/wL//wD+//4AAAABAgIAAQAAAf8AAP///wAAAP//AQIDAgICAAABAAAAAP8A////AAD/AAABAAEAAAAA///+/v////8AAQIDBAMDAgEA//////7//wD//wAAAAEBAQICAf/////+/v4AAQEBAAEBAQEAAAEAAP8AAAD//v///v79+Pr7/wIAAQP+/gEA/wABAgEAAP///wD/AAAAAP////////7///////////8AAAD///8AAQEBAAEAAAAAAAD/AAABAgEBAAAAAQD///8BAAEBAAAAAP8AAQMDAwICAQAA//3+/wD/AAIBAgIDAgICAQD//////////v7/AAEBAwMDBQIEAgABAP8BAP8AAAAAAAEAAAEAAQEAAP8AAAD+/v//AAEBAAABAAAAAAD//wAAAAAAAP8AAQH//////v7//v7//wAAAAD/AQAAAf//AAEAAQABAQEAAAD//v///wAAAP8AAQEBAQEBAQEBAQAAAQAA///9/v/+AP//AAABAQEBAAD/AAD//v7+/v8AAAABAQAAAQIAAAAAAQICAQABAAEBAQEA/wD//v7+/v7//wAAAAABAQICAgECAQD/AP8AAP///v8A//7/AAAAAQEBAAAAAAEAAQAAAgICAgECAQEBAQEBAQEBAQIAAAABAAD//v//AP8BAAAAAQABAQEBAgIBAAAAAAAA//8AAAD//wAAAAEBAAAA//8A/wAAAQEBAgEBAQEBAQECAQAA//////8AAP///////wABAQEBAAAAAAAAAAABAAAAAQICAQH///7//wAAAAAAAAABAwQCAgEBAQECAgEBAP8AAAAAAQICAgIBAQEAAQEBAP//AAD//wD/AAABAQAAAAEBAgEBAgEBAP///////wEBAAABAQEBAP//AAABAwD/AAD+/v4A/v///////wD//wEAAP8A//8AAQEAAP///wAAAAD//v7+/gD//wEAAgECAgIBAgIBAAEBAAD///8AAP////8BAQEA///////+/v7+/v8AAAABAgEDAQEDAQEAAQEAAQD///7/AAEAAQEAAAAA/wD+/////wABAQICAQH/AAD/AAAA//3/AP79AP//AP/+AAD//////wECAQIBAAAAAAEBAQEAAAEBAQEA//7+/v7//v/+/v7+/f7+AAEAAAEBAAECAQD/////AAAAAAAAAQAAAQICAwIBAf/+/////////wD/AAD//v7+/wAAAQEAAQABAAAA////////AAAAAP////z/A/71+QABAwH//gQAAgABAAEBAgEBAAABAQD/Af////0A/wD//v/+/gD/AP///wEBAQAA/wEEAwIDAQD/AP8A///+9/YFAwQHBgIBAQIB/gIBAP//AQAAAAABAQEBAgICAQAA/f79/f7+/ffx+gIGBgP//wABAv///gEBAQEAAQABAgIBAQAA//4A///+/v7+/gD/AAAAAAAA//8AAAAA/v7//v///v7+/v7//v8AAP4A/////////wAAAAD/AAAAAAAAAAAAAQABAgICAgEA//wAAgEB//7+AAAA/wAAAgMBAQEA////AAEBAQEBAgIA//7+/v////8AAAD+/wABAQABAgEB//8AAQEAAQICAgEBAP8AAAEAAAAAAAAAAQEBAf/+/v7/AAAAAQEBAQABAQEBAQD/AAD////+////AP8AAQABAQEBAQEA//////8AAQECAwMDAQAAAAAAAAAA//7+/v3+/v8AAAEBAAAAAP///wEAAP///v7/AAABAQIBAQEAAP///gD/AAAAAAAAAQEBAAD///8A//8AAP8A//8AAQEBAAEBAQAA/v79Af4A/v7//wABAQECAQEBAgEBAAEBAQEBAgIBAQABAQEA//8A//8AAAD/AAEAAAEBAAD//wAAAQEBAQEBAQIBAQICAQAA/wD/AAABAAECAgEA////AAECAQEAAQD///8AAAEBAQD////+//////79/f4AAQEBAgH//v7+/v8A//8AAAAAAAAAAAECAgEBAgEA///+/v7+//8AAAAAAAAA/wAAAAAAAP//AAACAP//AQEBAQAA////AAEBAQEBAQEAAAAA/////////wEBAgEBAQEBAAABAQEBAQEBAQEAAP///v///wABAAABAAEBAP8AAQEBAQEBAQABAAAAAP////79/v//AAABAgIBAP/+/v7//wAAAAEAAAAAAAEBAQECAgIA////////////AAAAAQEAAQEAAP///gABAQEAAAAAAAEAAAEA//////8AAAAAAAD///8A////AAAB/wABAAAAAAEBAAAAAAD//////wAAAAAAAQEAAQAB//7///8BAP7+AP77+QADAAEB//3+/wABAQABAP8A/wAAAAEAAP//////////AQICAgIDAwICAgIBAAAAAAAA/wD///7/AAAAAAEBAQAAAP8AAQICAgICAQEAAQEAAAAAAAAAAQAAAAAA//8A/wABAAD/AAEBAQEAAAD//v8AAQECAgIBAQAAAAD///8AAP/+/v7//v///wAAAQEBAAAAAP////8AAP/+/gAAAAAA/wAAAAEAAP///wAAAAAAAAAAAQEBAQIBAQEAAAAAAP//Av7//wAA//8AAAEBAgAAAAAAAQEBAAABAQEBAQEBAQAAAAD///8BAQEBAgEAAAAAAP////7///8AAQABAAD/AAAAAAAAAAEA//////7+/v///////wABAQAAAAAAAQIBAQAA/wABAv///v/+AAAAAAAAAAAAAAAAAP7+/v7+/gH/AQAA//8AAAABAQAAAQIBAAAAAQICAgIBAAD+/v8AAP////////////8AAAAAAQEAAQICAf8AAP///wD//wAAAAAAAAAAAP/+/v//AAD//v39/wABAgECAgIAAQEBAAD///7/AAAAAAIBAP/+/wABAQABAQEAAQEA/wABAQEAAAABAAEBAP8AAAEA/////////wAAAQABAQEBAAAAAAAAAAAAAQEBAQD////+/wAAAP////////8AAAABAQABAAEEBAEAAP4A//7+/v///wABAQEBAAAA///+/v7+////AQEA/wABAAAAAgEBAQAAAAEBAQD/////AAABAAAA////////AQECAgECAgICAQEAAP8AAAAAAAEA//8AAAAAAAEBAQAAAAABAgEA//8CAQD//wAAAQD///8BAQEAAAAA/wAAAAEAAgEAAAAAAAAAAP8AAAECAQEBAQD//////////wAAAAD/AAEB///+/v39/f3+/v////8AAQEBAQEA////AAAAAAAA//8AAAABAgH+Af8CAAAA//0C/AH/AQICAgH/AP8AAAD/AAAAAP//AP4A/wEAAP8AAP////////8AAAH/AAEBAQAAAQECAQICAQAAAgEA/wD//////gEBAQEAAgEBAQEA//3/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/gAAAAAA/v4A/wL9AAP/Av4BAP0B/v75BAD/Av4EAQEBAAEBAAAD/wAF/v8AAAH/AQAF/v8A/P/+/wH+///////9Av/9/v4CAP///gABAAH/AAABAQIBAAAAAQIBAQAA/v7//v8AAAABAQAAAAEAAQD////+/gAA/wD/AQEBAQAAAAABAQEAAQAAAP////8AAAEBAAEBAQAAAAAAAAEBAAEAAP8AAAABAQIBAAIBAQAA/wAAAAAAAAEAAQEBAQABAQABAP///v7/AP/79vX6/gL+/wH//wIA/v/+Af//AAABAAABAAIAAAECAgECAAAAAAH/AQAA/wABAQEBAQH+//8A//8AAP8A//////8BAAAA/v7+/v8AAP////8A//8AAQAAAAAAAAACAgABAAEAAQEAAQEBAgMCAwEB//7/AP8AAAEBAP8A/v7//wABAQH/AAABAQH/AP///v/+/v8BAAEBAAEBAgEBAgEA//8AAP///wABAQIDAwECAQECAQAAAAEBAQD+/f7/AAEAAAD/AQAA/wAAAP8A//8AAQICAQAAAAAAAAEAAQAAAAAAAAABAgEBAAEAAP8BAP8BAAD/AAAAAQAAAgAAAAEAAAD/////AQECAAEA/v7//gAAAQEBAQD///////8A/wAAAAAAAP//AAD//wABAP7+/v8AAAEAAAD/AAEAAAEAAAEAAAAAAAD///////////7/AAEBAAABAP//AAAAAAEBAAEAAQEBAQEBAQEAAAABAQEAAAAAAQIBAwIBAQEAAP/+/v///wD//v8AAQABAQEBAQEBAf//////AAAAAAABAAABAP8A/wAAAAD//wABAQEAAAAAAAEAAAD+//7+/wEBAgEA//7+/v39/v4AAQAAAAD/AQECAQABAQEBAgUBAgIE/gIE/gH//gH/AQD/AQAAAP////8AAQICAgEAAP//AAAAAf8AAf8AAP8CAf8A////AAAA/wD/AAEAAgICAQEAAAAA/wAAAQEA/////wECAQEA/wAAAAD//wD///8A/wAAAAAAAP8AAQECAgEBAAD/AAABAQIBAP/////////////+AP8B/wIAAgD/AQABAQEBAQAAAAEBAQEAAgH8AQABAAAAAQECAAAAAQEBAf8A/wD//v7/AP//AAEBAgIBAQEA//79/f3+/v7+/wAAAAEBAQIBAQECAQMBAP7/AAAA/wAAAAAAAAD/AP///v7+/wAAAQEBAgICAQAA//7+/v7/AP4A/wAAAf///wD/AAEAAP8AAAECAgICAwMBAgEAAAEBAQIDAgEBAQEBAQEA//39/v7+/v7/AAAAAQEBAgICAQEBAQD//v//AP8AAAEAAAEBAQEBAQAAAAD+/v7+//8AAAECAgIBAQICAAD//wAAAAD/AAD///8A////AP///v7+/v//AAECAgABAAD/AQD//wD//v7+//8AAP8B/wICAwMCAAAAAQAAAAAAAQAAAQEBAgEBAAD///7+/////wAAAAEAAAD////+/////v8AAAAAAAABAQEAAAEAAQAAAAABAQAAAAAAAQEBAf//////AP8A/wABAQABAQEBAP////////7/AP///wD/AAABAQEA//////8AAAAAAQICAwMDAgEBAQEAAQEAAAEAAAD/AAABAQD///7+/wD//wAAAQABAQECAgEBAAAA//8A//////8AAAABAAABAQD/AP/+//7/AP8AAAABAQICAgICAf///v7+/v//AAIA///+/v7+/v7+////AAAAAQECAQICAgEBAQEB/////wD///////8A///+//8AAAECAQIBAgICAQABAAEAAAAAAAD/AP8AAAECAgMDBAEBAP/+///+//8AAAEBAQEBAQEAAQEAAP/////+////AAAAAAAAAAEBAP8AAQABAQABAQEBAgEAAAAA/wAAAP//AAAAAQICAgIA//7+/v7///8A/wAAAP/+//8AAAAAAAEBAQAAAP///wABAQEBAAAAAAD//wABAgMCAwMDAwICAQD//v7+/f7///8AAQAAAAABAP/9/f39/f3+/wABAQEBAQEAAAAAAAAAAAABAQEBAQEBAQEBAQAA//79/f79/v7//wAAAQEAAQEA//7+/v7+/v7/AAEBAAABAQEBAQD//v7//v8AAAECAgEBAgEBAQEAAAEBAQIBAQD//wEAAQEBAAD/AP////8AAAAAAQECAgAAAAABAP/+/AABAQEB/wABAQABAQEA///+/v4AAAEAAQD/AAEAAAAA////AAAAAAEBAP8AAAABAAAA/v8AAf8AAAAAAAAAAQEBAQABAAD+/v3+/wAAAQAAAQEBAgECAQEA/////////wABAQIDBAMEAwIAAAABAgICAf8AAP////8AAP////////8AAAAAAAAAAP/////+//8AAAAAAAAAAAEBAQEBAQEAAAD/////AAAAAQEBAgICAQAA/////wAA//7+/gAA//8AAP/+/wAAAP///wABAQEBAQEBAgIBAQIBAQICAgEA//8BAQEBAQH/////AAAAAAAA//8AAAABAgEBAQEAAQAAAAAAAAAAAAAAAAAAAAEBAQAAAAAAAAAAAAEBAQIBAQICAQAAAAAAAP////79Cf4DBP3/AAEC/f8A/wD/AP3//gD9AAEBAAAAAAEAAQEB/wEA//8AAP8A/wD/////AAABAAAAAAD/AQAA//////8AAAEB/wD///8BAQECAwEA/wD/AP///v/+/v8BAAEBAQEAAAABAQEAAAD//v/+///9AAAAAAABAAEBAP7/////AAACAQEBAP8AAQECAgD//wD//wABAQEAAAAAAQACAAAA////AP8AAAEAAAEBAgIBAQEAAAAA/////////wAAAQECAgICAQEBAQEAAQEAAAD//wAAAQEBAAABAQICAgEAAQD//v7//v7/AP8AAAAAAQD/AAABAQEBAQAAAAAAAQIBAAD/AP7/AAEBAAD//v/+////AAEBAQEAAAEBAAEA//8A//7/AAABAP8A//8A/////v7+/////wAAAQEAAQAAAAABAAEBAgEBAQECAgEAAAABAQIB//7/AAAAAQEBAQEBAQAAAAECAgEBAP///v7+/v/+/////wD///8AAAABAQIDAgEBAAAA//8AAQECAgIBAQEBAAAA///+/wAAAP/+/v7+AQEAAAABAQD///8AAQAAAAD+/v/+/wAA//8A///+/v8AAAAAAAABAgMCAgICAgICAwIA////AAD////////+/f7/AAEBAQIBAQEAAP////8AAQABAAAA////////AAAA//8AAQECAQD+/v7/AAD/AAEBAAAAAP8AAQAAAAAAAAAAAAD//v7+/v7+/wABAQEBAQECAgIBAQABAQEAAAAA////AAABAP8BAQEAAQD//wD//v7///8AAQICAgIBAgIBAQEBAQEBAAD/AP8AAP/+////AAEAAAAA//7/AP8AAQEBAQD///8AAAD///8AAAEAAAD///8AAAAAAAAAAAAA//7/AAAAAAD/AP//AAAAAQEAAAAAAAEBAQAA/v7+/////v8AAP///wAAAQEBAgMDAgEAAAAAAAD/AQEAAQAA/////wAAAAEBAQAAAAAAAQD/AAAA/wAAAQEBAQEAAAAAAAD/AAAAAAAAAAAAAAAAAAEBAAABAQEBAgEBAQEAAP/+//7//wD///7+////AQIBAAD///7+/v8AAAAAAQACAQIBAQEBAAEBAP///wAAAAABAQIBAQEAAAABAAD9//4B/gAAAQEBAAABAQAAAAAA/////wAAAQAA/wAA////AAD/AAD/////AAACAQEBAAAAAAAAAAAAAAD/AAAAAQEBAAD/////AAD///8AAAEBAQAAAAEAAP///gD+AP3/AgL/AAAAAQD+//sD/f/+AP8C/gMAAAL/BAEEAgICAf8A/gD/AQQCAQIAAgABAQAAAP4A/wD/AAEBAf8AAAEA/////////wAA/wD//v4A////AAABAf////8BAAEBAQH/AAEBAgIBAAEAAP/+/wD////////////+/f///v///wD/AP8AAAAAAAD/AAD////+/gAAAP8A/wAAAAD/AP8BAQABAgECAQECAgIAAAABAQICAQH///7/Af4C/wD/AwAC/gL/AQACAAAD/wECAQICAAEA/gD+AP//AP8AAQAB/wD/AQAAAQAA/wAAAAD/AAABAAAAAQABAQECAQH8BP7//v/+/v7+/Pz//wEAAgABAAAAAAAAAv8Y8/wK8wf8/QP9DAgABQMC/wIEAgEBAAEAAAACAf//AgEAAQICAAMBAQEAAAEA/wD//v////8AAAAAAQAAAAEAAP/+/wH/AAABAQH/AwAC/wH+/vIB8/v/Bv8B+gIBAgL6APr/AwIBAf//AP/9AAEAAQIBAQABAQAA//39/v4AAAABAQEBAgIBAv7+/vgAAAH/AgEC/wIE/gIB/wEAAQD+/wAAAAEBAQEBAAEB//8AAAD/AAD/AAEDBwMDAv8C/wL/AgQGAgf/AgH+AP8B/QL//v8AAf4AAAEAAgECAAEBAAL///f///3+AP0CAAH6/gD/AP4D/wAAAP7+/wD8AP8A/gEC/gEBAwH/AwIB/gH9//n++gD8AAL/Bf4AAAD8BP0C/wMEBAIBAwD//wD+Af7//v/+//8AAQAB/gD/AAAAAP8AAQEA/QECAAIAAQEBAQH///7/AAAA///1AuP/AgT8+QH/AwYG8wMCAwAM+AEAAv37/QT+/vz8A/8CAf//////AP4A/v4A/f8BAP///wD//wABAAECAQECAAH9+//8/f8A/gH/AQECAQIEAQMCAAH/Af4B//8BAQICAf8BAAAAAAL//wEB/wEAAAAAAAAA/wH/////////AAAAAQABAQIBAAEBAQIAAQACAAEA//8A/wEBAgAA////////AP//AQABAAD/AAD+///+/wAA//8AAAEBAP//AP7//wABAQAAAAMBAQICAwMCAgIBAf8C/wABAv8A/wAAAf8B//8BAQH+AgD+//z+/gAAAwACAgIBAAEAAAH+AP4IAvf9+AL9+vv8BAf9AAIB/QUCAAIC/P8ABAD7AQYF/gICAAP9//4A///8APv//P4A/f4D+gIBAPv8B/4B/gAB9QYDC/vxC/v6CAAE/wkSKjIU+x0g6f8K+gj4DPMECPbyDAP4AgDxBfnv/+sEA/j/Bf0C+/YE8gMGAO79FfshDeb3AgL3APnn/Pv4A/H6BO8L/A/9+A348gwB8v0C+wgEAwP9Af/8BP4D9gPvBv/+BevL4QDiAS4G9AT4Acm/Vmj+3zDADAMP378DHxoAAfkDCPsKCwH0EALwBfL98fwt/tr88eii6IHtKNP5+OP9MjgoNvTayQD7DQUOCPkMCfwlAzP8BwcKOMfrCQQCCfP88Sb4+BDuFREN9PETxsUjxe0KHgcoBADy7Qnu8gUBEQHx0hkIMijG/xz00hwD3h32AO/W/BIPAfICC/gXFPft4vYW+d8DCfv4AgfsKhQIBAcSC+wKAgUB4vfiBP4IDOcJDADzzRPqPvD3GvQC9/0b8BjpEP74Cvj+B+bzBRkAG/vlIREQCO/y4wsg6/8M8xXZ1gL5NAoC7vwYBfsa/BoA4/vo7AEB/w/iNPn2CPf8AQEa/eX4Be4NAQgABA4KAgIBCQEFATgrC/Lt//QLJwAJ8wUR///8/e/4BQQLAgsQCer3DPsC/gUCAQwDC//7CPz8Ev4G+Pkm8Pb15AkH9Ab3Af4B7uv3CgUNBvYOAPcR8wYJ+v8H+v/8AfwL/wr5AQLyCAAEBPcG/v3///n6CP4F+/gH/wMCAP/7BOwJ+gMB+QD+/RECCPzv+P0H+Af9+wQAAP7/Af0D5AQI9Qv5/Aj7BP/8A/0C+/oU9gUF+gMB+AP7+/79+wEB/wT+B/sZ4QINDO79+gAG+AT5+f///wP7+wH/A/v/AwT9AvsAAvwCAAABAgEA/gAAAAD+AAL+AwD9//4BAPwI9vH5Avv9/fz9/v7//fz99gMAAv79BfwBAf3//v8D/gUCAgICAf///v3++wP9/v39AwT+AwUBBgMCAwICAf8CAQX9AQL+BAL/+/0DAQAA/wICBAAAAwADAQAC/wECAAABAQABAAMCAwEBAwIBAv79AQMEAAAD/wEB/gEBAgEAAgECAwEFAAEBAgEAAQAAAQEBAQMBAwL/AP4AAP/+/wH/AQEDAgABAf8BAQIDAgEBAAEBAAIB/v8AAAECAf8BAQEBAAD//wABAQEDAP/+AAABAQICAgMBAgQAAP8A///+/v7+AAD+AP//AP4DAgEBAgAA/f7+AAAAAQEBAQAA/QAA/wD//gD//gAA/wD+/v8BAP8A/v8A/wEB//4A/v//AP//AAAA//3+/v3+///+/QD///8A/v4A/gH+AAD//wAA/wH///756ff1+QH/BAIA/wAAAf8AAv3///v+/v7+//8AAAEBAf8AAAD//wD8/v4A/v79/v7//wEAAAECAAAAAf8AA/4BAv7/AAEAAQEAAAD////////+AP8AAf8AAQH8BAAD/wECAAIA/QD/AQABBP8DAQECAAICAQIAAwECAgEAAQAB/wACAAEBAAABAQIAAgICAwMCAgEAAQEA/wABAQIBAQECAgICAQEBAgAAAP7/BP8HBQQBAgP/BAL+AgD/Af4A//8BAAIGAwIDAQIDAQAAAAEBAP///v/+AAACAgAAAf8A//7+/v////7///8AAAEB/v/////+/f3//wABAgMAAgIBAf79/v//AAD///8A/wAA//4AAQEBAAD///7/////AQAAAAAAAP79/v7//wAA/////v7+/wD/AAAA//7+/f3+/v8AAQAAAAAAAQAA//7+/v8AAP8A//8BAQAB//39/Pz9/v7//v//AAEA//8AAAAAAP/////+/v//AP8AAQAAAAEAAAD/////AP8AAQEAAAECAgQDAwIAAP/+/wABAAEAAAAAAQIBAwEBAQEBAQAAAAD+/wABAf8AAQD/AAEAAAH/AQIDAwIBAgEAAAAB//8A/wAA/gAAAQECAgMDAwEA////AQAAAAABAAICAgEBAQEAAAAAAAABAQABAQEAAwABAQAA/wD///8AAAAAAAIDAQIBAf8AAP8AAP///////wEBAQECAQEBAgEBAAABAQD+/gAAAAD////+/wD///8AAAEBAgEAAAACAwH//wICAgEA////AP8BAQAAAP8AAP//AP8AAQECAgEBAAEB//7//gAAAQABAQECAgEAAP//AP7+//////8A//8AAQEBAgEBAAABAAEAAAAAAQIBAQEBAQECAAD//v7+/v7//wABAQECAgIBAQD/AAD/AAAAAAAA//7//wAA/wEAAAAAAAAAAP///wL+AQIBAAAA//////7/AAEAAAEA//7///8AAAAAAQD//v7+/P3+/f7+//8A/wABAgEAAAABAAAA//////8AAP/+/f7+/v///wABAgIBAQEBAAD+/f7+/v8AAQAAAAEAAAAA/wAA/wD//////wAAAP8AAQEBAQEBAAAAAAAAAAAAAQICAgEBAAAAAQAAAAD/////AAABAAEDAgEBAAIB////AP//AAEBAP///wAAAQD//wABAP8AAP8A//4AAQEBAAEBAQEB//////8BAQECAgEBAAEAAAAB/wAA///+//////8AAQECAQAA////AAAAAAAAAQABAQD///7///79/v//AAAAAQEBAgICAgEA////AAEBAQECAQEAAAD//v7+/f7/AAD//gAAAQEAAQAAAAEBAAD+//8A//7+/wAAAQECAQEBAAAA/////////wAAAAICAAEA//8AAQEAAAABAQEBAP8BAQEBAP//AAAAAAAAAAECAgEBAQICAgABAf8AAP8AAAAA//////7//wAAAAABAAAAAP8AAAAAAQEBAQAAAAEBAQEAAQIBAP//AAAAAAD//wEAAP8AAQEBAQEAAP////7/////AP//////AAD///8A/////v7+////AAAAAAABAQEBAQEBAAAAAAAAAAAAAP////////8AAAEBAQEAAP///v7+/wAAAAEAAAEBAQEBAQECAQEA/wD/AAAAAAEBAQEBAQEBAQAAAP8AAQEBAQAAAQIBAQEBAgEA/v7+/v//AAAAAAAAAAAAAAEBAAEA/wAAAAEBAgIDAgICAQD//v8AAQABAQEAAP/+/v8AAQD///8AAAAAAAABAQECAQAA/wAAAAAAAAAAAAD//////wAAAAAAAAABAQAAAQICAwMCAQAAAQD///7+/v8CAQEBAgICAQABAP/////+/f39/gABAgMCAQICAgEAAAD//v7+//8AAQEBAgEBAQICAQEAAAAAAP8AAAAAAQECAgIBAQEA//7+/v//AAEBAQEAAAD//v7//v8A//8AAAABAAEBAQECAgIBAQAAAP///wAAAAAAAAAA/wACAgEBAAEAAQD/AAEAAAAAAAD///79/f7/AAEAAAAAAP//AAD///79/v/+/wABAQEBAQEAAAAAAAAAAAEBAQEBAQEAAQD//v3+//7+/v7+/v7/AAEBAQIBAP8AAQEBAAD///7+//8AAQECAgEBAQD/AP8AAQEBAQEBAgIBAgICAgEB//8AAAEBAQABAgEAAP///////wAAAQEAAAD//v///wABAAAAAAECAgEAAP///wAAAAAAAP////4AAP8AAAAA////AAAAAAAAAQICAgEA////////////AAAA/////v4AAAAAAAEAAAAAAP////////7+////////AAAAAAAAAP//AAAAAP//AAAAAQEBAQICAgEAAAAAAP////7+/v7+AAAAAAAAAQEBAAAAAAH/AAAAAQAAAP//AAAAAAAA/wAA//8AAAABAQEBAQEAAAABAAEBAQEBAAAAAAAAAAAAAAEBAQEAAP7/AAAA//7//wAAAAAAAQEBAgIBAQIBAgICAgEBAQEBAgIBAP8A//8AAP///v7+/v7+AP8AAQECAgICAQAAAAABAP/+/v7+////"

{card:Lake}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/ABgBAQD/AP8BAwD/ANoBAQAjAQMA/wDZAQMAIgEDAP8A2QEDACIBAwD/ANkBAwAiAQMA/wDYAQMAJAEDAP8A1wEDACQBAwD/ANcBAwAkAQMA/wDXAQMAJAEDAAUBAgD/ANABAwAkAQMABAEEAP8AzwEDABEBAwAQAQMAAwEFAP8AzwEDAA8BBgADAQEACwEDAAIBBQATAQMA/wC6AQMADgEHAAIBAwAKAQMAAgEEABMBBQD/ALkBAwANAQQAAQEDAAEBBAAKAQMAAQEEABMBBgD/ALkBAwANAQMAAwEBAAIBBAAKAQMAAQEFABIBBgD/ALkBAwANAQMABgEEAAoBDQANAQYABAEBAP8AtQEDAAwBAwAIAQMACgEOAAwBBgADAQMA/wC0AQMADAEDAAgBAwAKAQYAAwEGAAYBAQADAQYABAEDAP8AtQEDAAsBAwAHAQUACQEDAAEBAQAIAQMABAEKAAUBAwD/ALUBAwAHAQMAAQEDAAYBBwAIAQMAAQEBAAkBAwADAQgABwEDAP8AtQERAAQBBQACAQcABAEFAAgBAwAEAQcABgEDAP8AtwEMAAEBCwAEAQcAAwEFAAgBAwAJAQMABQEDAP8AuAEIAAUBCAAHAQUABAEFAAgBAwAJAQMABAEDAP8AxwEFABMBBAAIAQMACgEJAP8A3wEDAAkBAwALAQcA/wDhAQEACgEDAAwBBQD/AO4BAQD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wA6AQUA/wD6AQkA/wDgAQIAFAEMAP8A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BQD/AFIBBA0RHQMATR0KAAwdEwATHQkBBQD/AFIBBA0SHQMASx0KABAdDgAVHQgBBgD/AFIBBA0THQMASR0KADQdCAEGAP8AUgEEDRMdBABHHQoANR0DDQEdAw0BAQYA/wBSAQUNEx0EAD4dFgAxHQMNAR0DDQEBBgD/AFMBBA0UHQQANx0hACwdBw0BAQYA/wBTAQQNFR0FADEdKgAnHQcBBwD/AFMBBQ0VHQcAKh0ODQQdEQ0BHQ8AIh0HAQcA/wBUAQUNFR0RABwdDA0FHRYNBR0PAB0dBg0BAQcA/wBVAQUNFh0QABcdMg0DHQ8AFh0IAQgA/wBWAQUNFR0RABIdJQERHRcADB0MDQEBCAD/AFcBBg0UHRMADh0hAR0dKQEHAP8AWQEGDRodDgAIHQkNAR0VASUdKAEGAP8AWgEjHRcNAh0SATAdFg0BHQoBCAD/AFsBJx0iARYADgEVHQ8NBB0HAQkA/wBeASUdHQEWABoBER0LDQEBEwD/AGABJR0ZARQADwECABEBKwD/AHcBER0VAREAFgECABMBJgD/AHsBER0RAQ4AHAECABcBIAD/AIIBJgAhAQIAAgEDABUBGAD/AIgBIQAeAQUAAgEDAB0BEQD/AIABAgAKARwAJgEEAP8AsAECAAoBGAAqAQMA/wCxAQEADAESAC8BAgAtAQIA/wCCAQIATAECAC4BBAD/AIABAQBNAQEAMQEBAAQBAgD/AHMBBAADAQEASQEGADEBAQADAQEA/wB3AQIAAgEBAEcBAwAFAQIALwEBAAIBAQD/AHkBAQACAQEAAwEBACMBAQADAQEAJAECAC4BAQACAQEA/wB6AQEAAQEBAAIBAQAkAQIAAgEBACUBAQAuAQEAAQEBAP8AewEBAAEBAQABAQIAJQEBAAEBAgBUAQEAAQEBAAIBAwD/AHYBAQABAQEAAQEBACYBAQABAQEABAECAE0BCAD/AHYBCAAlAQMAAwEBAE0BAgAHAQMA/wBzAQEACAECACABBAABAQQAWQEBAP8AcwEBAAkBAgAfAQEABwEDAP8A1wEBACkBAQD/ANYBAgApAQEA/wDWAQEA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wCY"
{widgets}
cStreets:{"type":"button","size":[85,15],"pos":[153,285],"script":"Lake.0","text":"Ruined Road"}
lDesc:{"type":"field","size":[204,210],"pos":[153,60],"border":1,"scrollbar":0,"align":"center","value":"A lake murmurs gently to the side, undisturbed aside from a faint wind blowing from the east. It's mirror finish rippling back and forth against the bank. The subtle smell of the grass and water makes the area feel very tranquil, and at peace.\n\nAhead is a ruined road, broken walls of linked wire flank either side but guard nothing.\n\nTo the left is a dusty road, fading into sand and nothing the further on it goes.\n\nTo the right, a beaten down trail amongst soft green grass waves in the breeze.\n\nBehind is the safe path."}
wRoad:{"type":"button","size":[85,15],"pos":[272,285],"script":"Lake.1","text":"Dusty Road"}
sRoad:{"type":"button","size":[85,15],"pos":[153,310],"script":"Lake.2","text":"Safe Road"}
gRoad:{"type":"button","size":[85,15],"pos":[272,310],"script":"Lake.3","text":"Beaten Trail"}
water:{"type":"button","size":[136,60],"pos":[357,130],"script":"Lake.4","show":"transparent","style":"invisible"}

{script:Lake.0}
on click do
  play["walking_1"]
  go["cStreets" "SlideDown"]
end
{end}

{script:Lake.1}
on click do
  play["walking_3"]
  go["wasteland" "SlideRight"]
end
{end}

{script:Lake.2}
on click do
  play["walking_2"]
  go["Shelter" "SlideUp"]
end
{end}

{script:Lake.3}
on click do
  play["walking_2"]
  go["grassland" "SlideLeft"]
end
{end}

{script:Lake.4}
on click do
 play["buffer"]
 inventory.widgets.waterCheck.text:"Yes"
 inventory.widgets.waterCount.text:"1"
end
{end}

{card:cStreets}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD6AQEA/wDrAQMAEQEDAP8A6AEGABABAwA/AQEA/wCmAQgAEAEDAC8BBwAIAQMA/wCkAQUAAgEDAA8BAwAnARAABwEEAP8AogEEAAMBAwAGAQIACAEDACUBEwAGAQMAMwEBAP8AbgEDAAYBAQAGAQQABwEDACQBCwAGAQIABwEDADIBAwD/AG0BAwAOAQMABwEDACUBAwAWAQMAMgEDAP8AbAEDABABAQAIAQMAJgEDABUBAwAyAQMA/wBrAQMAGgEDACcBBAATAQMAMgEDAP8AawEDABoBAwAUAQEAEwEEABIBAwAyAQMAAwECAP8AZQEDABsBAwATAQMAEwEEABEBAwAtARAA/wBiAQMAFwENAAEBAQALAQMAFQEEAA8BAwAsARIA/wBhAQMAFgERAAkBAwAXAQQADgEDAC0BCwACAQMAAQEDAP8AXgEDABIBAgADAREACAEDABgBBAANAQMAHgEBAA0BAQAFAQMACAEFAP8AXgEDABABBAAFAQMABwEEAAcBAwAbAQMADAEDAA4BAQADAQQABgEEAAsBAwAEAQMABwEHAP8AXQEDABABAwAGAQMACQEDAAUBAwAdAQMABgEPAAYBAwABAQYAAwEGAAkBBgADAQMACAEGAP8AXQEDABABAwAGAQMACQEDAAUBAwAdAQMABQESAAQBCwABAQgABwEEAAEBAwACAQMACQEEAP8AXwEDAAoBAQAEAQMABgEDAAoBAwADAQMAHwEDAAUBEgADAQUABAEGAAIBAwAGAQQAAgEDAAMBAwAJAQMA/wBfAQMACQEDAAMBAwAGAQMACwEEAAEBAwAWAQIACAEDAAUBAQADAQMABwECAAQBBQAFAQQAAgEDAAcBAwACAQMABAEDAAkBAwD/AGABAwAHAQMABAEDAAYBAwAMAQcAFQEEAAcBAwAJAQMADQEEAAYBBAABAQMABgEEAAMBAwAEAQMACgEDAP8AXwEGAAMBBAAEAQMABgEDAA0BBQAVAQQACQEDAAgBAwANAQQABQEJAAUBCwAEAQMACgEDAP8AYAELAAUBAwAGAQQADgEDABQBAwALAQMACAEDAA0BAwAGAQgABwEJAAUBAwALAQMA/wBhAQgABgEDAAYBBAANAQMAFQEDAAsBAwAHAQMADgEDAAcBBgAIAQgABgEEAAoBAwD/AGQBAwAJAQEABwEEAA0BAwAVAQMACwEDAAcBAwAOAQMACAEDAAgBBQAKAQYA/wCEAQMADQEDABYBAwALAQMABwEDAA0BAwAJAQMABwEHAAkBBgACAQIA/wCBAQEADgEDABcBBQAGAQQABwEEAA0BAwAKAQMABAEFAAEBAwAHAQQAAQECAAIBBQACAQEA/wCKAQMAGQENAAgBBAANAQMACgEKAAQBDAAHAQcA/wCKAQMAGgELAAkBBAANAQMACwEIAAUBCwAKAQUA/wCJAQMAHgEGAAsBBAANAQMADAEFAAgBCAAOAQIA/wCKAQMALwEEAA4BAQD/ALsBAwAxAQMA/wDKAQMAMgEBAP8AywEEAP8A/QEEAP8A/AEFAP8A/AEEAP8A/gECAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBc"
{widgets}
lake:{"type":"button","size":[102,15],"pos":[136,285],"script":"cStreets.0","text":"Ruined Road"}
cStreetDesc:{"type":"field","size":[238,210],"pos":[136,60],"align":"center","value":"The road leads to the midst of giants made of glass and steel, all of them broken and crumbling. Their glittering shards have long since settled on the shattered road beneath them. It's clear they once used to be grand displays of importance, maybe.\n\nHowever, one stands beyond all others. A tower ahead, stretching far, far into the sky like a sleek black obelisk. It has no glass to be shattered, and its steel remains steadfast\n\nTo the left, a concrete tunnel into the earth connects to a metal one further down. It appears structurally sound, despite time.\n\nTo the right, the faint sounds of water brushing against the shore can be heard. It sounds... wrong, somehow.\n\nBehind is the road to the lake."}
bunker:{"type":"button","size":[102,15],"pos":[136,315],"script":"cStreets.1","text":"Earth Tunnel"}
dock:{"type":"button","size":[102,15],"pos":[272,285],"script":"cStreets.2","text":"Side Street"}
tTower:{"type":"button","size":[102,15],"pos":[272,315],"script":"cStreets.3","text":"Enter the Tower"}

{script:cStreets.0}
on click do
  play["walking_1"]
  go["Lake" "SlideUp"]
end
{end}

{script:cStreets.1}
on click do
  play["walking_3"]
  go["bunker" "SlideRight"]
end
{end}

{script:cStreets.2}
on click do
  play["walking_1"]
  go["Dock" "SlideLeft"]
end
{end}

{script:cStreets.3}
on click do
 if inventory.widgets.keyCheck.text="Yes"
  play["walking_1"]
  go["tTower" "WipeDown"]
 else
  alert["The tower doesn't seem to any visible door. Just a wide black wall."]
 end
end
{end}

{card:bunker}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AOwBAwD/APwBBwD/APgBCgD/APYBBQADAQQA/wD1AQQABgEDAP8A8wEEAAgBAwAoAQEA/wDJAQMACgEDACYBAwD/AMgBAwALAQMAJQEDAP8AyAEDAAsBAwAlAQMA/wDIAQMACwEDACUBAwD/AMgBAwALAQMAJQEDAP8AyAEDAAsBAwAlAQMA/wDIAQMACwEDACUBAwADAQMA/wDCAQMACwEDACUBAwACAQUAIAECAP8AnwEDAAYBCAAlAQMAAgEEABwBCAD/AJ4BAwAFAQgAJgEDAAIBAwAbAQsA/wCdAQMABgEGAB0BAQAJAQMAAQEDABsBCwD/AJ4BAwAHAQQAEwEBAAkBAwAIAQYAEAECAAkBBAAGAQEA/wCfAQMACAEEAAgBAQAIAQMABAEBAAIBBQAHAQgADAEFAAcBBAD/AKcBBAAIAQMABwEDAAcBAwADAQMAAQEGAAYBCQAKAQcABgEDAP8AqAEFAAgBAwAFAQMACAEDAAMBBgABAQMABgEKAAgBBAABAQMABQEEAP8AqAEEAAoBAwADAQMACQEDAAMBBgABAQMABgEFAAMBAwAGAQMAAwEDAAUBAwD/AKkBAwAMAQMAAgEDAAkBAwADAQYAAQEDAAYBBAAFAQMAAwEEAAMBBAAFAQMA/wCpAQMADAEDAAIBAwAJAQMAAwEFAAIBAwAGAQMABwEDAAEBBQACAQQABgEDAP8AqAEEAAwBAwACAQMACQEDAAMBBQADAQMABQEDAAcBAwABAQQAAQEFAAcBAwD/AKgBBQAKAQMAAwEDAAkBAwACAQYAAwEDAAUBAwAHAQMAAQEIAAkBAwD/AKgBBwAIAQMAAwEDAAgBBAACAQUABAEDAAUBBAAGAQMAAQEHAAcBAQACAQMA/wCoAQoAAwEEAAQBAwAIAQQAAgEFAAQBAwAFAQUABQEDAAEBBQAIAQMAAQEDAP8AqAEDAAIBCwAFAQMABwEFAAIBBQAEAQMABQEFAAQBBAABAQMACQEEAAEBAwD/AKgBAwAEAQgABgEDAAUBBwACAQUABAEDAAUBBAAEAQUAAgEDAAYBBQACAQMA/wCpAQEACAEDAAkBAwACAQkAAgEEAAUBAwAFAQQABAEEAAMBBAADAQUABAEDAP8AvwEIAAIBBAABAQQABQEDAAUBBAAFAQIABQEKAAUBAwD/AMABBQAEAQMAAgEEAAYBAwAEAQMADgEHAAgBAQD/AMIBAgAGAQMAAgEDAAcBBAAEAQEAEQEDAP8A1gEBAAMBAwAHAQMA/wD1AQEACQEBAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBQ"
{widgets}
bDesc:{"type":"field","size":[170,225],"pos":[170,60],"style":"plain","align":"center","value":"Descending into the tunnel, the air grows cold and heavy. An oppressive atmosphere permeates through the passageway making each step more arduous than the last. \n\nComing up to a great metal door, footsteps echo upon entering the garantuan steel chamber. Eons of dust and decay lay on the cold floor. Whatever was once here is gone.\n\nThe large room is empty aside from a flickering light coming out of a cracked door.\n\nIt is a terminal, still powered by whatever fuel still  remains, its faint, dull buzz-hum the only sound in the room. \n\nThe screen holds a few icons."}
terminal:{"type":"button","size":[85,30],"pos":[153,300],"script":"bunker.0","text":"Use Terminal"}
leave:{"type":"button","size":[85,30],"pos":[272,300],"script":"bunker.1","text":"Leave"}

{script:bunker.0}
on click do
  play["walking_1"]
  go["terminal" "SlideRight"]
end
{end}

{script:bunker.1}
on click do
  play["walking_2"]
  go["cStreets" "SlideLeft"]
end
{end}

{card:terminal}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8Arg=="
{widgets}
terminalTitle:{"type":"field","size":[102,40],"pos":[204,20],"font":"deckbuilder","border":0,"align":"center","value":"Terminal"}
tDesc:{"type":"field","size":[170,190],"pos":[170,70],"locked":1,"align":"center","value":"Covered in a thick layer of grime, the screen is dim and hard to read but its legible enough to make out the bigger points.\n\nThere are four icons on the screen. Out of the four, one is the recyle bin, and the other is a broken shortcut. The last two is an unnamed icon of a key, and the other is a text file with the name \"htkG.\"\n\nThe mouse scratches against the cold, worn desk, but it moves well enough to click the icons.\n\nThe terminal buzzes and hums as it awaits a command."}
howToKillGod:{"type":"button","size":[170,20],"pos":[170,270],"script":"terminal.0","text":"htkG"}
key:{"type":"button","size":[68,20],"pos":[170,300],"script":"terminal.1","text":"Key"}
leave:{"type":"button","size":[68,20],"pos":[272,300],"script":"terminal.2","text":"Leave"}

{script:terminal.0}
on click do
 alert["The text is hard to read through the grime but it seems to talk about something high in the sky, and there is a way to affect it. From what can be gathered, the one thing that can affect what is in the sky is a: Length of unnatural metal poisoned with pure water."]
end
{end}

{script:terminal.1}
on click do
  play["sosumi"]
  inventory.widgets.keyCheck.text:"Yes"
  inventory.widgets.keyCount.text:"1"
  alert["From somewhere high above, there is a thundering noise as something slides open."]
end
{end}

{script:terminal.2}
on click do
  play["walking_1"]
  go["bunker" "SlideLeft"]
end
{end}

{card:Dock}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wDuAQQA/wD6AQoA/wD1AQ0A/wDzAQYABAEFAP8A8QEEAAoBAwAoAQEA/wDEAQEAAQEDAA0BAwAmAQMA/wDCAQUADgEDACYBAwD/AMIBBQAOAQMAJgEDAP8AwwEDABABAwAlAQMA/wDDAQMAEAEDACUBAwAHAQEA/wC8AQMADwEDACUBAwAGAQMA/wC7AQMADwEDACUBAwAFAQMA/wC8AQMADwEDACUBAwAEAQMA/wC9AQMADgEDACYBAwADAQMA/wC+AQMADgEDACYBAwACAQMA/wC/AQMADgEDAAYBAwAQAQMACgEDAAEBAwD/AMABAwAOAQMABAEKAAkBBgAJAQcA/wDAAQMADgEDAAMBDAAHAQgACAEJAP8AvgEDAA4BAwABAQUAAgEIAAUBBAABAQQACAELAP8AvAEDAA0BAwABAQQAAgEFAAMBAwADAQMABAECAAkBDAD/ALwBAwAMAQcAAgEFAAQBAwACAQMAEAEFAAQBBAD/ALsBAwAMAQYABAEDAAUBAwABAQMAEQEEAAYBAwD/ALsBBAAKAQYADQEDAAEBAwARAQMACAEDAP8AugEEAAkBAwABAQMADAEDAAEBAwASAQMACAEDAP8AugEEAAkBAwABAQMADAEDAAEBAwASAQMACAEDAP8AugEEAAgBAwACAQMACwEDAAIBAwASAQMACQEDAP8AuQEEAAYBBQADAQMACgEDAAIBAwAPAQIAAQEDAAkBAwD/ALoBAwAFAQUABAEDAAcBBQADAQMADgEHAAkBAwD/ALoBAwAEAQQABgEDAAYBBQAEAQMADQEEAAEBAwAJAQMA/wC6AQMAAwEEAAcBBQAEAQQABgEDAAoBBQACAQQACAEDAP8AugEDAAMBBAAIAQwABgEDAAgBBgADAQQACAEEAP8AuQEJAAoBCgAIAQQABAEGAAUBBAAIAQQA/wC5AQgADQEHAAoBCwAIAQMACQECAP8AuwEGACABCAAKAQMA/wDuAQQADQEBAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBH"
{widgets}
dDesc:{"type":"field","size":[170,225],"pos":[170,60],"align":"center","value":"Leaving the towering giants and going down a narrow side street, the ocean comes into view. Continuing on down a wooden path stretching out from the shore onto the water, it becomes increasingly evident that it is indeed the ocean.\n\nGray and thick. Sickening arrays of color swimming on the surface, and dark shapes swirling deep within still clearly visible despite the deep pollution.\n\nIt smells of sulfur, salt, ammonia, and unholy concoctions of chemicals and entropy.\n\nIt is dead, and its viscous waves lop against the shore, threatening the dock."}
leave:{"type":"button","size":[170,30],"pos":[170,300],"script":"Dock.0","text":"Leave"}

{script:Dock.0}
on click do
  play["walking_2"]
  go["cStreets" "SlideRight"]
end
{end}

{card:tTower}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/ABkBAQD/AP8BAwD/AP4BAwD/AMIBEQArAQMA/wC9AR4AAwEBAB8BAwAHAQQA/wCxASAAAQEDAB4BAwADAQkA/wCvAQcABQEDAAkBCAACAQMAGgETAP8AsAECAAkBAwAOAQMAAgEDABkBDwADAQEA/wC8AQMABgEEAAQBAwACAQMAGgEKAP8AxAEDAAUBBgADAQMAAgEDAA8BBAAKAQMA/wDIAQMABAEHAAMBAwACAQMACAEDAAMBBgAJAQMA/wDIAQMAAwEDAAMBAgADAQMAAgEDAAYBBgACAQcACAEDAP8AyAEDAAMBAwADAQMAAgEDAAIBAwAFAQcAAwEGAAgBAwD/AMgBAwADAQMAAwEDAAIBAwACAQMAAQEBAAIBCAAEAQQACQEDAP8AyAEDAAMBAwACAQQAAQEBAAEBAwABAQ4ABgEDAAkBAwD/AMgBAwAEAQ4AAQEMAAkBAwAIAQMA/wDIAQMABAEFAAEBBAABAQMAAQEDAAEBBQAIAQEABAEDAAcBAwD/AMgBAwAFAQMAAgEDAAMBBgACAQMABwEGAAEBAwAHAQMA/wDIAQMACwEBAAQBBgACAQMABQEJAAEBAwAGAQMA/wDIAQMAEAEHAAIBCwABAQgABgEDAP8AyAEDABEBAQACAQIABAEIAAQBBwAGAQMA/wDIAQMAGwEFAAgBBAAHAQMA/wDIAQMAMwEDAP8AyAEDADQBAQD/AMkBAwA7AQgA/wC7AQMABQEEABcBAQAYAQsA/wC6AQMABAEGABQBBAAIAQIABgECAAQBDAD/ALoBAwADAQkABgEBAAoBBgAFAQUABAEEAAIBBAAHAQEA/wC7AQMAAgEDAAIBBgAEAQMABQEBAAQBBQADAQcABAEEAAEBAwD/AMUBBAABAQMAAQEIAAMBAwAEAQMABQEDAAIBCAAFAQYA/wDGAQcAAwEDAAEBAwACAQMABAEEAAQBAwADAQMAAQEEAAYBBAD/AMcBAwABAQMACAEDAAEBAwAEAQMABQEDAAIBCAAHAQMA/wDIAQMAAgEDAAcBAwABAQMABAEDAAQBBAABAQgABAEBAAMBAwD/AMkBAQADAQQABgEHAAIBBQABAQYAAgEGAAUBAwACAQMA/wDOAQwAAgEPAAMBAwAHAQQAAgEDAP8AzwEKAAQBBQACAQUABQEDAAUBBQADAQMA/wDRAQYABwECAAUBAQAIAQwABAEDAP8A7wEJAAUBBAD/APEBBQAIAQMA/wD/AQEA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBH"
{widgets}
tTowerDesc:{"type":"field","size":[204,195],"pos":[153,75],"align":"center","value":"The tower's facade of grand opulence fails upon entering. Its innards have decayed just like everything else that has come before it. The uncountable floors that rise high above are splintered, and flaked; sloughed off its bones onto the growing basin beneath. \n\nIn spite of the tower's immense stature, it refuses to move in the winds that buffet its outside, and it lets no sound in through its walls.\n\nIt is silent. It is blind. It is dead.\n\nThe stairs that lead to the top are unbroken. The ascent is clear.\n\n"}
rise:{"type":"button","size":[170,15],"pos":[170,285],"script":"tTower.0","text":"Ascend"}
leave:{"type":"button","size":[170,15],"pos":[170,315],"script":"tTower.1","text":"Leave"}

{script:tTower.0}
on click do
  go["cKingdom" "SlideDown"]
end
{end}

{script:tTower.1}
on click do
  play["walking_2"]
  go["cStreets" "SlideUp"]
end
{end}

{card:cKingdom}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/ACYBAgD/AP4BBAD/APwBBQAUAQIA/wDmAQUAEwEEAAoBAgAwAQEA/wCoAQUAEwEEAAkBBAAuAQMA/wCmAQYAEwEEAAkBAwAuAQQA/wByAQEAMwEDAAEBAwATAQMACQEDAAYBAQAnAQUA/wBnAQQABQEDADIBAwABAQMAEwEDAAgBAwAGAQMAJgEFAP8AZQEHAAQBAwAyAQMAAQEDABMBAwAIAQMABgEDACcBBAD/AGMBCgADAQMAMgEDAAEBAwATAQMABwEDAAgBAQApAQMA/wBiAQUAAwEDAAMBAwAyAQMAAQEDABMBAwAHAQMAMgEDAP8AYAEFAAYBAQAFAQMAMQEDAAEBAwATAQMABgEDABQBAQAfAQMA/wBeAQQADgEDADEBAwABAQMAEwEDAAUBAwAUAQMAHgEDAP8AXQEEAA8BAwAxAQMAAQEDABIBAwAFAQUADwEBAAIBBQAOAQEADgEDAB8BAQD/ADwBAwARAQMABwEGAAkBAQAaAQMAAQEDABIBAwAEAQcADQEDAAEBBQAHAQMAAwEDAA0BAwAVAQEACAEDAP8AOgEDABMBAwAFAQgABwEDAAcBAQARAQMAAQEDABIBAwADAQkADAEJAAUBBgABAQQADQEDAA4BAQAFAQMABgEEAP8AOQEDABQBAwAEAQkABwEDAAYBAwALAQQAAgEGABIBAwABAQYAAgEDAAYBAQAFAQkABAEHAAEBBAAFAQQABAEDAAQBAwAGAQMAAwEEAAUBBQD/ADgBAwAVAQMAAwEDAAIBBwAEAQQABQEFAAgBBwABAQYAEgEIAAQBAwAFAQMABAEFAAEBAwADAQgAAQEEAAMBBwADAQMAAQEIAAQBAwACAQUABQEFAP8AOAEDABUBAwADAQMAAwEHAAMBAwAGAQUABwEPABIBBgAHAQMABAEDAAQBBQABAQMAAgEDAAMBAgACAQQAAgEIAAMBDQADAQMAAgEFAAQBBgD/ADcBAwAWAQMAAwEDAAQBAgABAQQAAgEDAAYBBQAGAQQABAEIABIBBgAHAQMABAEDAAQBBQABAQMAAgEDAAcBBAABAQQAAgECAAQBDgACAQMAAQEGAAQBBgD/ADcBAwAWAQMAAwEDAAgBAwACAQMABgEFAAYBAwAFAQgAEgEFAAgBAwADAQMABQEEAAIBAwABAQMACAEDAAIBAwAJAQUAAgEDAAEBAwACAQMAAQEGAAMBAwABAQMA/wA3AQMAFgEDAAQBAwAHAQMAAgEDAAcBBAAFAQMABQEJABIBAwAKAQMAAwEEAAQBBAACAQMAAQEDAAcBBAACAQMACQEEAAIBBAABAQMAAgEDAAEBBgADAQMAAQEDAP8AOAEDABABAQAEAQMABAEDAAcBAwACAQMABwEDAAYBAwAFAQMAAQEFABIBAwAKAQMAAwEFAAMBBAACAQMAAgEDAAUBBQACAQMACAEFAAEBBAADAQMAAQEDAAEBBgADAQMAAQEDAP8AOAEDAA0BBQAEAQMAAwEDAAgBAwABAQMABwEEAAUBAwAGAQEAAgEEABMBAwAJAQQAAwEEAAQBBAACAQMAAgEDAAQBBgACAQMACAEFAAIBAgAEAQMAAQEGAAEBAwACAQMAAgEDAP8AOAEEAAgBCAAFAQMABAEDAAYBBAACAQMABQEFAAUBAwAJAQQAEwEDAAkBBAAEAQIABQEDAAMBAwADAQgAAQEDAAIBAwAIAQUABwEDAAIBBgABAQMAAgEDAAIBAwD/ADkBEgAGAQMABQEEAAIBBQADAQMABQEGAAQBAwAJAQMAFAEDAAkBBAAMAQEABAEEAAMBBgACAQMAAwEEAAUBBgAGAQQAAgEGAAEBAwACAQMAAgEDAP8AOgEOAAkBAwAGAQkABQEDAAMBAwABAQQAAwEDAAgBBAAUAQQACAEEABEBBAAEAQQAAwEDAAQBDgAEAQUAAwEFAAIBAwABAQMABAEDAP8AOwEIAA0BAwAHAQYABwEDAAIBBAACAQUAAgEDAAcBBgATAQMACAEDABMBAwALAQMABQEJAAIBAwABAQYAAwEGAAIBAwABAQMABAEDAP8AUQEBAAoBAgAKAQcABAEJAAUBCQASAQMACQEBABUBAQAMAQMABwEFAAUBBwAFAQYAAgEGAAUBAwD/AGgBBgAHAQ8AAQEFABMBAQAfAQMACgEDABMBBAAIAQQAAwEGAAUBAwD/AGkBAwALAQIAAgEIAAMBBAAyAQMACwEDABQBAQAKAQQAAwEFAAYBBAD/AHsBBQAFAQMAMgEDAAwBAwAfAQMABAEFAAYBBAD/AIYBAQAzAQMADAEDACABAQAGAQQABgEEAP8AugEDAAwBAwAnAQMACAECAP8AuwEDAAwBAwAoAQEA/wDGAQMACwEDAP8A8AEDAAsBAwD/APABAwALAQMA/wDwAQMACwEDAP8A8QEDAAkBAwD/APIBAwAJAQMA/wDzAQMABwEDAP8A9QEEAAQBBAD/APYBCgD/APgBCAD/APsBBAD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wDs"
{widgets}
cKingdom:{"type":"field","size":[204,200],"pos":[153,70],"align":"center","value":"Time blends into one moment. Darkness envelops all, yet each step is as sure as the last. All that is known is the ascent, and the departure of the earth below.\n\nAfter forever, in no time at all, a door is reached. Passing through the threshold, darkness is assaulted and destroyed. Burned away by the same light that reveals an endless sea of clouds.\n\nThe tower has pierced the clouds and broken into its kingdom. Stepping out onto the clouds feels like touching something infinitely soft, incredibly hard, and so deeply wrong.\n\nThere is something ahead."}
button1:{"type":"button","size":[204,20],"pos":[153,280],"script":"cKingdom.0","text":"Proceed"}
leave:{"type":"button","size":[204,20],"pos":[153,310],"script":"cKingdom.1","text":"Descend"}

{script:cKingdom.0}
on click do
  go["god" "WipeDown"]
end
{end}

{script:cKingdom.1}
on click do
  go["tTower" "WipeUp"]
end
{end}

{card:grassland}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wDMAQYA/wD5AQoA/wD2AQwA/wDzAQUABgEEAP8A8QEEAAoBAwD/AO8BBAAMAQMAOAEBACYBAQD/AI0BAwAPAQEAOAEDACQBAwD/AIwBAwBHAQQAJAEDAP8AiwEDAEgBAwAlAQMA/wCLAQMAGgEDACsBAwAlAQMA/wCKAQMAGgEFACoBAwAlAQMA/wCKAQMAFwEBAAIBBwAoAQMAJQEDAP8AigEDABYBAwABAQMAAQEFACYBAwAjAQEAAQEDAP8AiQEDAAwBBQAGAQMAAQEDAAIBCAALAQEAFgEDAAYBAgAIAQEAEQEGAP8AiQEDAAgBCgAGAQYABAEHAAkBBAAUAQMABQEEAAYBAwAFAQEACAEIAP8AiQEDAAcBCwAGAQUABgEGAAgBBgAGAQIACwEDAAUBBAABAQEABQEDAAIBBAAGAQQAAQEEAP8AiQEDAAgBBAACAQMABwEFAAYBBgAIAQYABQEGAAgBAwAEAQQAAQEDAAQBAwABAQUABgEDAAIBBQD/AIkBAwANAQMABwEFAAYBBQAEAQEABQEFAAYBBgAHAQMAAwEEAAIBBAADAQoABQEDAAEBBgD/AIkBAwAMAQMACAEFAAYBAwAFAQMABAEEAAgBBQAHAQMAAwEDAAMBBAADAQYAAQEDAAUBAwACAQUA/wCKAQMACwEDAAkBBAAGAQMABQEDAAUBAwAIAQQACAEDAAMBAwAEAQMAAwEFAAIBAwAEAQMABAEEAP8AigEDAAsBAwAJAQQABgEDAAUBBAAEAQMACQEDAAgBAwADAQMAAwEEAAEBAQABAQUAAgEDAAQBAwAEAQQA/wCLAQMACgEDAAkBBAAHAQMABAEEAAMBBQAIAQMACAEDAAMBAwADAQwAAgEDAAQBAwAEAQQA/wCMAQQACAEDAAkBBAAHAQMAAwENAAUBAQADAQMABwEDAAMBAwACAQgAAQEEAAIBAwADAQEAAQEDAAMBBAD/AI0BDgAJAQQACAETAAMBAwACAQMACAEDAAMBCwACAQQAAwEKAAIBBQD/AI4BDQAKAQMACAEHAAIBCgADAQMAAgEDAAgBAwADAQYAAgECAAMBBAAEAQUAAQEDAAIBBQD/AJABDAAJAQMACQEFAAgBBgACAQQAAQEDAAkBAQAFAQQACAEDAAYBAwADAQMAAQEGAP8AlwEEAAoBAQAYAQUAAwEHABsBAwAMAQYAAQEDAP8AlwEDACYBAgAFAQUAHQEBAA4BBQACAQMA/wCXAQEAMAECAC4BBAACAQMA/wD5AQIABAEDAP8A/gEDAP8A/wEBAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wAz"
{widgets}
gDesc:{"type":"field","size":[204,200],"pos":[153,70],"align":"center","value":"The wind is warm and soft, sunlight settling down on the ground and warming the earth, feeding the grass. Stepping off the path is like stepping onto an endless emerald ocean. Waves of long, plush grass as far as the eye can sea all swaying and moving in gentle motions as the wind quietly guides the blades back and forth.\n\nThe only sound for miles around is that of the wind,and the subtle rustle of the grass against itself.\n\nThe horizion seems so close. It curves and slips just beyond view. It seems to stretch on and on into infinity.\n\nThe road back is quiet."}
run:{"type":"button","size":[204,20],"pos":[153,280],"script":"grassland.0","text":"Return"}

{script:grassland.0}
on click do
play["walking_2"]
  go["Lake" "SlideRight"]
end
{end}

{card:Shelter}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A7wEBACEBAQD/AN0BAwAfAQMACQEBAP8AwgELAAUBAwAfAQMACAEDAP8AwAEOAAMBAwAfAQMACAEEAP8AvwEPAAIBAwAfAQMACQEDAP8AwAEDAAgBAgAEAQMAHgEDAAkBAwD/AMABAwAOAQMACQECABQBAwAIAQMA/wDBAQQADAEDAAgBBAATAQMACAEDAP8AwgEEAAwBAwAGAQYACgEBAAcBAwAIAQMA/wDDAQQACwEDAAUBAwABAQMACAEFAAYBAwAHAQMA/wDFAQQACQEDAAQBAwACAQMABwEHAAUBAwAHAQMAGAECAAMBCQD/AKABBAAIAQMAAwEDAAMBAwAGAQQAAQEDAAUBAwADAQwACAECAAgBBAABAQwAAQEBAP8AnQEEAAcBAwACAQMABAEDAAYBAwABAQMABgEDAAIBDgAFAQUABwEUAP8AlAECAAgBAwAHAQYABgEDAAQBAwACAQMABwEDAAIBDgADAQcABgEGAAkBBQD/AJMBBgAGAQMABgEGAAYBAwAEAQMAAgEDAAcBAwAGAQMABQEBAAMBBAABAQMABwEFAAsBAgD/AJMBCAAGAQMABQEFAAcBAwAEAQMAAQEDAAUBAQACAQMABgEDAAkBAwACAQMACAEDAP8AoQEDAAEBBQAGAQMABAEEAAgBAwADAQcABQEDAAEBAwAGAQMABQEBAAIBAwACAQMACQEDAP8AogEDAAMBAQAHAQMABAEEAAgBAwADAQYABgEDAAEBAwAGAQMABAEDAAEBBwAKAQMA/wCiAQMADAEDAAMBAwAJAQMAAwEFAAYBAwACAQMABgEDAAUBCQAHAQEAAwEDAP8AowEEAAoBAwADAQMACQEDAAQBAwAHAQMAAgEDAAYBAwAGAQcABwEDAAIBAwD/AKQBBgAGAQMABAEDAAkBAwAEAQMABQEEAAMBAwAGAQMABwEEAAgBAwADAQMA/wClAQ4ABQEDAAgBBAAEAQoABQEDAAUBAwAJAQMABgEDAAQBAwD/AKcBCwAFAQQACAEEAAUBCAAGAQMABQEDAAkBAwAFAQMABQEDAP8AqgEHAAcBAwAIAQMABwEFAAgBAwAFAQQACQEDAAIBBAAGAQMA/wC4AQMACQEBABYBAQAHAQMACgEHAAcBAwD/ALkBAQAqAQEADAEFAAkBAQD/APMBAgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AEs="
{widgets}
sDesc:{"type":"field","size":[204,200],"pos":[153,60],"align":"center","value":"Safe again from the outside world.\n\nEvery so often, the ramshackle walls shudder in the breeze letting in a faint coolness to the entire room. Scraps of cloth and dry grass litter the floor.\n\nA pile of various, useless trinkets assemble in the far back left corner. Dust would have settled on all of it, if not for the holes in the shelter blowing it clean.\n\nWhat remains of a fire sit smoldering in a pit in the center, faint embers being kicked up when the wind comes in. The residual heat has been long since sucked out by the cold.\n\nThere is nothing here."}
leave:{"type":"button","size":[204,20],"pos":[153,270],"script":"Shelter.0","text":"Leave"}
rest:{"type":"button","size":[204,20],"pos":[153,310],"script":"Shelter.1","text":"Rest"}

{script:Shelter.0}
on click do
  play["walking_2"]
  go["Lake" "SlideDown"]
end
{end}

{script:Shelter.1}
on click do
  if inventory.widgets.bloodCheck.text = "Yes"
   go["End"]
  else
   alert["It is not time."]
  end
end
{end}

{card:End}
{widgets}
end:{"type":"field","size":[170,40],"pos":[170,30],"font":"olympiad_title","border":0,"align":"center","value":"The End"}
ending:{"type":"field","size":[204,140],"pos":[153,80],"align":"center","value":"Laying down on the scraps of cloth, sleep overtakes, and the world begins to fade away. What was wrong has been righted, and nothing has changed for it.\n\nThe world spins, time marches on, and tomorrow will come with the rise of the sun and departure of the moon.\n\nSleep is peaceful, unfettered, and the wind gently blows through the room. It never grows too cold, nor does it become too hot. It is perfect, and the day is over."}
startOver:{"type":"button","size":[204,40],"pos":[153,230],"script":"End.0","text":"Begin Again"}

{script:End.0}
on click do
  go["Lake" "Wink"]
  inventory.widgets.weaponCheck:"No"
  inventory.widgets.weaponCount:"0"
  inventory.widgets.waterCheck:"No"
  inventory.widgets.waterCount:"0"
  inventory.widgets.bloodCheck:"No"
  inventory.widgets.bloodCount:"0"
  inventory.widgets.boneCheck:"No"
  inventory.widgets.boneCount:"0"
end
{end}

{card:wasteland}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/APIBAQAkAQIAHgEBAP8AugEDACIBBAAcAQMA/wC6AQMAIQEEABwBAwApAQEA/wB3AQEAGAEDACIBAwAcAQMAKAEDAP8AdQEDABcBAwAiAQMAHAEDACgBAwD/AHUBAwAXAQMAIgEDABwBAwAoAQQA/wB1AQMAFgEDACIBAwAcAQMAKAEEAP8AdQEDABYBAwAiAQMAHAEDACgBBAD/AHUBAwAKAQIACgEDACIBAwAcAQMAKAEEAP8AdgEDAAgBBAAJAQMAIgEDABwBAwAoAQQA/wB2AQMACAEEAAgBAwAfAQ0AFgEDACgBBAD/AHYBAwAHAQYABwEDAAkBAQAQAQMAAQEPABUBAwAoAQQA/wB2AQMABwEGAAcBAwAGAQUADAEHAAEBDQAGAQMADQEDACgBBAD/AHcBAwAFAQMAAgEDAAYBAwAFAQYACwEIAAYBAwAKAQUADAEDAAYBAgALAQEAFQEDAP8AdwEDAAUBAwACAQMABQEDAAUBBwAEAQEABgEEAAEBAwAGAQMACQEHAAsBAwAFAQQACQEDAAUBAQAOAQMA/wB3AQMABQEDAAMBAwAEAQMABAEDAAIBAwADAQMABgEDAAIBAQAHAQMACAEDAAIBAwALAQMABAEGAAgBAwAEAQMACAECAAMBAwD/AHgBAwAEAQMAAwEDAAQBAwAEAQMAAwEBAAMBBAAGAQQACQEDAAcBAwADAQMABQEBAAUBAwADAQMAAQEDAAkBAwACAQUABQEFAAIBAwD/AHgBAwADAQMABQEDAAMBAwAEAQMACAEDAAcBBAAIAQMABwEDAAMBAwAEAQMABAEDAAMBAwABAQMAAwEBAAUBAwACAQUABAEHAAEBAwD/AHkBAwACAQMABQEDAAMBAwAEAQMACAEEAAcBBAAHAQMABQEKAAUBAwAEAQMAAwEDAAEBAwACAQMABAEDAAEBBgADAQQAAQEDAAEBBAD/AHgBAwACAQMABgEDAAEBAwAFAQMABwEFAAkBAwAGAQMABAEKAAYBAwAEAQMAAwEDAAIBAQADAQMABQEGAAEBAwACAQMAAgEDAAEBBAD/AHgBAwACAQMABgEHAAUBAwAHAQYABAEBAAMBAwAHAQMABAEIAAYBAwAFAQMAAwEDAAYBAwAFAQYAAQEDAAIBAwABAQMAAgEEAP8AeQEGAAgBBQAGAQMABgEDAAIBCAADAQMABgEDAAUBAwAJAQMABgEDAAMBAwAGAQMABQEGAAEBAwACAQMAAQEDAAEBBQD/AHkBBgAJAQIACQEDAAQBBAADAQYABQEDAAUBAwAGAQMABQEFAAcBAwADAQMABgEEAAMBBgADAQMAAQEDAAIBAQACAQUA/wB6AQQAFQEKAAUBBwADAQMABQEDAAYBDAAIAQMAAwEDAAUBBQACAQcAAwEDAAEBAwAFAQUA/wB7AQIAFwEIAAkBCwAFAQEACAEKAAoBAwADAQMAAwEHAAEBBwADAQMAAQEDAAQBBgD/AJUBBQANAQgAEQEFAA0BAwADAQMAAgEEAAEBCgAEAQcABAEGAP8AqQEFACQBAwAEAQcAAwEEAAEBBAAEAQQAAQEDAAIBAwABAQMA/wDSAQMABQEEAAYBAgADAQMABAEEAAEBBgD/ANgBAwAGAQIADQEBAAYBAgADAQUA/wDYAQMAIgEEAP8A2AEDAP8A/gEDAP8A/wEBAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wA0"
{widgets}
wDesc:{"type":"field","size":[170,190],"pos":[170,60],"align":"center","value":"The wind whips and blows across a sea of sand. Waves of massive dunes, blown tall and torn down by ceaseless winds. Pieces of old ruins jut out from the smooth landscape, like fingers from old world giants grasping at a sky that is no longer theirs.\n\nAhead is one of the last remaining ruins admidst the sands. A concrete box, its corners worn and broken apart to create a wide enough hole to get through.\n\nBehind is the road that appears as it goes on."}
shack:{"type":"button","size":[170,30],"pos":[170,260],"script":"wasteland.0","text":"Destroyed Shack"}
leave:{"type":"button","size":[170,30],"pos":[170,300],"script":"wasteland.1","text":"Return"}

{script:wasteland.0}
on click do
  play["walking_3"]
  go["dShack" "SlideDown"]
end
{end}

{script:wasteland.1}
on click do
  play["walking_4"]
  go["Lake" "SlideLeft"]
end
{end}

{card:village}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wDnAQEACwEBAAYBAQD/AOwBAwADAQEABQEDAAQBAwD/AOsBAwACAQMABAEDAAQBAwD/ANwBAQAOAQMAAgEEAAMBAwAEAQMA/wDbAQMADAEDAAQBAwADAQMABAEDAP8A2wEDAAwBAwAFAQEABAEDAAQBAwD/ANwBAwALAQMACgEDAAQBAwD/ANwBAwALAQMACgEDAAQBAwD/AN0BAwAKAQMACwEDAAMBAwAHAQMA/wDTAQMACgEDAAsBAwADAQMABgEGACIBAgD/AK0BAwAJAQMADAEDAAMBAwAFAQgAHgEGAP8ArQEDAAgBAwAMAQMAAwEDAAQBAwADAQMADwEBAAwBCQD/AKwBAwAHAQMABgEBAAYBAwADAQMAAwEDAAQBAwAMAQYACQEGAAEBAwD/AK0BAwAGAQMABQEDAAUBAwAEAQMAAgEDAAQBAwALAQgABwEEAAQBAwD/AK0BAwAGAQMABQEDAAUBAwAEAQMAAgEDAAQBAwAKAQUAAQECAAcBAwAGAQMA/wCuAQMABAEDAAYBAwAFAQMABAEDAAIBAwAFAQEAAQEBAAgBAwAFAQEABAEFAAUBBQD/AK4BAwAEAQMABgEDAAYBAwADAQMAAgEDAAYBAwAHAQMABAEDAAIBBgADAQYA/wCvAQMAAwEDAAcBAwAGAQMAAwEDAAMBAwAFAQMACAEDAAIBBAADAQwABwEBAP8AqQEDAAMBAwAIAQMABgEDAAIBAwADAQMABQEDAAkBCAAEAQkACAEDAP8AqQEDAAIBAwAIAQMABgEDAAIBAwAEAQMABAEEAAgBCAAEAQcACQEDAP8AqgEDAAEBAwAKAQEABwEDAAMBAQAGAQMAAgEFAAkBAwABAQMABAEDAAwBAwD/AKsBAwABAQMAEwEBAAwBCgAEAQEABgEDAAUBAwALAQMA/wCtAQUAIgEFAAIBAwACAQMABQEDAAUBAwAKAQMA/wCuAQQAJAECAAUBBwAFAQMABgEDAAcBBAD/ALABAgAtAQUABgEDAAcBBAADAQUA/wDfAQUABwEDAAgBCgD/AN8BBAAIAQMACgEHAP8A4AEDAAoBAwAMAQMA/wDiAQMACQEDAP8A8QEDAAkBAwD/APIBAwAJAQMA/wDyAQMACAEDAP8A9AEEAAUBBAD/APUBCwD/APcBCQD/APoBBQD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBU"
{widgets}
vDesc:{"type":"field","size":[238,210],"pos":[136,60],"align":"center","value":"The hidden road starts narrow, buried, difficult to navigate, and even harder to follow. As it goes on, however, it clears and becomes more and more of a worn path. The remains of the city and safety of the lake are left behind.\n\nAhead are a set of three houses. Broken and battered by time, Some have become decrepit and fallen into disrepair. \n\nOne has been fixed up, and crude patches have been stuck to its walls to keep out the wind.\n\nAnother has been untouched, except by time. Its walls, windows, and doors are all falling apart.\n\nThe last one is untouched, even by time. Though the windows and walls are intact, they're impossible to see through, as though there's a haze preventing any visibility inside."}
home:{"type":"button","size":[102,20],"pos":[136,280],"script":"village.0","text":"Repaired House"}
aHouse:{"type":"button","size":[102,20],"pos":[272,280],"script":"village.1","text":"Decrepit House"}
eHouse:{"type":"button","size":[102,20],"pos":[136,310],"script":"village.2","text":"House"}
leave:{"type":"button","size":[102,20],"pos":[272,310],"script":"village.3","text":"Leave"}

{script:village.0}
on click do
  play["walking_3"]
  go["house" "WipeRight"]
end
{end}

{script:village.1}
on click do
  play["walking_2"]
  go["aHouse" "WipeDown"]
end
{end}

{script:village.2}
on click do
  play["walking_4"]
  go["eHouse" "WipeLeft"]
end
{end}

{script:village.3}
on click do
  play["walking_2"]
  go["Lake" "SlideUp"]
end
{end}

{card:house}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A4QEBAAkBAQD/APUBAwAHAQMA/wD0AQMACAEDAP8A8wEDAAgBAwD/APQBAwAHAQMA/wD0AQMABwEDAP8A9AEDAAcBAwD/APQBAwAHAQMAOAEFAP8AtwEDAAcBAwAJAQcAFQEEAA4BBwD/ALYBAwAHAQMACAEJAAQBAwAFAQEABgEHAAsBCAD/ALYBAwACAQgABwELAAIBBQADAQMABgEHAAkBAwADAQMA/wC2AQMAAQELAAQBAwACAQMAAQEDAAIBBAAEAQMABgEDAAEBAgAJAQMAAwEDAP8AtwEQAAIBAwADAQMAAQEDAAIBAwAFAQMABwEDAAoBAwADAQMA/wC4AQMAAQEBAAYBBAACAQMAAwEDAAIBAwACAQMABQEEAAcBAwAJAQMAAgEDAP8AuQEDAAgBAwADAQMAAwEDAAIBAwACAQMABQEFAAcBAwAHAQMAAQEEAP8AugEDAAgBAwADAQMABAEBAAIBAwADAQMABQEFAAQBBgAFAQkA/wC7AQMABwEEAAQBAwAGAQMABAEDAAQBEAADAQkABwECAP8AswEDAAcBBAAEAQMABAEEAAYBAwADAQMAAQEIAAEBAwAEAQYACAEEAP8AsgEDAAgBAwAFAQkACAEIAAIBBgACAQMABgEDAAkBAwD/ALMBBAAHAQMABgEHAAoBBgAHAQcABwEDAAcBAwD/ALUBAwAIAQEACAEEAA0BBAAJAQYACAEDAAMBBgD/ALUBAwAwAQUACQEKAP8AtwEBADMBAgALAQcA/wD7AQMA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBX"
{widgets}
hDesc:{"type":"field","size":[204,220],"pos":[153,60],"align":"center","value":"Trying the door reveals that it is stuck. It feels like there is something behind the door keeping it shut, as though it were locked.\n\nTrying a few more times with a bit more force each time works. Pushing through the door, whatever was keeping it shut shatters and reveals what's inside.\n\nHuddled together at the back of the room, their backs up against the wall, are a set of creatures. Their eyes, staring at the door that was broken open.\n\nA crackling fire sits in the center of the room, smoke billowing up and out a hole in the ceiling. There is a stick with a pathetic strip of something above it. It is roasting above the flame.\n\nThe creatures do not move."}
leave:{"type":"button","size":[204,40],"pos":[153,290],"script":"house.0","text":"Leave"}

{script:house.0}
on click do
  play["walking_1"]
  go["village" "SlideLeft"]
end
{end}

{card:eHouse}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8AHgEBAP8A5QEBABkBAwD/AMABAgAhAQMAFwEEAP8AuAEBAAIBCAAfAQQAGAEDAP8AtwELACABAwAZAQMA/wC3AQkAIgEDABkBAwD/ALcBBAAnAQMAGQEDAP8AtwEDACgBAwAZAQMA/wC3AQMAKAEDABkBAwD/ALcBAwAMAQEAEwEEAAMBBQAYAQMA/wC3AQMABgEBAAQBAwACAQIADQEGAAEBCQAVAQMAAwEEAP8AsAEDAAMBBQADAQMAAQEEAAIBAgAGAQkAAQEJAAkBAQAKAQMAAgEGAAUBAQAkAQMA/wCCAQMAAgEFAAQBAwABAQQAAQEEAAQBBAADAQMAAwEGAAEBAQAHAQMACQEDAAEBCAADAQUAFQEEAAcBBQD/AIEBCQAFAQMAAQEEAAEBBQADAQUAAwEDAAIBAwADAQMABQEDAAoBBgAEAQMAAQEHAAYBAQAMAQYABAEIAP8AgAEGAAgBDwACAQQABAEDAAIBAwAEAQMABAEDAAoBBQAFAQMAAQEIAAQBAwAFAQIAAwEIAAIBBAADAQMA/wB/AQUACQELAAEBAwACAQMABAEDAAMBAwAFAQMAAgEDAAsBBQAFAQYAAQEFAAQBAwAEAQQAAgEDAAEBAwADAQMABAEDAP8AfwEEAAUBAQAEAQsAAQEDAAEBBAADAQMABAEDAAYBBwALAQQABgEGAAEBBgADAQMABAEEAAIBBAABAQEAAwEDAAQBBAADAQEA/wB8AQMAAwEEAAMBCgADAQcAAwEDAAQBAwAHAQYADAEDAAYBBgACAQIAAQEDAAIBAwAEAQMABAEEAAQBAwADAQQAAwEDAP8AewEKAAMBBAACAQMABQELAAUBAwAIAQQADQEEAAUBBgAFAQMAAgEDAAQBBAADAQUAAwEDAAEBBQADAQMA/wB8AQkABAEDAAQBAQAHAQkABgEDAAgBAwAOAQQABQEGAAUBAwACAQMAAwEFAAIBBgABAQkABQEDAP8AfAEGAAgBAQAPAQYACAEBAAkBAwAOAQQABAEDAAIBAwAEAQMAAgEDAAIBAwABARMABQEDAP8AfgEBABwBAwAUAQMADwEEAAQBAwACAQoAAgEDAAIBAwABARMABQEDAP8AmwEDABQBAwAPAQQABQEBAAQBCAAEAQYAAwELAAQBCgD/AJwBBAATAQMADwEDAAwBBQAGAQUACAEGAAYBCAD/AJ0BBQASAQMAEAEBABkBAwAXAQUA/wCfAQQAEQEDAP8A6QEDABIBAwD/AOoBAQATAQMA/wD+AQMA/wD/AQEA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AGc="
{widgets}
leave:{"type":"button","size":[204,40],"pos":[153,290],"script":"eHouse.0","text":"Leave"}
eHouseDesc:{"type":"field","size":[204,220],"pos":[153,60],"align":"center","value":"The door opens with ease, gliding to a gentle stop shortly after it was pushed open.\n\nInside, the walls are intact if a bit neglected. The floor is still level and together, with a few spots of dirt and dust having gathered in random spots. The air is clear, and easy to breathe having no dust floating around.\n\nThe windows, despite being near opaque, are letting in natural light which makes it easy to see everything. Though, the haze still covers the glass and is impossible to wipe away, or see through.\n\nThe room is comfortably warm, the walls are intact, the door can be locked, the windows cannot be looked through. It is secure.\n\nIt is silent."}

{script:eHouse.0}
on click do
  play["walking_1"]
  go["village" "SlideRight"]
end
{end}

{card:aHouse}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AEsBAQD/AP8BAwD/AP4BAwD/AP4BAwD/AP4BAwD/AP4BAwD/AP4BAwD/AIgBAQAJAQEAMgEBADgBAwD/AIcBAwAHAQMAMAEDADcBAwD/AIcBAwAHAQMALwEEADcBAwD/AIYBBAAHAQMALwEEADcBAwD/AIYBBAAIAQMALgEEADcBBAD/AIQBBQAIAQMALgEEADcBBAD/AIQBBQAIAQMALgEEADcBBAD/AIMBBgAIAQMALgEFABgBAgAcAQQA/wCDAQYACAEDAAEBBgAnAQUAEQEDAAMBBAAbAQQA/wCCAQMAAQEDAAgBCwAmAQUACQEDAAQBBQACAQQADQEBAA0BBAD/AIEBAwACAQMACQELABABAQAEAQEACwEDAAEBBQAIAQUAAgEGAAEBBQAKAQUABgEDAAMBBAD/AIABAwADAQMACQEEAAUBAwAEAQIACAEDAAIBAwAIAQYAAQEEAAUBCQABAQYAAQEFAAgBBwAEAQYAAgEEAP8AgAEDAAQBAwAIAQMABgEDAAMBBAAHAQMAAgEEAAYBDAAEAQoAAQEMAAcBCAADAQcAAgEEAP8AfwEOAAUBAwAHAQMAAQEHAAUBAwABAQYABAEEAAMBBgADAREAAQEGAAYBCAAEAQMAAQEDAAEBBQD/AH4BEAAEAQMABwEGAAEBBQADAQQAAQEGAAQBAwACAQgAAwEDAAEBEAABAQMABgEHAAMBAQABAQMAAQEDAAEBBQD/AH0BAwABAQwABQEDAAcBBgACAQQAAwEHAAEBAwAEAQMAAQEJAAIBBAABAQQAAgEKAAEBAwAEAQcABAEGAAEBAwABAQUA/wB8AQMACQEDAAcBAwAHAQYAAgEEAAMBBwABAQMAAwEOAAEBCQADAQMAAQEFAAIBAwADAQYABQEHAAIBAQACAQUA/wB7AQQACQEDAAcBAwAGAQMAAQEDAAIBBAADAQcAAQEDAAIBBwAEAQQAAQEIAAQBAwABAQUAAgEDAAQBBQADAQUAAgEDAAMBBgD/AHoBBAALAQMAAQEBAAQBAwAGAQMAAQEDAAMBAwACAQgAAgEGAAEBAwAEAQUAAQEHAAQBAwACAQUAAgEEAAUBCgADAQMAAwEHAP8AegECAA0BBQADAQMABQEDAAMBAwABAQgAAQEFAAIBBQADAQMAAwEIAAEBAwAFAQMAAgEFAAMBBAAFAQcABgEDAAIBAwABAQQA/wCJAQMABAELAAMBCwACAQUAAgEEAAQBDQADAQkAAgEFAAQBBAAGAQQACAEDAAEBAwACAQMA/wCLAQEABgEJAAUBCQADAQUAAwECAAYBBwACAQIABAEIAAMBBQAEAQMAFAEGAAMBAQD/AJQBBgAIAQQACAEDAA0BBQAKAQYABAEEAAYBAQAWAQQA/wCzAQMAJwECAB8BAgD/ALUBAQD/APcBAQD/AP8BAwD/AP4BAwD/AP4BAwD/AP4BAwD/AP4BAwAEAQMALwECAP8AxgEDAAMBBQAhAQMACAEFAP8AxQEDAAIBBgAGAQEAAQEDABUBBgAFAQcA/wDEAQMAAQEDAAEBAwAEAQgAFAEHAAQBAwABAQMA/wDEAQcAAQEDAAMBCgAEAQEABgEBAAgBBgAEAQcA/wDEAQYAAgEDAAIBBwABAQMAAwEDAAQBAwAIAQQABAEHAAUBAQD/AL8BBQADAQMAAgEDAAEBAwACAQMAAQEEAAQBAwAIAQMABAEHAAUBAwD/AL4BBAAEAQMAAgEDAAEBBAABAQMAAQEDAAUBBAAFAQEAAgELAAYBAwD/AL8BBAAEAQMAAgEDAAEBAwACAQMAAQEDAAUBBAAEAQ8ABgEDAP8AvwEDAAUBAwACAQMAAgEBAAIBAwADAQMAAwETAAIBAwAEAQQA/wC/AQMABgEDAAIBAwAFAQMABAEIAAEBBgABAQYABQEJAP8AwAEEAAQBBAADAQMAAgEEAAUBBwADAQQAAgEGAAYBBwD/AMEBBAAEAQMABAEIAAcBBAAMAQQACAEEAP8AwwEDAAYBAQAGAQYAGgEBAP8A0QEBABABAgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AEM="
{widgets}
aHouseDesc:{"type":"field","size":[204,200],"pos":[153,80],"style":"plain","align":"center","value":"The door opens with no resistance, partially crumbling as it swings open and collides with the wall. Opening the door scattered dust and debris across the floor, the rotten wood splitering and snapping as it catches against the rough floor.\n\nAfter the dust settles and the crumbling house collects itself again, all that remains is nothing. The home is dark, and dingy. Anything that was here is either decayed beyond recognition, or gone entirely.\n\nAll there is are the piles of dust in the corners, collected carefully by the wind that sneaks in through the cracks.\n\nIt is silent, aside from the ominous creaking from the aging wood."}
leave:{"type":"button","size":[204,40],"pos":[153,290],"script":"aHouse.0","text":"Leave"}

{script:aHouse.0}
on click do
  play["walking_2"]
  go["village" "SlideUp"]
end
{end}

{card:basement}
image:"%%IMG2AgABVhT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U7gEFFP8U+QEJFP8U9QENFFoBART/FJgBBwAFAQMUWAEDFP8UlwEEAAkBAxRXAQMU/xSXAQMACgEDFFcBAxQJAQQU/xSKAQMACgEDFFcBBBQGAQcU/xSJAQMACgEDFFcBBBQDAQkU/xSKAQMACgEDFFABAhQGAQsU/xSOAQMACQEDFCwBARQjARIU/xSQAQMACQEDFCYBARQEAQMUIQEQFP8UkwEDAAgBAxQfAQIUBQEDFAIBBBQDAQIUHAEOFP8UlQEDAAUBBRQXAQIUBQEFFAQBBBQBAQQUAgEEFBUBARQEAQQABQEGFP8UlQEDAAIBBxQJAQQUCAEGFAMBBhQFAQMUAQEEFAIBBBQLAQEUCAEDFAIBBQAEAQMUAgEDFP8UlAEDAAEBBxQJAQYUBgEIFAEBBxQEAQMAAQEFFAIBBBQJAQQUBgEEFAEBBgAEAQMUAgEDFP8UlAEDAAIBBxQGAQcUBgEFAAIBAQABAQMAAgEDFAQBCRQBAQUUCAEGFAYBAxQBAQYABAEDFAIBAxT/FJQBAwAGAQQUBAEEFAUBAhQEAQMABQEDAAIBAxQEAQUUAQEDFAEBBhQGAQcUBgEGFAIBAwACAQMUBAEDFP8UkwEDAAgBAxQCAQQUBQEEFAQBBAACAQMAAgEDFAQBBhQBAQYUAQEDFAQBCBQHAQYUAgEDAAIBAxQEAQMU/xSTAQMACQEDFAEBAxQGAQQUBQEEAAEBBxQFAQUUAgEGFAEBAxQDAQgUCAEFFAQBAwABAQMUBAEEFP8UkQEDAAoBAxQBAQMUBQEEFAUBAQABAQoUBQEGFAIBBhQBAQMUBAEGFAYBARQDAQMUBgEFFAYBBBT/FJABBAAJAQMUAgELFAMBDRQFAQcUAgEGFAIBAxQBAQIAAQEDFAcBAxQDAQEUCAEDFAcBBBT/FJABBAAIAQQUAwEaFAMBBBQBAQMUBAEFFAIBChQGAQMUDgEBFAkBAxT/FJABDxQFAQUUAgENFAMBCBQDAQEUBQEEFAQBBRQCAQoUGQEEFP8UjwEOFA4BBBQDAQUUBAEGFAoBAxQGAQIUBQEIFBoBAxT/FJEBCxQaAQEUBgEDFA0BARQPAQYUHAEBFP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FP8U/xT/FLAVhBT/FHkVjxT/FGcVnhT/FGAVoxT/FF0VphT/FFkVqhT/FFQVrxT/FFAVshT/FE0VFAU9FWUU/xRKFRAFSAABFV8U/xRIFQ8FWBVTFP8URhUNBWAVCgUsFRkU/xREFQsAAQWdFRUU/xRDFQkFpRURFP8UQRUJBakVDxT/FEAVBwUUATgFYRUOFP8UPxUGBQgBBQUDAUMFXRUMFP8UPxUFBQcBXAU4AREFCBUKFP8UPhUEBQYBYgUPATgFCBUIFP8UPhUDBQUBCgADAZ8FCBUHFP8UPRUEBQQBCAAHAaAFBxUHFP8UPBUEBQMBBwALAZ8FBxUGFP8UPBUDBQQBBgARAZsFBxUFFP8UOxUEBQQBBQAqAXcABAEJBQcVBRT/FDoVBAUEAQUAlQEDABABBwUHFQQU/xQ6FQUFAwEFAKkBBgUHFQUU/xQ5FQUFAwEGAKkBBgUHFQQU/xQ4FQYFAwEHAKkBBQUHFQUU/xQ3FQYFAwEHAKkBBQUHFQUU/xQ3FQYFAwEHAKkBBQUHFQYU/xQ2FQYFAwEHAKoBBAUHFQYU/xQ1FQcFAwEHAKoBBAUHFQYU/xQ1FQcFAwEHAKoBBAUHFQcU/xQ0FQcFAwEGAKsBBAUHFQcU/xQ0FQcFAwEGAKoBBQUHFQcU/xQ0FQcFAwEGAKoBBQUHFQcU/xQ0FQcFBAEFAKoBBQUIFQYU/xQ0FQcFBQEEAKoBBQUIFQYU/xQ0FQcFBgEEAKkBBQUIFQcU/xQyFQgFBwEDAKkBBgUHFQcU/xQyFQgFBwEDAKkBBgUHFQcU/xQyFQgFBwEEAKgBBgUHFQcU/xQyFQgFBwEEAKgBBgUHFQcU/xQyFQgFCAEDAKgBBgUHFQcU/xQyFQgFCAEEAKcBBgUHFQcU/xQxFQoFBwEEAKcBBgUHFQcU/xQxFQoFBwEFAKYBBgUHFQcU/xQwFQsFCAEEAKYBBgUHFQcU/xQwFQsFCAEEAKUBBwUHFQcU/xQwFQwFBwEEAKUBBwUHFQcU/xQwFQwFBwEEAKUBBwUHFQcU/xQwFQwFBwEEAKUBBwUHFQcU/xQxFQsFBwEFAKMBCAUHFQcU/xQxFQsFBwEFAKMBCAUHFQcU/xQxFQsFBwEFAKMBCAUHFQcU/xQxFQsFBwEFAKMBCAUHFQcU/xQxFQsFBwEFAKMBCAUHFQcU/xQxFQsFBwEFAKMBCAUHFQcU/xQxFQsFCAEFAKEBCQUHFQcU/xQxFQsFCAEFAKEBCQUHFQcU/xQxFQwFBwEFAKEBCQUHFQcU/xQxFQwFBwEFAKEBCAUIFQcU/xQxFQwFBwEFAKEBCAUIFQcU/xQxFQwFBwEFAKABCQUHFQgU/xQxFQwFBwEFAKABCAUIFQgU/xQxFQsFCAEFAKABCAUIFQgU/xQxFQsFCAEFAKABCAUHFQkU/xQxFQsFBwEGAKABCAUHFQkU/xQxFQsFBwEGAKABCAUHFQkU/xQxFQoFCAEFAKEBCAUHFQkU/xQxFQoFCAEFAKEBCAUHFQkU/xQxFQoFBwEGAKEBCAUHFQkU/xQxFQoFBwEGAKEBCAUHFQkU/xQxFQoFBwEGAKEBCAUHFQkU/xQxFQoFBwEGAKIBBwUHFQkU/xQxFQkFCAEHAKEBBwUHFQkU/xQxFQgFCQEFAKMBBgUIFQkU/xQxFQgFCQEEAKQBBgUIFQkU/xQxFQgFCAEEAKUBBgUHFQoU/xQxFQcFCAEFAKUBBgUHFQoU/xQxFQcFCAEFAKUBBgUHFQoU/xQxFQYFCAEGAKUBBgUHFQoU/xQxFQYFCAEGAKUBBQUIFQoU/xQxFQYFCAEGAKYBBAUIFQoU/xQxFQYFBwEHAKYBBAUHFQsU/xQwFQcFBwEGAKcBBAUHFQsU/xQwFQcFBwEGAKgBAwUHFQsU/xQwFQcFBwEGAKgBAwUHFQsU/xQwFQYFCAEGAKgBAwUHFQsU/xQwFQYFCAEGAKgBAwUHFQsU/xQvFQcFCAEGAKgBAwUHFQsU/xQvFQcFBwEHAKcBBAUHFQsU/xQvFQcFBwEHAKYBBQUHFQsU/xQvFQcFBwEHAKUBBgUIFQoU/xQvFQYFCAEHAKQBBwUIFQoU/xQuFQcFCAEHAKMBCQUHFQsU/xQtFQcFBwEIAKMBCQUHFQsU/xQtFQcFBwEIAKMBCQUHFQsU/xQtFQcFBwEIAKMBCQUIFQoU/xQtFQcFBwEIAKMBCQUJFQkU/xQtFQcFBwEIAKMBCgUJFQkU/xQsFQcFBwEIAKMBCgUJFQkU/xQsFQcFBwEIAKMBCgUKFQgU/xQsFQcFBwEIAKMBCwUJFQgU/xQsFQcFBwEJAKIBCwUJFQgU/xQsFQcFBwEJAKIBCwUJFQgU/xQsFQcFBwEJAKIBCwUJFQkU/xQrFQcFBwEJAKIBCwUJFQkU/xQrFQcFBwEJAKEBDQUIFQkU/xQrFQcFCAEIAKEBDQUIFQkU/xQrFQcFCAEIAKEBDQUIFQkU/xQrFQgFBwEIAKEBDQUIFQkU/xQrFQgFBwEIAKEBDQUIFQkU/xQrFQgFBwEIAKEBDQUIFQkU/xQrFQgFBwEIAKEBDQUHFQoU/xQrFQgFBwEIAKEBDQUHFQoU/xQrFQgFBwEHAKIBDQUHFQoU/xQrFQgFBwEHAKIBDAUIFQoU/xQrFQgFBwEHAKIBDAUIFQoU/xQrFQgFCAEGAKIBDAUIFQoU/xQrFQgFCAEHAKEBDAUHFQsU/xQrFQkFBwEHAKABDQUHFQsU/xQrFQkFBwEHAKABDQUHFQsU/xQrFQkFBwEHAKABDQUHFQoU/xQsFQkFBwEIAJ8BDQUHFQoU/xQsFQkFCAEHAJ8BDQUHFQoU/xQsFQkFCAEHAJ8BDQUHFQoU/xQsFQoFBwEHAJ8BDQUHFQoU/xQsFQoFBwEHAJ8BDQUHFQoU/xQsFQoFBwEIAJ4BDQUHFQoU/xQsFQoFBwEIAJ4BDAUIFQoU/xQsFQoFCAEHAJ4BDAUIFQoU/xQsFQoFCAEIAJ0BDAUHFQsU/xQsFQsFBwEJAJwBDAUHFQsU/xQsFQsFCAEJAJsBDAUHFQsU/xQsFQsFCAEJAJsBCwUIFQsU/xQsFQwFBwEJAJsBCwUIFQsU/xQsFQwFBwEJAJsBCwUHFQwU/xQsFQwFBwEJAJsBCwUHFQwU/xQsFQwFBwEJAJsBCwUHFQwU/xQsFQwFBwEJAJsBCwUHFQwU/xQsFQwFBwEIAJwBCwUHFQwU/xQsFQwFBwEHAJ0BCwUHFQwU/xQsFQwFBwEGAJ4BCwUHFQwU/xQsFQwFBwEFAJ8BCwUHFQwU/xQsFQsFCAEEAKABCwUHFQwU/xQsFQoFCQEEAKABCwUHFQsU/xQtFQkFCQEFAKABCgUIFQsU/xQtFQkFCQEEAKIBCQUIFQsU/xQtFQkFCAEFAKMBCAUHFQwU/xQtFQkFBwEGAKMBCAUHFQwU/xQtFQkFBwEGAKMBCAUHFQsU/xQuFQkFBwEGAKQBBgUIFQsU/xQuFQkFBwEHAKMBBgUIFQsU/xQuFQkFBwEHAKQBBQUHFQwU/xQuFQkFBwEHAKQBBQUHFQwU/xQuFQkFBwEHAKQBBQUHFQwU/xQuFQkFBwEHAKMBBgUHFQsU/xQvFQkFBwEHAKQBBAUIFQsU/xQvFQkFBwEIAKQBAwUIFQsU/xQvFQkFBwEIAKQBAwUHFQwU/xQvFQkFBwEJAKMBAwUHFQwU/xQvFQkFBwEJAKMBAwUHFQwU/xQvFQkFBwEKAKIBAwUHFQsU/xQwFQkFBwELAKABBAUHFQsU/xQwFQkFBwELAJ8BBQUHFQsU/xQwFQkFBwELAJ0BBwUHFQsU/xQwFQkFBwELAJ0BBwUHFQsU/xQwFQkFBwELAJ0BBwUHFQsU/xQwFQkFBwELAJ0BBwUHFQsU/xQvFQoFBwEKAJ4BBwUHFQsU/xQvFQoFBwEKAJ4BBwUHFQsU/xQvFQoFCAEJAJ4BBwUHFQsU/xQvFQoFCAEJAJ4BBwUIFQoU/xQvFQsFBwEJAJ4BBwUIFQoU/xQvFQsFBwEJAJ4BBwUIFQoU/xQvFQsFCAEIAJ4BBgUJFQoU/xQvFQsFCAEIAJ4BBgUJFQoU/xQvFQsFCAEIAJ4BBgUJFQoU/xQvFQwFBwEIAJ4BBgUJFQoU/xQvFQwFBwEIAJ4BBgUJFQoU/xQvFQwFBwEIAJ4BBgUJFQkU/xQwFQwFBwEIAJ4BBgUJFQkU/xQwFQwFBwEIAJ4BBgUJFQkU/xQwFQwFCAEHAJ4BBgUJFQkU/xQwFQwFCAEHAJ4BBgUJFQkU/xQwFQ0FBwEIAJ0BBgUJFQkU/xQwFQ0FBwEIAJ0BBgUJFQkU/xQwFQ0FBwEIAJ0BBgUJFQkU/xQwFQ0FCAEHAJ0BBgUIFQoU/xQwFQ0FCAEHAJ0BBgUIFQoU/xQwFQ4FBwEHAJ0BBgUIFQoU/xQwFQ4FCAEGAJ0BBgUIFQoU/xQwFQ4FCAEGAJ0BBgUHAAEVChT/FDAVDwUIAQYAnAEGBQcVCxT/FDAVDwUJAQYAmwEFBQgVCxT/FDAVEAUIAQgAmQEEBQkVCxT/FDAVEAUKAQcAmAEEBQkVCxT/FDEVEAUKAQkAlQEEBQgVDBT/FDEVEAULAQoAkwEDBQkVDRT/FDAVEQUMAQwAjgEEBQkVDRT/FDAVEgUMAUcAQwEJAAUBBAUJFQ4U/xQwFRMFDAFTABYBDQANARcFCRUPFP8UMBUVBQwBlwUKFQ8U/xQwFRYFDAGMBQUBBAUKFREU/xQvFRcFDQGFBRcVEhT/FC8VGAUQAX0FGhUTFP8ULxUaBR4BJwVfFRQU/xQvFRsFohUVFP8ULxUcBaEVFRT/FC8VHQWgFRUU/xQvFR8FnRUWFP8ULhUjBZkVFxT/FC0VKAWNFSEU/xQpFTkFLBVIBQkVJBT/FCYVrwUHFSYU/xQlFdwBART/FCQBARXaAQIUkwH/Af8B/wH/Af8B/wH/Af8B/wH/AQoNvgEYDf8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/Df8N/w3/DZ8="
script:"basement.0"
{widgets}
bDesc:{"type":"field","size":[170,190],"pos":[170,80],"script":"basement.1","show":"transparent","border":0,"style":"plain","align":"center","value":"The door opens, its hinges creaking as the heavy wood swings aside to open a passage down a set of stairs.\n\nDescending the stairs, the cool air permeates throughout the entire basement. The concrete feels solid, if cold. A breeze blows through,but it seems to circulate and return from where it came from.\n\nDespite the little light that in available, it can be seen where the rushing air comes from, and returns to.\n\nA tunnel has been carved out of the concrete. It leads downwards."}
t:{"type":"button","size":[170,20],"pos":[170,280],"script":"basement.2","text":"Enter"}
Leave:{"type":"button","size":[170,20],"pos":[170,310],"script":"basement.3","text":"Leave"}

{script:basement.0}
on view do
 
end
{end}

{script:basement.1}
on change val do
 
end
{end}

{script:basement.2}
on click do
  play["walking_1"]
  go["Next" "WipeDown"]
end
{end}

{script:basement.3}
on click do
  play["walking_3"]
  go["eHouse" "WipeUp"]
end
{end}

{card:t1}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AOMBAwD/APwBCgD/APYBFQA8AQIA/wCtAQQAAwETADcBBAD/AK0BBQAGAQ8ANwEDAP8ArwEEAAQBAwAIAQQAOAEDAP8AsAECAAUBAwBEAQMA/wC3AQMARAEDAP8AtwEDAEQBAwD/ALcBAwBEAQMA/wC3AQMAHwECACMBAwD/ALcBAwAIAQIADgECAAQBBAAEAQEABAEDABYBAwD/ALcBAwAHAQQABgEBAAUBBAACAQUAAwEDAAIBBQAJAQMACQEDAP8AtwEDAAcBAwAGAQMABQEDAAIBBQADAQMAAQEHAAcBBQAIAQMA/wC3AQMABgEDAAYBBAAFAQMAAQEGAAMBBgACAQMABgEGAAgBAwD/ALcBAwAGAQMABgEDAAYBAwABAQYAAwEGAAIBAwAFAQMAAQEDAAgBAwD/ALgBAwAFAQMABgEDAAYBAwABAQYAAwEGAAIBAwAFAQMAAQEDAAkBAwD/ALcBAwAFAQMABAEGAAQBAQABAQUAAQEDAAMBBgACAQMABAEIAAkBAwD/ALcBAwAFAQ0AAwEIAAEBAwADAQUAAwEDAAQBBwADAQEABgEDAP8AtwEDAAYBCAACAQMAAQEJAAEBAwADAQUAAwEDAAQBBgADAQMABQEDAP8AtwEDAAcBBQAEAQcAAQEEAAIBAwADAQUAAwEDAAQBAwAGAQMABQEDAP8AtwEDABEBBQACAQQAAgEEAAMBBAADAQQAAwEDAAUBBAAFAQMA/wC4AQEAEwECAAQBBAACAQUAAgEDAAQBAwAEAQMAAwEFAAYBAwD/ANIBAwADAQQAAwEDAAUBAQAGAQkABwEDAP8A0wEBAAUBAgAFAQEADgEGAAoBAwD/AO8BAwAMAQMA/wD/AQEA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AEQ="
{widgets}
t1Desc:{"type":"field","size":[170,190],"pos":[170,60],"align":"center","value":"The air in the tunnel is cooler than the basement by a small, but noticeable, margin. Walls curve into the ceiling and leave ample room to travel through. The breeze flows by from behind.\n\nWith what little light there is, it's clear to see that the path down the tunnel is anything but linear. It starts steep, almost a slide, but seems to flatten out just a few feet ahead.\n\nThe darkness makes it hard to see much further than that.\n\nGoing down the slope will make it difficult to return."}
t2:{"type":"button","size":[170,30],"pos":[170,260],"script":"basement.2","text":"Proceed"}
leave:{"type":"button","size":[170,30],"pos":[170,300],"script":"t1.0","text":"Leave"}

{script:t1.0}
on click do
  play["walking_2"]
  go["Prev" "SlideUp"]
end
{end}

{card:t2}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBRAQIA/wD+AQQA/wD9AQUA/wD7AQYA/wCIAQMAbwEDAAEBAwD/AIYBCgBpAQMAAgEDAP8AhQEVADwBAgAhAQMAAgEDAP8AhAEEAAMBEwA3AQQAIQEBAAMBAwD/AIUBBQAGAQ8ANwEDACUBAwD/AIcBBAAEAQMACAEEADgBAwAlAQMA/wCIAQIABQEDAEQBAwAlAQMA/wCPAQMARAEDACQBAwD/AJABAwBEAQMAJAEDAP8AkAEDAEQBAwAjAQQA/wCQAQMAHwECACMBAwAXAQEACgEHAP8AjgEDAAgBAgAOAQIABAEEAAQBAQAEAQMAFgEDAA4BAQAGAQQACQEIAP8AjQEDAAcBBAAGAQEABQEEAAIBBQADAQMAAgEFAAkBAwAJAQMADQEDAAQBBAAJAQoA/wCMAQMABwEDAAYBAwAFAQMAAgEFAAMBAwABAQcABwEFAAgBAwANAQMAAwEEAAoBBgABAQMA/wCMAQMABgEDAAYBBAAFAQMAAQEGAAMBBgACAQMABgEGAAgBAwAOAQMAAQEFAAsBBAADAQMA/wCLAQMABgEDAAYBAwAGAQMAAQEGAAMBBgACAQMABQEDAAEBAwAIAQMADgEIAAwBBAAEAQMA/wCLAQMABQEDAAYBAwAGAQMAAQEGAAMBBgACAQMABQEDAAEBAwAJAQMADgEGAA0BAwAGAQEA/wCMAQMABQEDAAQBBgAEAQEAAQEFAAEBAwADAQYAAgEDAAQBCAAJAQMADgEFAA8BAQD/AJQBAwAFAQ0AAwEIAAEBAwADAQUAAwEDAAQBBwADAQEABgEDAA0BBQD/AKUBAwAGAQgAAgEDAAEBCQABAQMAAwEFAAMBAwAEAQYAAwEDAAUBAwAMAQcA/wCkAQMABwEFAAQBBwABAQQAAgEDAAMBBQADAQMABAEDAAYBAwAFAQMADAEHAP8ApAEDABEBBQACAQQAAgEEAAMBBAADAQQAAwEDAAUBBAAFAQMACwEFAAEBAwD/AKQBAQATAQIABAEEAAIBBQACAQMABAEDAAQBAwADAQUABgEDAAsBBAADAQMA/wC9AQMAAwEEAAMBAwAFAQEABgEJAAcBAwAKAQQABQEEAP8AvAEBAAUBAgAFAQEADgEGAAoBAwAJAQMABwEEAP8A2AEDAAwBAwAKAQEACQEDAP8A6AEBABYBAQD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8ALQ=="
script:"t2.0"
{widgets}
t2Desc:{"type":"field","size":[170,200],"pos":[170,60],"align":"center","value":"Going down the harsh slope until the path begins to level out again, it's clear now that it's impossible to go back. The only way is forward.\n\nAhead, the tunnel grows darker, and colder. The walls are becoming smoother, and the curve of the ceiling becoming even more precise. It's hard to tell just where the flat of the wall becomes the ceiling, but it can be found.\n\nThe wind blowing through the passageway is slower than it was previously, and its growing absence brings silence.\n\nAhead, the path continues."}
continue:{"type":"button","size":[170,40],"pos":[170,280],"script":"t2.1","text":"Continue"}

{script:t2.0}
on view do
 if invTracker1.weaponCheck="Yes"
  play["sosumi"]
 end
end
{end}

{script:t2.1}
on click do
  play["walking_2"]
  go["t3" "SlideDown"]
end
{end}

{card:t3}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AOMBAwBtAQQA/wCLAQoAZgEIAP8AiAEVADwBAgAdAQoA/wCGAQQAAwETADcBBAAdAQIABAEEAP8AhgEFAAYBDwA3AQMAJAEDAP8AiAEEAAQBAwAIAQQAOAEDACIBBAD/AIoBAgAFAQMARAEDACEBBAD/AJIBAwBEAQMAHwEFAP8AkwEDAEQBAwAeAQYA/wCTAQMARAEDAB8BBQD/AJMBAwAfAQIAIwEDAA8BAQARAQMA/wCTAQMACAECAA4BAgAEAQQABAEBAAQBAwAWAQMADgEDABABAwD/AJMBAwAHAQQABgEBAAUBBAACAQUAAwEDAAIBBQAJAQMACQEDAA8BAwADAQEACwEDAP8AkwEDAAcBAwAGAQMABQEDAAIBBQADAQMAAQEHAAcBBQAIAQMADwEDAAIBAwAFAQcA/wCUAQMABgEDAAYBBAAFAQMAAQEGAAMBBgACAQMABgEGAAgBAwAPAQMAAQEDAAUBBwD/AJUBAwAGAQMABgEDAAYBAwABAQYAAwEGAAIBAwAFAQMAAQEDAAgBAwAPAQYABQEHAP8AlwEDAAUBAwAGAQMABgEDAAEBBgADAQYAAgEDAAUBAwABAQMACQEDAA4BBQAHAQEA/wCcAQMABQEDAAQBBgAEAQEAAQEFAAEBAwADAQYAAgEDAAQBCAAJAQMADwEDAP8ApQEDAAUBDQADAQgAAQEDAAMBBQADAQMABAEHAAMBAQAGAQMADgEEAP8ApQEDAAYBCAACAQMAAQEJAAEBAwADAQUAAwEDAAQBBgADAQMABQEDAA4BBQD/AKQBAwAHAQUABAEHAAEBBAACAQMAAwEFAAMBAwAEAQMABgEDAAUBAwANAQYA/wCkAQMAEQEFAAIBBAACAQQAAwEEAAMBBAADAQMABQEEAAUBAwANAQMAAQEDAP8ApAEBABMBAgAEAQQAAgEFAAIBAwAEAQMABAEDAAMBBQAGAQMADAEDAAIBAwD/AL4BAwADAQQAAwEDAAUBAQAGAQkABwEDAAwBAwADAQMA/wC+AQEABQECAAUBAQAOAQYACgEDAAoBAwAFAQMA/wDaAQMADAEDAAoBAwAFAQMA/wDqAQEACgEDAAEBAQAFAQQA/wDzAQYABQEEAP8A8gEFAAcBBAD/APEBBAAKAQEA/wDzAQIA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8ALw=="
script:"t3.0"
{widgets}
field1:{"type":"field","size":[170,230],"pos":[170,60],"align":"center","value":"Deeper still the tunnel goes. Its walls are like polished glass, the ceiling curved to perfection. A seamless transition makes it impossible to find where the walls end, and the ceiling begins.\n\nThe wind is dying,and the silence is heavy. It bears down on everything, filling the void like water fills a container. The shadows, cast from what dying light remain, lengthen from their corners. The darkness seems to ebb, and flow, back and forth. Not as though the light it came from is flickering, but instead as though the shadow itself is alive.\n\nThe path continues on ahead, almost flat now, but somehow it still feels like a rapid descent down. Down into... something."}
continue:{"type":"button","size":[170,30],"pos":[170,300],"script":"t3.1","text":"Continue"}

{script:t3.0}
on view do
 if invTracker1.weaponCheck="Yes"
  alert["bong"]
 end
end
{end}

{script:t3.1}
on click do
  play["walking_3"]
  go["t4" "SlideDown"]
end
{end}

{card:t4}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AOMBAwD/APwBCgD/APYBFQA8AQIA/wCtAQQAAwETADcBBAAqAQEA/wCCAQUABgEPADcBAwAiAQIABQEDAP8AgwEEAAQBAwAIAQQAOAEDACEBBAADAQMA/wCFAQIABQEDAEQBAwAhAQMABAEDAP8AjAEDAEQBAwAhAQMABAEDAP8AjAEDAEQBAwAhAQMABAEDAP8AjAEDAEQBAwAhAQMABAEEAP8AiwEDAB8BAgAjAQMAIQEDAAMBBAD/AIwBAwAIAQIADgECAAQBBAAEAQEABAEDABYBAwAhAQsA/wCLAQMABwEEAAYBAQAFAQQAAgEFAAMBAwACAQUACQEDAAkBAwANAQIAEwEKAP8AiwEDAAcBAwAGAQMABQEDAAIBBQADAQMAAQEHAAcBBQAIAQMADAEEAAsBAQAHAQQAAwEDAP8AigEDAAYBAwAGAQQABQEDAAEBBgADAQYAAgEDAAYBBgAIAQMADAEFAAgBBAANAQMA/wCKAQMABgEDAAYBAwAGAQMAAQEGAAMBBgACAQMABQEDAAEBAwAIAQMADQEFAAUBBQAPAQMA/wCKAQMABQEDAAYBAwAGAQMAAQEGAAMBBgACAQMABQEDAAEBAwAJAQMADwEDAAMBBQAQAQQA/wCJAQMABQEDAAQBBgAEAQEAAQEFAAEBAwADAQYAAgEDAAQBCAAJAQMAEAEDAAEBBAATAQIA/wCKAQMABQENAAMBCAABAQMAAwEFAAMBAwAEAQcAAwEBAAYBAwARAQUA/wChAQMABgEIAAIBAwABAQkAAQEDAAMBBQADAQMABAEGAAMBAwAFAQMAEgEDAP8AogEDAAcBBQAEAQcAAQEEAAIBAwADAQUAAwEDAAQBAwAGAQMABQEDABEBBQD/AKEBAwARAQUAAgEEAAIBBAADAQQAAwEEAAMBAwAFAQQABQEDABABAwABAQMA/wChAQEAEwECAAQBBAACAQUAAgEDAAQBAwAEAQMAAwEFAAYBAwAPAQMAAgEDAP8AuwEDAAMBBAADAQMABQEBAAYBCQAHAQMADgEDAAQBAwD/ALsBAQAFAQIABQEBAA4BBgAKAQMADAEDAAYBAwD/ANcBAwAMAQMADAEDAAcBAwD/AOYBAQAMAQUABwEDAP8A8gEEAAkBAQD/APQBAgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/ADE="
{widgets}
t4Desc:{"type":"field","size":[238,240],"pos":[136,50],"align":"center","value":"It is black.\n\nSmoother than anything that has existed before, and honed beyond perfection, just touching the walls seems like a defiance against nature, as they seem to deflect anything that seems to contact it. \n\nThe wind is softer than a dying whisper, and the oppressive silence that takes its place forces itself against the walls. It's heavy, and loud, and makes it hard to remember what anything sounded like. What hearing was like.\n\nDarkness licks and thrashes at the walls, urging and moving within the tunnel. Shadows grasp and breathe at the untouchable walls. It seems hungry, and claws as what little light there is left.\n\nThe tunnel floor is undeniably flat now. It takes no effort to move across it. It is the last steps toward an invisible precipice.\n\nIt is the only road left."}
continue:{"type":"button","size":[238,30],"pos":[136,300],"script":"t4.0","text":"Continue"}

{script:t4.0}
on click do
  play["walking_4"]
  go["t5" "SlideDown"]
end
{end}

{card:t5}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AOMBAwD/APwBCgD/APYBFQA8AQIAKQEEAP8AgAEEAAMBEwA3AQQAJgEHAP8AgAEFAAYBDwA3AQMAJQEHAP8AgwEEAAQBAwAIAQQAOAEDACUBAwD/AIgBAgAFAQMARAEDACUBAwD/AI8BAwBEAQMAJQEFAP8AjQEDAEQBAwAmAQUA/wCMAQMARAEDACYBBgD/AIsBAwAfAQIAIwEDACcBAQABAQMA/wCLAQMACAECAA4BAgAEAQQABAEBAAQBAwAWAQMAJAEBAAMBAwD/AIwBAwAHAQQABgEBAAUBBAACAQUAAwEDAAIBBQAJAQMACQEDABgBAQAKAQgA/wCMAQMABwEDAAYBAwAFAQMAAgEFAAMBAwABAQcABwEFAAgBAwAXAQMABwEBAAEBBwD/AI0BAwAGAQMABgEEAAUBAwABAQYAAwEGAAIBAwAGAQYACAEDABcBAwAFAQQAAQEFAP8AjgEDAAYBAwAGAQMABgEDAAEBBgADAQYAAgEDAAUBAwABAQMACAEDABgBAwADAQQAAwEBAP8AkgEDAAUBAwAGAQMABgEDAAEBBgADAQYAAgEDAAUBAwABAQMACQEDABgBAwABAQQA/wCXAQMABQEDAAQBBgAEAQEAAQEFAAEBAwADAQYAAgEDAAQBCAAJAQMAGAEGAP8AmQEDAAUBDQADAQgAAQEDAAMBBQADAQMABAEHAAMBAQAGAQMAGQEEAP8AmgEDAAYBCAACAQMAAQEJAAEBAwADAQUAAwEDAAQBBgADAQMABQEDABgBBAD/AJsBAwAHAQUABAEHAAEBBAACAQMAAwEFAAMBAwAEAQMABgEDAAUBAwAXAQYA/wCaAQMAEQEFAAIBBAACAQQAAwEEAAMBBAADAQMABQEEAAUBAwAWAQMAAgEEAP8AmQEBABMBAgAEAQQAAgEFAAIBAwAEAQMABAEDAAMBBQAGAQMAFQEFAAIBBAD/ALIBAwADAQQAAwEDAAUBAQAGAQkABwEDABUBBAAEAQIA/wC0AQEABQECAAUBAQAOAQYACgEDABUBAgD/ANgBAwAMAQMA/wD/AQEA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AEQ="
{widgets}
t5Desc:{"type":"field","size":[204,220],"pos":[153,60],"align":"center","value":"Silence bears down on the tunnel, so strong and heavy that it feels as though the walls themselves will bow out to accomidate the overwhelming silence.\n\nIn the living darkness, color returns in twisted, contorted, wrong hues. The impossibly slick walls that were hidden by devouring shadow now swirl with deep, unseen, vibrant, unnatural colors. It's as though light and darkness itself cannot maintain its grip on the material, sending both cascading away in showers of splintering particles.\n\nThe tunnel continues forward in a single path, but it feels as though there's a different way to go.\n\nA decision that isn't yours to make."}
continue:{"type":"button","size":[204,40],"pos":[153,290],"script":"t5.0","text":"Continue"}

{script:t5.0}
on click do
 if random[20] > 10
  play["walking_1"]
  go["obelisk" "WipeDown"]
 else
  play["walking_1"]
  go["dGod" "WipeDown"]
 end
end
{end}

{card:obelisk}
image:"%%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BQD/ACgBBQDPAQUA/wAoAQUAzwEFAP8AKAEFAM8BBQD/ACgBBQDPAQUA/wAnAQYAzwEGAP8AJgEGAM8BBgD/ACYBBQDRAQUA/wAmAQUA0QEFAP8AJgEFANEBBQD/ACYBBQDRAQUA/wAmAQUA0QEFAP8AJgEFANEBBQD/ACYBBQDRAQUA/wAmAQUA0QEFAP8AJgEFANEBBQD/ACYBBQDRAQUA/wAmAQUA0QEFAP8AJgEFANEBBQD/ACYBBQDRAQUA/wAmAQUA0QEFAP8AJgEFANEBBQD/ACYBBQDRAQUA/wAmAQUA0QEFAP8AJQEGANEBBgD/ACQBBgDRAQYA/wAkAQUA0wEFAP8AJAEFANMBBQD/ACQBBQDTAQUA/wAkAQUA0wEFAP8AJAEFANMBBQD/ACQBBQDTAQUA/wAkAQUA0wEFAP8AJAEFANMBBQD/ACQBBQDTAQUA/wAkAQUA0wEFAP8AJAEFANMBBQD/ACQBBQDTAQUA/wAkAQUA0wEFAP8AJAEFANMBBQD/ACQBBQDTAQUA/wAkAQUA0wEFAP8AJAEFANMBBQD/ACMBBgDTAQYA/wAiAQYA0wEGAP8AIgEFANUBBQD/ACIBBQDVAQUA/wAiAQUA1QEFAP8AIgEFANUBBQD/ACIBBQDVAQUA/wAiAQUA1QEFAP8AIgEFANUBBQD/ACIBBQDVAQUA/wAiAQUA1QEFAP8AIgEFANUBBQD/ACIBBQDVAQUA/wAiAQUA1QEFAP8AIgEFANUBBQD/ACIBBQDVAQUA/wAiAQUA1QEFAP8AIgEFANUBBQD/ACIBBQDVAQUA/wAhAQYA1QEGAP8AIAEGANUBBgD/ACABBQDXAQUA/wAgAQUA1wEFAP8AIAEFANcBBQD/ACABBQDXAQUA/wAgAQUA1wEFAP8AIAEFANcBBQD/ACABBQDXAQUA/wAgAQUA1wEFAP8AIAEFANcBBQD/ACABBQDXAQUA/wAgAQUA1wEFAP8AIAEFANcBBQD/ACABBQDXAQUA/wAgAQUA1wEFAP8AIAEFANcBBQD/ACABBQDXAQUA/wAfAQYA1wEGAP8AHgEGANcBBgD/AB4BBQDZAQUA/wAeAQUA2QEFAP8AHgEFANkBBQD/AB4BBQDZAQUA/wAeAQUA2QEFAP8AHgEFANkBBQD/AB4BBQDZAQUA/wAeAQUA2QEFAP8AHgEFANkBBQD/AB4BBQDZAQUA/wAeAQUA2QEFAP8AHgEGANgBBQD/AB4BBgDYAQUA/wAeAQYA2AEFAP8AHgEFANkBBQD/AB4BBQDZAQUA/wAeAQUA2QEFAP8AHQEGANkBBgD/ABwBBgDZAQYA/wAcAQYA2gEFAP8AHAEGANoBBQD/ABwBBgDaAQUA/wAcAQYA2gEFAP8AHAEGANoBBQD/ABwBBgDaAQUA/wAcAQYA2gEFAP8AHAEGANoBBQD/ABwBBgDaAQUA/wAcAQYA2gEFAP8AHAEGANoBBQD/ABwBBgDaAQUA/wAcAQYA2gEFAP8AHAEGANoBBQD/ABwBBgDaAQUA/wAcAQYA2gEFAP8AHAEGANgBBwD/ABsBBwDXAQkA/wAaAQcA1wEJAP8AGgEHANcBCQD/ABoBBwDXAQkA/wAaAQcA2AEIAP8AGgEHANgBCAD/ABoBBwDYAQgA/wAaAQcA1wEJAP8AGgEIANYBCQD/ABoBCADWAQkA/wAaAQgA1QEKAP8AGgEJANQBCgD/ABoBCQDTAQsA/wAaAQkA0wELAP8AGgEJANMBCwD/ABoBCQDSAQwA/wAaAQkA0gEMAP8AGgEKANABDQD/ABoBCgDQAQ0A/wAZAQwAzgEPAP8AGAEMAM0BEAD/ABgBDQDLAREA/wAYAQ0AygESAP8AGAENAMkBEwD/ABgBDgDIARMA/wAYAQ4AxwEUAP8AGAEPAMUBFQD/ABgBDwDEARYA/wAYARAAwwEWAP8AGAERAMEBFwD/ABgBEQDAARgA/wAYARIAvgEZAP8AGAESAL0BGgD/ABgBEwC8ARoA/wAYARQAugEbAP8AGAEVALgBHAD/ABgBFgC2AR0A/wAYARcAswEfAP8AFwEZALEBIQD/ABYBGgCvASIA/wAWAR0AqwEjAP8AFgEfAKcBJQD/ABYBIQCkASYA/wAWASMAoQEnAP8AFgEmAJwBKQD/ABYBJwCaASoA/wAWASoAlgErAP8AFgEsAJMBLAD/ABYBLQCQAS4A/wAWATAAjAEvAP8AFgE0AIcBMAD/ABYBOACBATIA/wAWAToAfQE0AP8AFgE+AHcBNgD/ABYBPwBzATkA/wAWAUEAbwE7AP8AFgFEAGoBPQD/ABUBSQBkAUAA/wAUAU8AWwFDAP8AFAFhAEUBRwD/ABQBeAApAUwA/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wAUAe0A/wATAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wASAe8A/wARAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAQAfEA/wAPAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMA/wAOAfMAhw=="
{widgets}
oDesc:{"type":"field","size":[204,200],"pos":[153,60],"show":"transparent","border":0,"align":"center","value":"Slipping away and fading, the darkness and silence disappear as an enourmous hollow room is revealed.\n\nThe material chamber is made out of still glimmers and glows with the wrong colors that were seen in the tunnel. It is the most beautiful thing to ever be seen on this planet, and it instills a deep, deep fear of whatever lurks beyond its impossible colors.\n\nIn the center of the chamber sits an immense structure made of all the absence of light that should be here. A solid monolith of pure black, shimmering and glinting in the colors of the room.\n\nAt its base is an inscription written in an indecipherable text."}
read:{"type":"button","size":[68,10],"pos":[221,260],"script":"obelisk.0","text":"Read it","style":"invisible"}
blackout:{"type":"button","size":[204,20],"pos":[153,300],"script":"obelisk.1","text":"The world turns black"}

{script:obelisk.0}
on click do
 alert["'Blood from the sky and taken bones may undo what once was done.'
 
 
 Beneath the inscription there is a hole a few inches wide, and six spots around the obelisk that look like could hold something very pointy."]
end
{end}

{script:obelisk.1}
on click do
  go["Lake" "Wink"]
  alert["The chamber is consumed by black, and the feeling of falling can be felt before it too fades away into nothing.
 
 
 Soft wind and the gentle brush of grass is felt as the world returns, and the gentle waves of the lake washing against the shore can be heard."]
end
{end}

{card:dGod}
image:"%%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R///+5vv/s9+//////vv/2e77ONxtvEQhCRAQmSZEy2mzZs2tbbbbt2522///zbc23fe/Obbt/7brbN2mmmm+GLe+278/tv3//f/f//////+7P//04OeRGGJGTIEjJlMbTSzls27bbNtt772/7ee173Zt7/7tu7bcrM2TMy2Y2xrt+/bz/v1v/3////9///++/8zfc/7zJIIEiIBsyJk00mzZNlra229tt2n/7f/w3tm3v3v///7/36azbNnltl5H/89fn+93////7397973u//b/099HfP4kkSIzAjTJpsymx1tM022ztvbfX//buHPfudff737f23NrNm2cmKd3Jbb10/99v////7/37/3v//f//33/9836xEgRJDKGZko3szTJt3223PbbtvU29v+PbM92/b/7Z3+/Sc2TZm7JvQtnl/771///++37vv2/e3f/7/fvK7ynTtkKxImMqTNZoxm2trNNtt9bbbu/937/yO99u+/97Tnt7ZZptmdjOt+K/9u/9////9+/fvvf29/d3v////rvt/doIiSSQSmZNZzMyzbNtttnb23O/93Pt/4T5s2//9X9v3y2tmyZGaZ3553++53///t999/f9v72/3/97///e/yd78QiJFlMzMZ85lnJfPbbebm2e3d/+/3/8jt2/bvWZlfeSZbLtdzV/f3//+/////f7333d3+3v7vtv79//97f/78RmIkWUybZYzNku0tNtt7e9+3///7ff//NMy//e3t2829psmZmWT5/ft/8///29vvv/f/b/fvvv+7/+///e+T2/ETKwbJiJ9s5rqbbebbW1ts3fe939////c3rf6nbb7yybm9bK2fbn/79n//+37/fv2/u/9/e/vt7/f//7e793+xGIjksmy7MzKrc5s7bd3dt3b///b3b///9u07O+bnsm5tNQLmZ///z/3//7/v9//3/v/3799////ffd//7v3m/sZmG2Zn7MsazUzzu2225tu2////vfv//9t37dq7b9mzlsfyG7A9/f9v//3t/d/v3/f3fb397b79//////7fnt7xEW8Jk3NMzXW9nM227rtu3f/////ff///3vb/f13zPNr5/////+39///ff9/++/7f39//d//vt73v///7//fnKb/o2z/KdTU2s29222u7dtv////3/9/3//uevV/dts3rLG/9//f/vv//+///v/+//v372992+////33/7235O+/uklTtmpNWys5jW227bdt7///+3////3//88+b9H2zPOfft/f+3uf//v/3ff+/+++/bv77377e973//v/77/u9O1ZN/GWY2tttvNm23d27bv/7//v/+//////27u1tNt89+/5/////9/vv3/f3+3777/+3vvvv9/7/7/v//77N/fZJu9s0Zqs1M5u222bW7e3////u////7//O/q+7Pszb5B5f77Ntv//f/v///3/fvvm2/e+++3279/+/////v288u3/Sy22tpdprbtt7dt23//////////+/f+6//L7bP//h/////f//f7/9/9/t9+2fbZtt57/f7/9+///+9/P7yab3ZNszZN5b7Wttm223dm/////////9+/f/T3cP9u37f///3tf//////977v3tt5ttu232l9v9v+///9/3ef/tv/z002ltTpjWbbe27bdv7///+////////vcv/R/+/v////vv3//3//+/77vebdnrbabbbfn+9/e//////f228W2zHZs2bbO3W9ttttttt/////9v////v7/8z7dNv/////9u+f/+3/fv/f7/c7ZubJJskm1uZ77//73/////X7f/22Zs1tK05mzbbdt27bv//////////+/v79f3w//////b/77//////v/f3b22ppbbW26Xb73vu/3/////23v//szLZtmazpu3Ntttt7buf/////3////7+//3+LAH//9t/t+f//d//3/u92bNmbGySUJpspG2e+7v99///3/u3+4zOZstbnt5s+227bm7t9b/////3////t/3vu+0ATdt/2/979/9/9/9+727ZmsaSSS0k0zdZ9t/v//////+3tt7tszZpmWTTmzNtrbOztv7L/9////////2/e//bAD9//f/v3//v////7/tuzNkykmmBRRTZlm3d/t+/v7/+/f/8szWZtuZ3ObfNtu29vbdv/P////9////+/9//e5Kb/+/t/f9/+///e/ttszZlKGSEUlEkibatd3f3////+/7Nv5pMzZZu2c5k/bbbbc7ZbXeb///9/////7////7wCt///39//3f///9/bbWzJIkEkkiSZmZJs229vvv/9/////fN22ZpmZt23pbbdttzf73fd/////v////f/////CP////f3f/f/7/t2dtMyZJEkiIkiJESbVu7v//v//3/33f95LMzbbZmVbPbbbbbfcj3tfb/+//v////d/+//////+298//6///7v97aakxJMIAIgCIEkZJMls7b//v////f77aY2ZZm3dttbbbbbZ0G232+////9v////f////v//d2/////7////bnZrMySIIgQAIASIwS5tbz/t7v/v/93v+/ZszTWZmrXbbbW23id77bzbf///w////8//////+///b//93/9+9/ObWUgiIAAAAAAQIhSTJpvTf///+/d/P+/WZmbZtmvNbbbe22Cb1t7v3f////n//979////+97e//f//3//992e6ZRMmAAAAAAAAAASRJrS/9u///7///3/eZmyzmdtbmbba22jP/d363c////+L///93////93+7f999vv//997aykkkEAAAAAAAABAEjJbaz++///v//fff+zOzNZtTO7WbtsG/f9+b997////4////vd+////b/9///+/+/f7m0yYpEAAAAAAAAAAEkSJS03t/+////v/+/+/M21nNfdrWbNsE7+7591z7P////////u/9/v/////7//t7/++7OzSxIEAAAAAAAAAAAAESTG1t23+/9//uf/75dkzOdY1W2+9gP/77r3d7reb///////v7///////3/v//3/f+79tshIQAAAAAAAAAAAAISSWZtv/v//3///+b/zNmszbrdbszINt3277d77/dv////////v///////3//7f//v+zUykgRAAAAAAAAAAAAAAkyVps2/v//f/+W////O23Kcs1m3B///3xz7bbze9////////+3/f////v/979v//d7ZpJCQAAAAAAAAAAAAAEgiUbb37f//++////v+bNM2567XNDb7++n3z+93u5zf//////////9/e3////3/979mzskEAAAAAAAAAAAAAAABCRpZtn//f7///vvvw7M2zbNs7MDt/76/v3z7d7d7v////////7f/7f/3//+9v//7+2ZZSEAAAAAAEkgAAAAAAEEmTZvb7//v/3u///ybbNlc2yuLn3f/tu33ndz277P///////////////3/7+//fpszBCEAAAAAS0STZAAAAAASRaZt7v//+3v/9v///etvW1P2Mv/d5fb9t/fb3u3s3//////+/u//3+//+/t/ve/tuaIEAAAABJBIhBMgAAAAAFEzbT+9+///////f/ezJOd2VFb7/71d17zue3e9f2/////////9v/////9////7bMwggAAAACSEAACAmQAAAAkIzZv37//t//9t3//6fbu0zck/2+7b2z7vu++5t9ez//////////f7/7//zf73vbNGSBAAAAEhIAAACARAAAAAJiTS2f///3//v/b/7czaW7mC637aUqJv+7u27+7c/J///////////7///v///+bbMQYAAAAJCAAAAABCSAAAAJEmbt93v//+//7/43/312yuM7vqE27/+Z7u3d57e8/3//////////////e29+7+zMyQIAAAIEAAAAAACJIAAAABGatn3//23/f3//yfv+WnZB2+sSW/Xd/33fdz29t7bf/////////////f//+/mzZCAIAAAIQAAAAAAAAEgAAADMIzPP3//////9//5v5s+QDn54Tt9/+2/Xc7v77vbb3/////////f//7/dv//fdlsGAAAAIQAAAAAAAAISAAAAImzNu39/9vv//3+/JPkgADvnwAv337/s/v7uznPe+2n//8//3///////9/3vdtmQwBAAAIQAAAAAAAAAhAAAAAIJtu/9//+//d/7/dkFNv//vAe7f/30/7ub3f3fa27u//f7f/3//v///b73//ubJBhAAAAQAAAAAAAAACEAAABIkmZtt//t///b////////9/Aw3/7/35vv7nc33bvbvr///d////////fvv927ZmkAAAADQAAAAAAAAAACQAAACSZZvf/7/3+/f3/t//////wDD///7//7dnvu9vb23bP//vbf//7/////e///7ezJIQAAAAAAAAAAAAAAAJAAACElm7dv3/vf//2f//////fsCM9/////b33fu96333d/X//7dtug////f97/e22ZkiAAABiAAAAAAAAAAACSAAAEkKZt/v/u/f+/83////9/oQf/97////3P9N3b3W3bzd///bf8o/////33///2ZkSEAAACAAAAAAAAAAACCAAAAIptm7f//7//////v+//7oB9vf////7d+2/3e3u7fPtv//+79//////3ffftntkkAAAAYAAAAAAAAAAAAGEAAAIiSdr///3v7////sD/u6Af/b/+///+923bO29u96e77///zv///////9/fv/OZkSAAAAgAAAAAAAAAAAAEAAAASTZvW+9/f3/v//v//+8A/ZP//+///7+/f+7t722/brb///+//////u33/vts5kgAAAECAAAAAAAAAAAABIAAAREmrd9/+9///tm//+9gf+zf///////s8+3vvbne+d27////////////ff//bmRIiAAAwAAAAAAAAAAAABEAAAAkmbb3//72/9vf///9G/9zf//////+9962udu/ts+373/3////////99/33dszIgAAAhAAAAAAAAAAAAABIAAAiJVWvv/3v//////+l////////////t9+/v925vv8+t3//////////733v3e1mIIQAAAAAAAAAAAAAAAABAgACBJlW7v33+/d////6////7/////////b78/Xt97PN892//7/////////f/39tcyYQAAEgAAAAAAAAAAAAADAAABEGa3fv/77////2T/////////////+fu353P17ve9923//v//////+79v/7txiQAAAAiAAAAAAAAAAAAACEAAACYqtdv//v///7Pf/v////////////e9/f3/Pbfbrdu9f//v///////v/77vXMkSAAAiAAAAAAAAAAAAAAEAAACBmZ2/9++/////////////////7bVG529dne+9bvdu99//////////e7379c5kkAAAAAAAAAAAAAAAAAAEQAAAmEZrb3/77v////7/////////+27d/t/u9/f27ft3e27/////////+97//72zJIEAAJkAAAAAAAAAAAAAAkAAAgJm63v/fv///37v//3//////Zt727t9u757Pe+f3dvbb///9//////3397u2ZIgAAAgAAAAAAAAAAAAAACQAABImZ3e//e3/9v3v//b///7f/btt37fr//tzu97dN2+3bf////////3ff3780zCSAAABAAAAAAAAAAAAAAEAAAAEhJm9979/9///f/2////P/+bv7bnfbbd///u2/f3tve9/////////99//592KQIAAMQAAAAAAAAAAAAAASAAAIJmuz3/72///+//3///9f/++3L7ve9293Npu76/Nve7bf////////733/f9kySQAAAQAAAAAAAAAAAAAAEIAAAhKZnv+/v/////////7J//9+9vz3e3zb9//vvnrfvdrvb////////3vf7+5uzEIQAAEAAAAAAAAAAAAAAEQAAAEQlm29/+2////////s77//9t7X3c3/tt3bdOffbOdvu+/////////+97376qUSAAAIQAAAAAAAAAAAAAAJAAAQjWbt9/t////////+tz///5u33bb/37b/f9993fv9vdy/7///////v73/3zsxJCAAAgAAAAAAAAAAAAAAIAAABGEpt9//23v/3+///t3+//ru7Xu+6/bbLe3zX3bfPfZ39/v//////vfv+/fZzIkAAAKAAAAAAAAAAAAAABQAAAEErTb/fv////7///9v//+27dvb675/+be+/9u3t+dv71v+///////9++985mSQAAAIIAAAAAAAAAAAAABEAAAQEpbbv/u2/////v/9//v/tzt+7nu3/++S9522/ez/u23u97//////719//76SRJAAAQAAAAAAAAAAAAAACQAABJJS3+3v9//9//v////v+t33tz/e+fb//J33ttt/mvbdu/23/////3v3/+9pukgAAARAAAAAAAAAAAAAACAAAAElW2X//33////f//////t3nbXzbt/f/e/Xfvtvt/vft73e9v/////+/fu7bmSSQAAAkAAAAAAAAAAAAACSAAAiCS0/f7+ff//t/////3+t2vt/33ve/7+/d9vNtuzvbftnft//////t79//vbMkAQAAgAAAAAAAAAAAAAAEAAACIil29399/f///////3/727O2t3bc3739/m/fbb/vfte/u/Zv//////n9/eZskyAAABgAAAAAAAAAAAAAUQAAAAmmtv3933//////////Nt79+727//7/32+7fdtm92e9tu/f7f////d/f+97yZCEAABCAAAAAAAAAAAAABAAABGIVq2///f////////9/922z1vb7zN7+//72+/3e5397vdt+b3/////39+/3bZIkAAAAAAAAAAAAAAAAACEAAAEIlHt7999v///////9/rd97t+e3f///+//ty6d9t9vffd+3+3f////vb3/fZmZkIAABkAAAAAAAAAAAAAIAAAIBMtN3v9z////////v/7t9295+9c3d/v+2/3t9zdz6c9d57f9/////e/v397mZEIQAAAgAAAAAAAAAAAAkgAAAKIptve//t/////////3b/bb722++2/vv//b93/t3r+73339/3/////7e/73fZJIAAABiAAAAAAAAAAAACAAACQJJrb//b//////////9f+7vLvfb97/f/v9/tvN7b22+vOdz3//////f9+//ZNpJIAAABAAAAAAAAAAAAEIAAABEVbNu/fpv//////////+z2/u2/n3v///v7d+93+t208+93vf/////+33+976bSQgAABEAAAAAAAAAAABAAAAQkTRe+9/7///////////7f33bvrfbe/97/f977/bd3t97fd7//////+/ff93rpERAAAAAQAAAAAAAAAABGAAAAgkLTb//t77/////////2223bu333973/7/f7vt/99t5u2d3//////99t93/e3WyRAAACQAAAAAAAAAAAQAAACBiabdve/3v////////9t3u7v7vXPb3/+/7+/+/2377zt7+7bv///////v/+9zZIjCAAACQAAAAAAAAAARAAAAJBJa2++9vf/////////bnO9uzu/+/v9+/f7+37v/bvv7Xm7vO3////+7ef77nmkyAAAAAJAAAAAAAAAAQAAAAgBGU27+/7/////////+7Pvd9v7uv7e/9/f79/Xvt/++zvfu2f3f////ft9/3vebRkiAAAAEAAAAAAAAAQgAAACTIZ1vt/vm////////3z/bdt9zu+b3b///779/ff237/+2u9/Pt////97n3f/05lEiAAABIQAAAAAAAAQgAAAIBCzlu//u3/////////nzb3u53/t/3f3v3777799//ft3+9t2+73////3vP/7b2yZkEAAAAhAAAAAAAAQgAAAAkiSNtt/v3v////////vvbvPb7zP232//37/3v7z229/3N9/fu7v/////f+/b9tZpEwQAAACEAAAAAAAggAAAEBJE5t/3ffvv//////9Ns/s/fbvvf7v77///fe7vt/73f/27c897f////9t7/3d1mUjBAAAAJIAAAAACCAAAAARBGzLbf/8//7//////936b7bfc/c3u3//+/f97//m3vdvf735932////TvXvfdudZkMAAAAACkgAAAIMAAAABBGSJfe93u7f//////0r3O/u72d7f/f9+/e//33/dvbe/+9v3P9vf/////eef//s5kkwyAAAACCCAAEiwAAAAAEISZzW7/+/+//////37Nu+c73+/e89t3///v3/bf//17b7+3+7e//////9+97u/3uZDAIAAAAAIMkkKAAAAAAgYklmnv772b9v///92t/3s9/bm7e779//3//////b7fn/vt/vz9///////99v+5tZpMMwgAAAAQgIRIAAAAAACgSGW+vb7vf///////tzdt98+/ve+/t7737339vf/79vbe/22fz2zf////dnbf/71myQhCAAAAAAAAAAAAAAAkJRMtl/f/+/f////+6tv972165u+87f7v////3/9u///397f393u39////9/d/u7vebJJEIAAAAAAAAAAAAAAAREksnV/e27ff/////ts/zu99/7u9/tr+//e9//3/+973b39vvd+/z3////72z/7855mRJAgAAAAAAAAAAAAARESSZvf2//v/+///////9Ps951bu99/73/ff/99//397/9vb++912nvf////2/v31zmyTJKAgAAAAAAAAAAAARESJpttv7tub/////////9t9t/3/771r3f////99933/97++z57f3/7f////X22/3/+zmJIkgAAAAAAAAAAAAgSSSmzb23/9/7//////+2r39u6vW3vv/39/v73//9///f3973n287nt+/////tt7/tzvmSSRBAAAAAAAAAAAAiQiSZbbP/9t23v////e627tpvu+/ve+7f39///3/f+97ff9/v/d77vP2/////7tn7v3s3WSREEgAAAAAAAAACAEiSRk2+2797///////7tt27/O97u9739v//79/3/f////t9+723O//Pf/////7e3/bt22ySSYCQAAAAAAAAIJMJEnbbb/77zv/////f+3t3b5vt3v73nb/t+7///3/ve/3v/37v/e5Te//////3tt//v2ymkiIoAgAAAAAAAQhIZE2Zu3tv7v/3/////7bb2/b3fe3fvf/vf//9/e//v/+//+/f+2//3337////n+227fe3u2SSIyCAAAAAAEhCCJJkz2/f+/23ff/////e7t6d3Z8/d+92+/f///f/7/3v972+97/7df3XLt////trb/9t22lMkIQkJAAAAIkCEaYTM2na9t93/e/////+c7t2+3vz9/37377/3v+/vf7//v//+/7+399t3v3v///9+2t7/33fcySQgQEgAIggIIQhSZs+3v/921//////+++3d9u2/t2+3vv32//v////97/u9//v7/b7/3vXe////zbb/7fndttJJjJIAhIiBIkkmWzM5u2tv9733////9u87d1u97//77e+3/5//v//u9/7//9vv7u/vtvvf3/////dnN39vtus2SEIIkAAAJASEkSWd7s//+53vv////7dt97bv93Ntvv97/7v+//77////73f/v3//e/+7e3d/////Wdv3/u7btbIyYgQSRADRMkms7bd9tt77f//////dtt2+7N/f/+7b3t3//+/737/fe///f//93f7b7+93////+f7e/bf7dtmSgQhgABGZCQks227d73/3b93f////e7u2679s/bb7/vf33b/+///7/++97/b7v//f/vzt3f/////mt7/9n73e3bklCISEIiJJtldzdvvbfe3/////+a7u7u7z97f/v2e9v3/7///+//v///7/7+9392+3v/9////8+2X33vbtZuVmRAIQIQIktlP1nd+c/9u/dv///+/u9tu7nr/+2+397/3v77/fe/9/33v/7379/b37/7az3///799ZXvf/73s+W9vkQxlZmbbdvf3b9+3u2/////+2+53du/+7b/7fv37v/f/7/f/v9/3/u///9+//3tr27vf////33tv9tbvb29kybUjGTNtLts7Ofn++bv+7/////9v7d25l7vtvduvfu39/////vv9/9/+97d++23dvm2+//////Na3b/d+/ttvbzt+9ubW+27zu+/b99u2//////9ub7vd/e+/+f3e+//v/7933////9/f/79+///97ft1rf///99zbfvfZs7tttnTpjM7drbbP/+7/tn3///////ze+zu95977be/d//e//3///373e9++3f/69tu37tv3e2/////vZm/ff/7vbbe3O3d22229+3Z/u7fPdv////2ntu73bb33v9+5//d+/v39v9/b/f7////e773u/f+7ft27//9/6zmb//be/fttu973d27223uf2+7du9/7///dv3u33d7/fe22/2+/3/v2luV2/9///v/////vPb9372/W3////f7Nsnb/c52e+2zWmZm2t3ee+f797bv/3///Z/XO3W3T299+/9/77v3v2vd/3/9///////////dr3v35/tf/////9q2f2//3957vt+/u993t9++3tzvvb/////5dve33f3v319t2/3/3///Zkm2/9v//////////bvu/v2/23//7/ZRlt3+9/v33u3l7f93e33d//dveff7/////73c/nu3u7f3//9/93799/9+/5v7f/////////d2/+//7e///7+//NGX9727Pfdvf3dN7c7dd3u9s99////9t+7vb83u/v767be997//7/yZ99t2//////////+/37//3v99+////6c9ZN//7+9t+9ud/b3/9//e7N7Xzf//zbZt2/t7ts/d37/+/9/+9///7t9//////////////vu3vv//9+////39hlt+9v3r/77+/7f3M3+79tPdvv////vdt3bbu737d3f2+/f+9/7e//ez/9/////////////+/f/77/7+///v/fjTJ7/3ftu3t+r+Xf/b7rdfbe2////+e/u/bu7vf//939//e//f+//97t/3/////////////9/9//3fu/////9uHNnvf9/e/f2/2/fe//7ZbbN/////ze7O7f232922339/u//e/f/////3/3//////////9//7/9///e+3///fz8GKWd77d99Pd3u+/+2TT7e/y/////e3fd233f73/ff7+//vf//fv//ff/////////////9//2/++//+/////vPwbld37/33/9/v++39tbrczv////723dt32383vt997+93f/vb/v////7////////////////////3++9////+fwW0mb/vvvv9/3/7Em225/N////bXfbvvv/t/e/3379///b//7v///////////////////f///ffv3+9/////83DJs62//v/f9/u0s7bb7d7////7d23vO7m3997ffv9/e7/73////////////////////////+////3/7/////y+hkyzJbft+7ykjbt22l5H////n+3vdv7vvb3399vd+//3//29/////////////////////+9//7//3f7/9//9m7DJFtktNmpLNutNzbNz/////vTe29/b/u/vfb3//++3f29//9///////////////////////7/+9/97v/////H7I0hKyZMW00ozdmk9pv///+7vt77Z93f7e9/vf3u+////9/f////////////////////7/f/7//+73////9//DfB7JlJp0TTbnJsP7M///3/7u73t/33dv977e+3v//7t/f9/f///////////////////7/////v////bf/////ydkCWaTE1NteSH9sP/////d3budzff/+3/7/+//vfb/9/f7///////////////////////9//f/fdvf/+////8Ht5AJzc20yQDfNY/////93d369799tt/bf7e/7/e/997/f3v/////////////////////////7//+/3b/v////AD3/kggBJfu2IH///v//3d3X/733//2/939/b3f//9/3/fv////////////////////////////v/v/v//3v//wnJJ3v9t2fmTP/////9vvd9bN3fbbf7b33/f/fvbf/f3fv///////////////////////73//3/d/v/7//////7GBltt7YwMf//////72u9z+/39/79v//37f9/vf/ffv/Pf/////////////////////v////v/99/b3//79///3xYAEAEHL////37/7v9zvu7Pu233+3d33/t/v///fv7f///////////////////////9////+////3dv/////////////////+///r+33u9v++/ffb/f3/3v+/723//2/u/////////////////////////////fu739/////////////v////////f13P/t+b5999/t/f7vv+/7//3t97u//////////////////////////f//ff//79tv39//////e/////////udd3uzP5/v33zbf3d7vv2+39///1/vf/////////////////////////f/3///d79///9/3//////////////u997vvfN2+/fb/9vf3/v3///9t7f9/c/////////////////////////////77//99tt//3/e/7//////9/92v/bbtu/e/778723//ffv3/fu//75vbf///////////////////////////f///7+////2//+/////7/3/f//9vM++97ue63vu7//du++/37e/9v7z+f//////////////////////////////fe/9++9vf7b///v/e///7//27/e7777u+//e+/299++/737//f/vn1/////////////////////////////v//f+9/+9+9vttv////++//3vfttvfnnv/+9297/f779//f37/u+/ve3//t////////////////////////////f////v//7+//2zbd/3/7b3u8/++23fe3d937/t9vv//fe/79v/9/Ztv9v//////////////////////////////7//fvvf/7bf729233e/vv75t77799/d3/v7f3+/du9/97//3f3f9/3f///////////////////////////////7/////dv/2333vbvc7dvbv93v3v72//bvf/fb///73t7+/3+/aZ7vf//////////////////////////////9/+//33/+23vdnO3u3/d/f+5/e3e7/7b/v929/tu7v/v/99v79277u//7////////////////////////////3///3//3v//u7/vve3Nf7eb769v9723/u/33/2/+/v9/+99//3W/7//////////////////////////////////v/v37//vtv7rve93/ebu/v77en33/be93v9v/d+/t97///23ds33//f///////////////////////////////3///97/v/f3vd7fre/+++339/ffm//9/v3/u/////73e+3/t//f3/f//////////////////////////////3///79/7/vdd3e3c7++197/fb399v7bd9/vd/+9tt9v//9/tu5t////////////////////////////////////////+/7/f93e+/729933t9/vb3/3/9/3v9737//3/97v9/t7////f+/////////////////////////////////v9/+/3/b/7d7P3d3/ff32+/vb33b+/fv/3vvd/ft//v/fd7f+///////////////////////////////////7///3+/vfaz3d+3t/b99vf77f/v3/979++3/ff7+/+9/e9d//v//////////////////////////////////9//9+33+++973d33v6/v3+9vv/b+/3d/v79/7f/vv7+97f/39//v////////////////////////////////////////3/7u33/e3vb7e/b7++7/t9/f7ff997/vfff2///2vv/////9////////////////////////////////////+/3fu/frd7vf397/vt77u/97/f/fd///vf/+//t33v//+7/f7+////////////////////////////////////+/9/97Pv3vefb3u+//v+/f7ve+//+99v/vv7/f33vv/3///3+//////////////////////////////////7//+721z/evfe9/ve77t/d+9v+/9/ve97/7vff29vtv/+/////+T/////////////////////////////////f/vv/+7/zd+9u/2+9/vv3f+//9/d9vf//73//+//+2/f///////v///////////////////////////////////f/vb/s3/3b29v772+/vfb9t399///ve//973+9bf//////++/O////////////////////////////////////3//mf/2vfv9+3v/77v/fv//f3+93v/997/33999vvv3/vv//Tb////////////////////////////////////7bf9tve+9t5/e233/u/+779v+9/v3v779//f73/v/3/f///bf//////////////////////////////////////9v/2965/729//33e/b/3v/t/+/3/v7977/bvb//////+7c3v/////////////////////////////////9+/+3+tv3397O/79tv3f+/93+7//e/37/39/73f////////9//3v////////////////////////////////////d/N++3e17+7vt//v/e+73373u/+373v9/f/+9v//vf7/f+7N9/////////////////////////////////////2/37fs/73/u/7be7997//f/f+3///v7++979+/vv///+//t9/////////////////////////////////737/fven9v9v3W/7b///v3/97+9/v/39+/3+/9/99/f//9/f/2zc////////////////////////////////////99u8/b3d23v7f/2+2+/u9739+/f337/33/d/d//f3//+/fvJ+/////////////////////////////////////3/799vd/3u392/7/77/9//3+/e3/v3f/v//f9v///d+/fu27v///////////////////////////////////+/bbt3++63v9337vt33tv+93u/f/9/3/7/u/fb/3/9/9///afl7//////////////////////////////////97/e//N7u/vd3fvu/33/++9///f39937v3//ff//+9/v/v9m/3T//////////////////////////////////93ue7a/3u9vd/9u/7f/7v9/+73/33////ft3ff+/+//vv//OXJZf/////////////////////////////////9/e+/97ff9/f7v/7f/27/f/e/3vv/e+99/v//fu/f//v//+c9bm3/////////////////////////////////999+9z389t7evu7f93f/3e7f/f/f7/9/9/f72/u/f//v//6zb2bb/////////////////////////////////993293vb737++f79339u/f7/ve9/37v/d+/737v//79///7nNubNv////////////////////////////////39/f9/+/vvbz99v33fv/7/v/v/97v3/vf//v3vv3/////+ze38+e3////////////////////////////////3b79t7b7e+/3n3+3v9+733v9v3v///9/fvfffu//3/////7ZLZ82f///////////////////////////////9v/vv/79v357f/fb/vv3733v3/3vvd377///fe/79//f3/7Nzd79ue///////////////////////////////9+7e+7bz+3X37b9/t/u/f///3v3//f/f/733/e9v7/9//7vt2Zz/M////////////////////////////////397977/3t//fb/u2/3f799773/v73/u+9//33/////9///s3Cbb2b/9//////////////////////////////vd/33v23/229/2+/7fffv33v/7/7/b///993/bvf//v//d33O2d/z///////////////////////////////++97ffe3/tvv72f79v9/e+/f/d7739/733f7/9///7v//+9XO22//v///////////////////////////////+9//999/tv++3v9vt+33/77/vf7/v9/7/v/f+//9/v/v/+7c+ztu/////////////////////////////////7/9u3332//b7/e3+/7/fbv3u/fv9/v+39/7/e+7v9///9+///3tu/////////////////////////////////v/v+/fff7bfvt9/b7bt9/vf+9/v97/e/9977/////////99//2zf////////////////////////////////+/dvb9999v/++/32/v//37fe7/7/t/7//v/7/73vf3+/f75n//m3/f///////////////////////////////7////3333+227bff7e23fb//73f7/+/7vfe/+/////3/ff3///u33////////////////////////////////v/fv73vffb////99v9//d/7vf3/f7++////9++973v////df//Nvv///////////////////////////////9/+/fv3/+9/ttt233+322/27+9/2+/2/973vv9/////9/v/d3//93////////////////////////////////39+//+/3b72///3/fb/f/7f77773/93/v3/vfv/ve973+/7e///T3///////////////////////////////+//9/3t+/fvv7bbft9/t9tv9v/v7393//fv9//fe///////387//fv///////////////////////////////7+/f/3//9+++3//9v32/3/+3/d+7/7/77/f797///3ve//f/b3/0+////////////////////////////////7/+//37+3377/bbb/ff7fbb/bf37979773/377+7vf///9/u+ten67///////////////////////////////3/v/vf/7/vfvt///t9tv9//t//ff979/7/3v3/9///73vv/u779+7////////////////////////////////3/f///+/v/9/f222/3/+322/2399779+/+///99/d3v///+/7Nrl72///////////////////////////////3//3v39+/t33ff//7fbb/f/7f/b73v9+++97377+///973bbe92v33///////////////////////////////f/7//v3////vfdttv9+/t9tv9t/7/f7+/+/7/b/+/v7t3vfvZzbfvf/////////////////////////////////797///vb+//f//+327f3/+3/3f9/v+/e/v9/93/fbv//+e/3+/e9//////////////////////////////+/////797f/793/bbb/f/9vbb/bf97++2/e/v9/9/v/f///297f6+97///////////7f/////////////////+//9/+////3/3/bf//t9t3+//t/9v3t7////f3+3+/u////f/3+3+/////////////+2////////////////+///9//+9/fv2/7/+23/3/3b7bf23+/f/vvb3/3v/e/e///+9tv//d/f/////////////tv//////////////+///f/7///f//+723//tvbf/v/9v/b7/u/ff/vv/d/+9///t7//+2///////////////9vu3/////////////+///f/77/e/32////dt/+/9u+23+3/3ve/ff7/f79+27///v3////////////////////7f/d////////////////////////3+3999/3f7b+7//b/bf+9+/fv3ff7+9v//7ff//+3////////////////79N9////////////3//v/9///f/7///3739/+3/t/tt/u/+77+/fvf/+/+9v//79////////////////////////n7b//////////3///9//f/f3v79v/v/t93/2/2//2++3/3++/v+7v+29v//v7////f//////////////////fvP/7/////////////////3////7/u/2/9/3v7f7bf7+/d39+/v7/+9/5ve/e//////////////////////////+3b7////////3//////////7+////v9v+/vv9v/9vv99373/f3+972t7azf///////////////////////3/9/7f////////////+//97999/9+933v3+++/u3+23++33/7vvfv9//v+7u/+////////////////////////z3+//99//////////////////9////3//v7////b//b7/vv3//fv7/e+9779//////////////////////////3//a3/3///////////++//////vve/77+3/fdt/u2/v2/vfd3fv3+///33v/////////////////////////////f/e//////////3/////v3v/v//+/79/2+//2//7e39/9//fv39//ff3f/////7//////////////////////3//9/7////////39///9///vv///+/99/+/vf7e3//33v3d/v37/f/d3//3////////////////////////////u337///////////3///7///+973+//7//f+/+/7d3ve/9/v3///ff//+///////////////////////////////fb////////3///////+//////3++77v/292/v9//9979v37d/+/e///////////////////////////////f2////////////////33//9/v/////7//v//3/ff97397//37//77////////////////////////////////+/+32///////////f9///vv/v3vf7vf+9/2+///e93v9/9v37/fb3////////////////////////////////v99/f7f//////////////f//v//////f/9/+97b/7/ft+9/f79/f//////////////////////////////////3729v9/////////////+///////vf3/ff9+/3/3vv/f+999797/f///////////////////////////////////v7+32////////9/f///++//e9///3//f+/f3///b/e//7/9/vf//////////////////////////////////7/vt/f7///////////7/+//////3t//v/u//vu7t/3+/e/+9++///7///////////////////////////////////29vtt///+/////3/+//33/////7/3v/3vv//73u/e999+777+/////////////////////////////////973f7+//z////////3/+////73v//f73//3//3d/3+/f/39+/v72//////////////////////////////////7//vt7bfm3///7////+/+/////9/f////v733/7f7/fvff+9////////////////////////////////////7/////3/9/3//////7/9///ff//39/+/+9///v7v+7/fvf+993e/////////////////////////////////////////bb9/7f////7///////ve///7/e/9+9///3/7fv/e99/////////////////////////////////////////////7////9/+/////7///////////f+/99933f/v39/////////////////////////////////////////////+2//f////////3///9///93v/7//f/v79///fv33/ff////////////////////////////////////////////+/////////////////3v//v377/v/v9/9/+///7//////////////////////////////////////////////9+/v//3/3////+/7/3v////3/7//7/9/f93/77v///////////////////////////////////////////////27/2//////9/9/7/3//39/////37/7//f/3b3v9//////////////////////////////////////////////f/t37f////9/9///////797/+/v7+7/3/e//3/////////////////////////////////////w=="
{widgets}
deadGod:{"type":"field","size":[170,40],"pos":[170,20],"font":"olympiad_title","show":"transparent","border":0,"align":"center","value":"Dead God"}
dgDesc:{"type":"field","size":[204,230],"pos":[153,70],"locked":1,"border":0,"align":"center","value":"The tunnel opens into a vast, endless wasteland. Silence, darkness, and most other things seems to have fled away from this place. \n\nEverything is gone from here. Everything except a deep drone, blanketing everything, reaching everywhere. It doesn't grow quieter, nor louder, despite moving around the landscape. The only change in the drone is when looking at something in the center of the wasteland, only then does it go from a drone to a quiet, weak whisper.\n\nLong stretches of bone reach toward the center of the wasteland, where the drone grows quiet. Encirling it, the stretching tendrils of calcium seals it within a sphere. It is a prison.\n\nIt resembles an eye, and its gaze bores through you."}
blackout:{"type":"button","size":[204,20],"pos":[153,310],"script":"dGod.0","text":"The world turns black"}

{script:dGod.0}
on click do
  go["Lake" "Wink"]
  alert["The wasteland swirls and curls inward, tumbling into black. The feeling of falling can be felt before it too fades away into nothing.
 
 
 Soft wind and the gentle brush of grass is felt as the world returns, and the gentle waves of the lake washing against the shore can be heard."]
end
{end}

{card:god}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AOMBBQD/APsBCAD/APgBCgD/APYBAwAFAQUA/wDzAQMACAEFAP8A8QEDAAkBBQD/APABAwALAQQA/wDuAQMADgEBAP8A7wEDAP8A/gEDAC4BAQD/AM8BAwAtAQMA/wDOAQMALQEEAP8AzQEDAC0BBAD/AM0BAwAuAQQA/wDMAQMACgECACMBAwD/AMwBAwAGAQcAIwEDAP8AywEDAAQBCQAjAQMA/wDLARAAIwEDAP8AywEJAAQBAwAJAQQAFwEDAP8AygEHAAYBAwAHAQcADQEFAAQBAwD/AMsBAwAJAQMABgEJAAsBBwADAQMA/wDLAQMACQEDAAUBBAABAQUACgEIAAMBAwD/AMsBAwAJAQMABQEDAAEBBwAIAQMAAwEDAAMBAwD/AMsBAwAJAQMABAEDAAIBCAAGAQMABAEDAAMBAwD/AMsBAwAJAQMAAwEDAAMBAwACAQQABQEDAAQBAwADAQMA/wDMAQMABwEDAAQBAwAEAQEAAwEFAAMBAwAFAQMAAgEDAP8AzQEDAAcBAwADAQMACgEEAAMBAwAEAQMAAwEDAP8AzQEDAAQBAgABAQMAAwEDAAwBAwABAQMABAEEAAMBAwD/AM4BAwABAQgAAwEDAAwBAwABAQMABQECAAMBAwD/ANABBwABAQMAAwEDAAwBAwABAQMACgEDAP8A0QEEAAMBAwADAQMADAEDAAEBAwAJAQMA/wDTAQEABQEEAAMBAwAKAQMAAwEDAAgBAwD/ANkBBAADAQMACgEDAAMBAwAIAQMA/wDZAQQABAEDAAgBAwAEAQMABwEDAP8A2wEDAAUBBAAEAQQABQEDAAcBAwD/ANwBAQAHAQoABwEDAAQBBAD/AOYBCAAIAQQAAQEFAP8A6QEEAAsBCAD/APoBBQD/AP4BAQD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wBV"
{widgets}
gDesc:{"type":"field","size":[272,210],"pos":[119,60],"align":"center","value":"Traveling over the sea of clouds gives a sense of comfortable unease. The terrain is wrong, yet it is okay that it is. The hardness of the soft clouds beneath shouldn't exist, but it does and nothing can be done about it.\n\nPillars of hard light rise up on either side of the path when approaching, turning a mild plain of clouds into a grand walkway leading to what lay ahead.\n\nArriving in front of what was seen when stepping out of the tower, it is now clear what it was.\n\nSurrounded by gently twirling golden rings, each of the eyes lining the rings turn to stare. The unintelligable entity at the center has no eyes, yet its gaze can be felt just as easily as the rings.\n\nThe air hums, filled with electric anticipation.\n\nIt is wrong, and it must be fixed."}
fix:{"type":"button","size":[272,20],"pos":[119,280],"script":"god.0","text":"Fix it"}
leave:{"type":"button","size":[272,20],"pos":[119,310],"script":"god.1","text":"Leave"}

{script:god.0}
on click do
 if inventory.widgets.weaponCheck.text = "Yes"
  if inventory.widgets.waterCheck.text = "Yes"
   go["KilledGod"]
   inventory.widgets.bloodCheck.text:"Yes"
   inventory.widgets.bloodCount.text:"1"
  else
   alert["The proper tool is not at hand"]
  end
 else
  alert["The proper tool is not at hand"]
 end
end
{end}

{script:god.1}
on click do
  go["cKingdom" "WipeUp"]
end
{end}

{card:KilledGod}
{widgets}
dGodTitle:{"type":"field","size":[170,40],"pos":[170,20],"font":"olympiad_title","border":0,"align":"center","value":"Dead God"}
dGodDesc2:{"type":"field","size":[204,200],"pos":[153,70],"align":"center","value":"What once was a glorious set of golden rings, twirling  gently in the air surrounding some unknown thing at its center, now lays in a cold heap. The rings stacked haphazadly where they fell.\n\nThe thing that was at its center, glowing and humming, is now fallen and dead. It is no more decipherable now than it was before. A mind cannot comprehend what lay before it. Perhaps it is better that way.\n\nAll that remains is the body, and the kingdom holding it. The clouds do not seem to care about what has happened, nor does the world. Everything proceeds as it has before.\n\nThe world was here before its residents arrived, and it will be here after."}
leave:{"type":"button","size":[204,30],"pos":[153,290],"script":"KilledGod.0","text":"Leave"}

{script:KilledGod.0}
on click do
  go["Lake" "BoxOut"]
end
{end}

{card:dShack}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AB8BAQD/AP8BAwD/AP4BAwD/ANQBBQAlAQQA/wDMAQEABAEJACMBBAA/AQEA/wCLAQMAAgELACIBBAA+AQMA/wCKAQMAAQEEAAUBBAAiAQMAPQEEAP8AigEGAAkBAwAhAQMAPQEEAP8AigEFAAsBAwAgAQMAPgEDAP8AigEFAAsBAwAgAQMAPgEDAP8AigEEAAwBAwAhAQMAPQEDAP8AigEDAA0BAwAhAQMAPQEEAP8AiQEDAA0BAwAhAQMAPgEDAP8AiQEDAA0BAwALAQIABwEGAAEBCwAuAQMABgECAAMBAwD/AIkBAwANAQMACQEFAAUBGAAeAQIABwEGAAQBBAACAQMA/wCJAQMADQEDAAcBCAAFARgAAgECAAUBAQAJAQEACAEEAAUBCAACAQYAAQEDAP8AiQEDAA0BAwAGAQgABgEEAAIBBQACAQMAAgEGAAEBBAACAQYABQEDAAYBBAAFAQQAAgEDAAEBAwACAQYA/wCJAQMADQEDAAQBBQABAQMACAEEAAIBAwADAQMABQESAAQBAwAFAQMABQEFAAEBBAABAQMAAgEHAP8AiQEDAAwBAwADAQQAAQEEAAoBBAACAQEABAEDAAUBBgABAQwAAwEEAAMBAwAFAQoAAgEDAAEBAwABAQQA/wCJAQMACwEDAAMBCQAMAQMABwEDAAUBBQACAQgAAQEEAAIBBQACAQMABAEKAAMBAwABAQMAAQEEAP8AiQEDAAMBAgAGAQMAAwEIAAwBAQABAQMABgEDAAUBBQACAQgAAgEDAAIBBQABAQMABQEDAAEBBAADAQEAAQEDAAIBAQACAQQA/wCKAQEAAwEEAAUBAwACAQcACAEBAAQBAwABAQMABAEEAAYBAwADAQcABAEDAAIBBwAFAQMACAEDAAEBAwAEAQUA/wCOAQMABAEDAAMBBQAJAQMAAgEDAAIBAwADAQUABgEDAAQBAwAHAQMAAwEGAAUBAwAHAQQAAgEDAAIBBgD/AI8BBAABAQQAAwEDAAoBBAACAQMAAwEDAAIBBQAGAQMABAEDAAYBAwAGAQQABgEDAAQBBQAEAQcAAQEDAP8AjwEHAAUBAwAHAQUAAwEDAAQBAwABAQUABgEDAAUBAwAFAQMABgEDAAcBCwAFAQYAAgEDAP8AkAEFAAYBDgAFAQQAAgEDAAEBBQAGAQMABQELAAUBAwAJAQgACAEDAAUBAQD/AJMBAQAJAQsACAEHAAMBBAAHAQEABwEJAAUBAwALAQUA/wCyAQcACwEFAAQBBAAQAQcABgEDAP8A1gECAAYBAwAcAQMA/wDgAQEAHQEDAP8A/QEDAP8A/gEDAP8AzgEBAC4BAwD/AM4BAwAtAQMA/wDOAQMALAEDAP8AzwEDACwBAwD/AM8BAwApAQEAAgEDAP8AwgEKAAQBAwAnAQYA/wDCAQwAAwEDACcBBwD/AMEBDAADAQMAKAEFAAIBAgD/AL8BBQAEAQEABAEDAAUBAwAgAQMAAgEFAP8AvwEFAAgBAwADAQYAHwEDAAEBBgD/AMEBBAAHAQMAAgEHAB8BCQD/AMMBAwAHAQMAAQEEAAEBAwAGAQQADgEDAAQBCQD/AMQBAwAGAQYAAwEDAAUBBgAMAQUAAwEIAP8AxgEDAAUBBQAEAQMABAEHAAsBBwACAQcACQEBAP8AtgEEAAQBAwAEAQQABQEDAAMBAwACAQYABwEDAAIBAwACAQYACQEDAP8AtAEHAAIBAwAEAQQABAEDAAMBAwADAQcABgEDAAIBAwACAQYACQEDAP8AtAEIAAEBAwAEAQQABAEDAAMBAwADAQcABQEDAAQBAQADAQUACQEDAP8AtQEEAAEBAgACAQMABAEDAAUBAwACAQMABAEIAAQBAwAIAQUABgEGAP8AtgEFAAMBAwAEAQMABgEDAAEBAwAFAQcABAEDAAgBEAD/ALgBCQAFAQMABgEDAAIBAwAFAQUABQEDAAgBAwABAQoA/wC8AQYABgEDAAYBAwACAQMABQEFAAMBAgABAQMABgEEAAIBBgD/AMEBAwAHAQMABgEDAAIBBAADARoA/wDSAQMABgEXAAIBDgD/ANEBAwAHAQUAAQEHAAIBBQAGAQYAAwECAP8A0gEDAAgBAwADAQQA/wDtAQEA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wAs"
{widgets}
dShackDesc:{"type":"field","size":[170,170],"pos":[170,90],"align":"center","value":"Within the concrete box, repurposed as more of a shack over time, the whipping winds of the wasteland slip through the cracks, throwing sand across the interior burying anything that was left.\n\nIn spite of this, a crude metal pipe sticks out from a low point in the gathering sand. The end where it was broken has been untouched by time and sand, and remains sharp.\n\nSand filters in through the crack from behind."}
takePipe:{"type":"button","size":[170,20],"pos":[170,270],"script":"dShack.0","text":"Take Pipe"}
leave:{"type":"button","size":[170,20],"pos":[170,300],"script":"dShack.1","text":"Leave"}

{script:dShack.0}
on click do
  play["buffer"]
  inventory.widgets.weaponCheck.text:"Yes"
  inventory.widgets.weaponCount.text:"1"
  alert["The pipe is made of steel. The end is dangerously sharp."]
end
{end}

{script:dShack.1}
on click do
  play["walking_4"]
  go["wasteland" "SlideUp"]
end
{end}

{card:inventory}
script:"inventory.0"
{widgets}
title:{"type":"field","size":[340,50],"pos":[85,20],"locked":1,"font":"olympiad_title","border":0,"align":"center","value":"Inventory"}
weapon:{"type":"field","size":[153,20],"pos":[85,90],"font":"menu","border":0,"align":"center","value":"Length of unnatural steel"}
name:{"type":"field","size":[153,20],"pos":[85,70],"font":"menu","align":"center","value":"Name"}
count:{"type":"field","size":[17,20],"pos":[238,70],"font":"menu","align":"center","value":"#"}
acquired:{"type":"field","size":[170,20],"pos":[255,70],"font":"menu","align":"center","value":"Has?"}
weaponCount:{"type":"field","size":[17,20],"pos":[238,90],"font":"menu","align":"center","value":"1"}
weaponCheck:{"type":"field","size":[170,20],"pos":[255,90],"font":"menu","border":0,"align":"center","value":"Yes"}
waterCount:{"type":"field","size":[17,20],"pos":[238,110],"font":"menu","align":"center","value":"1"}
keyCount:{"type":"field","size":[17,20],"pos":[238,130],"font":"menu","align":"center","value":"1"}
bloodCount:{"type":"field","size":[17,20],"pos":[238,150],"font":"menu","align":"center","value":"1"}
boneCount:{"type":"field","size":[17,20],"pos":[238,170],"font":"menu","align":"center","value":"0"}
water:{"type":"field","size":[153,20],"pos":[85,110],"font":"menu","border":0,"align":"center","value":"Pure Water"}
key:{"type":"field","size":[153,20],"pos":[85,130],"font":"menu","border":0,"align":"center","value":"Door Key"}
blood:{"type":"field","size":[153,20],"pos":[85,150],"font":"menu","border":0,"align":"center","value":"God's Blood"}
bones:{"type":"field","size":[153,20],"pos":[85,170],"font":"menu","border":0,"align":"center","value":"Sixty-Six Pointed Bone(s)"}
waterCheck:{"type":"field","size":[170,20],"pos":[255,110],"font":"menu","border":0,"align":"center","value":"Yes"}
keyCheck:{"type":"field","size":[170,20],"pos":[255,130],"font":"menu","border":0,"align":"center","value":"Yes"}
bloodCheck:{"type":"field","size":[170,20],"pos":[255,150],"font":"menu","border":0,"align":"center","value":"Yes"}
boneCheck:{"type":"field","size":[170,20],"pos":[255,170],"font":"menu","border":0,"align":"center","value":"No"}

{script:inventory.0}
on get_weapon do
 invTracker.weaponCheck
 print["agawabobo"]
end
{end}

{module:zazz}
description:"easy animation effects for your decks"
{script}

on inbox targets box do
 on overlaps a do min(a.pos<box.pos+box.size),box.pos<a.pos+a.size end
 if "card"~typeof targets targets:targets.widgets end
 if "list"~typeof targets targets:(targets..name)dict targets end
 r:select where overlaps @ value from box.name drop targets
 r.key dict r.value
end

on wave targets box speed do
 targets:inbox[targets box]
 a:if box.size[0]>box.size[1] 0,1 else 1,0 end # axis
 m:sum.5*a*box.size # magnitude
 b:m+sum a*box.pos  # baseline
 each v in targets
  v.pos:(v.pos*!a)+a*(-a*.5*v.size)+b+m*sin(sum v.pos*!a)+sys.ms*speed
 end
end

on bob targets speed do
 if "card"~typeof targets targets:targets.widgets end
 if "list"~typeof targets targets:(targets..name)dict targets end
 r:select val:value shad:r @ (list "%s_shadow") format key from r:targets
 r:select val shad where shad..type="canvas" from r
 on oval pos size do
  flip pos+size*flip unit 2*pi*(range 20)/20
 end
 each row index in rows r
  sprite:row.val
  shadow:row.shad
  a:sin index+sys.ms*speed
  h:shadow.size[1]/2
  c:shadow.pos[1]+h+h*a
  sprite.pos:((shadow.pos[0]+shadow.size[0]/2)-(sprite.size[0]/2)),c-1.1*sprite.size[1]
  o:shadow.size/2
  shadow.clear[]
  shadow.pattern:1
  shadow.poly[oval[o (.9*o)+.1*o*a]]
 end
end

on path nodes offset do
 points:(nodes..pos)+.5*nodes..size
 len:sum lens:mag points-1 drop points,1 take points
 here:len*offset-floor offset
 i:0 while here>lens[i] here:here-lens[i] i:i+1 end
 on lerp a b t do (b*t)+(a*1-t) end
 lerp[points[(count points)%i] points[(count points)%i+1] 1&0|here/lens[i]]
end

on march nodes target speed offset do
 points:(nodes..pos)+.5*nodes..size
 len:sum mag points-1 drop points,1 take points
 tween:(len%floor sys.ms*speed)/len
 target.pos:path[nodes offset+tween]-.5*target.size
end

lup.nw:-1,-1  lup.n : 0,-1  lup.ne: 1,-1
lup.w :-1, 0                lup.e : 1, 0
lup.sw:-1, 1  lup.s : 0, 1  lup.se: 1, 1
on scroll target offset do
 if "card"~typeof target target:target.image end
 if "string"~typeof offset offset:lup[offset] end
 x:offset[0] y:offset[1]
 if x>0 c:target.copy[] target.paste[c x,0] target.paste[c (x-c.size[0]),0] end
 if x<0 c:target.copy[] target.paste[c x,0] target.paste[c (x+c.size[0]),0] end
 if y>0 c:target.copy[] target.paste[c 0,y] target.paste[c 0,(y-c.size[1])] end
 if y<0 c:target.copy[] target.paste[c 0,y] target.paste[c 0,(y+c.size[1])] end
end

on flipbook target source speed frames do
 if "card"~typeof target target:target.image end
 if "card"~typeof source source:source.image end
 if "canvas"~typeof source source:source.copy[] end
 fc:floor source.size/target.size
 fr:(range fc[0]*fc[1]) unless frames
 fi:fr[(count fr)%floor sys.ms*speed]
 target.paste[source.copy[target.size*floor(fc[0]%fi),(fi/fc[0]) target.size]]
end

module.inbox:inbox
module.wave:wave
module.bob:bob
module.path:path
module.march:march
module.scroll:scroll
module.flipbook:flipbook
{end}

{module:rect}
description:"Utilities for working with rectangles"
{script}
module.make     :on make      a b do ("pos","size") dict (list a),(list b)                   end
module.overlaps :on overlaps  a b do min(a.pos<b.pos+b.size),b.pos<a.pos+a.size              end
module.inside   :on inside    a b do min(a.pos>b.pos),(a.pos+a.size)<b.pos+b.size            end
module.constrain:on constrain a b do (b.pos+b.size-a.size)&b.pos|a.pos                       end
module.union    :on union     a b do p:a.pos&b.pos make[p ((a.pos+a.size)|(b.pos+b.size))-p] end
module.intersect:on intersect a b do p:a.pos|b.pos make[p ((a.pos+a.size)&(b.pos+b.size))-p] end
{end}

{module:PublicTransit}
description:"Fancy transition animations"
{data}
dissolveLut:"%%IMG1ACAAIE89euIjSGos8HDHDdaH0cTJI1FA4vxarzRTKlUc0N/Az4L8n7UcRCOz68jQ5bwirLO5ymT7VnFa7t3owcHH1cqgoe6SHc4uD3FLVSFBA+RGwQf9ROaTpLZZwFhZhDyTLlt7vyk4AoXn62MWR2jQbwRzFIHNHxlBRAj11jfi9pE29hm9KMYyqAVzUvNLBQ6QWv6nsobtztFugL4AHnxgrdCst32fmiwEDEq95NMtX/gg5w/0S+kSnztUJJhDOverTrq4h+R8G727VJH1Y4SqxSJXntWPre+I+Tay8eCdZULeLyeNZ4oB+6qMGD5u9YKucjH/zh4/zjE3t07rtnf82TF4/qMqAGfSPol2+TmbYy+dm54J4OY0xt30/d6CGVfYmBNgeFdSzHSkakxejZF72l7YrMsxxUDsIdQfF20ZIZbTM8anpEMOgwcEg+Cwi5hZNRrjcCVFtEl6GMIAbzvxqadk+qmqINLbjn5P6gq9nhhyhP9GJ+GTg8heKTd716IoH4bfKNSJeruxCMXMy9qQ7SSxivNrNtcQ6EyNujoGyunVUFIWTTBS90qhd/tOw4s8llGwbIo/p668h25riz/fIFb0CZ3DLAUScmqlbn0vAjaAEdwQc6FV/2Od8ZAJsekhxzq23ZUCXBOxMpQOz5Sv+l+XTCdxFoDMeiYNs4zvLplNCxx1z3g34UZbK6AfXfIUvDP+QQPCviJiKYGW8qM/pjmjZlsi3aUjqqtrmdt2dMMBvvMy1xqvB03s2ZlsjR11JjAAnIHgm2hsVlMqmtLECew+6Vz0k5wISHk9ZmGgFVg4uOOJXefEK1SXRTVHPXnz44lwhUOM2i0r+ECfuxT2TxuBdUHw/8sKuX5RIHdkiFFthZLshFneWPrZBrSUmBOI8fJ42ciuGgN9PG9LosqPmpTNA0TNaD3jzGlCCySM644qCuV/4dM1DjUVoAbkAZB7XEAe20YPt8IMdFsmR3nuv+JtZsn+pl+b/HwHGLU5YsVOLr+yCklQUMumWjuha3Y4nF4RYSy62w1igwEmzSu5aXEbkkh+FXkXz/ALx8n4T+1W5gZ3ZRbGGm/DAoXlZkIUZ2moEIZgjxDTVSf5akWClhK8Qn/cubTyHWSj0V0esqi3qEdcZd52VJ71lzTh2KXClabvc1NMsDuKjtSZ+q0TbPvwKNEzUyR8OTNp3Fd/SSWIujSpLWiXSffnMLjSuHQbF3+OYg2tYQxDpFDWyTgR6C0SlZwwqSX2rqt93Iea7+q23wVF7fi+v+qLSl8EPPclZ/nWStew1di7s+gdtGUIMnI+5nAptZHayMAvTToLD3Wi5Y9dlRX9rKLA6mHBkhyAtX6GYKuvxKUXbUj97hEMWNQ="
blindsVertLut:"%%IMG1AEAAAQAIEBggKDA4QEhQWGBocHiAiJCYoKiwuMDI0Njg6PD4+PDo4NjQyMC4sKigmJCIgHhwaGBYUEhAODAoIBgQCAA="
blindsHorizLut:"%%IMG1AAEAMAAKFSAqNUBKVWBqdYCKlaCqtcDK1eDq9fbr4NbLwLaroJaLgHZrYFZLQDYrIBYLAA=="
{script}
dissolveLut:image[data.dissolveLut]
blindsVertLut:image[data.blindsVertLut]
blindsHorizLut:image[data.blindsHorizLut]

on lookup c a b t lut do
 c.merge[lut]
 c.merge[((floor 255*t) take b),(256 take a)]
end

on oval pos size do
 flip pos+size*flip unit 2*pi*(range 20)/20
end

on star c t rot do
 o:c.size/2
 r:(2.5*t)*o
 i:unit(pi/2)+(pi*rot/2)+(range 10)*(pi/5)
 p:each v index in i
  o+(if 2%index 1 else 0.5 end*r)*v
 end
 c.poly[p]
end

on heart c t do
 o:(0.5,0.6)*c.size
 r:t*c.size
 p:each v in (1,0,-1,0)join(0,-1,0,1) o+r*v end
 c.poly[p]
 c.poly[oval[o+r*( 1,-1)/2 r/sqrt 2]]
 c.poly[oval[o+r*(-1,-1)/2 r/sqrt 2]]
end

clickpos:0,0
on circleClick c t do c.poly[oval[clickpos t*max c.size]] end
on circle      c t do c.poly[oval[c.size/2 t*max c.size]] end

transition[on Dissolve       c a b t do lookup[c a b t dissolveLut   ] end]
transition[on BlindsVert     c a b t do lookup[c a b t blindsVertLut ] end]
transition[on BlindsHoriz    c a b t do lookup[c a b t blindsHorizLut] end]
transition[on StarIn         c a b t do star  [c   t 0] c.merge[a b] end]
transition[on StarOut        c a b t do star  [c 1-t 0] c.merge[b a] end]
transition[on StarSpinIn     c a b t do star  [c   t t] c.merge[a b] end]
transition[on StarSpinOut    c a b t do star  [c 1-t t] c.merge[b a] end]
transition[on HeartIn        c a b t do heart [c   t  ] c.merge[a b] end]
transition[on HeartOut       c a b t do heart [c 1-t  ] c.merge[b a] end]
transition[on CircleIn       c a b t do circle[c   t  ] c.merge[a b] end]
transition[on CircleOut      c a b t do circle[c 1-t  ] c.merge[b a] end]
transition[on CircleInClick  c a b t do if 0~t clickpos:pointer.start end circleClick[c   t] c.merge[a b] end]
transition[on CircleOutClick c a b t do if 0~t clickpos:pointer.start end circleClick[c 1-t] c.merge[b a] end]
transition[on StretchDown    c a b t do c.paste[a] c.paste[b (       0    ,  0),      b.size*1,t] end]
transition[on StretchUp      c a b t do c.paste[a] c.paste[b (c.size*0    ,1-t),(0,1)+b.size*1,t] end]
transition[on StretchRight   c a b t do c.paste[a] c.paste[b (       0    ,  0),      b.size*t,1] end]
transition[on StretchLeft    c a b t do c.paste[a] c.paste[b (c.size*(1-t),  0),(1,0)+b.size*t,1] end]

transition[on Wink c a b t do
 s:if t<.5 c.paste[a] t else c.paste[b] 1-t end
 c.rect[       0,0 c.size*1, s]
 c.rect[c.size*0,1 c.size*1,-s]
end]

module.descs.Dissolve      :"A randomized dissolve."
module.descs.BlindsVert    :"Vertical Venetian blinds."
module.descs.BlindsHoriz   :"Horizontal Venetian blinds."
module.descs.StarIn        :"Star-shaped zoom-in."
module.descs.StarOut       :"Star-shaped zoom-out."
module.descs.StarSpinIn    :"Spinning star-shaped zoom-in."
module.descs.StarSpinOut   :"Spinning star-shaped zoom-out."
module.descs.HeartIn       :"Heart-shaped zoom-in."
module.descs.HeartOut      :"Heart-shaped zoom-out."
module.descs.CircleIn      :"Circle-shaped zoom-in."
module.descs.CircleOut     :"Circle-shaped zoom-out."
module.descs.CircleInClick :"Circle-shaped zoom-in centered on the user's last click."
module.descs.CircleOutClick:"Circle-shaped zoom-out centered on the user's last click."
module.descs.StretchDown   :"Stretch the destination in from the top edge."
module.descs.StretchUp     :"Stretch the destination in from the bottom edge."
module.descs.StretchRight  :"Stretch the destination in from the left edge."
module.descs.StretchLeft   :"Stretch the destination in from the right edge."
module.descs.Wink          :"Vertical squint to black, then unsquint to destination."
{end}

</script>
<a id='target' style='display:none'></a>
<img id='loader' style='display:none'/>
<input id='source' type='file' style='display:none'>
<canvas id='render' style='display:none'></canvas>
<canvas id='lrender' style='display:none'></canvas>
<canvas id='rrender' style='display:none'></canvas>
<canvas width='0' height='0' id='ltools'></canvas>
<canvas id='display'></canvas>
<canvas width='0' height='0' id='rtools'></canvas>
<style>
html,body{height:100%;}
body{background:black;margin:0;display:flex;align-items:center;justify-content:space-between;-webkit-user-select:none;user-select:none;}
body{touch-action:none;overflow:hidden;}
</style>
<script>
VERSION="1.11"
// lil: Learning in Layers

let allocs=0,calldepth=0
lmn  =x      =>(allocs++,{t:'num',v:isFinite(x)?+x:0}),   lin  =x=>x&&x.t=='num'
lms  =x      =>(allocs++,{t:'str',v:''+x }),              lis  =x=>x&&x.t=='str'
lml  =x      =>(allocs++,{t:'lst',v:x    }),              lil  =x=>x&&x.t=='lst'
lmd  =(k,v)  =>(allocs++,{t:'dic',k:k||[],v:v||[]}),      lid  =x=>x&&x.t=='dic'
lmt  =x      =>(allocs++,{t:'tab',v:x    }),              lit  =x=>x&&x.t=='tab'
lmi  =(f,n,x)=>(allocs++,{t:'int',f,n}),                  lii  =x=>x&&x.t=='int'
lmon =(n,a,b)=>(allocs++,{t:'on' ,n:n,a:a,b:b,c:null}),   lion =x=>x&&x.t=='on'
lmnat=f      =>(allocs++,{t:'nat',f:f}),                  linat=x=>x&&x.t=='nat'
lmblk=_      =>(allocs++,{t:'blk',b:[],locals:[]}),       liblk=x=>x&&x.t=='blk'
lmenv=p      =>{allocs++;const r={t:'env',v:{},p:p};r.local=(n,x)=>env_local(r,lms(n),x);return r}

NONE=lmn(0), ONE=lmn(1), seed=0x12345, max=Math.max, min=Math.min, abs=Math.abs
ISODATE=lms('%04i-%02i-%02iT%02i:%02i:%02iZ%n%m'), PARTS=['year','month','day','hour','minute','second'].map(lms)
clchar=x=>{const c=x.charCodeAt(0);return x=='\t'?' ':(c>=32&&c<=126)||(x=='\n')?x:'?'}
clchars=x=>x.replace(/\r/g,'').replace(/\t/g,' ').replace(/[\u201C\u201D]/g,'"').replace(/[\u2018\u2019]/g,"'").replace(/[^ -~\n]/g,'?')
wnum=y=>{
 let w='',d='',s=y<0?(y=-y,'-'):'',i=Math.floor(y);while(i>0){w=(0|i%10)+w,i=i/10}
 y=Math.round((y-Math.floor(y))*1000000);for(let z=0;z<6;z++){d=(0|y%10)+d,y=y/10}
 return s+('0'+w).replace(/^(0+)(?=[^0])/,'')+('.'+d).replace(/(\.?0+)$/,'')
}
mod=(x,y)=>x-y*Math.floor(x/y)
range=x=>Array.from(Array(x)).map((_,i)=>i)
torect=t=>{const n=Object.values(t).reduce((x,y)=>max(x,lil(y)?count(y):1),0);Object.keys(t).map(k=>t[k]=take(n,lil(t[k])?t[k].v:[t[k]]))}
count=x=>lin(x)?1: lis(x)||lil(x)||lid(x)?x.v.length: lit(x)?(Object.values(x.v)[0]||[]).length:0
rows=x=>{const t=lt(x);return lml(range(count(t)).map(i=>lmd(Object.keys(t.v).map(lms),Object.values(t.v).map(x=>x[i]))))}
coltab=x=>{
 const n=lmn(x.v.reduce((x,y)=>max(x,lil(y)?count(y):1),0))
 return lmt(x.k.reduce((r,k,i)=>(r[ls(k)]=dyad.take(n,lil(x.v[i])?x.v[i]:lml([x.v[i]])).v,r),{}))
}
rowtab=x=>{
 const ok=[],t={};x.v.map(r=>r.k.map(k=>{if(!t[ls(k)])ok.push(k);t[ls(k)]=[]}))
 x.v.map(x=>Object.keys(t).map((k,i)=>t[k].push(dget(x,ok[i])||NONE)));return lmt(t)
}
listab=x=>{
 const m=x.v.reduce((r,x)=>max(r,count(x)),0);const t={};for(let z=0;z<m;z++)t['c'+z]=[]
 x.v.map(row=>{for(let z=0;z<m;z++)t['c'+z].push(z>=count(row)?NONE:row.v[z])});return lmt(t)
}
zip=(x,y,f)=>{const n=count(x),o=count(y)<n?take(n,y.v):y.v;return x.v.map((x,i)=>f(x,o[i%n]))}
match=(x,y)=>x==y?1: (x.t!=y.t)||(count(x)!=count(y))?0: (lin(x)||lis(y))?x.v==y.v:
          lil(x)?x.v.every((z,i)=>dyad['~'](z,y.v[i]).v): lit(x)?dyad['~'](rows(x),rows(y)).v:
          lid(x)?x.v.every((z,i)=>dyad['~'](z,y.v[i]).v&&dyad['~'](x.k[i],y.k[i]).v):0
splicet=(f,x,t)=>{const r={};Object.keys(t.v).map(k=>r[k]=f(x,t.v[k]));return lmt(r)}
splice=(f,x,y)=>lis(y)?lms(f(x,ll(y)).map(ls).join('')): lid(y)?lmd(f(x,y.k),f(x,y.v)): lit(y)?splicet(f,x,y): lml(f(x,ll(y)))
ina=(x,y)=>lmn(lis(y)?y.v.indexOf(ls(x))>=0: lil(y)?y.v.some(y=>match(x,y)): lid(y)?dget(y,x)!=undefined: lit(y)?ls(x)in y.v: x==y)
filter=(i,x,y)=>{
 x=lis(x)?monad.list(x):lml(ll(x))
 if(lid(y)){const r=lmd();y.k.forEach((k,v)=>i==lb(ina(k,x))&&dset(r,k,y.v[v]));return r}
 if(!lit(y))return lml(ll(y).filter(z=>i==lb(ina(z,x)))); const n=x.v.every(lin),nx=x.v.map(ln),ix=y.v[Object.keys(y.v)[0]]||[]
 if(n&&i){const r=dyad.take(NONE,y);nx.forEach(i=>{Object.keys(y.v).map(c=>{const v=y.v[c][i];if(v)r.v[c].push(v)})});return r}
 if(n&&!i){const r=dyad.take(NONE,y);ix.forEach((_,i)=>{if(nx.indexOf(i)<0)Object.keys(y.v).map(c=>r.v[c].push(y.v[c][i]))});return r}
 return lmt(Object.keys(y.v).reduce((t,k)=>(i==lb(ina(lms(k),x))&&(t[k]=y.v[k]),t),{}))
}
take=(x,y)=>{const n=y.length, s=x<0?mod(x,n):0; return range(abs(x)).map(z=>y[mod(z+s,n)])}
dkix=(dict,key)=>dict.k.findIndex(x=>match(key,x)), dget=(dict,key)=>dict.v[dkix(dict,key)]
dvix=(dict,val)=>dict.v.findIndex(x=>match(val,x)), dkey=(dict,val)=>dict.k[dvix(dict,val)]
dset=(d,k,v)=>{const i=d.k.findIndex(x=>match(x,k));if(i<0){d.k.push(k),d.v.push(v)}else{d.v[i]=v};return d}
union=(x,y)=>{const r=lmd(x.k.slice(0),x.v.slice(0));y.k.forEach(k=>dset(r,k,dget(y,k)));return r}
amend=(x,i,y)=>{
 if(lii(x))return x.f(x,i,y)
 if(!lis(x)&&!lil(x)&&!lid(x))return amend(lml([]),i,y)
 if((lil(x)||lis(x))&&(!lin(i)||(ln(i)<0||ln(i)>count(x))))return amend(ld(x),i,y)
 if(lil(x)){const r=lml(x.v.slice(0));r.v[ln(i)|0]=y;return r}
 return lid(x)?dset(lmd(x.k.slice(0),x.v.slice(0)),i,y): lis(x)?lms(ls(x).slice(0,ln(i))+ls(y)+ls(x).slice(1+ln(i))): lml([])
}
l_at=(x,y)=>{
 if(lii(x))return lis(y)&&y.v=='type'?lms(x.n): x.f(x,y)
 if(lit(x)&&lin(y))x=monad.rows(x); if((lis(x)||lil(x))&&!lin(y))x=ld(x)
 return lis(x)?lms(x.v[ln(y)|0]||''): lil(x)?x.v[ln(y)|0]||NONE: lid(x)?dget(x,y)||NONE: lit(x)&&lis(y)?lml(x.v[ls(y)]): NONE
}
amendv=(x,i,y,n,tla)=>{
 if(lii(x))tla.v=0;const f=monad.first(i[n]||NONE)
 return (!tla.v&&n+1 <i.length)?amendv(l_at(x,f),i,y,n+1,tla):
        (n+1<i.length)?amend(x,f,amendv(l_at(x,f),i,y,n+1,tla)): (n+1==i.length)?amend(x,f,y): y
}
lb=x=>lin(x)?x.v!=0: lis(x)?x.v!='': lil(x)||lid(x)?x.v.length: true
ln=x=>lin(x)?x.v: lis(x)?(isFinite(x.v)?+x.v:0): lil(x)||lid(x)?ln(x.v[0]): 0
ls=x=>lin(x)?wnum(x.v): lis(x)?x.v: lil(x)?x.v.map(ls).join(''): ''
ll=x=>lis(x)?x.v.split('').map(lms): lil(x)||lid(x)?x.v: lit(x)?rows(x).v: [x]
ld=x=>lid(x)?x:lit(x)?monad.cols(x):lil(x)||lis(x)?lmd(range(count(x)).map(lmn),lis(x)?ll(x):x.v):lmd()
lt=x=>lit(x)?x: lid(x)||lil(x)?lmt((lid(x)?['key','value']:['value']).reduce((t,k,i)=>(t[k]=x[k[0]],t),{})): lmt({value:ll(x)})
vm=f=>{const r=x=>lil(x)?lml(x.v.map(r)):f(x);return r}
vd=f=>{const r=(x,y)=>lil(x)&lil(y)?lml(zip(x,y,r)): lil(x)&!lil(y)? lml(x.v.map(x=>r(x,y))): !lil(x)&lil(y)?lml(y.v.map(y=>r(x,y))): f(x,y);return r}
vmnl=f=>{const r=x=>lil(x)?(ll(x).some(x=>!lin(x))?lml(x.v.map(r)):f(x)):f(x);return r}
tflip=x=>{
 const c=Object.keys(x.v), kk=c.indexOf('key')>-1?'key':c[0], k=(x.v[kk]||[]).map(ls), cc=c.filter(k=>k!=kk)
 return lmt(k.reduce((r,k,i)=>{r[k]=cc.map(c=>x.v[c][i]);return r},{key:cc.map(lms)}))
}
tcat=(x,y)=>{
 const r={}
 Object.keys(x.v).map(k=>r[k]=x.v[k].concat(y.v[k]?[]:range(count(y)).map(x=>NONE)))
 Object.keys(y.v).map(k=>r[k]=(x.v[k]?x.v[k]:range(count(x)).map(x=>NONE)).concat(y.v[k]))
 return lmt(r)
}
fstr=x=>{
 let ct=0;return x.split('').map(x=>{
  let e=0;if(x=='<'){ct=1}else if(x=='/'&&ct){e=1}else if(x!=' '&&x!='\n'){ct=0}
  return e?'\\/':({'\n':'\\n','\\':'\\\\','"':'\\"'})[x]||x
 }).join('')
}
fjson=x=>lin(x)?wnum(x.v): lil(x)?`[${x.v.map(fjson).join(',')}]`:
         lis(x)?`"${fstr(x.v)}"`:lid(x)?`{${x.k.map((k,i)=>`${fjson(lms(ls(k)))}:${fjson(x.v[i])}`).join(',')}}`:'null'
pjson=(y,h,n)=>{
 const si=h, hn=_=>m&&y[h]&&(n?h-si<n:1), hnn=x=>m&&h+x<=y.length&&(n?h+x-si<n:1)
 const jd=_=>{while(hn()&&/[0-9]/.test(y[h]))h++}, jm=x=>hn()&&y[h]==x?(h++,1):0, iw=_=>/[ \n]/.test(y[h]), ws=_=>{while(hn()&&iw())h++}
 const esc=e=>e=='n'?'\n': /[\\/"]/.test(e)?e: e=='u'&&hnn(4)?String.fromCharCode(parseInt(y.slice(h,h+=4),16)):' '
 let f=1, m=1, rec=_=>{
  const t={null:NONE,false:NONE,true:ONE};for(let k in t)if(hnn(k.length)&&y.slice(h,h+k.length)==k)return h+=k.length,t[k]
  if(jm('[')){const r=lml([]);while(f&&hn()){ws();if(jm(']'))break;r.v.push(rec()),ws(),jm(',')}return r}
  if(jm('{')){const r=lmd();while(f&&hn()){ws();if(jm('}'))break;const k=rec();ws(),jm(':');if(f)dset(r,k,rec());ws(),jm(',')}return r}
  if(jm('"')){let r='';while(f&&hn()&&!jm('"'))r+=hnn(2)&&jm('\\')?esc(y[h++]):y[h++];return lms(r)}
  const ns=h;jm('-'),jd(),jm('.'),jd();if(jm('e')||jm('E')){jm('-')||jm('+');jd();}return h<=ns?(f=0,NONE): lmn(+y.slice(ns,h))
 }, r=rec();return {value:r,index:h}
}
monad={
 '-':    vm(x=>lmn(-ln(x))),
 '!':    vm(x=>lb(x)?NONE:ONE),
 floor:  vm(x=>lmn(Math.floor(ln(x)))),
 cos:    vm(x=>lmn(Math.cos(ln(x)))),
 sin:    vm(x=>lmn(Math.sin(ln(x)))),
 tan:    vm(x=>lmn(Math.tan(ln(x)))),
 exp:    vm(x=>lmn(Math.exp(ln(x)))),
 ln:     vm(x=>lmn(Math.log(ln(x)))),
 sqrt:   vm(x=>lmn(Math.sqrt(ln(x)))),
 unit:   vm(x=>{const n=ln(x);return lml([lmn(Math.cos(n)),lmn(Math.sin(n))])}),
 mag:    vmnl(x=>lmn(Math.sqrt(ll(x).reduce((x,y)=>x+Math.pow(ln(y),2),0)))),
 heading:vmnl(x=>{const a=getpair(x);return lmn(Math.atan2(a.y,a.x))}),
 sum:    x=>ll(x).reduce(dyad['+'],NONE),
 raze:   x=>ll(x).slice(1).reduce(dyad[','],monad.first(x)),
 max:    x=>ll(x).slice(1).reduce(dyad['|'],monad.first(x)),
 min:    x=>ll(x).slice(1).reduce(dyad['&'],monad.first(x)),
 count:  x=>lmn(count(x)),
 first:  x=>lit(x)?monad.first(rows(x)): count(x)?ll(x)[0]: NONE,
 last:   x=>lit(x)?monad.last (rows(x)): count(x)?ll(x)[count(x)-1]: NONE,
 range:  x=>lml(lin(x)?range(max(0,0|ln(x))).map(lmn): ld(x).k),
 list:   x=>lml([x]),
 typeof: x=>lms(({num:"number",str:"string",lst:"list",dic:"dict",tab:"table",on:"function",nat:"function"})[x.t]||x.n||"interface"),
 flip:   x=>lit(x)?tflip(x):lml(range(ll(x).reduce((w,z)=>max(w,lil(z)?count(z):1),0)).map(i=>lml(ll(x).map(c=> !lil(c)?c: i<count(c)?c.v[i]: NONE)))),
 rows:   x=>rows(x),
 cols:   x=>{const t=lt(x).v;return lmd(Object.keys(t).map(lms),Object.values(t).map(lml))},
 table:  x=>lid(x)?coltab(x): lil(x)&&x.v.every(lid)?rowtab(x): lil(x)&&x.v.every(lil)?listab(x): lt(x),
 '@tab': t=>{t=lt(t);const r=lmt({});Object.keys(t.v).map(k=>r.v[k]=t.v[k].slice(0)),r.v.index=range(count(r)).map(lmn);return r},
}
dyad={
 '+':  vd((x,y)=>lmn(ln(x)+ln(y))),
 '-':  vd((x,y)=>lmn(ln(x)-ln(y))),
 '*':  vd((x,y)=>lmn(ln(x)*ln(y))),
 '/':  vd((x,y)=>lmn(ln(x)/ln(y))),
 '%':  vd((x,y)=>lmn(mod(ln(y),ln(x)))),
 '^':  vd((x,y)=>lmn(Math.pow(ln(x),ln(y)))),
 '<':  vd((x,y)=>lmn(lin(x)&&lin(y)?ln(x)< ln(y): ls(x)< ls(y))),
 '>':  vd((x,y)=>lmn(lin(x)&&lin(y)?ln(x)> ln(y): ls(x)> ls(y))),
 '=':  vd((x,y)=>lmn(lii(x)||lii(y)?x==y: lin(x)&&lin(y)?ln(x)==ln(y): ls(x)==ls(y))),
 '&':  vd((x,y)=>lin(x)||lin(y)?lmn(min(ln(x),ln(y))): lms(ls(x)<ls(y)?ls(x):ls(y))),
 '|':  vd((x,y)=>lin(x)||lin(y)?lmn(max(ln(x),ln(y))): lms(ls(x)>ls(y)?ls(x):ls(y))),
 split:(x,y)=>lml(ls(y).split(ls(x)).map(lms)),
 fuse: (x,y)=>lms(ll(y).map(ls).join(ls(x))),
 dict: (x,y)=>(y=ll(y),ll(x).reduce((d,x,i)=>dset(d,x,y[i]||NONE),lmd())),
 take: (x,y)=>lin(x)?splice(take,ln(x),y):filter(1,x,y),
 drop: (x,y)=>lin(x)?splice((x,y)=>x<0?y.slice(0,x):y.slice(x),ln(x),y):filter(0,x,y),
 limit:(x,y)=>count(y)>ln(x)?dyad.take(lmn(ln(x)),y):y,
 in:   (x,y)=>lil(x)?lml(x.v.map(x=>dyad.in(x,y))):ina(x,y),
 ',':  (x,y)=>lit(x)&&lit(y)?tcat(x,y): lid(x)?union(x,ld(y)):
                 lis(x)?dyad[','](lml([x]),y): lis(y)?dyad[','](x,lml([y])): lml(ll(x).concat(ll(y))),
 '~':  (x,y)=>match(x,y)?ONE:NONE,
 unless:(x,y)=>lin(y)&&ln(y)==0?x:y,
 join: (x,y)=>{ // natural join on tables.
  const f=x=>lin(x)?monad.range(x):lml(ll(x));if(!lit(x)||!lit(y))return lml(zip(f(x),f(y),dyad[',']))
  const a=x,b=y,ak=Object.keys(a.v),bk=Object.keys(b.v), ik=bk.filter(x=>ak.indexOf(x)>=0),dk=bk.filter(x=>ak.indexOf(x)<0)
  const r=lmt({}); ak.forEach(k=>r.v[k]=[]), dk.forEach(k=>r.v[k]=[])
  for(let ai=0;ai<count(a);ai++)for(let bi=0;bi<count(b);bi++)
   if(ik.every(k=>match(a.v[k][ai],b.v[k][bi])))ak.forEach(k=>r.v[k].push(a.v[k][ai])),dk.forEach(k=>r.v[k].push(b.v[k][bi]))
  return r
 },
 cross: (x,y)=>{ // cartesian join; force columns to be unique:
  const f=x=>lt(lin(x)?monad.range(x):lml(ll(x)));if(!lit(x)||!lit(y))return lml(rows(dyad.cross(f(x),f(y))).v.map(x=>lml(x.v)))
  const a=lt(x),b=lt(y), ak=Object.keys(a.v),bk=Object.keys(b.v), uk=bk.map(x=>ak.indexOf(x)>=0?x+'_':x)
  const r=lmt({}); ak.forEach(k=>r.v[k]=[]), uk.forEach(k=>r.v[k]=[])
  for(let bi=0;bi<count(b);bi++)for(let ai=0;ai<count(a);ai++)ak.forEach(k=>r.v[k].push(a.v[k][ai])),bk.forEach((k,i)=>r.v[uk[i]].push(b.v[k][bi]))
  return r
 },
 parse: (x,y)=>{
  if(lil(y))return lml(y.v.map(y=>dyad.parse(x,y)))
  x=ls(x),y=ls(y);let r=[],f=0,h=0,m=1;while(x[f]){
   if(x[f]!='%'){if(m&&x[f]==y[h]){h++}else{m=0}f++;continue}f++
   let n=0,d=0,v=null,si=h,sk=x[f]=='*'&&(f++,1),lf=x[f]=='-'&&(f++,1);if(x[f]=='0')f++
   const hn=_=>m&&y[h]&&(n?h-si<n:1), id=x=>/[0-9]/.test(x), ix=_=>/[0-9a-fA-F]/.test(y[h]), iw=_=>/[ \n]/.test(y[h])
   while(id(x[f]))n=n*10+(+x[f++]);x[f]=='.'&&f++
   while(id(x[f]))d=d*10+(+x[f++]);if(!x[f])break;const t=x[f++]
   if('%mnzsluaro'.indexOf(t)<0)while(hn()&&iw())h++
   if(t=='%'){if(m&&t==y[h]){h++}else{m=0}}
   else if(t=='m'){v=m?ONE:NONE}
   else if(t=='n'){v=lmn(h)}
   else if(t=='z'){v=m&&h==y.length?ONE:NONE}
   else if(t=='s'||t=='l'||t=='u'){v=lms('');while(hn()&&(n?1:y[h]!=x[f]))v.v+=y[h++];if(t=='l')v.v=v.v.toLowerCase();if(t=='u')v.v=v.v.toUpperCase()}
   else if(t=='a'){v=lml([]);while(hn()&&(n?1:y[h]!=x[f]))v.v.push(lmn(y[h++].charCodeAt(0)))}
   else if(t=='b'){v=/[tTyYx1]/.test(y[h])?ONE:NONE;while(hn()&&(n?1:y[h]!=x[f]))h++}
   else if(t=='i'){v=lmn(0);const s=(y[h]=='-')?(h++,-1):1;m&=id(y[h]);while(hn()&&id(y[h]))v.v=v.v*10+(+y[h++]);v.v*=s}
   else if(t=='h'||t=='H'){v=lmn(0),                       m&=ix();    while(hn()&&ix())v.v=v.v*16+parseInt(y[h++],16)}
   else if(t=='j'){if(m){const j=pjson(y,h,n);h=j.index,v=j.value}else{v=NONE}}
   else if(t=='f'||t=='c'){
    v=lmn(0);let p=10,s=(y[h]=='-')?(h++,-1):1; if(t=='c'&&m&&y[h]=='$')h++
    m&=id(y[h])||y[h]=='.';  while(hn()&&id(y[h]))v.v=v.v*10+(+y[h++])
    m&&hn()&&y[h]=='.'&&h++; while(hn()&&id(y[h]))v.v+=(+y[h++])/p,p*=10;v.v*=s
   }
   else if(t=='r'||t=='o'){
    let cc=x.slice(f,f+(d||1));v=lms(''),f+=(d||1);
    while(hn()){if(cc.indexOf(y[h])>=0==lf?1:0){if(n)m=0;break}v.v+=y[h++];if(t=='o')break;}if(!m)v.v='';
   }
   else if(t=='e'||t=='p'){
    const [dy,dm,dd,dh,dmi,ds,dl,dma]=ll(dyad.parse(ISODATE,lms(y.slice(h)))), l=ln(dl), d=new Date(y.slice(h,h+l))
    if(l&&ln(dma)){h+=l}else{m=0}; v=t=='e'?lmn(m?0|(d.getTime()/1000):0):lmd(PARTS,[dy,dm,dd,dh,dmi,ds])
   }else{m=0}while(n&&y[h]&&h-si<n)h++,m=0;if(!sk&&v!=null)r.push(v)
  }return r.length==1?r[0]:lml(r)
 },
 format: (x,y)=>{
  const frec=(i,x,y)=>{
   if(i>=count(x))return y
   const fuse=(count(x)-i)%2?0:1,r=lml(ll(lit(y)?rows(y):y).map(z=>dyad.format(x.v[i+fuse],frec(i+fuse+1,x,lit(y)?lml(ll(z)):z))))
   return fuse?dyad.fuse(x.v[i],r):r
  };if(lil(x))return frec(0,x,y)
  x=ls(x),y=lil(y)?y:monad.list(y);let r='',f=0,h=0;while(x[f]){
   if(x[f]!='%'){r+=x[f++];continue}f++
   let n=0,d=0,sk=x[f]=='*'&&(f++,1),lf=x[f]=='-'&&(f++,1),pz=x[f]=='0'&&(f++,1)
   const hn=_=>m&&y[h]&&(n?h-si<n:1), id=x=>/[0-9]/.test(x)
   while(id(x[f]))n=n*10+(+x[f++]);x[f]=='.'&&f++
   while(id(x[f]))d=d*10+(+x[f++]);if(!x[f])break;const t=x[f++]
   let o='', a=t=='%'?NONE: (!sk&&h<count(y))?y.v[h++]: 'sluro'.indexOf(t)>=0?lms(''):NONE
   if     (t=='%'){o='%'}
   else if(t=='s'){o=ls(a)}
   else if(t=='l'){o=ls(a).toLowerCase()}
   else if(t=='u'){o=ls(a).toUpperCase()}
   else if(t=='r'||t=='o'){o=ls(a),lf=1;d=max(1,d);while(d&&x[f])d--,f++;d=n;}
   else if(t=='a'){o=ll(a).map(x=>clchar(String.fromCharCode(ln(x)))).join('')}
   else if(t=='b'){o=lb(a)?'true':'false'}
   else if(t=='f'){o=d?ln(a).toFixed(min(100,d)):wnum(ln(a))}
   else if(t=='c'){const v=ln(a);o=(v<0?'-':'')+'$'+abs(v).toFixed(min(100,d)||2)}
   else if(t=='i'){o=''+Math.trunc(ln(a))}
   else if(t=='h'||t=='H'){o=ln(a).toString(16);if(t=='H')o=o.toUpperCase()}
   else if(t=='e'){o=new Date(ln(a)*1000).toISOString().split('.')[0]+'Z'}
   else if(t=='p'){const d=ld(a);o=dyad.format(ISODATE,lml(PARTS.map(x=>dget(d,x)))).v}
   else if(t=='j'){o=fjson(a);}
   let vn=o.length; if(d&&(t=='f'||t=='c'))d=0;if(d&&lf)vn=min(d,vn)
   if(n&&!lf)for(let z=0;z<n-vn;z++)r+=pz?'0':' '
   for(let z=d&&!lf?max(0,vn-d):0;z<vn;z++)r+=o[z]
   if(n&&lf)for(let z=0;z<n-vn;z++)r+=pz?'0':' '
  }return lms(r)
 },
}
merge=(vals,keys,widen)=>{
 const i=lms('@index');let ix=null
 if(!widen){ix=lml([]);vals.v.map((val,z)=>{dget(val,i).v.map(x=>ix.v.push(x))})}
 if(count(vals)==0)vals.v.push(keys.v.reduce((x,y)=>dset(x,y,lml([])),lmd()))
 let r=monad.raze(lml(vals.v.map(x=>monad.table(widen?x:dyad.drop(i,x)))))
 if(widen){ix=lml(r.v['@index']),r=dyad.drop(i,r)}
 return {r,ix}
}
n_uplevel=([a])=>{let i=2, e=getev(), r=null, name=ls(a); while(e&&i){r=e.v[name];if(r)i--;e=e.p};return r||NONE}
n_eval=([x,y])=>{
 y=y?ld(y):lmd();const yy=lmd(y.k.slice(0),y.v.slice(0)), r=lmd(['value','vars','error'].map(lms),[NONE,yy,lms('')])
 const feval=([r,x])=>{dset(r,lms('value'),x);const b=dget(r,lms('vars')), v=getev().v; Object.keys(v).map(k=>dset(b,lms(k),v[k]));return r}
 try{
  const prog=parse(x?ls(x):'')
  blk_opa(prog,op.BUND,2),blk_lit(prog,lmnat(feval)),blk_op(prog,op.SWAP),blk_op(prog,op.CALL)
  issue(env_bind(null,yy.k.map(ls),lml(yy.v)),prog)
 }catch(e){dset(r,lms('error'),lms(e.x))};return r
}
triad={
 '@sel': (orig,vals,keys)=>{const mv=merge(vals,keys,0);return count(keys)>1?mv.r: dyad.take(mv.ix,dyad.drop(lms('index'),orig))},
 '@ext': (orig,vals,keys)=>{
  const r=monad.cols(triad['@sel'](orig,vals,keys));if(r.v.every(x=>lil(x)&&count(x)==1))r.v=r.v.map(monad.first)
  return count(r)!=1||count(r.k[0])?r: monad.first(r)
 },
 '@upd': (orig,vals,keys)=>{
  orig=dyad.drop(lms('index'),orig);const mv=merge(vals,keys,1),r=mv.r,ix=mv.ix
  Object.keys(r.v).map(c=>{
   if(r.v[c]==ix)return;const ci=c in orig.v, col=range(count(orig)).map(z=>ci?orig.v[c][z]:NONE)
   orig.v[c]=col,ix.v.map((x,row)=>col[0|ln(x)]=r.v[c][row])
  });return orig
 },
 '@ins': (v,n,x)=>{
  const torect=t=>{
   const n=lmn(Object.values(t.v).reduce((x,y)=>max(x,y.length),0))
   Object.keys(t.v).map(k=>t.v[k]=ll(dyad.take(n,lml(t.v[k]))))
  }, r=monad.table(dyad.dict(n,v));torect(r);return lin(x)?r:dyad[','](lt(x),r)
 },
}

findop=(n,prims)=>Object.keys(prims).indexOf(n), as_enum=x=>x.split(',').reduce((x,y,i)=>{x[y]=i;return x},{})
let tnames=0;tempname=_=>lms(`@t${tnames++}`)
op=as_enum('JUMP,JUMPF,LIT,DROP,SWAP,OVER,BUND,OP1,OP2,OP3,GET,SET,LOC,AMEND,TAIL,CALL,BIND,ITER,EACH,NEXT,COL,QUERY,IPRE,IPOST')
oplens=   [ 3   ,3    ,3  ,1   ,1   ,1   ,3   ,3  ,3  ,3  ,3  ,3  ,3  ,3    ,1   ,1   ,1   ,1   ,3   ,3   ,1  ,3    ,3   ,3     ]
blk_addb=(x,n  )=>x.b.push(0xFF&n)
blk_here=(x    )=>x.b.length
blk_setb=(x,i,n)=>x.b[i]=0xFF&n
blk_getb=(x,i  )=>0xFF&x.b[i]
blk_adds=(x,n  )=>{blk_addb(x,n>>8),blk_addb(x,n)}
blk_sets=(x,i,n)=>{blk_setb(x,i,n>>8),blk_setb(x,i+1,n)}
blk_gets=(x,i  )=>0xFFFF&(blk_getb(x,i)<<8|blk_getb(x,i+1))
blk_op  =(x,o  )=>{blk_addb(x,o);if(o==op.COL)blk_addb(x,op.SWAP)}
blk_opa =(x,o,i)=>{blk_addb(x,o),blk_adds(x,i);return blk_here(x)-2}
blk_imm =(x,o,k)=>{let i=x.locals.findIndex(x=>match(x,k));if(i==-1)i=x.locals.length,x.locals.push(k);blk_opa(x,o,i)}
blk_op1 =(x,n)=>blk_opa(x,op.OP1,findop(n,monad))
blk_op2 =(x,n)=>blk_opa(x,op.OP2,findop(n,dyad ))
blk_op3 =(x,n)=>blk_opa(x,op.OP3,findop(n,triad))
blk_lit =(x,v)=>blk_imm(x,op.LIT,v)
blk_set =(x,n)=>blk_imm(x,op.SET,n)
blk_loc =(x,n)=>blk_imm(x,op.LOC,n)
blk_get =(x,n)=>blk_imm(x,op.GET,n)
blk_getimm=(x,i)=>x.locals[i]
blk_cat=(x,y)=>{
 let z=0,base=blk_here(x);while(z<blk_here(y)){
  const b=blk_getb(y,z);if(b==op.LIT||b==op.GET||b==op.SET||b==op.LOC||b==op.AMEND){blk_imm(x,b,blk_getimm(y,blk_gets(y,z+1)))}
  else if(b==op.JUMP||b==op.JUMPF||b==op.EACH||b==op.NEXT){blk_opa(x,b,blk_gets(y,z+1)+base)}
  else{for(let i=0;i<oplens[b];i++)blk_addb(x,blk_getb(y,z+i))}z+=oplens[b]
 }
}
blk_end=x=>{
 let z=0;while(z<blk_here(x)){
  let b=blk_getb(x,z);z+=oplens[b];if(b!=op.CALL)continue
  let t=1,i=z;while(i<blk_here(x)){if(blk_getb(x,i)!=op.JUMP){t=0;break}const a=blk_gets(x,i+1);if(a<=i){t=0;break}i=a}if(t)blk_setb(x,z-1,op.TAIL)
 }return x
}

parse=text=>{
 let i=0,r=0,c=0, tq=null // text index, row, column, token queued
 const er=x=>{throw {x,r,c,i,stack:new Error().stack}}
 const nc=_=>{const x=text[i++];x=='\n'?(r++,c=0):(c++);return x}
 const iw=_=>text[i]in{' ':1,'\t':1,'\n':1,'#':1}
 const sw=_=>{while(iw())if(text[i]=='#')while(i<text.length&&text[i]!='\n')nc();else nc()}
 const id=_=>0<='0123456789'.indexOf(text[i])
 //          !"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~
 const tcc=' s" sss ()ssssdsdddddddddd: sssn@nnnnnnnnnnnnnnnnnnnnnnnnnn[ ]sn nnnnnnnnnnnnnnnnnnnnnnnnnn s s'
 const ncc='                nnnnnnnnnn     n nnnnnnnnnnnnnnnnnnnnnnnnnn    n nnnnnnnnnnnnnnnnnnnnnnnnnn    '
 const mcc='     xx x xxxx x          x xxx x                          x  x                             x x'
 const esc={'\\':'\\','"':'"','n':'\n'}
 const ne=_=>{const e=nc();return e in esc?esc[e]: er(`Invalid escape character '\\${e}' in string.`)}
 const nw=x=>{let v=+x;    while(id())v=(v*10)+(+nc());  return v} 
 const nf=_=>{let v=0,p=10;while(id())v+=(+nc())/p,p*=10;return v}
 const nn=(x,tr,tc,v,sign)=>{
  if(x=='.'&&!id())return{t:'.',r:tr,c:tc}
  if(x=='.')v=nf();else v=nw(x),v+=(text[i]=='.')?(nc(),nf()):0
  return {t:'number',v:sign*v,r:tr,c:tc}
 }
 const tok=_=>{
  const w=iw()||i==0||(mcc[text[i-1].charCodeAt(0)-32]=='x');sw();if(i>=text.length)return{t:'the end of the script'}
  const tr=r,tc=c, x=nc(), cc=tcc[x.charCodeAt(0)-32]; let v=0
  if(cc==' '||cc==undefined)er(`Invalid character '${x}'.`)
  if(x=='-'&&w&&tcc[(text[i]||'').charCodeAt(0)-32]=='d')return nn(nc(),r,c,v,-1)
  if(cc=='n'){let v=x; while(ncc[(text[i]||' ').charCodeAt(0)-32]=='n')v+=nc();return {t:'name',v,r:tr,c:tc}}
  if(cc=='"'){let v='',c;while(i<text.length&&(c=nc())!='"')v+=(c=='\\'?ne():clchar(c));return{t:'string',v,r:tr,c:tc}}
  return cc=='s'?{t:'symbol',v:x,r:tr,c:tc}: cc=='d'?nn(x,tr,tc,v,1):{t:x,r:tr,c:tc}
 }
 const peek=_=>{if(!tq)tq=tok();return tq}
 const hasnext=_=>peek().t!='the end of the script'
 const peek2=_=>{const pi=i,pr=r,pc=c,pq=tq;next();const v=peek();i=pi,r=pr,c=pc,tq=pq;return v}
 const next=_=>{if(tq){const r=tq;tq=null;return r};return tok()}
 const matchp=k=>peek().t=='name'&&peek().v==k
 const match=k=>matchp(k)?(next(),1):0
 const matchsp=k=>peek().t==k?(next(),1):0
 const expect=t=>peek().t==t?next().v:er(`Expected ${t}, but found ${peek().t}.`)
 const ident=n=>{
  const kw={while:1,each:1,send:1,on:1,if:1,else:1,end:1,do:1,with:1,local:1,select:1,extract:1,update:1,insert:1,
   into:1,from:1,where:1,by:1,orderby:1,asc:1,desc:1};return !(n in kw||n in monad||n in dyad)
 }
 const name=n=>{const r=expect('name');if(!ident(r)&&n!='member')er(`'${r}' is a keyword, and cannot be used for a ${n} name.`);return r}
 const names=(x,n)=>{const r=[];while(!match(x))r.push(name(n));return r}
 const quote=_=>{const r=lmblk();expr(r);blk_end(r);return r}
 const block=_=>{const r=lmblk();iblock(r);return r}
 const quotesub=_=>{let c=0,r=lmblk();while(hasnext()&&!matchsp(']'))expr(r),c++;blk_opa(r,op.BUND,c);return r}
 const quotedot=_=>{const r=lmblk();blk_lit(r,lml([lms(name('member'))]));return r}
 const iblock=r=>{let c=0;while(hasnext()){if(match('end')){if(!c)blk_lit(r,NONE);return}if(c)blk_op(r,op.DROP);expr(r),c++};er(`Expected 'end' for block.`)}
 const parsequery=(b,func,dcol)=>{
  const cols=lmd([],[]);while(!matchp('from')&&!matchp('where')&&!matchp('by')&&!matchp('orderby')){
   let set=peek2().t==':', lit=peek().t=='string', name=lms(lit?(set?peek().v:''):peek().t=='name'?peek().v:'')
   let get=ident(ls(name)), unique=ls(name).length&&dkix(cols,name)==-1; if(set&&lit&&!unique)next(),next()
   const x=set&&unique?(next(),next(),name): get&&unique&&dcol?name: lms(dcol?`c${cols.k.length}`: '')
   cols.k.push(x),cols.v.push(quote())
  }
  let cw,cb,co,dir=-1,index=lmblk();blk_get(index,lms('index'))
  if(match('where'  )){cw=quote()}else{cw=lmblk(),blk_lit(cw,ONE )}
  if(match('by'     )){cb=quote()}else{cb=lmblk(),blk_lit(cb,NONE)}
  if(match('orderby')){co=quote();dir=match('asc')?-1: match('desc')?1: er(`Expected 'asc' or 'desc'.`)}
  else{co=lmblk(),blk_get(co,lms('index'))}if(!match('from'))er(`Expected 'from'.`)
  expr(b),blk_op1(b,'@tab')
  blk_lit(b,cw),blk_op(b,op.COL),blk_lit(b,cb),blk_op(b,op.COL),blk_lit(b,co),blk_op(b,op.COL),blk_lit(b,lmn(dir)),blk_opa(b,op.QUERY,func=='@upd')
  const keys=lml(cols.k.concat([lms('@index')])),name=tempname()
  blk_op(b,op.ITER);const head=blk_here(b);blk_lit(b,[ls(name)]);const each=blk_opa(b,op.EACH,0);
   blk_lit(b,keys),blk_get(b,name),cols.v.map(x=>(blk_lit(b,x),blk_op(b,op.COL)))
   blk_lit(b,index),blk_op(b,op.COL),blk_op(b,op.DROP),blk_opa(b,op.BUND,count(keys)),blk_op2(b,'dict')
  blk_opa(b,op.NEXT,head),blk_sets(b,each,blk_here(b)),blk_lit(b,keys),blk_op3(b,func)
 }
 const parseindex=(b,name)=>{
  const i=[];while(peek().t in{'[':1,'.':1}){
   if(matchsp('['))i.push(quotesub())
   if(matchsp('.')){
    if(peek().t in{'[':1,'.':1}){
     i.map(v=>(blk_cat(b,v),blk_op(b,op.CALL)))
     blk_op(b,op.ITER);const head=blk_here(b);blk_lit(b,['x'])
     const each=blk_opa(b,op.EACH,0);blk_get(b,lms('x')),parseindex(b)
     blk_opa(b,op.NEXT,head),blk_sets(b,each,blk_here(b));return
    }else{i.push(quotedot())}
   }
  }
  if(matchsp(':')){
   i.map(v=>blk_cat(b,v)),blk_opa(b,op.BUND,i.length),blk_op(b,op.OVER)
   for(let z=0;z<i.length-1;z++)blk_opa(b,op.IPRE,z),blk_opa(b,op.IPOST,z);expr(b),blk_imm(b,op.AMEND,name||NONE)
  }else{i.map(v=>(blk_cat(b,v),blk_op(b,op.CALL)))}
 }
 const term=b=>{
  if(peek().t=='number'){blk_lit(b,lmn(next().v));return}
  if(peek().t=='string'){blk_lit(b,lms(next().v));return}
  if(match('if')){
   expr(b);let bail=blk_opa(b,op.JUMPF,0),e=0,c=0
   while(hasnext()&&!match('end')&&!(e=match('else'))){if(c)blk_op(b,op.DROP);expr(b),c++;}
   if(!c)blk_lit(b,NONE);const exit=blk_opa(b,op.JUMP,0);blk_sets(b,bail,blk_here(b))
   if(e){iblock(b)}else{blk_lit(b,NONE)}blk_sets(b,exit,blk_here(b));return
  }
  if(match('while')){
   blk_lit(b,NONE);const head=blk_here(b);expr(b);const cond=blk_opa(b,op.JUMPF,0)
   blk_op(b,op.DROP),iblock(b),blk_opa(b,op.JUMP,head),blk_sets(b,cond,blk_here(b));return
  }
  if(match('each')){
   const n=names('in','variable');expr(b),blk_op(b,op.ITER);const head=blk_here(b);blk_lit(b,n)
   const each=blk_opa(b,op.EACH,0);iblock(b),blk_opa(b,op.NEXT,head),blk_sets(b,each,blk_here(b));return
  }
  if(match('on')){
   const n=name('function'),a=names('do','argument')
   blk_lit(b,lmon(n,a,blk_end(block()))),blk_op(b,op.BIND);return
  }
  if(match('send')){
   blk_lit(b,lmnat(n_uplevel)),blk_lit(b,lml([lms(name('function'))])),blk_op(b,op.CALL)
   expect('['),blk_cat(b,quotesub()),blk_op(b,op.CALL);return
  }
  if(match('local')){const n=lms(name('variable'));expect(':'),expr(b),blk_loc(b,n);return}
  if(match('select' )){parsequery(b,'@sel',1);return}
  if(match('extract')){parsequery(b,'@ext',0);return}
  if(match('update' )){parsequery(b,'@upd',1);return}
  if(match('insert')){
   const n=lml([]);while(!match('into')){n.v.push(lms(peek().t=='string'?next().v:name('column'))),expect(':'),expr(b)}
   blk_opa(b,op.BUND,count(n)),blk_lit(b,n),expr(b),blk_op3(b,'@ins');return
  }
  if(matchsp('(')){if(matchsp(')')){blk_lit(b,lml([]));return}expr(b),expect(')');return}
  const s=peek().v;if(findop(s,monad)>=0&&peek().t in{'symbol':1,'name':1}){next(),expr(b),blk_op1(b,s);return}
  const n=lms(name('variable'));if(matchsp(':')){expr(b),blk_set(b,n);return}blk_get(b,n),parseindex(b,n)
 }
 const expr=b=>{
  term(b);if(peek().t in {'[':1,'.':1}){parseindex(b)}
  if(matchsp('@')){
   const temp=tempname(),names=['v','k','i'];blk_set(b,temp),blk_op(b,op.DROP)
   expr(b),blk_op(b,op.ITER);const head=blk_here(b);blk_lit(b,names);const each=blk_opa(b,op.EACH,0)
    blk_get(b,temp),names.map(n=>blk_get(b,lms(n))),blk_opa(b,op.BUND,3),blk_op(b,op.CALL)
   blk_opa(b,op.NEXT,head),blk_sets(b,each,blk_here(b));return
  }
  const s=peek().v;if(findop(s,dyad)>=0&&peek().t in {'symbol':1,'name':1}){next(),expr(b),blk_op2(b,s)}
 }
 const b=lmblk();if(hasnext())expr(b);while(hasnext())blk_op(b,op.DROP),expr(b)
 if(blk_here(b)==0)blk_lit(b,NONE);return b
}

env_local=(e,n,x)=>{e.v[ls(n)]=x}
env_getr =(e,n  )=>{const r=e.v[ls(n)];return r?r: e.p?env_getr(e.p,n): null}
env_setr =(e,n,x)=>{const r=e.v[ls(n)];return r?e.v[ls(n)]=x: e.p?env_setr(e.p,n,x): null}
env_get  =(e,n  )=>env_getr(e,n)||NONE
env_set  =(e,n,x)=>{const r=env_getr(e,n);r?env_setr(e,n,x):env_local(e,n,x)}
env_bind =(e,k,v)=>{const r=lmenv(e); k.map((a,i)=>env_local(r,lms(a),v.v[i]||NONE));return r}
const monadi=Object.values(monad), dyadi=Object.values(dyad), triadi=Object.values(triad), states=[]; let state=null
pushstate=env=>{if(state){states.push(state)};state={e:[env],p:[],t:[],pcs:[]}}
popstate =_=>{state=states.pop()}
halt     =_=>{state.p=[],state.t=[],state.e=[state.e[0]]}
running  =_=>state.t.length>0
getev    =_=>state.e  [state.e  .length-1]
getblock =_=>state.t  [state.t  .length-1]
getpc    =_=>state.pcs[state.pcs.length-1]
setpc    =x=>state.pcs[state.pcs.length-1]=x
issue    =(env,blk)=>(state.e.push(env),state.t.push(blk),state.pcs.push(0))
descope  =_=>(state.e.pop(),state.t.pop(),state.pcs.pop())
ret      =x=>state.p.push(x)
arg      =_=>state.p.pop()
docall=(f,a,tail)=>{
 if(linat(f)){ret(f.f(ll(a)));return}
 if(!lion(f)){ret(l_at(f,monad.first(a)));return}
 if(tail){descope()}issue(env_bind(f.c,f.a,a),f.b),calldepth=max(calldepth,state.e.length)
}
runop=_=>{
 const b=getblock();if(!liblk(b))ret(state.t.pop())
 const pc=getpc(),o=blk_getb(b,pc),imm=(oplens[o]==3?blk_gets(b,1+pc):0); setpc(pc+oplens[o])
 switch(o){
  case op.DROP :arg();break
  case op.SWAP :{const a=arg(),b=arg();ret(a),ret(b);break}
  case op.OVER :{const a=arg(),b=arg();ret(b),ret(a),ret(b);break}
  case op.JUMP :setpc(imm);break
  case op.JUMPF:if(!lb(arg()))setpc(imm);break
  case op.LIT  :ret(blk_getimm(b,imm));break
  case op.GET  :{ret(env_get(getev(),blk_getimm(b,imm)));break}
  case op.SET  :{const v=arg();env_set(getev(),blk_getimm(b,imm),v),ret(v);break}
  case op.LOC  :{const v=arg();env_local(getev(),blk_getimm(b,imm),v),ret(v);break}
  case op.BUND :{const r=[];for(let z=0;z<imm;z++)r.push(arg());r.reverse(),ret(lml(r));break}
  case op.OP1  :{                      ret(monadi[imm](arg()    ));break}
  case op.OP2  :{const         y=arg();ret(dyadi [imm](arg(),y  ));break}
  case op.OP3  :{const z=arg(),y=arg();ret(triadi[imm](arg(),y,z));break}
  case op.IPRE :{const s=arg(),i=arg();ret(i),docall(s,i.v[imm]);if(lion(s)||lii(s)||linat(s)){for(let z=0;z<=imm;z++)i.v[z]=null}break}
  case op.IPOST:{const s=arg(),i=arg(),r=arg();ret(i.v[imm]?r:s),ret(i),ret(s);break}
  case op.AMEND:{
   let v=arg(),r=arg(),i=ll(arg()),ro=arg(),n=blk_getimm(b,imm),t={v:1}
   if(i.length&&!i[0]){i=i.filter(x=>x),t.v=0}r=amendv(ro,i,v,0,t);if(t.v&&!lin(n))env_set(getev(),n,r);ret(r);break
  }
  case op.CALL : // fall through:
  case op.TAIL :{const a=arg(),f=arg();docall(f,a,o==op.TAIL);break}
  case op.BIND :{const f=arg(),r=lmon(f.n,f.a,f.b);r.c=getev(),env_local(getev(),lms(f.n),r),ret(r);break}
  case op.ITER :{const x=arg();ret(lil(x)?x:ld(x));ret(lid(x)?lmd():lml([]));break}
  case op.EACH :{
   const n=arg(),r=arg(),s=arg();if(count(r)==count(s)){setpc(imm),ret(r);break}
   const z=count(r), v=lml([s.v[z],lid(s)?s.k[z]:lmn(z),lmn(z)]);
   state.e.push(env_bind(getev(),n,v)),ret(s),ret(r);break
  }
  case op.NEXT :{const v=arg(),r=arg(),s=arg();state.e.pop();if(lid(r))r.k.push(s.k[r.v.length]);r.v.push(v),ret(s),ret(r),setpc(imm);break}
  case op.COL  :{
   const ex=arg(),t=arg(),n=Object.keys(t.v),v=lml(Object.values(t.v).map(lml));ret(t)
   n.push('column'),v.v.push(t),issue(env_bind(getev(),n,v),ex);break
  }
  case op.QUERY:{
   const order_dir=ln(arg()),t=arg(),ct=lmn(count(t))
   const o=dyad.take(ct,lml(ll(arg()))),b=dyad.take(ct,lml(ll(arg()))),w=dyad.take(ct,lml(ll(arg()))),r=monad.rows(t)
   const uk=r.v.reduce((x,_,z)=>{if(lb(w.v[z]))dset(x,b.v[z],b.v[z]);return x},lmd([],[]))
   const rows=uk.v.map((v,group)=>{ // sort groups, select rows
    const lex_list=(x,y,a,ix)=>{
     if(x.length<ix&&y.length<ix)return 0;const xv=x[ix]||NONE,yv=y[ix]||NONE
     return lex_less(xv,yv)?a: lex_more(xv,yv)?!a: lex_list(x,y,a,ix+1)
    }
    const lex_less=(a,b)=>lil(a)&&lil(b)? lex_list(a.v,b.v,1,0): lb(dyad['<'](a,b))
    const lex_more=(a,b)=>lil(a)&&lil(b)? lex_list(a.v,b.v,0,0): lb(dyad['>'](a,b))
    const gp=range(r.v.length).filter(x=>lb(w.v[x])&&match(v,b.v[x])).sort((a,b)=>{
     if(lex_less(o.v[a],o.v[b]))return  order_dir
     if(lex_more(o.v[a],o.v[b]))return -order_dir
     return a-b // produce a stable sort
    })
    return monad.table(lml(gp.map((v,z)=>{const t=r.v[v];dset(t,lms('gindex'),lmn(z)),dset(t,lms('group'),lmn(group));return t})))
   });if(rows.length==0&&!imm)rows.push(dyad.take(NONE,t))
   ret(t),ret(lml(rows));break
  }
 }while(running()&&getpc()>=blk_here(getblock()))descope()
}

fchar=x=>x=='I'?'i': x=='B'?'b': x=='L'?'s': x
n_writecsv=([x,y,d])=>{
 let r='', spec=y?ls(y).split(''):[];const t=lt(x), c=Object.keys(t.v).length; d=d?ls(d)[0]:','
 while(spec.length<c)spec.push('s')
 let n=0;spec.forEach((x,i)=>{if(x=='_')return;if(n)r+=d;n++;r+=Object.keys(t.v)[i]||`c${i+1}`})
 rows(t).v.forEach(row=>{
  r+='\n';let n=0, cols=Object.keys(row.v);spec.forEach((x,i)=>{
   if(x=='_')return;if(n)r+=d;n++
   const sv=dyad.format(lms('%'+fchar(x)),row.v[cols[i]]).v; r+=(/["\n]/.test(sv)||sv.indexOf(d)>=0?`"${sv.replace(/"/g,'""')}"`:sv)
  })
 });return lms(r)
}
n_readcsv=([x,y,d])=>{
 let i=0,n=0, spec=y&&lis(y)?ls(y):null, text=count(x)?ls(x):'', r=lmt({}); d=d?ls(d)[0]:','
 const nv=_=>{let r='';while(text[i]&&text[i]!='\n'&&text[i]!=d)r+=text[i++];return r}, match=x=>text[i]==x?(i++,1):0
 while(i<text.length&&text[i]!='\n'){
  while(match(' '));const v=nv();if(!spec||(n<spec.length&&spec[n]!='_'))r.v[v]=[];n++;if(match('\n'))break;while(match(' '));match(d)
 }
 while(spec&&n<spec.length){if(spec[n]!='_'){r.v['c'+n]=[]};n++}
 if(!spec)spec='s'.repeat(Object.keys(r.v).length)
 let slots=0,slot=0;spec.split('').map(z=>{if(z!='_')slots++;});slots=min(slots,Object.keys(r.v).length),n=0
 if(i>=text.length)return r;while(i<=text.length){
  while(match(' '));
  let val='';if(match('"')){while(text[i]){if(match('"')){if(match('"')){val+='"'}else{break}}else{val+=text[i++]}}}else{val=nv()}
  if(spec[n]&&spec[n]!='_'){
   const k=Object.keys(r.v)[slot], x=(val[0]||'').toLowerCase(), s=spec[n]
   let sign=1,o=0; if(val[o]=='-')sign=-1,o++;if(val[o]=='$')o++;
   r.v[k].push(dyad.parse(lms('%'+fchar(s)),lms(val))),slot++
  };n++
  if(i>=text.length||text[i]=='\n'){
   while(n<spec.length){const u=spec[n++];if(u!='_'&&slot<slots)r.v[Object.keys(r.v)[slot++]].push(u=='s'?lms(''):NONE);}
   if(text[i]=='\n'&&i==text.length-1)break;i++,n=0,slot=0
  }else{while(match(' '));match(d)}
 };return r
}
n_writexml=([x])=>{
 const esc=x=>{const e={'&':'amp',"'":'apos','"':'quot','<':'lt','>':'gt'};return ls(x).replace(/[&'"<>]/g,x=>e[x]?`&${e[x]};`:x)}
 const rec=(x,tab)=>{
  if(lil(x))return x.v.map(x=>rec(x,tab)).join(''); if(!lid(x))return esc(x)+(tab?'\n':'')
  const t=ls(dget(x,lms('tag'))||lms('')),a=ld(dget(x,lms('attr'))||lmd()),c=ll(dget(x,lms('children'))||lml([]))
  const r=`<${t}${a.k.map((k,i)=>` ${ls(k)}="${esc(a.v[i])}"`).join('')}${c.length?'':'/'}>\n`
  return c.length?`${r}${c.map(x=>(' '.repeat(tab+2))+rec(x,tab+2)).join('')}${' '.repeat(tab)}</${t}>\n`:r
 };return lms(rec(x,0))
}
n_readxml=([x])=>{
 let i=0,t=ls(x)
 const xm=x=>t[i]==x?(i++,1):0
 const xc=_=>{while(t[i]&&t[i]!='>')i++;i++}
 const xs=_=>{let w=0;while(/[ \n]/.test(t[i]))i++,w=1;return w}
 const xe=(a,b)=>t.slice(i,i+2+a.length)==`&${a};`?(i+=2+a.length,b):null
 const name=_=>{let r='';xs();while(t[i]&&!/[>/= \n]/.test(t[i]))r+=t[i++];xs();return r.toLowerCase()}
 const text=stop=>{
  let r='';while(t[i]&&!(stop==' '&&/[>/ \n]/.test(t[i]))){
   if(xs())r+=' ';if(stop==t[i])break;r+=xe('amp','&')||xe('apos',"'")||xe('quot','"')||xe('lt','<')||xe('gt','>')||xe('nbsp',' ')||t[i++]
  }if(/['"]/.test(stop)&&t[i])i++;return lms(r)
 }
 const rec=ctag=>{
  let r=[];while(t[i]){
   const w=xs();if(t.slice(i,i+9)=='<![CDATA['){i+=9;let c='';while(t[i]&&t.slice(i,i+3)!=']]>')c+=t[i++];i+=3;r.push(lms(c));continue}
   if(t[i]!='<'){if(w)i--;r.push(text('<'));continue}i++,xs()
   if(xm('!')||xm('?')){xc();continue};if(xm('/')){const n=name();xm('>');if(ctag==n)break;continue}
   const tag=lmd(),attr=lmd(),n=name();r.push(tag),dset(tag,lms('tag'),lms(n)),dset(tag,lms('attr'),attr),dset(tag,lms('children'),lml([]))
   while(t[i]&&!/[>/]/.test(t[i])){const n=lms(name());if(xm('=')){xs(),dset(attr,n,text(xm("'")?"'":xm('"')?'"':' '))}else{dset(attr,n,ONE)}}
   if(xm('/')){xc()}else{if(t[i])i++;dset(tag,lms('children'),rec(n))}
  }return lml(r)
 }
 return rec('')
}
n_random=z=>{
 const randint=x=>{let y=seed;y^=(y<<13),y^=(y>>>17),(y^=(y<<15));return mod(seed=y,x);} // xorshift32
 const randelt=x=>lin(x)?lmn(randint(ln(x))): count(x)<1?NONE: l_at(x,lmn(randint(count(x))))
 let x=z[0]||NONE;if(z.length<2)return randelt(x)
 const y=ln(z[1]);if(y>=0){const r=[];for(let z=0;z<y;z++)r.push(randelt(x));return lml(r);}
 x=lin(x)?monad.range(x).v:ll(x);const p=range(x.length),r=[]
 for(let i=x.length-1;i>0;i--){const j=randint(i+1),t=p[j];p[j]=p[i],p[i]=t}
 for(let z=0;z<abs(y);z++)r.push(x[p[z%x.length]]);return lml(r)
}
let frame_count=0,audio_playing=0
interface_system=lmi((self,i,x)=>{
 if(!i)return NONE
 if(x){
  if(lis(i)&&i.v=='seed'){seed=0|ln(x);return x}
  if(lis(i)&&i.v=='fullscreen')return set_fullscreen(lb(x)),x
 }
 if(lis(i)&&i.v=='version'   )return lms(VERSION)
 if(lis(i)&&i.v=='platform'  )return lms('web')
 if(lis(i)&&i.v=='seed'      )return lmn(seed)
 if(lis(i)&&i.v=='fullscreen')return lmn(is_fullscreen())
 if(lis(i)&&i.v=='playing'   )return lmn(audio_playing)
 if(lis(i)&&i.v=='frame'     )return lmn(frame_count)
 if(lis(i)&&i.v=='now'       )return lmn(0|(new Date().getTime()/1000))
 if(lis(i)&&i.v=='ms'        )return lmn(0|(Date.now()))
 if(lis(i)&&i.v=='workspace' )return lmd(['allocs','depth'].map(lms),[allocs,calldepth].map(lmn))
 return x?x:NONE
},'system')
showt=(x,toplevel)=>{
 if(!toplevel)return `<TABLE...${Object.keys(x.v).length}>`;try{
 const w=Object.keys(x.v).map(k=>x.v[k].reduce((x,y)=>max(x,show(y).length+2),k.length+2))
 const s='+'+Object.keys(x.v).map((x,i)=>"-".repeat(w[i])).join('+')+'+'
 const v=(Object.values(x.v)[0]||[]).map((_,r)=>Object.keys(x.v).map(k=>' '+show(x.v[k][r])).map((f,i)=>f+(' '.repeat(max(0,w[i]-f.length)))))
          .map(x=>`|${x.join('|')}|`).join('\n')
 return `${s}\n|${Object.keys(x.v).map((x,i)=>` ${x+(' '.repeat(w[i]-x.length-2))} `).join('|')}|\n${s}${v.length?'\n'+v+'\n'+s:''}`
 }catch(err){console.log('cannot serialize',x);throw err}
}
show=(x,toplevel)=>linat(x)?'on native x do ... end':
  lil(x)?`(${x.v.map(x=>show(x)).join(',')})`: lit(x)?showt(x,toplevel): lion(x)?`on ${x.n}${x.a.map(x=>' '+x).join('')} do ... end`:
  lis(x)?`"${x.v.split('').map(x=>({'\n':'\\n','\\':'\\\\','"':'\\"'})[x]||x).join('')}"`:
  lin(x)?fjson(x):lid(x)?`{${x.k.map((k,i)=>`${show(k)}:${show(x.v[i])}`).join(',')}}`:
  lii(x)?`<${x.n}>`:`<INVALID ${x}>`

// dom + utilities

FORMAT_VERSION=1, RTEXT_END=2147483647, SFX_RATE=8000, FRAME_QUOTA=MODULE_QUOTA=10*4096, TRANS_QUOTA=2*4096, LOOP_QUOTA=1*4096, ANTS=255
sleep_frames=0, sleep_play=0, pending_popstate=0
DEFAULT_HANDLERS=`
on link x do go[x] end
on drag x do if !me.locked|me.draggable me.line[(pointer.prev-me.pos)/me.scale x] end end
on order x do if !me.locked me.value:select orderby me.value[x] asc from me.value end end
on navigate x do if x~"right" go["Next"] end if x~"left" go["Prev"] end end
on loop x do x end
`
DEFAULT_TRANSITIONS=`
transition[on SlideRight c a b t do  c.paste[a c.size*t,0   ] c.paste[b c.size*(t-1),0]      end]
transition[on SlideLeft  c a b t do  c.paste[a c.size*(-t),0] c.paste[b c.size*(1-t),0]      end]
transition[on SlideDown  c a b t do  c.paste[a c.size*0,t   ] c.paste[b c.size*0,t-1  ]      end]
transition[on SlideUp    c a b t do  c.paste[a c.size*0,-t  ] c.paste[b c.size*0,1-t  ]      end]
transition[on WipeRight  c a b t do  c.rect[0,0        c.size*t,1    ]          c.merge[a b] end]
transition[on WipeLeft   c a b t do  c.rect[0,0        c.size*(1-t),1]          c.merge[b a] end]
transition[on WipeDown   c a b t do  c.rect[0,0        c.size*1,t    ]          c.merge[a b] end]
transition[on WipeUp     c a b t do  c.rect[0,0        c.size*1,1-t  ]          c.merge[b a] end]
transition[on BoxIn      c a b t do  c.rect[c.size/2   c.size*t   "center"]     c.merge[a b] end]
transition[on BoxOut     c a b t do  c.rect[c.size/2   c.size*1-t "center"]     c.merge[b a] end]
`
FONTS={
 menu:'%%FNT0EA0BAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAwADAAMAAwADAAMAAAADAAMAAAAAAAAAAAwAAoACgAKA'+
 'AAAAAAAAAAAAAAAAAAAAAAAAACBIAEgB/ACQAJAD+AEgASAAAAAAAAAAAAAAABSAAcACoAOAA4ABwADgAOACoAHAAIAAA'+
 'AAAACW4AkgCUAGQACAAIABMAFIAkgCMAAAAAAAAACAAAeADMAM0AYQDOAMwAzADMAHgAAAAAAAAAAQAAgACAAIAAAAAAA'+
 'AAAAAAAAAAAAAAAAAAAAyAAQADAAMAAwADAAMAAwADAAEAAIAAAAAAAA4AAQABgAGAAYABgAGAAYABgAEAAgAAAAAAABQ'+
 'AAIACoAHAAqAAgAAAAAAAAAAAAAAAAAAAABQAAAAAAACAAIAD4ACAAIAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAD'+
 'AAMAAQACAAAAABQAAAAAAAAAAAAD4AAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAADAAMAAAAAAAAAABQgACAAQ'+
 'ABAAIAAgAEAAQACAAIAAAAAAAAAABgAAeADMAMwAzADMAMwAzADMAHgAAAAAAAAABgAAMABwADAAMAAwADAAMAAwADAAA'+
 'AAAAAAABgAAeACMAAwADAAYADAAYADAAPwAAAAAAAAABgAA/AAYADAAeAAMAAwADACMAHgAAAAAAAAABwAADAAcACwATA'+
 'CMAP4ADAAMAAwAAAAAAAAABgAA/ADAAMAA+AAMAAwADACMAHgAAAAAAAAABgAAOABgAMAA+ADMAMwAzADMAHgAAAAAAAA'+
 'ABgAA/AAMAAwADAAYADAAMAAwADAAAAAAAAAABgAAeADMAMwAzAB4AMwAzADMAHgAAAAAAAAABgAAeADMAMwAzADMAHwA'+
 'DAAYAHAAAAAAAAAAAgAAAAAAAMAAwAAAAAAAAADAAMAAAAAAAAAAAgAAAAAAAMAAwAAAAAAAAADAAMAAQACAAAAABQAAA'+
 'AAYADAAYADAAGAAMAAYAAAAAAAAAAAABgAAAAAAAAAA/AAAAPwAAAAAAAAAAAAAAAAABQAAAADAAGAAMAAYADAAYADAAA'+
 'AAAAAAAAAABgAAeACMAAwAGAAwADAAAAAwADAAAAAAAAAACQAAAAA+AEEAnICkgKSAmwBAAD4AAAAAAAAABgAAeADMAMw'+
 'AzAD8AMwAzADMAMwAAAAAAAAABgAA+ADMAMwAzAD4AMwAzADMAPgAAAAAAAAABgAAeADEAMAAwADAAMAAwADEAHgAAAAA'+
 'AAAABgAA+ADMAMwAzADMAMwAzADMAPgAAAAAAAAABQAA+ADAAMAAwADwAMAAwADAAPgAAAAAAAAABQAA+ADAAMAAwADwA'+
 'MAAwADAAMAAAAAAAAAABgAAeADEAMAAwADcAMwAzADMAHgAAAAAAAAABgAAzADMAMwAzAD8AMwAzADMAMwAAAAAAAAAAg'+
 'AAwADAAMAAwADAAMAAwADAAMAAAAAAAAAABgAADAAMAAwADAAMAMwAzADMAHgAAAAAAAAABwAAxgDMANgA8ADgAPAA2AD'+
 'MAMYAAAAAAAAABQAAwADAAMAAwADAAMAAwADAAPgAAAAAAAAACgAAgEDAwOHA88C+wJzAiMCAwIDAAAAAAAAABwAAggDC'+
 'AOIA8gC6AJ4AjgCGAIIAAAAAAAAABgAAeADMAMwAzADMAMwAzADMAHgAAAAAAAAABgAA+ADMAMwAzAD4AMAAwADAAMAAA'+
 'AAAAAAABgAAeADMAMwAzADMAMwAzADMAHgADAAAAAAABgAA+ADMAMwAzAD4AMwAzADMAMwAAAAAAAAABQAAcADIAMAA4A'+
 'BwADgAGACYAHAAAAAAAAAABgAA/AAwADAAMAAwADAAMAAwADAAAAAAAAAABgAAzADMAMwAzADMAMwAzADMAHgAAAAAAAA'+
 'ABgAAzADMAMwAzADMAMwAzADIAPAAAAAAAAAACgAAzMDMwMzAzMDMwMzAzMDMgP8AAAAAAAAABgAAzADMAMwAzAB4AMwA'+
 'zADMAMwAAAAAAAAABgAAzADMAMwAzAB4ADAAMAAwADAAAAAAAAAABgAA/AAMAAwAGAAwAGAAwADAAPwAAAAAAAAAA+AAw'+
 'ADAAMAAwADAAMAAwADAAMAA4AAAAAAABYAAgABAAEAAIAAgABAAEAAIAAgAAAAAAAAAA+AAYABgAGAAYABgAGAAYABgAG'+
 'AA4AAAAAAABQAAIABQAIgAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAP8AAAAAAAAAA4AAQAAgAAA'+
 'AAAAAAAAAAAAAAAAAAAAAAAAABgAAAAAAAHgAjAB8AMwAzADMAHwAAAAAAAAABgAAwADAAPgAzADMAMwAzADMAPgAAAAA'+
 'AAAABQAAAAAAAHAAyADAAMAAwADIAHAAAAAAAAAABgAADAAMAHwAzADMAMwAzADMAHwAAAAAAAAABgAAAAAAAHgAzADMA'+
 'PwAwADEAHgAAAAAAAAABQAAOABgAPAAYABgAGAAYABgAGAAAAAAAAAABgAAAAAAAHwAzADMAMwAzADMAHwADACMAHgABg'+
 'AAwADAAPgAzADMAMwAzADMAMwAAAAAAAAAAgAAwAAAAMAAwADAAMAAwADAAMAAAAAAAAAABQAAGAAAABgAGAAYABgAGAA'+
 'YABgAGACYAHAABgAAwADAAMwA2ADwAOAA8ADYAMwAAAAAAAAAAgAAwADAAMAAwADAAMAAwADAAMAAAAAAAAAACgAAAAAA'+
 'AP+AzMDMwMzAzMDMwMzAAAAAAAAABgAAAAAAAPgAzADMAMwAzADMAMwAAAAAAAAABgAAAAAAAHgAzADMAMwAzADMAHgAA'+
 'AAAAAAABgAAAAAAAPgAzADMAMwAzADMAPgAwADAAAAABgAAAAAAAHwAzADMAMwAzADMAHwADAAMAAAABQAAAAAAANgA4A'+
 'DAAMAAwADAAMAAAAAAAAAABQAAAAAAAHAAyADgAHAAOACYAHAAAAAAAAAABAAAYABgAPAAYABgAGAAYABgADAAAAAAAAA'+
 'ABgAAAAAAAMwAzADMAMwAzADMAHwAAAAAAAAABgAAAAAAAMwAzADMAMwAzADIAPAAAAAAAAAACgAAAAAAAMzAzMDMwMzA'+
 'zMDMgP8AAAAAAAAABgAAAAAAAMwAzADMAHgAzADMAMwAAAAAAAAABgAAAAAAAMwAzADMAMwAzADMAHwADACMAHgABgAAA'+
 'AAAAPwADAAYADAAYADAAPwAAAAAAAAAAyAAQABAAEAAQACAAEAAQABAAEAAIAAAAAAAAYAAgACAAIAAgACAAIAAgACAAI'+
 'AAgAAAAAAAA4AAQABAAEAAQAAgAEAAQABAAEAAgAAAAAAABgAAAAAAAGQAmAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAA'+
 'AAAAAAAAAAADbANsAAAAAAAAA',
 body:'%%FNT0CAoBAQAAAAAAAAAAAAABAICAgICAAIAAAAMAoKAAAAAAAAAABQAAUPhQ+FAAAAAFIHCooHAoqHAgAAgAf5KUbhk'+
 'pRgAABzBIUCBUiJRiAAABAICAAAAAAAAAAAMgQICAgICAQCAAA4BAICAgICBAgAAFAFAg+CBQAAAAAAUAACAg+CAgAAAA'+
 'AgAAAAAAAABAQIAEAAAAAPAAAAAAAAEAAAAAAAAAgAAABBAQICBAQICAAAAFAHCIiIiIiHAAAAUAIGAgICAgIAAABQBwi'+
 'AgQIED4AAAFAPgQIHAIiHAAAAUAEDBQkPgQEAAABQD4gPAICIhwAAAFADBAgPCIiHAAAAUA+AgQECAgIAAABQBwiIhwiI'+
 'hwAAAFAHCIiHgIEGAAAAMAAABAAAAAQAAABAAAACAAAAAgIEAEAAAQIEAgEAAAAAUAAAD4APgAAAAABAAAQCAQIEAAAAA'+
 'FADBICBAgACAAAAcAOESaqqqcQDgABQAgIFBQ+IiIAAAFAPCIiPCIiPAAAAUAcIiAgICIcAAABQDgkIiIiJDgAAAEAPCA'+
 'gOCAgPAAAAQA8ICA4ICAgAAABQBwiICYiIhwAAAFAIiIiPiIiIgAAAIAQEBAQEBAQAAABQAICAgIiIhwAAAFAIiQoMCgk'+
 'IgAAAQAgICAgICA8AAABwCCxqqSgoKCAAAFAMjIqKiYmIgAAAUAcIiIiIiIcAAABQDwiIjwgICAAAAFAHCIiIiIqHAQAA'+
 'UA8IiI8KCQiAAABQBwiIBwCIhwAAAFAPggICAgICAAAAUAiIiIiIiIcAAABQCIiIhQUCAgAAAHAIKCVFQoKCgAAAUAiIh'+
 'QIFCIiAAABQCIiFAgICAgAAAEAPAQIECAgPAAAANgQEBAQEBAQGAABICAQEAgIBAQAAADYCAgICAgICBgAAMAQKAAAAAA'+
 'AAAABgAAAAAAAAD8AAACAIBAAAAAAAAAAAQAAABgEHCQcAAABACAgOCQkJDgAAAEAAAAYJCAkGAAAAQAEBBwkJCQcAAAB'+
 'AAAAGCQ8IBgAAAEADBA4EBAQEAAAAQAAABwkJCQcBBgBACAgOCQkJCQAAACAEAAwEBAQEAAAAMAIABgICAgICDABACAgJ'+
 'CgwKCQAAACAMBAQEBAQEAAAAcAAADskpKSkgAABAAAAOCQkJCQAAAEAAAAYJCQkGAAAAQAAADgkJCQ4ICABAAAAHCQkJB'+
 'wEBAEAAAAsMCAgIAAAAQAAABwgGAQ4AAAAwBAQOBAQEAgAAAEAAAAkJCQkHAAAAUAAACIUFAgIAAABwAAAIJUVCgoAAAF'+
 'AAAAiFAgUIgAAAQAAACQkJCQcBBgBAAAAPAgQIDwAAADIEBAQIBAQEAgAAGAgICAgICAgIAAA4BAQEAgQEBAgAAFAGiwA'+
 'AAAAAAAAAUAAAAAAAAAqAAA',
 mono:'%%FNT0CAsBBQAAAAAAAAAAAAAABQAAICAgICAAIAAABQAAUFBQAAAAAAAABQAAUPhQ+FAAAAAABQAgcKigcCiocCAABQA'+
 'ASKhQIFCokAAABQAAYJCgQKiQaAAABQAgICAAAAAAAAAABQAQICBAQEAgIBAABQAgEBAICAgQECAABQAAIKhwqCAAAAAA'+
 'BQAAACAg+CAgAAAABQAAAAAAAABgYCBABQAAAAAA+AAAAAAABQAAAAAAAAAwMAAABQgIEBAgIEBAgIAABQAAcIiYqMiIc'+
 'AAABQAAIGAgICAgIAAABQAAcIgIECBA+AAABQAAcIgIMAiIcAAABQAAEDBQkPgQEAAABQAA+IDwCAiIcAAABQAAcIDwiI'+
 'iIcAAABQAA+AgIECAgIAAABQAAcIiIcIiIcAAABQAAcIiIiHgIcAAABQAAADAwAAAwMAAABQAAAGBgAABgYCBABQAACBA'+
 'gQCAQCAAABQAAAAD4APgAAAAABQAAQCAQCBAgQAAABQAAcIgIECAAIAAABQBwiIio6LCAiHAABQAAcIiI+IiIiAAABQAA'+
 '8IiI8IiI8AAABQAAcIiAgICIcAAABQAA8IiIiIiI8AAABQAA+ICA8ICA+AAABQAA+ICA8ICAgAAABQAAcIiAmIiIcAAAB'+
 'QAAiIiI+IiIiAAABQAAICAgICAgIAAABQAACAgICIiIcAAABQAAiJCgwKCQiAAABQAAgICAgICA+AAABQAAiNioiIiIiA'+
 'AABQAAiMiomIiIiAAABQAAcIiIiIiIcAAABQAA8IiI8ICAgAAABQAAcIiIiIiIcAgABQAA8IiI8IiIiAAABQAAcIiAcAi'+
 'IcAAABQAA+CAgICAgIAAABQAAiIiIiIiIcAAABQAAiIiIUFAgIAAABQAAiIiIiKjYiAAABQAAiFAgICBQiAAABQAAiIiI'+
 'UCAgIAAABQAA+AgQIECA+AAABQAwICAgICAgIDAABYCAQEAgIBAQCAgABQAwEBAQEBAQEDAABQAgUIgAAAAAAAAABQAAA'+
 'AAAAAAA+AAABQBAIBAAAAAAAAAABQAAAAB4iIiYaAAABQAAgIDwiIiI8AAABQAAAABwiICAeAAABQAACAh4iIiIeAAABQ'+
 'AAAABwiPiAeAAABQAAGCBwICAgIAAABQAAAAB4iIiIeAhwBQAAgIDwiIiIiAAABQAAIAAgICAgIAAABQAAIAAgICAgICD'+
 'ABQAAgICQoOCQiAAABQAAICAgICAgMAAABQAAAADwqKioqAAABQAAAACwyIiIiAAABQAAAABwiIiIcAAABQAAAADwiIiI'+
 '8ICABQAAAAB4iIiIeAgIBQAAAACwyICAgAAABQAAAAB4gHAI8AAABQAAICB4ICAgGAAABQAAAACIiIiYaAAABQAAAACIi'+
 'FBQIAAABQAAAACoqKioUAAABQAAAACIUCBQiAAABQAAAACIiIiIeAhwBQAAAAD4ECBA+AAABQAYICAgwCAgIBgABSAgIC'+
 'AgICAgICAgBQDAICAgGCAgIMAABQAAaLAAAAAAAAAABQAAAAAAAAAAqAAA'
}
COLORS=[
 0xFFFFFFFF,0xFFFFFF00,0xFFFF6500,0xFFDC0000,0xFFFF0097,0xFF360097,0xFF0000CA,0xFF0097FF,
 0xFF00A800,0xFF006500,0xFF653600,0xFF976536,0xFFB9B9B9,0xFF868686,0xFF454545,0xFF000000,
]
BRUSHES=[
 0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00, 0x00,0x00,0x10,0x38,0x10,0x00,0x00,0x00,
 0x00,0x00,0x18,0x3C,0x3C,0x18,0x00,0x00, 0x00,0x38,0x7C,0x7C,0x7C,0x38,0x00,0x00,
 0x38,0x7C,0xFE,0xFE,0xFE,0x7C,0x38,0x00, 0x10,0x00,0x41,0x08,0x80,0x11,0x00,0x22,
 0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00, 0x00,0x00,0x38,0x38,0x38,0x00,0x00,0x00,
 0x00,0x00,0x3C,0x3C,0x3C,0x3C,0x00,0x00, 0x00,0x7C,0x7C,0x7C,0x7C,0x7C,0x00,0x00,
 0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0xFE,0x00, 0x20,0x0A,0x80,0x24,0x01,0x48,0x02,0x51,
 0x00,0x00,0x10,0x10,0x10,0x00,0x00,0x00, 0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00,
 0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00, 0x00,0x00,0x08,0x10,0x20,0x00,0x00,0x00,
 0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x00, 0x02,0x00,0x08,0x00,0x20,0x00,0x80,0x00,
 0x00,0x00,0x00,0x38,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0xFE,0x00,0x00,0x00,0x00,
 0x00,0x00,0x00,0xAA,0x00,0x00,0x00,0x00, 0x00,0x00,0x20,0x10,0x08,0x00,0x00,0x00,
 0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x00, 0x80,0x00,0x20,0x00,0x08,0x00,0x02,0x00,
]
ALIGN={left:0,center:1,right:2}
DEFAULT_ANIMS='[[13,9,5,1,5,9],[4,4,8,14,14,8],[18,18,20,19,19,20],[0,0,0,0,1,1,1,1]]'
DEFAULT_PATTERNS=
 '%%IMG0AAgA4AAAAAAAAAAA//////////+AgID/CAgI/yBAgMEiHAgQgAAIAIAACAD/d//d/3f/3XEiF49HInT4iFAgAgW'+
 'IiIiIACIAiAAiAHfdd9133XfdQIAACAQCACABAQOESDAMAogiiCKIIogiqlWqVapVqlWABEAIASACEMAMjbEwAxvYqgCq'+
 'AKoAqgD/Vf9V/1X/Vf8A/wD/AP8AqqqqqqqqqqpEiBEiRIgRIt27d+7du3fuQIABAgQIECC/f/79+/fv3wgAqgAIAIgAj'+
 '493mPj4d4mqAIgUIkGIALCwsL8Av7+w'

array_is   =x=>lii(x)&&x.n=='array'
image_is   =x=>lii(x)&&x.n=='image'
sound_is   =x=>lii(x)&&x.n=='sound'
font_is    =x=>lii(x)&&x.n=='font'
button_is  =x=>lii(x)&&x.n=='button'
field_is   =x=>lii(x)&&x.n=='field'
grid_is    =x=>lii(x)&&x.n=='grid'
slider_is  =x=>lii(x)&&x.n=='slider'
canvas_is  =x=>lii(x)&&x.n=='canvas'
deck_is    =x=>lii(x)&&x.n=='deck'
card_is    =x=>lii(x)&&x.n=='card'
patterns_is=x=>lii(x)&&x.n=='patterns'
module_is  =x=>lii(x)&&x.n=='module'
widget_is  =x=>lii(x)&&x.n in {button:1,field:1,grid:1,slider:1,canvas:1}
ikey  =(x,k)=>lis(x)&&x.v==k
ivalue=(x,k,d)=>k in x?x[k]:d
ifield=(x,k)  =>x.f(x,lms(k))
iindex=(x,k,v)=>x.f(x,lmn(k),v)
iwrite=(x,k,v)=>x.f(x,k,v)
init_field=(dst,key,src)=>{const k=lms(key),v=dget(src,k);if(v)iwrite(dst,k,v)}
normalize_enum=(x,v)=>v in x?v:Object.keys(x)[0]
normalize_font=(x,v)=>ls(dkey(x,v)||x.k[dkix(x,v)]||lms('body'))
data_enc=x=>x[5]==undefined?-1:+x[5]
data_read=(type,x)=>(x.slice(0,2)!='%%'||x.slice(2,5)!=type)?null:new Uint8Array(atob(x.slice(6)).split('').map(x=>x.charCodeAt(0)))
data_write=(type,x)=>`%%${type}${btoa(Array.from(x).map(x=>String.fromCharCode(x)).join(''))}`
is_rooted=x=>card_is(x)?!x.dead: widget_is(x)?(is_rooted(x.card)&&!x.dead): 1

ceil=Math.ceil, clamp=(a,x,b)=>x<a?a:x>b?b:x, sign=x=>x>0?1:-1
last=x=>x[x.length-1]
rect=(x,y,w,h)=>({x:x||0,y:y||0,w:w||0,h:h||0})
rpair=(a,b)=>rect(a.x,a.y,b.x,b.y)
rcopy=r=>rect(r.x,r.y,r.w,r.h)
rint=r=>rect(0|r.x,0|r.y,0|r.w,0|r.h)
radd=(a,b)=>rect(a.x+b.x,a.y+b.y,a.w+b.w,a.h+b.h)
rsub=(a,b)=>rect(a.x-b.x,a.y-b.y,a.w-b.w,a.h-b.h)
rmul=(a,n)=>rect(a.x*n,a.y*n,a.w*n,a.h*n)
inset=(r,n)=>rect(r.x+n,r.y+n,r.w-2*n,r.h-2*n)
rin=(r,p)=>p.x>=r.x&&p.y>=r.y&&p.x<r.x+r.w&&p.y<r.y+r.h           // point-in-rect
ron=(a,b)=>b.x+b.w>=a.x&&b.x<=a.x+a.w&&b.y+b.h>=a.y&&b.y<=a.y+a.h // rect-overlaps-rect
requ=(a,b)=>a.x==b.x&&a.y==b.y&&a.w==b.w&&a.h==b.h
rmax=(a,b)=>rect(max(a.x,b.x),max(a.y,b.y),max(a.w,b.w),max(a.h,b.h))
rmin=(a,b)=>rect(min(a.x,b.x),min(a.y,b.y),min(a.w,b.w),min(a.h,b.h))
rclip=(a,b)=>{const c=rmax(a,b);return rect(c.x,c.y,min(a.x+a.w,b.x+b.w)-c.x,min(a.y+a.h,b.y+b.h)-c.y)}
runion=(a,b)=>{const c=rmin(a,b);return rect(c.x,c.y,max(a.x+a.w,b.x+b.w)-c.x,max(a.y+a.h,b.y+b.h)-c.y)}
rcenter=(a,b)=>rint(rect(a.x+(a.w-b.x)/2,ceil(a.y+(a.h-b.y)/2.0),b.x,b.y))
rnorm=r=>{r=rcopy(r);if(r.w<0)r.w*=-1,r.x-=r.w;if(r.h<0)r.h*=-1,r.y-=r.h;return rint(r)}
rclamp=(a,b,c)=>rmin(rmax(a,b),c)
lmpair=r=>lml([lmn(r.x),lmn(r.y)])
getpair=x=>(!x||!lil(x))?rect(): rect(x.v.length>0?ln(x.v[0]):0, x.v.length>1?ln(x.v[1]):0)
getrect=x=>!x?rect(): rect(x[0],x[1],x[2],x[3])
getimage=x=>(!x||!image_is(x))? image_make(rect()): x
ukey=(dict,name,root,original)=>{
 if(original&&match(name,original))return name
 if(name&&lis(name)&&!dget(dict,name))return name
 let i=1;while(1){let n=lms(root+(i++));if(!dget(dict,n))return n}
}
uset=(dict,name,root,x)=>(dset(dict,ukey(dict,name,root),x),x)
reorder=(dict,a,b)=>{
 b=clamp(0,b,count(dict)-1);const k=dict.k[a],v=dict.v[a]
 if(b<a){for(let z=a;z>b;z--)dict.k[z]=dict.k[z-1],dict.v[z]=dict.v[z-1]}
 else   {for(let z=a;z<b;z++)dict.k[z]=dict.k[z+1],dict.v[z]=dict.v[z+1]}
 dict.k[b]=k,dict.v[b]=v
}
anchors={top_left:0,top_center:1,top_right:2,center_left:3,center:4,center_right:5,bottom_left:6,bottom_center:7,bottom_right:8}
anchor=(r,a)=>{
 if(a==undefined)return rint(r);a=anchors[ls(a)]||0
 if(a==1||a==4||a==7)r.x-=r.w/2; if(a==2||a==5||a==8)r.x-=r.w
 if(a==3||a==4||a==5)r.y-=r.h/2; if(a==6||a==7||a==8)r.y-=r.h
 return rint(r)
}
unpack_rect=(z,size)=>{
 let s=size||frame.image.size, v=rect(0,0,s.x,s.y)
 if(z.length>=1){const a=rint(getpair(z[0])),b=rint(getpair(z[1]));if(b.x<0)a.x+=1+b.x,b.x*=-1;if(b.y<0)a.y+=1+b.y,b.y*=-1;v=rpair(a,b)}
 return anchor(v,z[2])
}
unpack_poly=z=>{
 const r=[];z.map(x=>{if(lil(x)&&x.v.every(x=>!lin(x))){ll(x).map(x=>r.push(getpair(x)))}else{r.push(getpair(x))}})
 if(r.length==1)r.push(r[0]);return r
}
readcolor=(cr,cg,cb,grayscale)=>{
 if(grayscale){
  // perceptually weighted gray: http://entropymine.com/imageworsener/grayscale/
  const rf=0.2126*Math.pow(cr,2.2), gf=0.7152*Math.pow(cg,2.2), bf=0.0722*Math.pow(cb,2.2), gg=Math.pow(rf+gf+bf,1/2.2)
  return clamp(0,0|gg,255)
 }
 let ci=0,cd=1e20;for(let c=0;c<16;c++){
  const dr=abs(((COLORS[c]>>16)&0xFF)/256.0-cr/256.0),
     dg=abs(((COLORS[c]>> 8)&0xFF)/256.0-cg/256.0),
     db=abs(((COLORS[c]    )&0xFF)/256.0-cb/256.0),
     diff=(dr*dr)+(dg*dg)+(db*db)
  if(diff<cd)ci=c,cd=diff
 }if(ci==15)return 1;return ci+32
}

let frame=null
inclip=p=>rin(frame.clip,p)
gpix=p=>frame.image.pix[p.x+p.y*frame.image.size.x]
pix=(p,v)=>frame.image.pix[p.x+p.y*frame.image.size.x]=v
pal_pat=(pal,p,x,y)=>pal[(x%8)+(8*(y%8))+(8*8*p)]
draw_pattern=(pal,pix,pos)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal_pat(pal,pix,pos.x,pos.y)&1
draw_hline=(x0,x1,y,pattern)=>{
 if(y<frame.clip.y||y>=frame.clip.y+frame.clip.h)return
 x0=max(frame.clip.x,x0),x1=min(frame.clip.x+frame.clip.w,x1);for(let z=x0;z<x1;z++)pix(rect(z,y),pattern)
}
draw_vline=(x,y0,y1,pattern)=>{
 if(x<frame.clip.x||x>=frame.clip.x+frame.clip.w)return
 y0=max(frame.clip.y,y0),y1=min(frame.clip.y+frame.clip.h,y1);for(let z=y0;z<y1;z++)pix(rect(x,z),pattern)
}
draw_rect=(r,pattern)=>{r=rclip(r,frame.clip);for(let a=r.y;a<r.y+r.h;a++)for(let b=r.x;b<r.x+r.w;b++)pix(rect(b,a),pattern)}
draw_invert_raw=(pal,r)=>{r=rclip(r,frame.clip);for(let a=r.y;a<r.y+r.h;a++)for(let b=r.x;b<r.x+r.w;b++){const h=rect(b,a);pix(h,1^draw_pattern(pal,gpix(h),h))}}
draw_icon=(p,i,pattern)=>{const s=i.size;for(let a=0;a<s.y;a++)for(let b=0;b<s.x;b++){const h=rect(p.x+b,p.y+a);if(i.pix[b+(a*s.x)]&&inclip(h))pix(h,pattern)}}
draw_line=(r,brush,pattern)=>{
 r=rint(r);const bsh=(z,x,y)=>(BRUSHES[(z*8)+y]>>(7-x))&1
 let dx=abs(r.w-r.x), dy=-abs(r.h-r.y), err=dx+dy, sx=r.x<r.w ?1:-1, sy=r.y<r.h?1:-1;while(1){
  if(brush==0){if(inclip(r))pix(r,pattern)}
  else{for(let b=0;b<8;b++)for(let a=0;a<8;a++){const h=rect(r.x+a-3,r.y+b-3);if(bsh(brush,a,b)&&inclip(h))pix(h,pattern)}}
  if(r.x==r.w&&r.y==r.h)break;let e2=err*2; if(e2>=dy)err+=dy,r.x+=sx; if(e2<=dx)err+=dx,r.y+=sy
 }
}
draw_box=(r,brush,pattern)=>{
 const size=frame.image.size
 if(r.w==0||r.h==0||!ron(r,rect(0,0,size.x,size.y)))return
 if(r.y         >=0)draw_line(rect(r.x      ,r.y      ,r.x+r.w-1,r.y      ),brush,pattern)
 if(r.y+r.h<=size.y)draw_line(rect(r.x      ,r.y+r.h-1,r.x+r.w-1,r.y+r.h-1),brush,pattern)
 if(r.x         >=0)draw_line(rect(r.x      ,r.y      ,r.x      ,r.y+r.h-1),brush,pattern)
 if(r.x+r.w<=size.x)draw_line(rect(r.x+r.w-1,r.y      ,r.x+r.w-1,r.y+r.h-1),brush,pattern)
}
draw_lines=(poly,brush,pattern)=>{for(let z=0;z<poly.length-1;z++)draw_line(rpair(poly[z],poly[z+1]),brush,pattern)}
poly_bounds=poly=>{
 const d=rect(frame.clip.x+frame.clip.w,frame.clip.y+frame.clip.h,frame.clip.x,frame.clip.y)
 for(let z=0;z<poly.length;z++){const p=poly[z];d.x=min(d.x,p.x),d.y=min(d.y,p.y),d.w=max(d.w,p.x),d.h=max(d.h,p.y)}
 d.w-=d.x,d.h-=d.y,d.w++,d.h++;return d
}
poly_in=(poly,pos)=>{
 let r=0;for(let i=0,j=poly.length-1;i<poly.length;i++){
  if(pos.x==poly[i].x&&pos.y==poly[i].y)return 1
  if(((poly[i].y>=pos.y)!=(poly[j].y>=pos.y))&&(pos.x<=(poly[j].x-poly[i].x)*(pos.y-poly[i].y)/(poly[j].y-poly[i].y)+poly[i].x))r^=1
  j=i
 }return r
}
draw_poly=(poly,pattern)=>{
 const r=rint(rclip(frame.clip,poly_bounds(poly)))
 for(let a=0;a<=r.h;a++)for(let b=0;b<=r.w;b++){const h=rect(b+r.x,a+r.y);if(poly_in(poly,h))pix(h,pattern)}
}
draw_fill=(r,pattern,ref)=>{
 if(!inclip(r))return
 const src=ref||frame.image, visited=new Uint8Array(src.size.x*src.size.y)
 const spix=p=>src.pix[p.x+p.y*src.size.x], source=spix(r), fringe=[r]
 const OFFSETS=[rect(-1,0),rect(0,-1),rect(1,0),rect(0,1)], stride=frame.image.size.x
 while(fringe.length){
  const here=fringe.pop();if(gpix(here)==pattern)continue;pix(here,pattern)
  for(let z=0;z<4;z++){
   const there=radd(here,OFFSETS[z]),ti=there.x+there.y*stride
   if(inclip(there)&&!visited[ti]&&spix(there)==source)fringe.push(there),visited[ti]=1
  }
 }
}
draw_char=(pos,font,c,pattern)=>{
 const iw=font_w(font),ih=font_h(font);
 for(let a=0;a<ih;a++)for(let b=0;b<iw;b++)if(font_gpix(font,c,b,a)){
  const h=rect(pos.x+b,pos.y+a);if(inclip(h))pix(h,pattern)
 }
}
draw_text=(pos,text,font,pattern)=>{
 const cursor=rect(pos.x,pos.y);for(let z=0;z<text.length;z++){
  const c=text[z];
  if(c!='\n'){draw_char(cursor,font,c,pattern),cursor.x+=font_gw(font,c)+font_sw(font)}
  else{cursor.x=pos.x,cursor.y+=font_h(font)}
 }
}
layout_plaintext=(text,font,align,mx)=>{
 let layout=[],lines=[],cursor=rect(0,0), lnl=_=>(cursor.x=0,cursor.y+=1), ws=x=>x=='\n'||x==' '
 const fh=font_h(font),fs=font_sw(font)
 for(let z=0;z<text.length;z++){
  let a=z,w=text[z]=='\n'?0:(font_gw(font,text[z])+fs)
  if(!ws(text[z]))while(text[z+1]&&!ws(text[z+1]))w+=font_gw(font,text[++z])+fs // find word
  if(cursor.x+w>=mx.x&&cursor.x>0)lnl() // word won't fit this line
  for(let i=a;i<=z;i++){                 // append word to line
   const c=text[i], size=rect(c=='\n'?0:font_gw(font,c)+fs,fh)
   if(c==' '&&cursor.x==0&&layout.length>0&&!ws(last(layout).char))size.x=0 // squish lead space after a soft-wrap
   if(cursor.x+size.x>=mx.x)lnl() // hard-break overlong words
   layout.push({pos:rpair(cursor,size),line:cursor.y,char:c,font,arg:NONE})
   if(c=='\n'){lnl()}else{cursor.x+=size.x}
   if(cursor.y>=(mx.y/fh)){
    layout=layout.slice(0,max(1,layout.length-3))
    layout[layout.length-1].c=ELLIPSIS,layout[layout.length-1].pos.w=font_gw(font,ELLIPSIS)+fs
    z=text.length-1;break
   }
  }
 }
 let y=0;for(let i=0,line=0;i<layout.length;i++,line++){
  let a=i;while(i<(layout.length-1)&&(layout[i+1].pos.y==line))i++          // find bounds of line
  let h=0;for(let z=a;z<=i;z++)h=max(h,layout[z].pos.h)                     // find height of line
  let w=(a&&a==i)?0:(layout[i].pos.x+layout[i].pos.w)                       // find width of line
  let x=align==ALIGN.center?0|((mx.x-w)/2): align==ALIGN.right?(mx.x-w): 0  // justify
  lines.push({pos:rect(x,y,w,h),range:rect(a,i)})
  for(let z=a;z<=i;z++){const g=layout[z].pos;g.y=y+0|((h-g.h)/2);g.x+=x;}if(i<layout.length-1)y+=h
 }return {size:rect(mx.x,y+fh),layout,lines}
}
layout_richtext=(deck,table,font,align,width)=>{
 const layout=[],lines=[],cursor=rect(0,0), lnl=_=>(cursor.x=0,cursor.y+=1), ws=x=>x=='\n'||x==' '
 const texts=table.v.text, fonts=table.v.font, args=table.v.arg
 for(let chunk=0;chunk<texts.length;chunk++){
  const f=dget(deck.fonts,fonts[chunk])||font, fh=font_h(f), fs=font_sw(f)
  if(image_is(args[chunk])){
   const size=args[chunk].size;if(cursor.x+size.x>=width&&cursor.x>0)lnl()
   layout.push({pos:rpair(cursor,size),line:cursor.y,char:'i',font:f,arg:args[chunk]})
   cursor.x+=size.x;continue
  }
  const t=ls(texts[chunk]);for(let z=0;z<t.length;z++){
   let a=z, w=t[z]=='\n'?0:(font_gw(f,t[z])+fs)
   if(!ws(t[z]))while(z+1<t.length&&!ws(t[z+1]))w+=font_gw(f,t[++z])+fs
   if(cursor.x+w>=width&&cursor.x>0)lnl()
   for(let i=a;i<=z;i++){
    const c=t[i], size=rect(c=='\n'?0:font_gw(f,c)+fs,fh)
    if(c==' '&&cursor.x==0&&layout.length>0&&!ws(last(layout).char))size.x=0
    if(cursor.x+size.x>=width)lnl()
    layout.push({pos:rpair(cursor,size),line:cursor.y,char:c,font:f,arg:args[chunk]})
    if(c=='\n'){lnl()}else{cursor.x+=size.x}
   }
  }
 }
 let y=0;for(let i=0,line=0;i<layout.length;i++,line++){
  let a=i;while(i<(layout.length-1)&&(layout[i+1].pos.y==line))i++            // find bounds of line
  let h=0;for(let z=a;z<=i;z++)h=max(h,layout[z].pos.h)                       // find height of line
  let w=(a&&a==i)?0:(layout[i].pos.x+layout[i].pos.w)                         // find width of line
  let x=align==ALIGN.center?0|((width-w)/2): align==ALIGN.right?(width-w): 0  // justify
  lines.push({pos:rect(x,y,w,h),range:rect(a,i)})
  for(let z=a;z<=i;z++){const g=layout[z].pos;g.y=y+0|((h-g.h)/2);g.x+=x;}y+=h
 }return {size:rect(width,y),layout,lines}
}
draw_text_wrap=(r,l,pattern)=>{
 r=rint(r);const oc=frame.clip;frame.clip=r;for(let z=0;z<l.layout.length;z++){
  const g=l.layout[z];if(g.pos.w<1)continue
  draw_char(radd(g.pos,r),g.font,g.char,pattern)
 }frame.clip=oc;
}
draw_text_rich=(r,l,pattern,opaque)=>{
 const oc=frame.clip;frame.clip=r;for(let z=0;z<l.layout.length;z++){
  const g=l.layout[z];if(g.pos.w<1)continue
  if(g.pos.y+g.pos.h<0||g.pos.y>r.h)continue; g.pos.x+=r.x, g.pos.y+=r.y
  if(lis(g.arg)&&count(g.arg))draw_hline(g.pos.x,g.pos.x+g.pos.w,g.pos.y+g.pos.h-1,19)
  if(image_is(g.arg)){image_paste(g.pos,frame.clip,g.arg,frame.image,opaque)}
  else{draw_char(g.pos,g.font,g.char,pattern)}
 }frame.clip=oc
}

pointer={f:(self,i,x)=>{
 if(ikey(i,'held' ))return lmn(self.held)
 if(ikey(i,'pos'  ))return lmpair(self.pos)
 if(ikey(i,'start'))return lmpair(self.start)
 if(ikey(i,'prev' ))return lmpair(self.prev)
 if(ikey(i,'end'  ))return lmpair(self.end)
 return x?x:NONE
},t:'int',n:'pointer',held:0,pos:rect(),start:rect(),prev:rect(),end:rect()}

keystore_read=x=>{
 let store=lmd();if(x)x.k.filter((k,i)=>!match(NONE,x.v[i])).map((k,i)=>dset(store,k,x.v[i]))
 return {f:(self,i,x)=>{
  i=ls(i);if(i=='keys')return monad.range(self.data)
  if(x){
   const f=lms('%j'),val=dyad.parse(f,dyad.format(f,x))
   if(match(NONE,val)){self.data=dyad.drop(lms(i),self.data)}else{dset(self.data,lms(i),val)}
   return x
  }else{return dget(self.data,lms(i))||NONE}
 },t:'int',n:'keystore',data:store}
}

module_read=(x,deck)=>{
 const ri=lmi((self,i,x)=>{
  if(x){
   if(ikey(i,'description'))return self.description=ls(x),x
   if(ikey(i,'name')){
    if(ls(x)=='')return x
    self.name=ls(ukey(self.deck.modules,lms(ls(x)),ls(x),lms(self.name)))
    self.deck.modules.k[dvix(self.deck.modules,self)]=self.name
    return x
   }
   if(ikey(i,'script')){
    self.script=ls(x),self.error='',self.value=lmd();try{
     const prog=parse(self.script),root=lmenv();primitives(root,deck),constants(root),root.local('data',self.data)
     pushstate(root),issue(root,prog);let q=MODULE_QUOTA;while(running()&&q>0)runop(),q--
     if(running()){self.error='initialization took too long.'}
     else{self.value=ld(arg())};popstate()
    }catch(e){self.error=e.x;return x}
   }
  }else{
   if(ikey(i,'name'       ))return lms(self.name)
   if(ikey(i,'data'       ))return self.data
   if(ikey(i,'description'))return lms(self.description||'')
   if(ikey(i,'script'     ))return lms(self.script||'')
   if(ikey(i,'error'      ))return lms(self.error||'')
   if(ikey(i,'value'      ))return self.value
  }return x?x:NONE
 },'module')
 const n=dget(x,lms('name'))
 ri.deck=deck
 ri.name=ls(ukey(deck.modules,n&&lis(n)&&count(n)==0?null:n,'module'))
 ri.data=keystore_read(dget(x,lms('data')))
 ri.value=lmd()
 init_field(ri,'description',x)
 init_field(ri,'script',x)
 return ri
}
module_write=x=>{
 const r=lmd()
 dset(r,lms('name'  ),ifield(x,'name'))
 dset(r,lms('data'  ),x.data.data)
 dset(r,lms('script'),ifield(x,'script'))
 if(x.description)dset(r,lms('description'),ifield(x,'description'))
 return r
}

const casts={u8:1,i8:1,u16b:2,u16l:2,i16b:2,i16l:2,u32b:4,u32l:4,i32b:4,i32l:4,char:1}
array_write=x=>data_write('DAT'+String.fromCharCode(48+Object.keys(casts).indexOf(x.cast)),x.data.slice(x.base,x.base+x.size))
array_read=x=>{const f=x.charCodeAt(5),d=data_read('DAT',x);return d?array_make(d.length,Object.keys(casts)[clamp(0,f-48,10)],0,d):array_make(0,'u8',0)}
n_array=([x,y])=>{if(lis(x))return array_read(ls(x));const size=ln(x),cast=y?normalize_enum(casts,ls(y)):'u8';return array_make(size,cast,0)}
array_make=(size,cast,base,buffer)=>{
 const offset=x=>({offset:ln(lil(x)?monad.first(x):x),len:lil(x)?max(0,ln(monad.last(x))):-1})
 const shift=(a,here)=>({here:0, size:a.size-here, base:a.base+here, cast:a.cast, data:a.data})
 const resize=(a,size)=>{
  if(a.slice)return;size=max(0,size);const old=a.data;a.data=new Uint8Array(size)
  for(let z=0;z<a.data.length;z++)a.data[z]=z>=old.length?0:old[z];a.size=size
 }
 const get_raw=(a,index)=>{
  const step=casts[a.cast];if(index<0||index>=(0|(a.size/step)))return 0
  const ix=a.base+step*index;if(ix<0||ix+step>a.data.length)return 0
  const ur=(i,s)=>a.data[ix+i]<<s
  const s8 =x=>x<<24>>24
  const s16=x=>x<<16>>16
  const u32=(a,b,c,d)=>(2*a)+(b|c|d)
  if(a.cast=='u8'  )return     ur(0,0)
  if(a.cast=='i8'  )return  s8(ur(0,0))
  if(a.cast=='u16b')return    (ur(0,8)|ur(1,0))
  if(a.cast=='u16l')return    (ur(1,8)|ur(0,0))
  if(a.cast=='i16b')return s16(ur(0,8)|ur(1,0))
  if(a.cast=='i16l')return s16(ur(1,8)|ur(0,0))
  if(a.cast=='u32b')return u32(ur(0,23),ur(1,16),ur(2,8),ur(3,0))
  if(a.cast=='u32l')return u32(ur(3,23),ur(2,16),ur(1,8),ur(0,0))
  if(a.cast=='i32b')return    (ur(0,24)|ur(1,16)|ur(2,8)|ur(3,0))
  if(a.cast=='i32l')return    (ur(3,24)|ur(2,16)|ur(1,8)|ur(0,0))
  return String.fromCharCode(ur(0,0))
 }
 const set_raw=(a,index,v)=>{
  if('string'==typeof v)v=v.charCodeAt(0)
  const step=casts[a.cast];if(index<0||index>=(0|(a.size/step)))return
  const ix=a.base+step*index;if(ix<0||ix+step>a.data.length)return
  const uw=(i,s)=>a.data[ix+i]=v>>>s
  if     (a.cast=='u16b'||a.cast=='i16b')uw(0,8),uw(1,0)
  else if(a.cast=='u16l'||a.cast=='i16l')uw(1,8),uw(0,0)
  else if(a.cast=='u32b'||a.cast=='i32b')uw(0,24),uw(1,16),uw(2,8),uw(3,0)
  else if(a.cast=='u32l'||a.cast=='i32l')uw(3,24),uw(2,16),uw(1,8),uw(0,0)
  else uw(0,0)
 }
 const get=(a,index,len)=>{
  if(a.cast=='char'&&len<0)len=1
  if(a.cast=='char'){
   const t=a.cast;a.cast='u8';
   const r=(new TextDecoder('utf-8')).decode(new Uint8Array(range(len).map(x=>get_raw(a,index+x))))
   return a.cast=t,lms(clchars(r))
  }
  return len<0?lmn(get_raw(a,index)): lml(range(len).map(x=>lmn(get_raw(a,index+x))))
 }
 const set=(a,index,len,v)=>{
  if(len<0)len=1
  if(array_is(v)){for(let z=0;z<len;z++)set_raw(a,index+z,array_get_raw(b,z))}       // array copy
  else if(lis(v)){for(let z=0;z<len;z++)set_raw(a,index+z,z>=count(v)?0:v.v[z])}     // copy chars up to len
  else if(lil(v)){for(let z=0;z<len;z++)set_raw(a,index+z,z>=count(v)?0:ln(v.v[z]))} // copy numbers up to len
  else{const vv=ln(v);for(let z=0;z<len;z++)set_raw(a,index+z,vv)}                   // spread a number up to len
 }
 const slice=(a,z)=>{
  const o=offset(z[0]||NONE),cast=z[1]?normalize_enum(casts,ls(z[1])):a.cast, step=casts[cast];o.offset*=step
  if(o.len<0)o.len=0|((a.size-o.offset)/step);const r=array_make(o.len,cast,o.offset,a.data);r.slice=1;return r
 }
 const copy=(a,z)=>{
  const o=offset(z[0]||NONE),cast=z[1]?normalize_enum(casts,ls(z[1])):a.cast, step=casts[cast];o.offset*=step
  if(o.len<0)o.len=0|((src.size-o.offset)/step);const r=array_make(o.len,cast,0)
  for(let z=0;z<o.len;z++)set_raw(r,z,get_raw(shift(a,o.offset),z));return r
 }
 const struct_size=shape=>{
  if( lis(shape))return (casts[ls(shape)]||1)
  if( lil(shape))return (casts[ls(monad.first(shape))]||1)*max(0,ln(monad.last(shape)))
  if(!lid(shape))return 0
  let bit=0, r=0;shape.v.map(type=>{
   if(!lin(type)&&bit)bit=0,r++
   if(lin(type)){bit+=clamp(1,ln(type),31),r+=0|(bit/8),bit%=8}else{r+=struct_size(type)}
  });return r
 }
 const struct_read=(a,shape)=>{
  if(lis(shape)){a.cast=normalize_enum(casts,ls(shape));const r=get(shift(a,a.here),0,-1);a.here+=casts[a.cast];return r}
  if(lil(shape)){
   const n=max(0,ln(monad.last(shape)))
   a.cast=normalize_enum(casts,ls(monad.first(shape)));const r=get(shift(a,a.here),0,n);a.here+=n*casts[a.cast];return r
  }
  if(!lid(shape))return NONE;let bit=0,r=lmd();shape.v.map((type,i)=>{
   let v=NONE;if(!lin(type)&&bit)bit=0,a.here++
   if(lin(type)){
    let n=clamp(1,ln(type),31),t=0;a.cast='u8'
    while(n>0){t=(t<<1)|(1&(get_raw(a,a.here)>>(7-bit))),bit++,n--;if(bit==8)bit=0,a.here++}v=lmn(t)
   }else{v=struct_read(a,type)}dset(r,shape.k[i],v)
  });return r
 }
 const struct_write=(a,shape,value)=>{
  if(lis(shape)||lil(shape)){
   let n=lis(shape)?1:max(0,ln(monad.last(shape)));a.cast=normalize_enum(casts,ls(lis(shape)?shape:monad.first(shape)))
   set(shift(a,a.here),0,n,value),a.here+=n*casts[a.cast];return
  }if(!lid(shape))return
  let bit=0;shape.v.map((type,i)=>{
   let v=dget(value,shape.k[i])||NONE
   if(!lin(type)){if(bit)bit=0,a.here++;struct_write(a,type,v);return}
   let n=clamp(1,ln(type),31), t=ln(v),m=(1<<n)-1;t&=m,a.cast='u8';for(let z=0;z<n;z++){
    let pos=1<<(7-bit),dst=get_raw(a,a.here)&~pos
    set_raw(a,a.here,t&(1<<(n-1-z))?dst|pos:dst),bit++;if(bit==8)bit=0,a.here++
   }
  })
 }
 const struct=(a,z)=>{
  const oc=a.cast, shape=z[0]||NONE, value=z[1], size=struct_size(shape);if(value&&a.here+size>=a.size)resize(a,a.here+size)
  const r=value?(struct_write(a,shape,value),value):struct_read(a,shape);return a.cast=oc,r
 }
 const ri=lmi((self,i,x)=>{
  if(!lis(i)){const o=offset(i);if(x){set(self,o.offset,o.len,x);return x;}else{return get(self,o.offset,o.len);}}
  if(x){
   if(ikey(i,'size'))return resize(self,ln(x)*casts[self.cast]),x
   if(ikey(i,'cast'))return self.cast=normalize_enum(casts,ls(x)),x
   if(ikey(i,'here'))return self.here=max(0,ln(x)),x
  }else{
   if(ikey(i,'encoded'))return lms(array_write(self))
   if(ikey(i,'cast'   ))return lms(self.cast)
   if(ikey(i,'size'   ))return lmn(self.size/casts[self.cast])
   if(ikey(i,'here'   ))return lmn(self.here)
   if(ikey(i,'slice'  ))return lmnat(z=>slice (self,z))
   if(ikey(i,'copy'   ))return lmnat(z=>copy  (self,z))
   if(ikey(i,'struct' ))return lmnat(z=>struct(self,z))
  }return x?x:NONE
 },'array')
 ri.size=size*casts[cast],ri.here=0,ri.base=base,ri.cast=cast,ri.data=buffer||new Uint8Array(ri.size)
 return ri
}

image_copy=(i,r)=>{
 r=r?rint(r):rect(0,0,i.size.x,i.size.y);const c=image_make(rect(r.w,r.h)), clip=rect(0,0,i.size.x,i.size.y)
 for(let y=0;y<r.h;y++)for(let x=0;x<r.w;x++)c.pix[x+r.w*y]=rin(clip,rect(r.x+x,r.y+y))?i.pix[(r.x+x)+i.size.x*(r.y+y)]:0
 return c
}
image_paste=(r,clip,src,dst,opaque)=>{
 r=rint(r);const s=src.size,ds=dst.size
 for(let y=0;y<s.y;y++)for(let x=0;x<s.x;x++)if(rin(clip,rect(r.x+x,r.y+y))&&(opaque||src.pix[x+s.x*y]))dst.pix[r.x+x+ds.x*(r.y+y)]=src.pix[x+s.x*y]
}
image_paste_scaled=(r,clip,src,dst,opaque)=>{
 r=rint(r);if(r.w==0||r.h==0)return;const s=src.size,ds=dst.size;if(r.w==s.x&&r.h==s.y)return image_paste(r,clip,src,dst,opaque)
 for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++){
  let sx=0|((b*1.0)/r.w)*s.x, sy=0|((a*1.0)/r.h)*s.y, c=src.pix[sx+sy*s.x]
  if((opaque||c!=0)&&rin(clip,rect(r.x+b,r.y+a)))dst.pix[r.x+b+ds.x*(r.y+a)]=c
 }
}
image_dither=i=>{
 const stride=2*i.size.x, m=[0,1,i.size.x-2,i.size.x-1,i.size.x,stride-1], e=new Float32Array(stride)
 for(let ei=0,z=0;z<i.pix.length;z++){
  const pix=((0xFF&i.pix[z])/256.0)+e[ei], col=pix>.5?1:0, err=(pix-col)/8.0
  e[ei]=0, ei=(ei+1)%stride; for(let x=0;x<6;x++)e[(ei+m[x])%stride]+=err; i.pix[z]=!col
 }
}
image_flip_h=i=>{const s=i.size;for(let z=0;z<s.y;z++){let a=z*s.x,b=(z+1)*s.x-1;while(a<b){let t=i.pix[a];i.pix[a]=i.pix[b];i.pix[b]=t;a++;b--}}}
image_flip_v=i=>{const s=i.size;for(let z=0;z<s.x;z++){let a=z,b=z+s.x*(s.y-1);while(a<b){let t=i.pix[a];i.pix[a]=i.pix[b];i.pix[b]=t;a+=s.x;b-=s.x}}}
image_flip=i=>{const s=i.size,r=image_make(rect(s.y,s.x));for(let a=0;a<s.y;a++)for(let b=0;b<s.x;b++)r.pix[a+s.y*b]=i.pix[b+s.x*a];i.pix=r.pix,i.size=r.size}
image_resize=(i,size)=>{
 const os=i.size,ob=i.pix;size=rint(rmax(size,rect()));if(requ(os,size))return i
 i.pix=new Uint8Array(size.x*size.y),i.size=size;
 for(let a=0;a<size.y;a++)for(let b=0;b<size.x;b++)i.pix[b+a*size.x]=a>=os.y||b>=os.x?0: ob[b+a*os.x];return i
}
image_make=size=>{
 const f=(self,i,x)=>{
  const s=self.size
  if(i&&lil(i)){ // read/write pixels
   const p=getpair(i),ib=p.x>=0&&p.y>=0&&p.x<s.x&&p.y<s.y
   if(x){if(ib)self.pix[p.x+p.y*s.x]=ln(x);return x}
   return ib?lmn(self.pix[p.x+p.y*s.x]):NONE
  }
  if(ikey(i,'encoded'))return lms(image_write(self))
  if(ikey(i,'size'))return x?(image_resize(self,getpair(x)),x): lmpair(self.size)
  if(ikey(i,'map'))return lmnat(([x,fill])=>{
   const m=new Uint8Array(256);for(let z=0;z<256;z++)m[z]=fill?ln(fill):z;x=ld(x)
   for(let z=0;z<x.k.length;z++)m[0xFF&ln(x.k[z])]=0xFF&ln(x.v[z])
   for(let z=0;z<self.pix.length;z++)self.pix[z]=m[self.pix[z]]
   return self
  })
  if(ikey(i,'transform'))return lmnat(([x])=>{
   if(x.v=='horiz')image_flip_h(self); if(x.v=='vert')image_flip_v(self); if(x.v=='flip')image_flip(self); if(x.v=='dither')image_dither(self)
   if(x.v=='left' )image_flip_h(self),image_flip(self); if(x.v=='right')image_flip(self),image_flip_h(self)
   return self
  })
  if(ikey(i,'copy'))return lmnat(z=>image_copy(self,unpack_rect(z,self.size)))
  if(ikey(i,'paste'))return lmnat(([img,pos,t])=>{
   img=getimage(img), pos=(pos?ll(pos):[]).map(ln); let solid=t?!lb(t):1, cl=rect(0,0,self.size.x,self.size.y); if(img==self)img=image_copy(img)
   image_paste_scaled(pos.length<=2?rect(pos[0],pos[1],img.size.x,img.size.y):getrect(pos),cl,img,self,solid)
  })
  return x?x:NONE
 };return {t:'int',f:f,n:'image',size:size,pix:new Uint8Array(size.x*size.y)}
}
image_read=x=>{
 const data=data_read('IMG',x);if(!data||data.length<4)return image_make(rect())
 const f=data_enc(x), w=(data[0]<<8)|data[1], h=(data[2]<<8)|data[3], r=image_make(rect(w,h))
 if(f==0&&data.length-4>=w*h/8){let s=ceil(w/8),o=0;for(let a=0;a<h;a++)for(let b=0;b<w;b++)r.pix[o++]=data[4+(0|b/8)+a*s]&(1<<(7-(b%8)))?1:0}
 if(f==1&&data.length-4>=w*h){r.pix=data.slice(4)}
 if(f==2){let i=4,o=0;while(i+2<=data.length){let p=data[i++],c=0xFF&data[i++];while(c&&o+1<=r.pix.length)c--,r.pix[o++]=p;}}
 return r
}
image_write=x=>{
 x=image_is(x)?x:image_make(rect());let f=0,s=x.size,t=[0xFF&(s.x>>8),0xFF&s.x,0xFF&(s.y>>8),0xFF&s.y],l=t.slice(0)
 for(let z=0;z<x.pix.length;){let c=0,p=x.pix[z];while(c<255&&z<x.pix.length&&x.pix[z]==p)c++,z++;l.push(p),l.push(c)}
 if(!x.pix.some(x=>x>1)&&(l.length>4+s.x*s.y/8)){
  f='0';let stride=8*ceil(s.x/8);for(let a=0;a<s.y;a++)for(let b=0;b<stride;b+=8)
  {let v=0;for(let i=0;i<8;i++)v=(v<<1)|(b+i>=s.x?0: x.pix[b+i+a*s.x]?1:0);t.push(v)}
 }else if(l.length>4+s.x*s.y){f='1';for(let z=0;z<s.x*s.y;z++)t.push(x.pix[z])}else{f='2',t=l}
 return data_write('IMG'+f,t)
}
n_image=([size])=>lis(size)?image_read(ls(size)):image_make(getpair(size))

sound_make=data=>{
 const sign_extend=x=>(x<<24>>24)
 const ri=lmi((self,i,x)=>{
  if(i&&lin(i)){ // read/write single samples
   return x?((self.data[ln(i)]=0xFF&ln(x)),x):lmn(sign_extend(self.data[ln(i)]))
  }
  if(i&&lil(i)){ // read/write ranges
   const n=getpair(i);n.y=max(0,n.y);if(x){
    const s=ll(x),dc=self.data.length,sc=s.length, r=new Uint8Array(clamp(0,(dc-n.y)+sc,10*SFX_RATE))
    for(let z=0;z<n.x         ;z++)r[z]=self.data[z]
    for(let z=0;z<sc          ;z++)r[n.x+z   ]=0xFF&ln(s[z])
    for(let z=0;z<dc-(n.x+n.y);z++)r[n.x+sc+z]=0xFF&self.data[n.x+n.y+z]
    return self.data=r,x
   }else{return lml(range(n.y).map(x=>lmn(sign_extend(self.data[x+n.x]))))}
  }
  if(ikey(i,'encoded'))return lms(sound_write(self))
  if(ikey(i,'size')){
   if(!x)return lmn(self.data.length)
   const n=clamp(0,ln(x),10*SFX_RATE),o=self.data;self.data=new Uint8Array(n)
   for(let z=0;z<o.length&&z<n;z++)self.data[z]=o[z];return x
  }
  if(ikey(i,'duration'))return lmn(self.data.length/SFX_RATE)
  return x?x:NONE
 },'sound')
 if(data&&data.length>10*SFX_RATE)data=data.slice(0,10*SFX_RATE)
 ri.data=data||new Uint8Array(0)
 return ri
}
sound_read=x=>sound_make((typeof x=='string')?data_read('SND',x):new Uint8Array(clamp(0,+x,10*SFX_RATE)))
sound_write=x=>data_write('SND0',x.data)
n_sound=([x])=>!x?sound_read(0): lis(x)?sound_read(ls(x)): lin(x)?sound_read(ln(x)): sound_make(Uint8Array.from(ll(x).map(ln)))

patterns_read=x=>{
 const set=(pal,p,x,y,v)=>pal[(x%8)+(8*(y%8))+(8*8*p)]=v
 const ri=lmi((self,i,x)=>{
  let r=null, t=i&&ln(i)?ln(i):0
  if(x){
   if(t>= 2&&t<=27&&image_is(x)){for(let a=0;a<8;a++)for(let b=0;b<8;b++)set(self.pal.pix,t,b,a,lb(iwrite(x,lmpair(rect(b,a)))))}
   if(t>=28&&t<=31){r=ll(x);if(r.length>8)r=r.slice(0,8);self.anim[t-28]=r.map(x=>{const f=clamp(0,ln(x),47);return f>=28&&f<=31?0:f});r=lml(r)}
   if(t>=32&&t<=47){COLORS[t-32]=0xFF000000|ln(x);r=x}
  }else{
   if(t>= 0&&t<=27){r=image_copy(self.pal,rect(0,t*8,8,8))}
   if(t>=28&&t<=31){r=lml(self.anim[t-28].map(lmn))}
   if(t>=32&&t<=47){r=lmn(0xFFFFFF&COLORS[t-32])}
  }return r?r:x?x:NONE
 },'patterns')
 ri.pal=image_resize(image_read(x.patterns?ls(x.patterns):DEFAULT_PATTERNS),rect(8,8*32))
 ri.anim=JSON.parse(DEFAULT_ANIMS);if(x.animations&&lil(x.animations))ll(x.animations).map((x,i)=>iindex(ri,28+i,x))
 return ri
}
patterns_write=x=>image_write(image_resize(image_copy(x.pal),rect(8,224)))
anims_write=x=>lml(x.anim.map(x=>lml(x.map(lmn))))

font_get=(i,f,v)=>{if(v!=undefined)f.pix[i]=v;return f.pix[i]}
font_w =(f,v)=>font_get(0,f,v)
font_h =(f,v)=>font_get(1,f,v)
font_sw=(f,v)=>font_get(2,f,v)
font_gs=(f,v)=>font_h(f)*ceil(font_w(f)/8)+1
font_gb=(f,c)=>3+(c.charCodeAt(0)-32)*font_gs(f)
font_gw=(f,c,v)=>font_get(font_gb(f,c),f,v)
font_pp=(f,c,x,y,v)=>font_get(font_gb(f,c)+1+y*ceil(font_w(f)/8)+Math.floor(x/8),f,v)
font_bit=(x,v)=>(v<<(7-(x%8)))
font_gpix=(f,c,x,y)=>((font_pp(f,c,x,y)&font_bit(x,1))?1:0)
font_spix=(f,c,x,y,v)=>font_pp(f,c,x,y,(font_pp(f,c,x,y)&~font_bit(x,1))|font_bit(x,v))
font_textsize=(f,t)=>{
 const cursor=rect(),size=rect(0,font_h(f))
 for(let z=0;t[z];z++){if(t[z]!='\n'){cursor.x+=font_gw(f,t[z])+font_sw(f),size.x=max(size.x,cursor.x)}else{cursor.x=0,size.y+=font_h(f)}}
 return size
}
font_read=s=>{
 const ri=lmi((self,i,x)=>{
  if(lin(i)||(lis(i)&&count(i)==1)){ // read/write glyphs
   let ix=lin(i)?ln(i): ls(i).charCodeAt(0)-32, c=String.fromCharCode(ix+32)
   if(x){
    if(!image_is(x))return x;font_gw(self,c,min(x.size.x,font_w(self)));const s=rect(font_gw(self,c),font_h(self))
    for(let a=s.y-1;a>=0;a--)for(let b=s.x-1;b>=0;b--)font_spix(self,c,b,a, b>=(x.size.x||a>=x.size.y)?0:x.pix[b+a*x.size.x]?1:0)
    return x
   }
   if(ix<0||ix>95)return image_make(rect())
   const s=rect(font_gw(self,c),font_h(self)),r=image_make(s)
   for(let a=s.y-1;a>=0;a--)for(let b=s.x-1;b>=0;b--)r.pix[b+a*s.x]=font_gpix(self,c,b,a)
   return r
  }
  if(x){
   if(ikey(i,'space'))return font_sw(self,ln(x)),x
   if(ikey(i,'size')){
    const r=font_read(getpair(x));iwrite(r,lms('space'),ifield(self,'space'))
    for(let z=0;z<96;z++)iindex(r,z,iindex(self,z));self.pix=r.pix;return x
   }
  }else{
   if(ikey(i,'size'))return lmpair(rect(font_w(self),font_h(self)))
   if(ikey(i,'space'))return lmn(font_sw(self))
   if(ikey(i,'textsize'))return lmnat(([x])=>lmpair(font_textsize(self,x?ls(x):'')))
  }return x?x:NONE
 },'font')
 if(typeof s=='string')ri.pix=data_read('FNT',s)
 if(!ri.pix){ri.pix=new Uint8Array(3+96*(1+s.y*ceil(s.x/8.0)));font_w(ri,s.x),font_h(ri,s.y),font_sw(ri,1)}
 return ri
}
font_write=x=>data_write('FNT0',x.pix)

rtext_len=tab=>tab.v.text.reduce((x,y)=>x+ls(y).length,0)
rtext_get=(tab,n)=>{let i=0;for(let z=0;z<tab.v.text.length;z++){i+=count(tab.v.text[z]);if(i>=n)return z}return -1}
rtext_getr=(tab,x)=>{let i=0;for(let z=0;z<tab.v.text.length;z++){const c=count(tab.v.text[z]);if(i+c>=x)return rect(i,i+c);i+=c}return rect(x,x)}
rtext_make=(t,f,a)=>{
 a=!a?'':image_is(a)?a:ls(a), f=!f?'':ls(f), t=image_is(a)?'i':!t?'':count(t)?ls(t):''
 return lmt({text:[lms(t)],font:[lms(f)],arg:[image_is(a)?a:lms(a)]})
}
rtext_cast=x=>{
 if(!x)x=lms('');if(lid(x))x=monad.table(x);if(!lit(x))return rtext_make(x)
 if(x.v.text&&x.v.font&&x.v.arg&&x.v.text.every((t,i)=>lis(t)&&lis(x.v.font[i])&&(image_is(x.v.arg[i])||lis(x.v.arg[i]))))return x
 let r={text:lml(x.v.text||[lms('')]),font:lml(x.v.font||[lms('')]),arg:lml(x.v.arg||[lms('')])};torect(r)
 r.text.map((_,z)=>{let i=image_is(r.arg[z]);r.text[z]=i?lms('i'):lms(ls(r.text[z])),r.font[z]=lms(ls(r.font[z])),r.arg[z]=i?r.arg[z]:lms(ls(r.arg[z]))})
 return lmt(r)
}
rtext_append=(tab,t,f,a)=>{
 if(image_is(a)){if(count(t)>1)t=lms('i');if(count(t)<1)return 0;}if(!count(t))return 0;
 if(tab.v.text.length&&match(f,last(tab.v.font))&&!image_is(a)&&match(a,last(tab.v.arg))){tab.v.text[tab.v.text.length-1]=lms(last(tab.v.text).v+t.v)}
 else{tab.v.text.push(t),tab.v.font.push(f),tab.v.arg.push(a)};return count(t)
}
rtext_appendr=(tab,row)=>{row.v.text.map((t,i)=>rtext_append(tab,t,row.v.font[i],row.v.arg[i]))}
rtext_string=(tab,pos)=>{
 pos=pos||rect(0,RTEXT_END);let r='',i=0,a=min(pos.x,pos.y),b=max(pos.x,pos.y)
 tab.v.text.map(s=>{for(let z=0;z<s.v.length;z++,i++)if(i>=a&&i<b)r+=s.v[z]});return lms(r)
}
rtext_is_plain=x=>{
 if(!lit(x)||!x.v.text||!x.v.font||!x.v.arg||x.v.text.length>1)return 0;if(x.v.text.length==0)return 1
 return ls(x.v.font[0])==''&&!image_is(x.v.arg[0])&&ls(x.v.arg[0])==''
}
rtext_is_image=x=>{
 let r=null,t=x.v.text,a=x.v.arg; // look for at least one image, and other spans must be only whitespace.
 for(let z=0;z<count(x);z++){if(image_is(a[z])){if(!r)r=a[z]}else if(ls(t[z]).trim()!=''){return null}}
 return r
}
rtext_span=(tab,pos)=>{
 let r=dyad.take(NONE,tab), i=0,c=0,a=min(pos.x,pos.y),b=max(pos.x,pos.y), partial=_=>{
  let rr='';for(let z=0;z<count(tab.v.text[c]);z++,i++)if(i>=a&&i<b)rr+=tab.v.text[c].v[z]
  rtext_append(r,lms(rr),tab.v.font[c],tab.v.arg[c]),c++
 }
 while(c<tab.v.text.length&&(i+count(tab.v.text[c]))<a)i+=count(tab.v.text[c++])                                      ;if(c<tab.v.text.length&&i<=a)partial()
 while(c<tab.v.text.length&&(i+count(tab.v.text[c]))<b)i+=rtext_append(r,tab.v.text[c],tab.v.font[c],tab.v.arg[c]),c++;if(c<tab.v.text.length&&i< b)partial()
 return r
}
rtext_splice=(tab,font,arg,text,cursor,endcursor)=>{
 const a=min(cursor.x,cursor.y),b=max(cursor.x,cursor.y),r=rtext_cast()
 rtext_appendr(r,rtext_span(tab,rect(0,a)))
 rtext_append (r,lms(text),font,arg)
 rtext_appendr(r,rtext_span(tab,rect(b,RTEXT_END)))
 endcursor.x=endcursor.y=a+text.length;return r
}
rtext_write=x=>{const r=monad.cols(x),arg=dget(r,lms('arg'));if(arg){arg.v=arg.v.map(x=>image_is(x)?lms(image_write(x)):x)};return r}
interface_rtext=lmi((self,i,x)=>{
 if(ikey(i,'end'   ))return lmn(RTEXT_END)
 if(ikey(i,'make'  ))return lmnat(([t,f,a])=>rtext_make(t,f,a))
 if(ikey(i,'len'   ))return lmnat(([t])=>lmn(rtext_len(rtext_cast(t))))
 if(ikey(i,'get'   ))return lmnat(([t,n])=>lmn(rtext_get(rtext_cast(t),n?ln(n):0)))
 if(ikey(i,'string'))return lmnat(([t,i])=>rtext_string(rtext_cast(t),i?getpair(i):undefined))
 if(ikey(i,'span'  ))return lmnat(([t,i])=>rtext_span  (rtext_cast(t),i?getpair(i):undefined))
 if(ikey(i,'cat'   ))return lmnat(x=>{let r=lmt({text:[],font:[],arg:[]});x.map(x=>rtext_appendr(r,rtext_cast(x)));return r})
 return x?x:NONE
},'rtext')
button_styles={round:1,rect:1,check:1,invisible:1}
button_read=(x,card)=>{
 const ri=lmi((self,i,x)=>{
  if(!is_rooted(self))return NONE
  if(x){
   if(ikey(i,'value'))return self.value=lb(x),x
   if(ikey(i,'text' ))return self.text=ls(x),x
   if(ikey(i,'style'))return self.style=normalize_enum(button_styles,ls(x)),x
  }else{
   if(ikey(i,'value'))return lmn(ivalue(self,ls(i),0))
   if(ikey(i,'text' ))return lms(ivalue(self,ls(i),''))
   if(ikey(i,'style'))return lms(ivalue(self,ls(i),'round'))
   if(ikey(i,'size' ))return lmpair(ivalue(self,ls(i),rect(60,20)))
  }return interface_widget(self,i,x)
 },'button');ri.card=card
 init_field(ri,'text' ,x)
 init_field(ri,'style',x)
 init_field(ri,'value',x)
 return ri
}
button_write=x=>{
 const r=lmd([lms('type')],[lms('button')])
 if(x.text)dset(r,lms('text' ),lms(x.text))
 if(x.style&&x.style!='round')dset(r,lms('style'),lms(x.style))
 if(x.value!=undefined)dset(r,lms('value'),lmn(x.value))
 return r
}
field_styles={rich:1,plain:1,code:1}
field_aligns={left:1,center:1,right:1}
field_read=(x,card)=>{
 const ri=lmi((self,i,x)=>{
  if(!is_rooted(self))return NONE
  if(x){
   if(ikey(i,'text'  ))return self.value=rtext_cast(lms(ls(x))),x
   if(ikey(i,'scroll'))return self.scroll=max(0,ln(x)),x
   if(ikey(i,'value' )){
    if(ls(ifield(self,'style'))!='rich'&&!rtext_is_plain(x))x=rtext_string(rtext_cast(x))
    return self.value=rtext_cast(x),x
   }
   if(ikey(i,'border'   ))return self.border=lb(x),x
   if(ikey(i,'scrollbar'))return self.scrollbar=lb(x),x
   if(ikey(i,'style'    ))return self.style=normalize_enum(field_styles,ls(x)),iwrite(self,lms('value'),ifield(self,'value')),x
   if(ikey(i,'align'    ))return self.align=normalize_enum(field_aligns,ls(x)),x
  }else{
   if(ikey(i,'text'     )){const v=ivalue(self,'value');return v!=undefined?rtext_string(v):lms('')}
   if(ikey(i,'border'   ))return lmn(ivalue(self,ls(i),1))
   if(ikey(i,'value'    ))return ivalue(self,ls(i))||rtext_cast()
   if(ikey(i,'scroll'   ))return lmn(ivalue(self,ls(i),0))
   if(ikey(i,'scrollbar'))return lmn(ivalue(self,ls(i),0))
   if(ikey(i,'style'    ))return lms(ivalue(self,ls(i),'rich'))
   if(ikey(i,'align'    ))return lms(ivalue(self,ls(i),'left'))
   if(ikey(i,'size'     ))return lmpair(ivalue(self,ls(i),rect(100,20)))
   if(ikey(i,'font'     ))return dget(self.card.deck.fonts,lms(self.font||(self.style=='code'?'mono':'body')))
  }return interface_widget(self,i,x)
 },'field');ri.card=card
 const rtext_read=x=>{
  if(lis(x))return x;x=ld(x)
  const a=dget(x,lms('arg'));if(a){dset(x,lms('arg'),lml(ll(a).map(a=>ls(a).startsWith('%%IMG')?image_read(ls(a)):lms(ls(a)))))}
  return rtext_cast(x)
 }
 {const k=lms('value'),v=dget(x,k);if(v)iwrite(ri,k,rtext_read(v))}
 init_field(ri,'border'   ,x)
 init_field(ri,'scrollbar',x)
 init_field(ri,'style'    ,x)
 init_field(ri,'align'    ,x)
 init_field(ri,'scroll'   ,x)
 return ri
}
field_write=x=>{
 const r=lmd([lms('type')],[lms('field')])
 if(x.border!=undefined)dset(r,lms('border'),lmn(x.border))
 if(x.scrollbar!=undefined)dset(r,lms('scrollbar'),lmn(x.scrollbar))
 if(x.style&&x.style!='rich')dset(r,lms('style'),lms(x.style))
 if(x.align&&x.align!='left')dset(r,lms('align'),lms(x.align))
 if(x.scroll)dset(r,lms('scroll'),lmn(x.scroll))
 if(x.value){if(rtext_is_plain(x.value)){const v=rtext_string(x.value);if(ls(v))dset(r,lms('value'),v)}else{dset(r,lms('value'),rtext_write(x.value))}}
 return r
}
slider_styles={horiz:1,vert:1,bar:1,compact:1}
slider_normalize=(self,n)=>{const i=getpair(ifield(self,'interval')),s=ln(ifield(self,'step'));return clamp(i.x,Math.round(n/s)*s,i.y)}
slider_read=(x,card)=>{
 const update=self=>iwrite(self,lms('value'),ifield(self,'value'))
 const ri=lmi((self,i,x)=>{
  if(!is_rooted(self))return NONE
  if(x){
   if(ikey(i,'value'   ))return self.value=slider_normalize(self,ln(x)),x
   if(ikey(i,'step'    ))return self.step=max(0.000001,ln(x)),update(self),x
   if(ikey(i,'format'  ))return self.format=ls(x),x
   if(ikey(i,'style'   ))return self.style=normalize_enum(slider_styles,ls(x)),x
   if(ikey(i,'interval')){const v=getpair(x);return self.interval=rect(min(v.x,v.y),max(v.x,v.y)),update(self),x}
  }else{
   if(ikey(i,'value'   )){const v=getpair(ifield(self,'interval'));return lmn(ivalue(self,ls(i),clamp(v.x,0,v.y)))}
   if(ikey(i,'format'  ))return lms(ivalue(self,ls(i),'%f'))
   if(ikey(i,'step'    ))return lmn(ivalue(self,ls(i),1))
   if(ikey(i,'interval'))return lmpair(ivalue(self,ls(i),rect(0,100)))
   if(ikey(i,'style'   ))return lms(ivalue(self,ls(i),'horiz'))
   if(ikey(i,'size'    ))return lmpair(ivalue(self,ls(i),rect(100,25)))
  }return interface_widget(self,i,x)
 },'slider');ri.card=card
 init_field(ri,'interval',x)
 init_field(ri,'step'    ,x)
 init_field(ri,'value'   ,x)
 init_field(ri,'format'  ,x)
 init_field(ri,'style'   ,x)
 return ri
}
slider_write=x=>{
 const r=lmd([lms('type')],[lms('slider')])
 if(x.interval)dset(r,lms('interval'),lmpair(x.interval))
 if(x.value!=undefined&&x.value!=0)dset(r,lms('value'),lmn(x.value))
 if(x.step!=undefined&&x.step!=1)dset(r,lms('step'),lmn(x.step))
 if(x.format&&x.format!='%f')dset(r,lms('format'),lms(x.format))
 if(x.style&&x.style!='horiz')dset(r,lms('style'),lms(x.style))
 return r
}
grid_read=(x,card)=>{
 const ints=(x,n)=>{const r=[];for(let z=0;z<n&&z<x.length;z++)r.push(ln(x[z]));return r}
 const ri=lmi((self,i,x)=>{
  if(!is_rooted(self))return NONE
  if(x){
   if(ikey(i,'value'    ))return self.value=lt(x),x
   if(ikey(i,'scroll'   ))return self.scroll=max(0,ln(x)),x
   if(ikey(i,'row'      ))return self.row=max(-1,ln(x)),x
   if(ikey(i,'scrollbar'))return self.scrollbar=lb(x),x
   if(ikey(i,'headers'  ))return self.headers=lb(x),x
   if(ikey(i,'lines'    ))return self.lines=lb(x),x
   if(ikey(i,'widths'   ))return self.widths=ints(ll(x),255),x
   if(ikey(i,'format'   ))return self.format=ls(x),x
  }else{
   if(ikey(i,'value'    ))return ivalue(self,ls(i),lmt({}))
   if(ikey(i,'scroll'   ))return lmn(ivalue(self,ls(i),0))
   if(ikey(i,'scrollbar'))return lmn(ivalue(self,ls(i),1))
   if(ikey(i,'headers'  ))return lmn(ivalue(self,ls(i),1))
   if(ikey(i,'lines'    ))return lmn(ivalue(self,ls(i),1))
   if(ikey(i,'widths'   ))return lml((ivalue(self,ls(i),[])).map(lmn))
   if(ikey(i,'format'   ))return lms(ivalue(self,ls(i),''))
   if(ikey(i,'size'     ))return lmpair(ivalue(self,ls(i),rect(100,50)))
   if(ikey(i,'row'      ))return lmn(clamp(-1,ivalue(self,ls(i),-1),count(ifield(self,'value'))-1))
   if(ikey(i,'rowvalue' )){const r=ln(ifield(self,'row')),v=ifield(self,'value');return r<0||r>=count(v)?lmd():l_at(v,lmn(r))}
  }return interface_widget(self,i,x)
 },'grid');ri.card=card
 init_field(ri,'scrollbar',x)
 init_field(ri,'headers'  ,x)
 init_field(ri,'lines'    ,x)
 init_field(ri,'widths'   ,x)
 init_field(ri,'format'   ,x)
 init_field(ri,'scroll'   ,x)
 init_field(ri,'row'      ,x)
 {const k=lms('value'),v=dget(x,k);if(v)iwrite(ri,k,monad.table(v))}
 return ri
}
grid_write=x=>{
 const r=lmd([lms('type')],[lms('grid')])
 if(x.scrollbar!=undefined)dset(r,lms('scrollbar'),lmn(x.scrollbar))
 if(x.headers!=undefined)dset(r,lms('headers'),lmn(x.headers))
 if(x.lines!=undefined)dset(r,lms('lines'),lmn(x.lines))
 if(x.widths)dset(r,lms('widths'),lml(x.widths.map(lmn)))
 if(x.format)dset(r,lms('format'),lms(x.format))
 if(x.value)dset(r,lms('value'),monad.cols(x.value))
 if(x.scroll)dset(r,lms('scroll'),lmn(x.scroll))
 if(x.row!=undefined&&x.row!=-1)dset(r,lms('row'),lmn(x.row))
 return r
}
canvas_clip=(canvas,z)=>{
 const i=canvas_image(canvas,1),s=i.size,w=rect(0,0,s.x,s.y);canvas.clip=!z||z.length<1?w:rint(rclip(w,unpack_rect(z,w)))
}
canvas_pick=canvas=>{
 canvas_image(canvas,1)
 if(!canvas.brush  )iwrite(canvas,lms('brush'  ),ifield(canvas,'brush'  ))
 if(!canvas.pattern)iwrite(canvas,lms('pattern'),ifield(canvas,'pattern'))
 if(!canvas.font   )iwrite(canvas,lms('font'   ),ifield(canvas,'font'   ))
 if(!canvas.clip   )canvas_clip(canvas)
 frame=canvas
}
canvas_image=(canvas,build)=>{
 if(canvas.image||!build)return canvas.image
 const i=canvas.image,scale=card_is(canvas)?1.0:ln(ifield(canvas,'scale')),size=getpair(ifield(canvas,'size'))
 canvas.image=i?image_copy(i):image_make(rect(ceil(size.x/scale),ceil(size.y/scale))),canvas_clip(canvas);return canvas.image
}
canvas_resize=(canvas,size)=>{
 if(!canvas.image)return
 const scale=ln(ifield(canvas,'scale'));image_resize(canvas.image,rect(ceil(size.x/scale),ceil(size.y/scale))),canvas_clip(canvas)
}
canvas_read=(x,card)=>{
 const wid_pal=x=>x.card.deck.patterns.pal.pix
 const wid_rect=(x,z)=>rint(unpack_rect(z,canvas_image(x).size))
 const wid_crect=(x,z)=>rint(rclip(unpack_rect(z,canvas_image(x).size),frame.clip))
 const text=(t,pos,a)=>{
  const font=ifield(frame,'font')
  if(pos&&lil(pos)&&count(pos)>=4){
   a=anchors[ls(a)]||0;const r=rint(getrect(ll(pos).map(ln))), align=(a==0||a==3||a==6)?ALIGN.left:(a==2||a==5||a==8)?ALIGN.right:ALIGN.center
   const valign=s=>rect(align==ALIGN.left?0:align==ALIGN.right?r.w-s.x:0|((r.w-s.x)/2), y=(a==0||a==1||a==2)?0:(a==6||a==7||a==8)?r.h-s.y:0|((r.h-s.y)/2))
   const rbox=s=>{const a=valign(s);return rclip(rint(rect(r.x+a.x,r.y+a.y,s.x,s.y)),frame.clip)}
   if(lit(t)){const l=layout_richtext(frame.card.deck,t,font,align,r.w);draw_text_rich(rbox(l.size),l,frame.pattern,0)}
   else      {const l=layout_plaintext(ls(t),font,align,rect(r.w,r.h)) ;draw_text_wrap(rbox(l.size),l,frame.pattern  )}
  }else{
   if(lit(t)){const p=getpair(pos);return text(t,lml([p.x,p.y,RTEXT_END/1000,RTEXT_END].map(lmn)))}
   const p=anchor(rpair(getpair(pos),font_textsize(font,ls(t))),a)
   draw_text(p,ls(t),font,frame.pattern)
  }return NONE
 }
 const ri=lmi((self,i,x)=>{
  if(!is_rooted(self))return NONE
  if(x){
   if(ikey(i,'brush'    ))return self.brush  =0|clamp(0,ln(x), 23),x
   if(ikey(i,'pattern'  ))return self.pattern=0|clamp(0,ln(x),255),x
   if(ikey(i,'font'     ))return self.font=normalize_font(self.card.deck.fonts,x),x
   if(!lis(i)){const img=canvas_image(self,1);return img.f(img,i,x)}
   if(self.free)return x
   if(ikey(i,'border'   ))return self.border=lb(x),x
   if(ikey(i,'draggable'))return self.draggable=lb(x),x
   if(ikey(i,'lsize'    )){i=lms('size'),x=lmpair(rmul(getpair(x),ln(ifield(self,'scale'))))}
   if(ikey(i,'size'     )){canvas_resize(self,getpair(x))}
   if(ikey(i,'scale'    )){return self.scale=max(0.1,ln(x)),canvas_resize(self,getpair(ifield(self,'size'))),x}
  }else{
   if(!lis(i)){const img=canvas_image(self,0);return img?img.f(img,i,x):NONE}
   if(ikey(i,'border'   ))return lmn(ivalue(self,ls(i),1))
   if(ikey(i,'draggable'))return lmn(ivalue(self,ls(i),0))
   if(ikey(i,'brush'    ))return lmn(ivalue(self,ls(i),0))
   if(ikey(i,'pattern'  ))return lmn(ivalue(self,ls(i),1))
   if(ikey(i,'size'     ))return lmpair(ivalue(self,ls(i),rect(100,100)))
   if(ikey(i,'scale'    ))return lmn(ivalue(self,ls(i),1.0))
   if(ikey(i,'lsize'    )){const s=getpair(ifield(self,'size')),z=ln(ifield(self,'scale'));return lmpair(rect(ceil(s.x/z),ceil(s.y/z)))}
   if(ikey(i,'clip'     ))return lmnat(z=>(canvas_clip(self,z),NONE))
   if(ikey(i,'clear'    ))return lmnat(z=>(canvas_pick(self),draw_rect(wid_crect(self,z),0            )           ,NONE))
   if(ikey(i,'rect'     ))return lmnat(z=>(canvas_pick(self),draw_rect(wid_crect(self,z),frame.pattern)           ,NONE))
   if(ikey(i,'invert'   ))return lmnat(z=>(canvas_pick(self),draw_invert_raw(wid_pal(self),wid_crect(self,z))     ,NONE))
   if(ikey(i,'box'      ))return lmnat(z=>(canvas_pick(self),draw_box(wid_rect(self,z),frame.brush,frame.pattern) ,NONE))
   if(ikey(i,'poly'     ))return lmnat(z=>(canvas_pick(self),draw_poly(unpack_poly(z),frame.pattern)              ,NONE))
   if(ikey(i,'line'     ))return lmnat(z=>(canvas_pick(self),draw_lines(unpack_poly(z),frame.brush,frame.pattern) ,NONE))
   if(ikey(i,'fill'     ))return lmnat(([pos])=>(canvas_pick(self),draw_fill(rint(getpair(pos)),self.pattern)     ,NONE))
   if(ikey(i,'copy'     ))return lmnat(z=>{const img=canvas_image(self,1);return image_copy(img,unpack_rect(z,img.size))})
   if(ikey(i,'paste'    ))return lmnat(([img,pos,t])=>{
    canvas_pick(self);const dst=canvas_image(self,1)
    img=getimage(img),pos=(pos?ll(pos):[]).map(ln); let solid=t?!lb(t):1
    image_paste_scaled(pos.length<=2?rect(pos[0],pos[1],img.size.x,img.size.y):getrect(pos),frame.clip,img,dst,solid)
    return NONE
   })
   if(ikey(i,'merge'))return lmnat(z=>{
    canvas_pick(self);if(lil(z[0]))z=ll(z[0]);const nice=x=>x&&image_is(x)&&x.size.x>0&&x.size.y>0, size=frame.image.size
    for(let y=0;y<size.y;y++)for(let x=0;x<size.x;x++){
     const h=rect(x,y);if(!inclip(h))continue;let p=gpix(h),c=0;
     if(nice(z[p])){const i=z[p];c=i.pix[(x%i.size.x)+(y%i.size.y)*i.size.x]}
     pix(h,c)
    }return NONE
   })
   if(ikey(i,'text'))return lmnat(([x,pos,a])=>(canvas_pick(self),text(x=lit(x)?rtext_cast(x):lms(ls(x)),pos,a)))
  }return interface_widget(self,i,x)
 },'canvas');ri.card=card
 ri.card=card
 {const v=dget(x,lms('image'));if(v)ri.image=image_read(ls(v)),iwrite(ri,lms('size'),lmpair(ri.image.size))}
 {const v=dget(x,lms('clip' ));if(v)canvas_clip(ri,ll(v))}
 {const v=dget(x,lms('size' ));if(v)ri.size=getpair(v)}
 {const v=dget(x,lms('scale'));if(v)ri.scale=max(0.1,ln(v))}
 init_field(ri,'border'   ,x)
 init_field(ri,'draggable',x)
 init_field(ri,'brush'    ,x)
 init_field(ri,'pattern'  ,x)
 init_field(ri,'font'     ,x)
 return ri
}
canvas_write=x=>{
 const r=lmd([lms('type')],[lms('canvas')])
 if(x.border!=undefined)dset(r,lms('border'),lmn(x.border))
 if(x.image    )dset(r,lms('image'    ),lms(image_write(x.image)))
 if(x.draggable)dset(r,lms('draggable'),lmn(x.draggable))
 if(x.brush    )dset(r,lms('brush'    ),lmn(x.brush))
 if(x.pattern!=undefined&&x.pattern!=1)dset(r,lms('pattern'),lmn(x.pattern))
 if(x.scale)dset(r,lms('scale'),lmn(x.scale))
 if(x.clip&&!requ(x.clip,rpair(rect(),getpair(ifield(x,'lsize')))))dset(r,lms('clip'),lml([x.clip.x,x.clip.y,x.clip.w,x.clip.h].map(lmn)))
 return r
}
widget_shows={solid:1,invert:1,transparent:1,none:1}
interface_widget=(self,i,x)=>{
 widget_rename=(card,a,b)=>{const w=card.widgets,i=dkix(w,a);w.k[i]=b,w.v[i].name=ls(b)}
 if(x){
  if(ikey(i,'name'  ))return widget_rename(self.card,lms(self.name),ukey(self.card.widgets,lms(ls(x)),ls(x),lms(self.name))),x
  if(ikey(i,'index' ))return reorder(self.card.widgets,dvix(self.card.widgets,self),ln(x)),x
  if(ikey(i,'font'  ))return self.font=normalize_font(self.card.deck.fonts,x),x
  if(ikey(i,'script'))return self.script=ls(x),x
  if(ikey(i,'locked'))return self.locked=lb(x),x
  if(ikey(i,'size'  ))return self.size=rint(rclamp(rect(),getpair(x),rect(4096,4096))),x
  if(ikey(i,'pos'   ))return self.pos=rint(getpair(x)),x
  if(ikey(i,'show'  ))return self.show=normalize_enum(widget_shows,ls(x)),x
 }else{
  if(ikey(i,'name'  ))return lms(self.name)
  if(ikey(i,'index' ))return lmn(dvix(self.card.widgets,self))
  if(ikey(i,'script'))return lms(ivalue(self,ls(i),''))
  if(ikey(i,'locked'))return lmn(ivalue(self,ls(i),0))
  if(ikey(i,'pos'   ))return lmpair(ivalue(self,ls(i),rect()))
  if(ikey(i,'show'  ))return lms(ivalue(self,ls(i),'solid'))
  if(ikey(i,'font'  ))return dget(self.card.deck.fonts,lms(ivalue(self,ls(i),button_is(self)?'menu':'body')))
  if(ikey(i,'event' ))return lmnat(args=>n_event(self,args))
 }return x?x:NONE
}
widget_read=(x,card)=>{
 const type=ls(dget(x,lms('type'))||lms('button'))
 const ri=({button:button_read,field:field_read,slider:slider_read,grid:grid_read,canvas:canvas_read}[type]||button_read)(ld(x),card)
 ri.name=ls(ukey(card.widgets,dget(x,lms('name')),type))
 init_field(ri,'size'  ,x)
 init_field(ri,'script',x)
 init_field(ri,'font'  ,x)
 init_field(ri,'locked',x)
 init_field(ri,'pos'   ,x)
 init_field(ri,'show'  ,x)
 return ri
}
widget_write=x=>{
 const r=lmd()
 dset(r,lms('name'),lms(x.name))
 dset(r,lms('type'),lms(x.n))
 dset(r,lms('size'),ifield(x,'size'))
 dset(r,lms('pos' ),ifield(x,'pos' ))
 if(x.size  )dset(r,lms('size'  ),lmpair(x.size))
 if(x.pos   )dset(r,lms('pos'   ),lmpair(x.pos))
 if(x.locked)dset(r,lms('locked'),lmn(x.locked))
 if(x.script)dset(r,lms('script'),lms(x.script))
 if(x.font&&x.font!=(button_is(x)?"menu":"body"))dset(r,lms('font'),lms(x.font))
 if(x.show&&x.show!='solid')dset(r,lms('show'),lms(x.show))
 return dyad[','](r,button_is(x)?button_write(x): field_is (x)?field_write (x):slider_is(x)?slider_write(x):
                    grid_is  (x)?grid_write  (x): canvas_is(x)?canvas_write(x):lmd())
}

widget_strip=x=>dyad.take(lml([lms('name'),lms('type')]),x)
widget_add=(card,x)=>{const r=widget_read(x,card);return dset(card.widgets,ifield(r,'name'),r),r}
card_add=(card,type,name)=>{
 if(lis(type)){
  if(!ls(type)in{button:1,field:1,slider:1,canvas:1,grid:1})return NONE
  const a=lmd([lms('type')],[type]);if(name)dset(a,lms('name'),lms(ls(name)));return widget_add(card,a)
 }
 if(widget_is(type)){const a=widget_write(type);if(name)dset(a,lms('name'),name);return widget_add(card,a)}
 return NONE
}
card_remove=(card,x)=>{
 if(!widget_is(x)||!dkey(card.widgets,x))return 0
 const name=ifield(x,'name');dget(card.widgets,name).dead=true,card.widgets=dyad.drop(name,card.widgets);return 1
}
card_copy_raw=(card,z)=>z.filter(w=>widget_is(w)&&w.card==card).map(widget_write)
card_paste_raw=(card,payload)=>payload.map(p=>widget_add(card,ld(p)))
card_copy=(card,z)=>lms(`%%WGT0${fjson(lml(card_copy_raw(card,lil(z)?ll(z):[z])))}`)
card_paste=(card,z)=>!lis(z)||!z.v.startsWith('%%WGT0')?NONE:lml(card_paste_raw(card,ll(pjson(ls(z),6,count(z)-6).value)))
card_read=(x,deck,cdata)=>{
 x=ld(x);const nav_dirs={right:1,left:1,up:1,down:1},ri=lmi((self,i,x)=>{
  if(self.dead)return NONE
  if(x){
   if(ikey(i,'name')){
    if(ls(x).length==0)return x;const n=ukey(deck.cards,lms(ls(x)),ls(x),lms(self.name))
    deck.cards.k[dvix(deck.cards,self)]=n,self.name=ls(n);return x
   }
   if(ikey(i,'script'))return self.script=ls(x),x
   if(ikey(i,'image' ))return self.image=image_is(x)?x:image_make(rect()),x
   if(ikey(i,'index'))return reorder(self.deck.cards,dvix(self.deck.cards,self),ln(x)),self.deck.history=[ln(ifield(self,'index'))],x
  }else{
   if(ikey(i,'name'   ))return lms(self.name)
   if(ikey(i,'size'   ))return lmpair(deck.size)
   if(ikey(i,'index'  ))return lmn(dvix(deck.cards,self))
   if(ikey(i,'script' ))return lms(self.script||'')
   if(ikey(i,'widgets'))return self.widgets
   if(ikey(i,'image'  ))return self.image||image_make(rect())
   if(ikey(i,'add'    ))return lmnat(([t,n])=>card_add(self,t,n))
   if(ikey(i,'remove' ))return lmnat(([x])=>lmn(card_remove(self,x)))
   if(ikey(i,'event'  ))return lmnat(args=>n_event(self,args))
   if(ikey(i,'copy'    )&&state.external)return lmnat(([z])=>card_copy(self,z))
   if(ikey(i,'paste'   )&&state.external)return lmnat(([z])=>card_paste(self,z))
  }return x?x:NONE
 },'card')
 const n=dget(x,lms('name'))
 ri.deck=deck
 ri.widgets=lmd()
 ri.name=ls(ukey(deck.cards,n&&lis(n)&&count(n)==0?null:n,'card'))
 ri.script=ls(dget(x,lms('script'))||lms(''))
 {const v=dget(x,lms('image'));if(v)ri.image=image_read(ls(v))}
 ll(dget(x,lms('widgets'))||lml([])).filter(w=>dget(w,lms('name'))).map(w=>{const i=widget_read(w,ri);if(lii(i))dset(ri.widgets,ifield(i,'name'),i)})
 return ri
}
card_write=card=>{
 const r=lmd(),wids=lmd()
 dset(r,lms('name'),lms(card.name)),dset(r,lms('widgets'),wids)
 if(card.script.length)dset(r,lms('script'),lms(card.script))
 if(card.image)dset(r,lms('image'),lms(image_write(card.image)))
 card.widgets.k.map((k,i)=>{
  let wid=widget_write(card.widgets.v[i]),n=dget(wid,lms('name'))
  wid=dyad.drop(lms('name'),wid)
  if(count(wid))dset(wids,n,wid)
 });return r
}
rename_sound=(deck,sound,name)=>{
 const sounds=deck.sounds,oldname=dkey(sounds,sound)
 sounds.k[dkix(sounds,oldname)]=ukey(sounds,name,ls(name),oldname)
}
deck_add=(deck,type,y,z)=>{
 const unpack_name=x=>x?lms(ls(x)):NONE
 if(font_is(type))return uset(deck.fonts,unpack_name(y),'font',font_read(font_write(type)))
 if(ikey(type,'font'))return uset(deck.fonts,unpack_name(z),'font',font_read(getpair(y)))
 if(sound_is(type))return uset(deck.sounds,unpack_name(y),'sound',sound_read(sound_write(type)))
 if(ikey(type,'sound'))return uset(deck.sounds,unpack_name(z),'sound',sound_read(y?ln(y):0))
 if(module_is(type)){const a=module_write(type);if(y)dset(a,lms('name'),lms(ls(y)));const r=module_read(a,deck);return dset(deck.modules,ifield(r,'name'),r),r}
 if(ikey(type,'module')){const a=lmd();if(y)dset(a,lms('name'),lms(ls(y)));const r=module_read(a,deck);return dset(deck.modules,ifield(r,'name'),r),r}
 if(card_is(type))return deck_paste(deck,deck_copy(deck,type),y?lms(ls(y)):null)
 if(ikey(type,'card')){const a=lmd();if(y)dset(a,lms('name'),lms(ls(y)));const r=card_read(a,deck);return dset(deck.cards,ifield(r,'name'),r),r}
 return NONE
}
deck_remove=(deck,t)=>{
 if(module_is(t)){const k=dkey(deck.modules,t);if(k)return deck.modules=dyad.drop(k,deck.modules),1}
 if(sound_is(t)){const k=dkey(deck.sounds,t);if(k)return deck.sounds=dyad.drop(k,deck.sounds),1}
 if(font_is(t)){
  const k=dkey(deck.fonts,t);if(!k||ls(k)in{body:1,menu:1,mono:1})return 0
  deck.cards.v.map(c=>c.widgets.v.map(w=>{if(w.font==ls(k))w.font='body'}))
  return deck.fonts=dyad.drop(k,deck.fonts),1
 }
 if(card_is(t)){
  if(count(deck.cards)<=1)return 0
  deck.cards=dyad.drop(dkey(deck.cards,t)||NONE,deck.cards),t.dead=true
  if(deck.card>=count(deck.cards))deck.card=count(deck.cards-1)
  deck.history=[ln(ifield(ifield(deck,'card'),'index'))]
  return 1
 }return 0
}
deck_copy=(deck,z)=>!card_is(z)?NONE: lms(`%%CRD0${fjson(card_write(z))}`)
deck_paste=(deck,z,name)=>{
 if(!lis(z)||!ls(z).startsWith('%%CRD0'))return NONE
 const payload=ld(pjson(ls(z),6,count(z)-6).value)
 const w=dget(payload,lms('widgets'));
 if(w&&lid(w)){w.v.map((v,i)=>{dset(v,lms('name'),w.k[i])})}
 const r=card_read(payload,deck);dset(deck.cards,name||ifield(r,'name'),r)
 return r
}
deck_read=x=>{
 const deck={},scripts={},cards={},modules={}, fonts=lmd(),sounds=lmd(); let i=0,m=0,md=0
 Object.keys(FONTS).map(k=>dset(fonts,lms(k),font_read(FONTS[k])))
 const match=k=>x.startsWith(k,i)?(i+=k.length,1):0
 const end=_=>i>=x.length||x.startsWith('<\/script>',i)
 const str=e=>{let r='';while(!end()&&!match(e))r+=match('{l}')?'{': match('{r}')?'}': match('{c}')?':': match('{s}')?'/': x[i++];return clchars(r)}
 const last=dict=>{const k=Object.keys(dict);return dict[k[k.length-1]]||lmd()}
 match('<body><script language="decker">');while(!end()){
  if(x[i]=='\n')i++
  else if(x[i]=='#')while(!end()&&x[i]!='\n')i++
  else if(match('{deck}\n'   ))m=1
  else if(match('{fonts}\n'  ))m=2
  else if(match('{sounds}\n' ))m=3
  else if(match('{widgets}\n'))m=4
  else if(match('{card:')){const k=str('}');cards[k]=lmd(['name','widgets'].map(lms),[lms(k),lml([])]),m=5}
  else if(match('{script:')){const k=str('}\n');scripts[k]=str('\n{end}')}
  else if(match('{module:')){const k=str('}');modules[k]=lmd(['name','script','data'].map(lms),[lms(k),lms(''),lmd()]),m=6,md=0}
  else if(m==6&&match('{data}\n')){md=1}
  else if(m==6&&match('{script}\n')){dset(last(modules),lms('script'),lms(str('\n{end}'))),m=1}
  else{
   const k=str(':'),j=pjson(x,i,x.length-i),v=j.value;i=j.index
   if(m==1)deck[k]=v
   if(m==2)dset(fonts,lms(k),font_read(ls(v)))
   if(m==3)dset(sounds,lms(k),sound_read(ls(v)))
   if(m==4){if(Object.keys(cards).length)dget(last(cards),lms('widgets')).v.push(dset(ld(v),lms('name'),lms(k)))}
   if(m==5)dset(last(cards),lms(k),v)
   if(m==6)dset(md?dget(last(modules),lms('data')):last(modules),lms(k),v)
  }
 }
 const dscript=x=>{const k=lms('script'),s=dget(x,k);if(s)dset(x,k,lms(scripts[ls(s)]))}
 Object.keys(cards).map(k=>{const card=cards[k];dscript(card),dget(card,lms('widgets')).v.map(dscript)})
 const ri=lmi((self,i,x)=>{
  if(x){
   if(ikey(i,'locked'))return self.locked=lb(x),x
   if(ikey(i,'name'  ))return self.name=ls(x),x
   if(ikey(i,'author'))return self.author=ls(x),x
   if(ikey(i,'script'))return self.script=ls(x),x
   if(ikey(i,'card'  ))return n_go([x],self),x
  }else{
   if(ikey(i,'version' ))return lmn(self.version)
   if(ikey(i,'locked'  ))return lmn(self.locked)
   if(ikey(i,'name'    ))return lms(self.name)
   if(ikey(i,'author'  ))return lms(self.author)
   if(ikey(i,'script'  ))return lms(self.script)
   if(ikey(i,'patterns'))return self.patterns
   if(ikey(i,'sounds'  ))return dyad.drop(NONE,self.sounds)
   if(ikey(i,'fonts'   ))return dyad.drop(NONE,self.fonts)
   if(ikey(i,'cards'   ))return self.cards
   if(ikey(i,'modules' ))return self.modules
   if(ikey(i,'card'    ))return self.cards.v[min(count(self.cards)-1,self.card)]
   if(ikey(i,'add'     ))return lmnat(([x,y,z])=>deck_add(self,x,y,z))
   if(ikey(i,'remove'  ))return lmnat(([x])=>lmn(deck_remove(self,x)))
   if(ikey(i,'event'   ))return lmnat(args=>n_event(self,args))
   if(ikey(i,'copy' )&&state.external)return lmnat(([x])=>deck_copy(self,x))
   if(ikey(i,'paste')&&state.external)return lmnat(([x])=>deck_paste(self,x))
  }return x?x:NONE
 },'deck')
 ri.fonts   =fonts
 ri.sounds  =sounds
 ri.cards   =lmd()
 ri.modules =lmd()
 ri.transit =lmd()
 ri.patterns=patterns_read(deck)
 ri.version ='version' in deck?ln(deck.version):1
 ri.locked  ='locked'  in deck?lb(deck.locked ):0
 ri.name    ='name'    in deck?ls(deck.name   ):''
 ri.author  ='author'  in deck?ls(deck.author ):''
 ri.script  ='script'  in deck?scripts[ln(deck.script)]:''
 ri.card    ='card'    in deck?clamp(0,ln(deck.card),Object.keys(cards).length-1):0
 ri.size    ='size'    in deck?rclamp(rect(320,240),getpair(deck.size),rect(4096,4096)):rect(512,342)
 if(Object.keys(cards).length==0)cards.home=lmd(['name'].map(lms),[lms('home')])
 const root=lmenv();constants(root),primitives(root,ri)
 pushstate(root),issue(root,parse(DEFAULT_TRANSITIONS));while(running())runop();popstate()
 Object.keys(cards  ).map(k=>{const v=card_read(cards[k],ri,cards);dset(ri.cards,ifield(v,'name'),v)})
 Object.keys(modules).map(k=>{const v=module_read(modules[k],ri);dset(ri.modules,ifield(v,'name'),v)})
 ri.history=[ln(ifield(ifield(ri,'card'),'index'))]
 return ri
}
deck_write=(x,html)=>{
 if(!deck_is(x))return '';let deck=x,scripts=lmd(),si=0,sci=0,r=(html?'<body><script language=\"decker\">\n':'')+'{deck}\nversion:1\n'
 const esc_write=(id,x)=>{
  let c='\0',lc=c,r='';for(let z=0;z<x.length;z++){
   lc=c,c=x[z],r+=c=='{'?'{l}': c=='}'?'{r}': c==':'&&id?'{c}': c=='/'&&lc=='<'?'{s}': c
  }return r
 }
 const script_ref=(base,x)=>{
  if(ls(x)=='undefined')throw new Error('welp')
  for(let z=0;z<scripts.v.length;z++)if(match(scripts.v[z],x))return scripts.k[z]
  const k=lms(base?`${base}.${sci}`:`${sci}`);sci++;dset(scripts,k,x);return k
 }
 const write_scripts=_=>{while(si<scripts.v.length)r+=`\n{script:${esc_write(1,ls(scripts.k[si]))}}\n${esc_write(0,ls(scripts.v[si++]))}\n{end}\n`}
 const write_line=(s,k,p,f)=>{const v=s[k];if(p(v))r+=`${k}:${fjson(f(v))}\n`}
 const write_key =(s,k,p,f)=>{const v=dget(s,lms(k));if(p(v))r+=`${k}:${fjson(f(v))}\n`}
 const write_dict=(k,x,f)=>r+=`${count(x)?k:''}${x.k.map((k,i)=>`${esc_write(1,ls(k))}:${fjson(f(x.v[i]))}\n`).join('')}`
 const pp=patterns_write(x.patterns),pa=anims_write(x.patterns),da=dyad.parse(lms('%j'),lms(DEFAULT_ANIMS))
 write_line(x,'card'      ,x=>1                                  ,lmn                       )
 write_line(x,'size'      ,x=>1                                  ,lmpair                    )
 write_line(x,'locked'    ,x=>x                                  ,lmn                       )
 write_line(x,'script'    ,x=>x.length                           ,x=>script_ref(null,lms(x)))
 write_line(x,'name'      ,x=>x.length                           ,lms                       )
 write_line(x,'author'    ,x=>x.length                           ,lms                       )
 write_line(x,'patterns'  ,x=>pp!=DEFAULT_PATTERNS               ,x=>lms(pp)                )
 write_line(x,'animations',x=>!match(pa,da)                      ,x=>pa                     )
 write_scripts()
 write_dict('\n{fonts}\n',dyad.drop(lml(['body','menu','mono'].map(lms)),deck.fonts),x=>lms(font_write(x)))
 write_dict('\n{sounds}\n',deck.sounds,x=>lms(sound_write(x)))
 deck.cards.v.map(c=>{
  const data=card_write(c),wids=dget(data,lms('widgets')),base=ls(dget(data,lms('name')));sci=0
  r+=`\n{card:${esc_write(1,base)}}\n`
  write_key(data,'image' ,x=>x ,x=>x                 )
  write_key(data,'script',count,x=>script_ref(base,x))
  wids.v.map(wid=>{const k=lms('script'),v=dget(wid,k);if(v)dset(wid,k,script_ref(base,v))})
  write_dict('{widgets}\n',wids,x=>x)
  write_scripts()
 })
 deck.modules.v.map(m=>{
  const data=module_write(m)
  r+=`\n{module:${esc_write(1,ls(dget(data,lms('name'))))}}\n`
  write_key(data,'description',x=>x,x=>x)
  write_dict('{data}\n',dget(data,lms('data')),x=>x)
  r+=`{script}\n${esc_write(0,ls(ifield(m,'script')))}\n{end}\n`
 })
 return r+'\n'+(html?'<\/script>\nRuntime stub is NYI.':'')
}

n_go=([x,t],deck)=>{
 let r=null, i=deck.card;t=t?ls(t):''
 if(lin(x))r=clamp(0,ln(x),count(deck.cards)-1)
 else if(card_is(x)){const i=dvix(deck.cards,x);if(i>=0)r=i}
 else{
  x=ls(x);if(deck.history.length>1&&x=='Back'){
   deck.history.pop();const ix=last(deck.history);
   if(ix>=0&&ix<count(deck.cards)){go_notify(deck,ix,t,x),deck.card=ix;return lmn(deck.card)}
  }
  else if(x=='First')r=0
  else if(x=='Last' )r=count(deck.cards)-1
  else if(x=='Prev' )r=mod(i-1,count(deck.cards))
  else if(x=='Next' )r=mod(i+1,count(deck.cards))
  else{const ix=dkix(deck.cards,lms(x));if(ix>=0)r=ix}
 }if(r!=null){go_notify(deck,r,t,x),deck.card=r;if(i!=r)deck.history.push(r)}else{go_notify(deck,-1,t,x)}return lmn(deck.card)
}
n_sleep=([z])=>{if(lis(z)&&ls(z)=='play'){sleep_play=1}else{sleep_frames=max(1,ln(z))};return z}
n_transition=(f,deck)=>{const t=deck.transit;if(lion(f))dset(t,lms(f.n),f);return t}

constants=env=>{
 env.local('sys'    ,interface_system)
 env.local('rtext'  ,interface_rtext)
 env.local('pointer',pointer)
 env.local('pi'   ,lmn(3.141592653589793))
 env.local('e'    ,lmn(2.718281828459045))
 env.local('colors',lmd(
  'white|yellow|orange|red|magenta|purple|blue|cyan|green|darkgreen|brown|tan|lightgray|mediumgray|darkgray|black'.split('|').map(lms),
  range(16).map(x=>lmn(x+32))
 ))
}
primitives=(env,deck)=>{
 env.local('show'      ,lmnat(n_show    ))
 env.local('print'     ,lmnat(n_print   ))
 env.local('play'      ,lmnat(n_play    ))
 env.local('go'        ,lmnat(([x,t])=>n_go([x,t],deck)))
 env.local('transition',lmnat(([f])=>n_transition(f,deck)))
 env.local('sleep'     ,lmnat(n_sleep   ))
 env.local('eval'      ,lmnat(n_eval    ))
 env.local('random'    ,lmnat(n_random  ))
 env.local('array'     ,lmnat(n_array   ))
 env.local('image'     ,lmnat(n_image   ))
 env.local('sound'     ,lmnat(n_sound   ))
 env.local('readcsv'   ,lmnat(n_readcsv ))
 env.local('writecsv'  ,lmnat(n_writecsv))
 env.local('readxml'   ,lmnat(n_readxml ))
 env.local('writexml'  ,lmnat(n_writexml))
 env.local('alert'     ,lmnat(n_alert   ))
 env.local('read'      ,lmnat(n_open    ))
 env.local('write'     ,lmnat(n_save    ))
}
fire_async=(target,name,arg,hunk,nest)=>{
 const scopes=lmd([NONE],[parse(DEFAULT_HANDLERS)]), root=lmenv(); let deck=null
 ancestors=target=>{
  if(deck_is(target))deck=target
  if(widget_is(target))ancestors(target.card)
  if(card_is(target))ancestors(target.deck)
  try{dset(scopes,target,parse(ls(ifield(target,'script'))))}
  catch(e){dset(scopes,target,lmblk());}
 }
 ancestors(target)
 primitives(root,deck)
 root.local('me',target)
 root.local('deck',deck)
 root.local('patterns',ifield(deck,'patterns'))
 constants(root);let core=null
 for(let z=scopes.v.length-1;z>=0;z--){
  let t=scopes.k[z], b=lmblk(), sname='!widget_scope'
  const bind=(n,v)=>{blk_lit(b,v),blk_loc(b,n),blk_op(b,op.DROP)}
  const func=(n,v)=>{blk_lit(b,lmon(n,[],blk_end(v))),blk_op(b,op.BIND),name=n,arg=lml([])}
  if(lin(t))sname='!default_handlers'
  if(deck_is(t)){
   t.modules.v.map((v,i)=>bind(t.modules.k[i],ifield(v,'value')))
   t.cards  .v.map((v,i)=>bind(t.cards  .k[i],v                ))
   sname='!deck_scope'
  }
  if(card_is(t)){
   bind(lms('card'),t)
   t.widgets.v.map((v,i)=>bind(t.widgets.k[i],v))
   sname='!card_scope'
  }
  blk_cat(b,scopes.v[z]),blk_op(b,op.DROP)
  if(!core&&hunk){func('!hunk',hunk)}
  else if(core){func(sname,core)}
  blk_get(b,lms(name)),blk_lit(b,arg),blk_op(b,op.CALL);if(!hunk)blk_op(b,op.DROP);core=b
 }
 if(nest)pushstate(root),pending_popstate=1;issue(root,core)
}
fire_event_async=(target,name,x)=>fire_async(target,name,lml([x]),null,1)
fire_hunk_async=(target,hunk)=>fire_async(target,null,lml([]),hunk,1)
n_event=(self,args)=>{fire_async(self,ls(args[0]),lml(args.slice(1)),null,0);return self}
// Decker

let pump=null, zoom=1, deck=null, fb=null, context=null, dirty=0
let FONT_BODY=null,FONT_MENU=null,FONT_MONO=null

const ELLIPSIS=String.fromCharCode(95+32)
const DOUBLE_CLICK_DELAY=20
const FIELD_CURSOR_DUTY =20
const FIELD_CHANGE_DELAY=60
const LISTEN_LINES      =30
const LISTEN_SIZE       =_=>rect(frame.size.x-20,100)
const MASTER_VOLUME     =0.3
const FAT               =8
const BG_MASK           =100

q=x=>document.querySelector(x)
gcd=(x,y)=>{while(x!=y){if(x>y){x-=y}else{y-=x}}return x}
lcm=(x,y)=>{const r=gcd(x,y);return 0|((x*y)/(r?r:1))}
copy_object=x=>Object.keys(x).reduce((r,k)=>((r[k]=x[k]),r),{})
plain_or_rich=x=>lit(x)?rtext_cast(x):lms(x?ls(x):'')
fieldstr=x=>({table:rtext_cast(x),scroll:0})
gridtab=(x,r)=>({table:x,scroll:0,row:r==undefined?-1:r})
open_url=x=>{window.open(x,'_blank')}
open_file=(filter,f)=>{const s=q('#source');s.value='',s.accept=filter,s.onchange=_=>{if(s.files.length)f(s.files[0])},s.click()}
open_text=(filter,f)=>open_file(filter,file=>{const r=new FileReader();r.onload=_=>{f(clchars(r.result))},r.readAsText(file)})
load_array=(file,after)=>{const r=new FileReader();r.onload=_=>{const b=new Uint8Array(r.result);after(array_make(b.length,'u8',0,b))},r.readAsArrayBuffer(file)}
load_image=(file,hint,after)=>{
 const read_image=grayscale=>{
  const i=q('#loader'),w=i.width,h=i.height,r=image_make(rect(w,h)); if(w==0||h==0)return r
  const t=document.createElement('canvas');t.width=w,t.height=h
  const tg=t.getContext('2d');tg.drawImage(i,0,0)
  const d=tg.getImageData(0,0,w,h).data
  let src=0,dst=0;while(dst<r.pix.length){
   const cr=d[src++],cg=d[src++],cb=d[src++],ca=d[src++]
   r.pix[dst++]=(ca!=0xFF)?(grayscale?0xFF:0x00): readcolor(cr,cg,cb,grayscale)
  }return r
 }
 const import_image=_=>{
  if(after){after(read_image(hint=='gray'));return}
  let i=read_image(0),m=null; if(i.size.x==0||i.size.y==0)return
  let color=0,c=new Uint8Array(256);i.pix.forEach(p=>c[p]++)
  let tw=c[0],ow=c[32];c[32]=0,c[47]=0;for(let z=2;z<256;z++)if(c[z]){color=1;break}
  if(color&&tw)i.pix.forEach((p,z)=>i.pix[z]=p!=0),m=i
  if(color){i=read_image(1)}else if(ow&&!tw){i.pix.forEach((p,z)=>i.pix[z]=p!=32)}
  setmode('draw'),bg_paste(i);dr.limbo_dither=color,dr.dither_threshold=0.5,dr.fatbits=0,dr.omask=m
 }
 const r=new FileReader();r.onload=_=>{q('#loader').src=r.result;setTimeout(import_image,100)};r.readAsDataURL(file)
}
save_text=(n,x)=>{
 const u=URL.createObjectURL(new Blob([x])), t=q('#target')
 t.download=n,t.href=u,t.click(),setTimeout(_=>URL.revokeObjectURL(u),200)
}
save_bin=(n,x)=>{
 const u=URL.createObjectURL(new Blob([Uint8Array.from(x)])), t=q('#target')
 t.download=n,t.href=u,t.click(),setTimeout(_=>URL.revokeObjectURL(u),200)
}
writegif=frames=>{
 const size=frames.reduce((s,f)=>rmax(s,f.size),rect(1,1)), pal=deck.patterns.pal.pix; let frame_index=0, payload=[]
 const anim_ants       =(x,y)=>(0|((x+y+frame_index)/3))%2?15:0
 const draw_pattern    =(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal_pat(pal,pix,x,y)&1
 const draw_color_trans=(pix,x,y)=>pix==ANTS?anim_ants(x,y): pix==0?16: pix>47?0: pix>31?pix-32: draw_pattern(pix,x,y)?15:0
 const b=x=>payload.push(x&0xFF), s=x=>{b(x);b(x>>8)}, t=x=>x.split('').forEach(x=>b(x.charCodeAt(0)))
 t('GIF89a'),s(size.x),s(size.y) // header, dimensions
 b(0xF4)                         // global colortable, 8-bits per channel, 32 colors
 b(0),b(0)                       // background color is 0, 1:1 pixel aspect ratio
 for(let z=0;z<16;z++)b(COLORS[z]>>16),b(COLORS[z]>>8),b(COLORS[z]) // global colortable
 for(let z=0;z<16;z++)b(0xFF         ),b(0xFF        ),b(0xFF     ) // padding entries
 s(0xFF21),b(11),t('NETSCAPE2.0'),b(3),b(1),s(0),b(0)               // NAB; loop gif forever
 for(let z=0;z<frames.length;z++){
  const frame=frames[z]
  s(0xF921),b(4)                            // graphic control extension
  b(9),s(20),b(16)                          // dispose to bg + has transparency, 20/100th of a second delay, color 16 is transparent
  b(0)                                      // end GCE
  b(0x2C)                                   // image descriptor
  s(0),s(0),s(frame.size.x),s(frame.size.y) // dimensions
  b(0),b(7)                                 // no local colortable,  minimum LZW code size
  let isize=frame.size.x*frame.size.y, off=0
  while(off<isize){
   const bsize=min(64,isize-off)
   b(1+bsize),b(0x80) // block size, LZW CLEAR
   for(let z=0;z<bsize;z++){
    const x=0|((off+z)%frame.size.x), y=0|((off+z)/frame.size.x)
    b(draw_color_trans(frame.pix[off+z],x,y))
   }off+=bsize
  }b(0),frame_index++ // end of frame
 };b(0x3B);return payload
}
writewav=sound=>{
 const payload=[], b=x=>payload.push(x&0xFF), s=x=>(b(x),b(x>>8))
 const d=x=>(b(x),b(x>>8),b(x>>16),b(x>>24)), t=x=>x.split('').forEach(x=>b(x.charCodeAt(0)))
 t('RIFF'),d(4+24+(8+sound.data.length)+(sound.data.length%2))
 t('WAVE'),t('fmt ')
 d(16)             // chunk size
 s(1),s(1),d(8000) // pcm, 1 channel, 8khz
 d(8000)           // 8000*(1 byte per sample)*(1 channel)
 s(1)              //      (1 byte per sample)*(1 channel)
 s(8)              // 8 bits per sample
 t('data'),d(sound.data.length)
 for(let z=0;z<sound.data.length;z++)b(128+sound.data[z])
 if(sound.data.length%2)b(0);return payload
}
writearray=array=>{
 const payload=[]
 for(let z=0;z<array.size;z++){const ix=array.base+z;payload.push(ix>=0&&ix<array.data.length?array.data[ix]:0)}
 return payload
}

keep_ratio=(r,s)=>{if(!ev.shift||s.x==0||s.y==0)return r;const scale=max(r.w/(s.x*1.0),r.h/(s.y*1.0));return rect(r.x,r.y,scale*s.x,scale*s.y)}
draw_frame=(image,clip)=>({brush:0,pattern:0,font:FONT_BODY,size:image.size,clip:clip||rect(0,0,image.size.x,image.size.y),image})
draw_pix=(x,y,pattern)=>{const h=rect(x,y);if(inclip(h))pix(h,pattern)}
draw_invert=(pal,r)=>{
 const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal_pat(pal,pix,x,y)&1; r=rclip(r,frame.clip)
 for(let a=r.y;a<r.y+r.h;a++)for(let b=r.x;b<r.x+r.w;b++){const h=rect(b,a), p=draw_pattern(gpix(h),b,a);pix(h,p==0||p==32?1:32)}
}
draw_shadow=(r,fcol,bcol,solid)=>{
 if(solid)draw_rect(rclip(r,frame.clip),bcol);draw_box(r,0,fcol),draw_hline(r.x+3,r.x+r.w,r.y+r.h,fcol),draw_vline(r.x+r.w,r.y+2,r.y+r.h+1,fcol)
}
draw_boxr=(r,fcol,bcol,background)=>{
 r=rint(r)
 draw_hline(r.x+2,r.x+r.w-2,r.y,fcol),draw_hline(r.x+2,r.x+r.w-2,r.y+r.h-1,fcol),draw_vline(r.x,r.y+2,r.y+r.h-2,fcol),draw_vline(r.x+r.w-1,r.y+2,r.y+r.h-2,fcol)
 draw_pix(r.x+1,r.y+1,fcol),draw_pix(r.x+r.w-2,r.y+1,fcol),draw_pix(r.x+1,r.y+r.h-2,fcol),draw_pix(r.x+r.w-2,r.y+r.h-2,fcol)
 if(background)draw_hline(r.x+2,r.x+r.w-2,r.y+1,bcol),draw_hline(r.x+2,r.x+r.w-2,r.y+r.h-2,bcol),draw_rect(rect(r.x+1,r.y+2,r.w-2,r.h-4),bcol)
}
draw_boxinv=(pal,r)=>{
 draw_invert(pal,rect(r.x,r.y,1,r.h))    ,draw_invert(pal,rect(r.x+r.w-1,r.y,1,r.h))
 draw_invert(pal,rect(r.x+1,r.y,r.w-2,1)),draw_invert(pal,rect(r.x+1,r.y+r.h-1,r.w-2,1))
}
draw_modalbox=s=>{
 const menu=16, r=rcenter(rect(0,menu,frame.size.x,frame.size.y-menu),s), o=inset(r,-5)
 draw_rect(inset(o,-5),32),draw_box(inset(o,-5),0,1),draw_box(inset(o,-2),0,1),draw_box(inset(o,-1),0,1);return r
}
draw_modal_rtext=extra=>{
 const size=rect(200,100)
 const l=lit(ms.message)?layout_richtext(deck,ms.message,FONT_BODY,ALIGN.center,size.x):layout_plaintext(ls(ms.message),FONT_BODY,ALIGN.center,size)
 const b=draw_modalbox(radd(l.size,extra)), tbox=rect(b.x,b.y,b.w,l.size.y)
 if(lit(ms.message)){draw_text_rich(tbox,l,1,1)}else{draw_text_wrap(tbox,l,1)}
 return b
}
draw_text_outlined=(pos,text,f)=>{
 ([[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]]).map(([x,y])=>draw_text(rect(pos.x+x,pos.y+y),text,f,32))
 draw_text(pos,text,f,1)
}
draw_textc=(r,text,font,pattern)=>{
 const size=font_textsize(font,text);
 if(pattern==-1){draw_text_outlined(rcenter(r,size),text,font)}
 else if(size.x<r.w){draw_text(rcenter(r,size),text,font,pattern)}else{draw_text_fit(r,text,font,pattern)}
}
draw_text_fit=(r,text,font,pattern)=>{
 const glyphs=[], glyph_push=(pos,c)=>glyphs.push({pos,c})
 let x=0,y=0,fh=font_h(font),ew=font_gw(font,ELLIPSIS)
 for(let z=0;z<text.length&&(y+fh)<=r.h;z++){
  const c=text[z]
  if(c=='\n'){x=0,y+=fh}
  else if(x+font_gw(font,c)>=(r.w-ew)){glyph_push(rect(x,y),ELLIPSIS);while(z<text.length&&text[z]!='\n')z++;x=0;if(z<text.length){y+=fh}else{z--}}
  else{glyph_push(rect(x,y),c),x+=font_gw(font,c)+font_sw(font)}
 }
 let yo=ceil((r.h-(y+fh))/2.0);glyphs.map(g=>{g.pos.x+=r.x,g.pos.y+=yo+r.y,draw_char(g.pos,font,g.c,pattern)})
}
draw_scaled=(r,image,opaque)=>{
 if(r.w==0||r.h==0)return;const s=image.size
 if(r.w==s.x&&r.h==s.y){image_paste(r,frame.clip,image,frame.image,opaque);return}
 image_paste_scaled(r,frame.clip,image,frame.image,opaque)
}
draw_invert_scaled=(pal,r,image)=>{
 if(r.w==0||r.h==0)return;const s=image.size, fb=frame.image.pix, fs=frame.image.size.x
 const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal[(x%8)+(8*(y%8))+(8*8*pix)]&1
 const gpix=p=>fb[p.x+p.y*fs], pix=(p,v)=>fb[p.x+p.y*fs]=v
 for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++){
  const sx=0|(s.x==r.w?b:((b*1.0)/r.w)*s.x), sy=0|(s.y==r.h?a:((a*1.0)/r.h)*s.y), dx=r.x+b, dy=r.y+a
  const c=draw_pattern(image.pix[sx+sy*s.x],dx,dy), h=rect(dx,dy)
  if(inclip(h))pix(h,c^draw_pattern(gpix(h),dx,dy))
 }
}
draw_fat=(src,pal,frame_count,mask,scale,offset)=>{
 const anim=deck.patterns.anim
 const anim_pattern=(pix,x,y)=>pix<28||pix>31?pix: anim[pix-28][(0|(frame_count/4))%max(1,anim[pix-28].length)]
 const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal[(x%8)+(8*(y%8))+(8*8*pix)]&1
 const s=src.size;for(let y=0;y<ceil(frame.size.y/scale);y++)for(let x=0;x<ceil(frame.size.x/scale);x++){
  if(offset.x+x>=s.x||offset.y+y>=s.y||offset.x+x<0||offset.y+y<0)continue
  const v=src.pix[(offset.x+x)+(offset.y+y)*frame.size.x];if(v==mask)continue
  const c=anim_pattern(v,offset.x+x,offset.y+y),p=draw_pattern(c,offset.x+x,offset.y+y)
  draw_rect(rect(x*scale,y*scale,scale,scale),c>=32?c: c==0?0: p?1:32)
 }
}
draw_fat_scaled=(r,image,opaque,pal,frame_count,scale,offset)=>{
 const anim=deck.patterns.anim
 const anim_pattern=(pix,x,y)=>pix<28||pix>31?pix: anim[pix-28][(0|(frame_count/4))%max(1,anim[pix-28].length)]
 const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal[(x%8)+(8*(y%8))+(8*8*pix)]&1
 if(r.w==0||r.h==0)return;const s=image.size
 for(let y=0;y<r.h;y++)for(let x=0;x<r.w;x++){
  const sx=0|(s.x==r.w?x:((x*1.0)/r.w)*s.x), sy=0|(s.y==r.h?y:((y*1.0)/r.h)*s.y), v=image.pix[sx+sy*s.x]
  const c=anim_pattern(v,r.x+x,r.y+y),p=draw_pattern(c,r.x+x,r.y+y)
  if(opaque||v!=0)draw_rect(rect((r.x-offset.x+x)*scale,(r.y-offset.y+y)*scale,scale,scale),c>=32?c: p?1:0)
 }
}
draw_dithered=(r,image,opaque,mask,threshold)=>{
 if(r.w==0||r.h==0)return;const s=image.size, stride=2*r.w, m=[0,1,r.w-2,r.w-1,r.w,stride-1], dither_err=new Float32Array(stride)
 for(let ei=0,a=0;a<r.h;a++)for(let b=0;b<r.w;b++){
  const sx=0|(((b*1.0)/r.w)*s.x), sy=0|(((a*1.0)/r.h)*s.y), src=0xFF&image.pix[sx+sy*s.x], ms=mask?mask.pix[sx+sy*s.x]:1
  const p=(src/256.0)+dither_err[ei], col=p>threshold?1:0, err=(p-col)/8.0
  dither_err[ei]=0, ei=(ei+1)%stride; for(let z=0;z<6;z++)dither_err[(ei+m[z])%stride]+=err
  const c=!col;if(ms&&(opaque||c!=0)){const h=rect(r.x+b,r.y+a);if(inclip(h))pix(h,c)}
 }
}
draw_widget=w=>{
 if(canvas_is(w))return canvas_image(w,1)
 const rsize=getpair(ifield(w,'size')),r=image_make(rsize),t=frame,te=copy_object(ev);frame=draw_frame(r),ev=event_state(),menus_clear() // !!!
 if     (button_is(w)){const p=unpack_button(w);p.size.x=0,p.size.y=0;widget_button(w,p,lb(ifield(w,'value')))}
 else if(slider_is(w)){const p=unpack_slider(w);p.size.x=0,p.size.y=0;widget_slider(w,p)}
 else if(grid_is  (w)){const p=unpack_grid  (w);p.size.x=0,p.size.y=0;widget_grid  (w,p,unpack_grid_value(w))}
 else if(field_is (w)){const p=unpack_field (w);p.size.x=0,p.size.y=0;widget_field (w,p,unpack_field_value(w))}
 return ev=te,frame=t,r
}
draw_card=(card,active)=>{
 const im=ms.in_modal;ms.in_modal=active
 const rsize=getpair(ifield(card,'size')),r=image_make(rsize),t=frame,te=copy_object(ev);frame=draw_frame(r),ev=event_state()
 const back=ifield(card,'image'), bsize=back.size, wids=ifield(card,'widgets')
 if(bsize.x!=0&&bsize.y!=0)image_paste(rpair(rect(),bsize),frame.clip,back,frame.image,1)
 if(uimode!='draw'||dr.show_widgets)wids.v.map(w=>{
  if(button_is(w))widget_button(w,unpack_button(w),lb(ifield(w,'value')))
  if(slider_is(w))widget_slider(w,unpack_slider(w))
  if(canvas_is(w))widget_canvas(w,unpack_canvas(w),canvas_image(w,0))
  if(grid_is  (w))widget_grid  (w,unpack_grid  (w),unpack_grid_value(w))
  if(field_is (w))widget_field (w,unpack_field (w),unpack_field_value(w))
 });return ev=te,frame=t,ms.in_modal=im,r
}
draw_thumbnail=(card,r)=>{
 const back=ifield(card,'image');r=inset(r,1),draw_rect(r,0);if(back.size.x>0||back.size.y>0)draw_scaled(r,back,1)
 const wids=ifield(card,'widgets'),s=getpair(ifield(card,'size')), xr=r.w*(1.0/s.x), yr=r.h*(1.0/s.y)
 wids.v.map(wid=>{const w=unpack_widget(wid);draw_box(rclip(rect(r.x+w.size.x*xr,r.y+w.size.y*yr,w.size.w*xr,w.size.h*yr),r),0,w.show=='invert'?0:1)})
}
draw_lil=(size,align,bare,x)=>{
 const GAP=50, w=size.x-GAP; let xo=align==ALIGN.right?GAP: align==ALIGN.left?0: 0|(GAP/2)
 const r=image_make(size), t=frame; frame=draw_frame(r)
 if(lit(x)){
  const tk=Object.keys(x.v), tc=tk.length, tr=tk.length?x.v[tk[0]].length:0
  const hh=tc?3+font_h(FONT_BODY):3, ch=font_h(FONT_MONO), fh=font_h(FONT_BODY), rows=0|min((size.y-(hh+fh))/ch,tr)
  const f=dyad.take(NONE,x), cw=range(256).map(x=>0)
  for(let c=0;c<tc&&c<256;c++){
   const dr=rows<tr?rows-1:rows;cw[c]=0;for(let r=0;r<dr;r++){
    const s=show(x.v[tk[c]][r]);f.v[tk[c]].push(lms(s))
    cw[c]=max(cw[c],font_textsize(FONT_MONO,s).x+10)
   }if(rows<tr)f.v[tk[c]].push(lms(' \x7f'))
   cw[c]=min(100,max(cw[c],font_textsize(FONT_BODY,tk[c]).x+10))
  }
  let cols=0,tw=0,ve=0;for(let c=0;c<tc&&c<256;c++){if(tw+cw[c]>=w){ve=1;break};cols++;if(c+1<=tc&&c+1<=256)tw+=cw[c]}
  xo=align==ALIGN.right?size.x-tw: align==ALIGN.left?0: 0|((size.x-tw)/2)
  let cx=xo;for(let c=0;c<cols;c++){
   if(c)draw_vline(cx,0,hh+ch*rows+(rows==0),1);draw_text_fit(rect(cx+2,0,cw[c]-4,hh),tk[c],FONT_BODY,1)
   for(let r=0;r<rows;r++)draw_text_fit(rect(cx+2,hh+ch*r,cw[c]-4,ch),ls(f.v[tk[c]][r]),FONT_MONO,1)
   if(c+1<=cols)cx+=cw[c]
  }draw_hline(xo,cx,hh-1,1);const bh=hh+ch*rows+1+(rows==0);if(cx==xo)cx+=min(25,w)
  const desc=`(${tc} column${tc==1?'':'s'}, ${tr} row${tr==1?'':'s'}.)`
  const ds=font_textsize(FONT_BODY,desc);draw_text_fit(rect(xo+tw-ds.x,bh,w,fh),desc,FONT_BODY,1)
  draw_box(rect(xo,0,cx-xo,bh),0,1);if(ve)draw_vline(cx-1,0,bh,13)
 }
 else if(image_is(x)){
  const s=x.size, desc=`(${s.x} x ${s.y})`, ds=font_textsize(FONT_BODY,desc), mh=max(1,min(s.y,size.y-font_h(FONT_BODY))), mw=max(1,min(s.x,w))
  const scale=s.x==0&&s.y==0?1:min(mw/(s.x*1.0),mh/(s.y*1.0)), iw=0|(scale*s.x), ih=0|(scale*s.y)
  const b=rect(xo+(w-max(iw,ds.x)),0,iw,ih); draw_scaled(b,x,1),draw_box(b,0,1),draw_text(rect(b.x,b.y+b.h,ds.x,ds.y),desc,FONT_BODY,1)
 }
 else{const l=layout_plaintext(bare?ls(x): show(x,0),FONT_MONO,align,rect(w,size.y));draw_text_wrap(rect(xo,0,w,size.y),l,1)}
 for(let y=size.y-1;y>0;y--){let f=0;for(let x=0;x<size.x;x++)if(r.pix[x+(y*size.x)]){f=1;break}if(f){break}else{r.size.y--}}
 return frame=t,r
}
unpack_widget=x=>({
 size  :rpair(getpair(ifield(x,'pos')),getpair(ifield(x,'size'))),
 show  :ls(ifield(x,'show'  )),
 locked:lb(ifield(x,'locked')),
})
unpack_button=x=>({
 size  :rpair(getpair(ifield(x,'pos')),getpair(ifield(x,'size'))),
 text  :ls(ifield(x,'text'  )),
 font  :   ifield(x,'font'  ) ,
 style :ls(ifield(x,'style' )),
 show  :ls(ifield(x,'show'  )),
 locked:lb(ifield(x,'locked')),
})
unpack_slider=x=>({
 size  :rpair(getpair(ifield(x,'pos')),getpair(ifield(x,'size'))),
 font  :   ifield(x,'font'  ) ,
 format:ls(ifield(x,'format')),
 show  :ls(ifield(x,'show'  )),
 style :ls(ifield(x,'style' )),
 locked:lb(ifield(x,'locked')),
 step  :ln(ifield(x,'step'  )),
 value :ln(ifield(x,'value' )),
 min   :getpair(ifield(x,'interval')).x,
 max   :getpair(ifield(x,'interval')).y,
})
unpack_canvas=x=>({
 size     :rpair(getpair(ifield(x,'pos')),getpair(ifield(x,'size'))),
 scale    :ln(ifield(x,'scale'    )),
 border   :lb(ifield(x,'border'   )),
 draggable:lb(ifield(x,'draggable')),
 show     :ls(ifield(x,'show'     )),
 locked   :lb(ifield(x,'locked'   )),
})
unpack_field=x=>({
 size     :rpair(getpair(ifield(x,'pos')),getpair(ifield(x,'size'))),
 font     :   ifield(x,'font'     ) ,
 show     :ls(ifield(x,'show'     )),
 scrollbar:lb(ifield(x,'scrollbar')),
 border   :lb(ifield(x,'border'   )),
 style    :ls(ifield(x,'style'    )),
 locked   :lb(ifield(x,'locked'   )),
 align    :ALIGN[ls(ifield(x,'align'))],
})
unpack_field_value=x=>({
 table :   ifield(x,'value' ) ,
 scroll:ln(ifield(x,'scroll')),
})
unpack_grid=x=>({
 size     :rpair(getpair(ifield(x,'pos')),getpair(ifield(x,'size'))),
 widths   :ll(ifield(x,'widths')).map(ln),
 font     :   ifield(x,'font'     ) ,
 format   :ls(ifield(x,'format'   )),
 headers  :lb(ifield(x,'headers'  )),
 scrollbar:lb(ifield(x,'scrollbar')),
 lines    :lb(ifield(x,'lines'    )),
 show     :ls(ifield(x,'show'     )),
 locked   :lb(ifield(x,'locked'   )),
})
unpack_grid_value=x=>({
 table :   ifield(x,'value' ) ,
 scroll:ln(ifield(x,'scroll')),
 row   :ln(ifield(x,'row'   )),
})

let cursor={default:'default',point:'pointer',ibeam:'text',drag:'grabbing'}
image_tiles=(count,size,image)=>range(count).map(x=>image_copy(image,rect(0,x*size,size,size)))
TOOLS=image_tiles(12,16,image_read(
 '%%IMG0ABAAwAMABIAEgASABIAEgGTwlKxMqiQKJAIQAggCCAQEBAQEAAAAAAAAAAA//EACgAGAAYABgAFAAz/+H/wAAAAAAA'+
 'AAAAAA8+eAAYABAAAAAIABgAGAAQAAAACAAYAB588AAADwAIgBCAGQAnACIAQgBEAIQAiAEIARAB4AHAAYABAAAAAAAAP4HA'+
 'YgAUABgAGAAoAcuOBnAFQAOAAIAAgAEAAAAAAAAADAADAADAADAADAADAADAADAAAAAAAAAAAAAAcACIAJgArADLAInBCOIU'+
 'dAh4APgBdAJyBHEIcJBgYEAAAAADgcVjar69VVqqvVVaqrVVZqrDVYGrAHwAAAAAAAAAAA//+AAYABgAGAAYABgAGAAYABgA'+
 'H//wAAAAAAAAAAAAD//6qr1VWqq9VVqqvVVaqr1VWqq///AAAAAAAAAAAAAAAAB+AYGCAEQAKAAYABgAFAAiAEGBgH4AAAAA'+
 'AAAAAAAAAH4B1YKqxVVqqr1VWqq1VWKqwdWAfgAAAAAA=='
))
ARROWS=image_tiles(8,12,image_read(
 '%%IMG0AAwAYAAABgAJARCCIERAL/DxEIEQgRCBH4AAAAABH4EQgRCBEI/w9EAiIEEQgAkABgAAAAAABgAPAR+DP8d/7//xH4'+
 'EfgR+BH4AAAAABH4EfgR+BH4//93/jP8EfgA8ABgAAAAIABgAKARPiICRAJEAiICET4AoABgACAAQABgAFB3yEQERAJEAkQE'+
 'd8gAUABgAEAAIABgAOAR/jP+d/53/jP+Ef4A4ABgACAAQABgAHB3+Hf8d/53/nf8d/gAcABgAEAA=='
))
CHECK=image_read('%%IMG0AAkABwCAAcGDY8Y2bBw4CBAA')
CHECKS=[
 '%%IMG0AA8ADQAAf/BAEEAQQBBAEEAQQBBAEEAQQBB/8AAA',
 '%%IMG0AA8ADQAAf/BgMFBQSJBFEEIQRRBIkFBQYDB/8AAA',
 '%%IMG0AA8ADQAAVVAAAEAQAABAEAAAQBAAAEAQAABVUAAA',
 '%%IMG0AA8ADQAAVVAgIFBQCIBFEAIARRAIgFBQICBVUAAA',
].map(image_read)
LOCK     =image_read('%%IMG0AAgACDhERP7+/v4A')
ZOOM     =image_read('%%IMG0AAwADB4AIQBMgIxAv0C/QIxATIAhwB7gAHAAMA==')
CORNERS=['%%IMG0AAUABf/mxISA','%%IMG0AAUABfk4GAgI','%%IMG0AAUABYSGx+f4','%%IMG0AAUABQgIGT/4'].map(image_read)
GESTURES={
 left: image_read('%%IMG2ABAAEAAaIAQACiADAQIgAQAIIAMBBCABAAYgAwEGIAEABCADAQggBgEMIAIBDiAEAQwgAQACIAMBCCADAAQgAwEGIAEACCADAQQgAQAKIAMBAiABAAwgBAAi'),
 right:image_read('%%IMG2ABAAEAASIAQADCABAQIgAwAKIAEBBCADAAggAQEGIAMABCADAQggAwACIAEBDCAEAQ4gAgEMIAYBCCADAAQgAQEGIAMABiABAQQgAwAIIAEBAiADAAogBAAq'),
 up:   image_read('%%IMG2ABAAEAAHIAMADSABAQEgAQAMIAIBASACAAsgAQEDIAEACiACAQMgAgAJIAEBBSABAAggAgEFIAIAByABAQcgAQAGIAIBByACAAUgAQEJIAEABCACAQkgAgADIAEBCyABAAMgAQELIAEAAyAFAQMgBQAHIAEBAyABAAsgBQAF'),
 down: image_read('%%IMG2ABAAEAAFIAUACyABAQMgAQAHIAUBAyAFAAMgAQELIAEAAyABAQsgAQADIAIBCSACAAQgAQEJIAEABSACAQcgAgAGIAEBByABAAcgAgEFIAIACCABAQUgAQAJIAIBAyACAAogAQEDIAEACyACAQEgAgAMIAEBASABAA0gAwAH'),
}
RADIOS=[
 '%%IMG0ABAADgAAB4AYYCAQIBBACEAIQAhACCAQIBAYYAeAAAA=',
 '%%IMG0ABAADgAAB4Af4DhwMDBgGGAYYBhgGDAwOHAf4AeAAAA=',
 '%%IMG0ABAADgAAAAAAAAAAB4APwA/AD8APwAeAAAAAAAAAAAA=',
 '%%IMG0ABAADgAAB4Af4D/wP/B/+H/4f/h/+D/wP/Af4AeAAAA=',
].map(image_read)
ICONS=[
 '%%IMG0AAwADAAAAAM8BEPkQBRAFEAUQBRAFEAXf/AAAA==',
 '%%IMG0AAwADAABHwERgRFBEeEQIRAhECEQIRAhH+AAAA==',
 '%%IMG0AAwADAAAAgAGQA4jPqM+oz6gDiAGQAIAAAAAAA==',
 '%%IMG0AAwADAABH4EfwAHBH8M/wznDOcM5wz/hH+AAAA==',
 '%%IMG0AAwADAAAAgAFAAiBEEIjpERSLiEScAnwBWACAA==',
 '%%IMG0AAwADAAAAAEf4RShF6EUoRShF6EQoR/gAAAAAA==',
 '%%IMG0AAwADAABFUIqoRVCKqEVQiqhFUIqoRVCKqAAAA==',
 '%%IMG0AAwADAAAAAAAIABgAMRBhmMDNgEcAAgAAAAAAA==',
].map(image_read)
ICON={dir:0,doc:1,sound:2,font:3,app:4,lil:5,pat:6,chek:7,none:8}
PANGRAM='How razorback jumping-frogs can level six piqued gymnasts.'

// State

let uimode='interact', uicursor=0, enable_gestures=0, profiler=0
is_fullscreen=_=>(document.fullscreenElement||document.webkitFullscreenElement)!=null
toggle_fullscreen=_=>{
 if(is_fullscreen()){
  if(document.exitFullscreen)document.exitFullscreen()
  if(document.webkitExitFullscreen)document.webkitExitFullscreen()
 }else{
  const e=q('body'), o={navigationUI:'hide'}
  if(e.requestFullscreen)e.requestFullscreen(o)
  if(e.webkitRequestFullscreen)e.webkitRequestFullscreen(o)
 }setTimeout(resize,500)
}
set_fullscreen=x=>{
 const i=is_fullscreen()
 if(i&&!x){toggle_fullscreen()}
 else if(!i&&x){modal_enter('fullscreen_lil')}
}
setmode=mode=>{
 n_play([NONE,lms('loop')])
 grid_exit(),field_exit(),bg_end_selection(),bg_end_lasso(),ob.sel=[],wid.active=-1,sc.others=[],dr.poly=[]
 msg.next_view   =(uimode!=mode)&&mode=='interact'
 msg.pending_loop=(uimode!=mode)&&mode=='interact'
 uimode=mode;if(mode!='interact')msg.pending_halt=1;if(mode!='draw')dr.fatbits=0
}

event_state=_=>({ // event state
 mu:0,md:0, clicktime:0,click:0,rdown:0,rup:0, dclick:0, clicklast:0,
 drag:0, tab:0, shift:0, alt:0, action:0, dir:0, exit:0, eval:0, scroll:0, hidemenu:0,
 pos:rect(), dpos:rect(), rawpos:rect(), rawdpos:rect(), shortcuts:{},
 callback:null, callback_rect:null, callback_drag:0
})
let ev=event_state()
over=r=>rin(r,ev.pos)
dover=r=>rin(r,ev.dpos)

wid_state=_=>({ // widget state
 active:0,count:0, scrolls:0,thumbid:0,thumbo:0, col_drag:0,col_num:0,col_orig:0,
 ingrid:0,g:null,gt:null,gv:null,pending_grid_edit:0,
 infield:0,f:null,ft:null,fv:null,field_dirty:0,change_timer:0,
 cursor:rect(),cursor_timer:0,
 hist:[],hist_cursor:0,
})
let wid=wid_state()
let ms={ // modal state
 type:null,subtype:null,in_modal:0,edit_json:0,old_wid:null,
 filter:0, grid:null,grid2:null, text:null,name:null,form0:null,form1:null,form2:null,
 desc:'',path:'',filter:'', message:null,verb:null, cell:rect(),
 from_listener:0,from_action:0, act_go:0,act_card:0,act_gomode:0,act_trans:0,act_transo:0,act_sound:0,
 time_curr:0,time_end:0,time_start:0, carda:null,cardb:null,trans:null,canvas:null,
}
let msg={ // interpreter event messages
 pending_drag:0,pending_halt:0,pending_view:0,pending_loop:0,next_view:0,overshoot:0,
 target_click:null,target_drag:null,target_release:null,target_order:null,target_run:null,target_link:null,target_change:null,target_navigate:null,
 arg_click:rect(),arg_drag:rect(),lastdrag:rect(),arg_release:rect(),arg_order:null,arg_run:null,arg_link:null,arg_change:null,arg_navigate:null,
}
let li={hist:[],vars:{},scroll:0} // listener state
let ob={sel:[],show_bounds:1,show_names:0,show_cursor:0,move:0,move_first:0,resize:0,resize_first:0,handle:-1,prev:rect(),orig:rect()} // object editor state
let sc={target:null,others:[],next:null, f:null,prev_mode:null,xray:0,status:''} // script editor state
script_save=x=>{const k=lms('script');mark_dirty();if(sc.target)iwrite(sc.target,k,x);if(sc.others)sc.others.map(o=>iwrite(o,k,x))}

draw_state=_=>({ // drawing tools state
 tool:'pencil',brush:3,pattern:1,fill:0,erasing:0, dither_threshold:0,
 show_widgets:1,show_anim:1,trans:0,trans_mask:0,fatbits:0,offset:rect(),
 show_grid:0,snap:0,grid_size:rect(32,32), sel_here:rect(),sel_start:rect(),limbo:null,limbo_dither:0,
 scratch:null,mask:null,omask:null, pickfill:0, poly:[]
})
let dr=draw_state()
settool=tool=>{setmode('draw'),dr.tool=tool}
bg_pat=_=>(dr.trans_mask&&dr.pattern==0)?32:dr.pattern
bg_fill=_=>(dr.trans_mask&&dr.fill==0)?32:dr.fill
bg_has_sel=_=>dr.tool=='select'&&(dr.sel_here.w>0||dr.sel_here.h>0)
bg_has_lasso=_=>dr.tool=='lasso'&&dr.mask!=null
sint=(x,a)=>a*(0|((0|(x+a/2))/a))
snap=p=>!dr.snap?p:rect(sint(p.x,dr.grid_size.x),sint(p.y,dr.grid_size.y),p.w,p.h) // position only
snapr=r=>rpair(snap(r),snap(rect(r.w,r.h))) // position + dimensions
snap_delta=p=>{const a=snap(p);return rect(a.x-p.x,a.y-p.y)}
fat_offset=p=>{const d=rect(frame.size.x/FAT,frame.size.y/FAT);dr.offset=rint(rect(p.x-d.x/2,p.y-d.y/2))}
fat_clip=_=>dr.fatbits?rint(rect(dr.offset.x,dr.offset.y,frame.size.x/FAT,frame.size.y/FAT)): frame.clip
fat_to_card=a=>rint(rect((a.x/FAT)+dr.offset.x,(a.y/FAT)+dr.offset.y))
card_to_fat=a=>dr.fatbits?rect((a.x-dr.offset.x)*FAT,(a.y-dr.offset.y)*FAT,a.w*FAT,a.h*FAT):a
mark_dirty=_=>{dirty=1}

let au={target:null,mode:'stopped', head:0,sel:rect(), hist:[],hist_cursor:0, clip:null,tick:null, record_stream:null,norecord:0} // audio editor state
byte_to_sample=b=>(b<<24>>24)/128
sample_to_byte=s=>0xFF&clamp(-127,s*128,127)

// Menus

const menu={heads:[],items:[],x:0,active:-1,stick:-1,lw:-1,sz:rect()}
no_menu=_=>menu.active==-1&&menu.stick==-1
in_layer=_=>no_menu()&&(ms.type?ms.in_modal:1)&&((!running()&&!msg.overshoot)||ms.type!=null)
in_widgets=_=>ms.type!=null?ms.in_modal:1
menus_off=_=>lb(ifield(deck,'locked'))||(uimode=='draw'&&ev.hidemenu&&ms.type==null)
menu_head=(name,enabled,t,b)=>({name,enabled,t,b}) // string,bool,rect,rect
menu_entry=(name,enabled,check,shortcut,t,b)=>({name,enabled,check,shortcut,t,b}) // string,bool,bool,char,rect,rect
menus_clear=_=>(menu.active=-1,menu.stick=-1)
menu_setup=_=>(menu.x=10,menu.heads=[],menu.sz=rect(),menu.active=-1)
menu_bar=(name,enabled)=>{
 if(menus_off())enabled=0
 const t=rpair(rect(menu.x,2),font_textsize(FONT_MENU,name)), b=rect(t.x-5,0,t.w+10,t.h+3), i=menu.heads.length
 menu.heads.push(menu_head(name,enabled,t,b)), menu.x=b.x+b.w+5
 if(ev.click&&enabled&&over(b)){ev.mu=0;if(menu.stick==-1)menu.stick=i}
 if(menu.stick!=-1&&enabled&&over(b))menu.stick=i,menu.lw=0
 if(menu.stick==-1){
  if(ev.drag&&enabled&&over(b)&&ev.dpos.y<b.h)ev.dpos=ev.pos,menu.lw=0
  if((ev.drag||ev.mu)&&enabled&&rin(b,ev.dpos))menu.active=i
 }if(i==menu.active||i==menu.stick)menu.sz=rect(b.x,b.h,max(b.w,menu.lw),0),menu.items=[]
 if(ev.md&&over(b)&&enabled)ev.md=0
}
shortcut_w=c=>!c?0: 10+font_textsize(FONT_MENU,'^'+c).x
menu_check=(name,enabled,check,shortcut,func)=>{
 const sc=enabled&&shortcut&&ev.shortcuts[shortcut]; if(sc)delete ev.shortcuts[shortcut];
 if(menu.heads.length-1!=menu.active&&menu.heads.length-1!=menu.stick)return sc
 const t=name?rpair(rect(menu.sz.x+5+8,menu.sz.y+menu.sz.h+2),font_textsize(FONT_MENU,name)): rect(menu.sz.x,menu.sz.y+menu.sz.h+2,1,1)
 if(shortcut)t.w+=shortcut_w(shortcut)
 const b=rect(menu.sz.x,menu.sz.y+menu.sz.h,max(menu.sz.w,t.w+10+8),t.h+4)
 menu.items.push(menu_entry(name,enabled,check,shortcut,t,b)), menu.sz=runion(menu.sz,b)
 if(enabled&&over(b)&&func)ev.callback=func,ev.callback_rect=rcopy(b),ev.callback_drag=1
 return sc||(enabled&&ev.mu&&over(b))
}
menu_item=(name,enabled,shortcut,func)=>menu_check(name,enabled,-1,shortcut,func)
menu_separator=_=>menu_check(0,0,0,0,0)
menu_finish=_=>{
 if(menus_off())return
 const b=rect(0,0,context.size.x,3+font_h(FONT_MENU)); draw_rect(b,32),draw_hline(0,b.w,b.h,1); const pal=deck.patterns.pal.pix
 menu.heads.map((x,i)=>{
  let a=x.enabled&&(over(x.b)||i==menu.stick||i==menu.active);if(ev.drag&&!dover(b))a=0
  draw_text(x.t,x.name,FONT_MENU,x.enabled?1:13);if(a)draw_invert(pal,x.b)
 })
 if(!menu.sz.w)return
 draw_shadow(menu.sz,1,32,1);menu.lw=0;let sw=0;menu.items.map(x=>{menu.lw=max(menu.lw,x.b.w),sw=max(sw,shortcut_w(x.shortcut))})
 menu.items.map(x=>{
  const o=over(x.b)&&x.name&&x.enabled
  if(x.name){draw_text(x.t,x.name,FONT_MENU,x.enabled?1:13)}else{draw_rect(rect(x.t.x+2,x.t.y,menu.sz.w-5,1),19)}
  if(x.check==1)draw_icon(rect(menu.sz.x+2,x.t.y+3),CHECK,x.enabled?1:13)
  if(x.shortcut)draw_text(rect(menu.sz.x+menu.sz.w-3-sw+10,x.t.y),'^'+x.shortcut,FONT_MENU,x.enabled?1:13)
  if(o)draw_invert(pal,inset(x.b,1))
 });if(ev.mu)menu.stick=-1
}

// Widgets

widget_setup=_=>{
 if(ev.mu||wid.active==-1)wid.col_drag=0;if(wid.active>=wid.count)wid.active=0
 if((uimode=='interact'||ms.type!=null)&&ev.tab&&wid.count&&!(wid.infield&&wid.f.style=='code')){
  if(wid.ingrid)grid_exit()
  if(wid.infield)field_exit()
  wid.active+=ev.shift?-1:1
  if(wid.active<0)wid.active+=wid.count;wid.cursor=rect()
 }
 if(uimode!='interact'&&uimode!='script'&&ms.type==null){
  if(wid.ingrid ||wid.gv!=null)grid_exit()
  if(wid.infield||wid.fv!=null)field_exit()
  wid.active=-1
 }wid.count=0,wid.scrolls=0,wid.ingrid=0,wid.infield=0
}

scrollbar=(r,n,line,page,scroll,visible,inverted)=>{
 const addscroll=x=>scroll=clamp(0,scroll+x,n)
 addscroll(0);const sz=ARROWS[0].size.x+2, fcol=!in_layer()?13:inverted?32:1, bcol=inverted?1:32
 const b=rect(r.x+r.w-sz-2,r.y,sz+2,r.h), rr=rect(r.x+1,r.y,visible?r.w-b.w-1:r.w-2,r.h-2), pal=deck.patterns.pal.pix
 let dragging_thumb=(wid.thumbid==wid.scrolls++)&&dover(b)
 if(visible){
  draw_box(b,0,fcol)
  arrow=(bb,base,dir)=>{
   const a=n>0&&over(bb)&&!dragging_thumb, o=a&&(ev.mu||ev.drag)&&dover(r)
   draw_box(bb,0,fcol),draw_icon(rect(bb.x+2,bb.y+2),ARROWS[base+(o?2:0)],fcol)
   if(o&&ev.md)addscroll(line*dir);if(a&&!ev.drag)uicursor=cursor.point
  }
  arrow(rect(b.x,b.y         ,sz+2,sz+2),0,-1)
  arrow(rect(b.x,b.y+b.h-sz-2,sz+2,sz+2),1, 1)
  if(n<=0||!in_layer())return {size:rr,scroll}
  const s=rect(b.x+1,b.y+sz+2,b.w-2,b.h-2*(sz+2));draw_rect(s,inverted?9:12)
  const thumb_height=0|max(16,s.h/(1+n)), thumb_y=0|((s.h-thumb_height)*(scroll/n)), thumb=rect(s.x,s.y+thumb_y,s.w,thumb_height)
  if(in_layer()&&ev.md&&over(thumb)){wid.thumbid=wid.scrolls-1,wid.thumbo=ev.dpos.y-thumb.y,dragging_thumb=1}
  if(in_layer()&&ev.drag&&dragging_thumb){
   const capped=max(s.y,min(s.y+s.h-thumb.h,ev.pos.y-wid.thumbo))-s.y
   thumb.y=capped+s.y,scroll=max(0,0|min((capped/(s.h-thumb_height))*n,n)),uicursor=cursor.drag
  }
  if(in_layer()&&ev.mu&&dragging_thumb)wid.thumbid=-1
  draw_rect(thumb,bcol),draw_box(thumb,0,fcol)
  inner=(bb,dir)=>{
   if(!dragging_thumb&&over(bb))uicursor=cursor.point
   if(!dragging_thumb&&ev.mu&&over(bb))draw_invert(pal,bb),addscroll(page*dir)
  }
  if(thumb_y>0          )inner(rect(s.x,s.y                ,s.w,     thumb_y         ),-1)
  if(thumb_y+thumb.h<s.h)inner(rect(s.x,s.y+thumb_y+thumb.h,s.w,s.h-(thumb_y+thumb.h)), 1)
 }
 if(in_layer()&&over(runion(r,b))&&ev.scroll)addscroll(ev.scroll*line)
 return {size:rr,scroll}
}

widget_button=(target,x,value,func)=>{
 const l=x.locked||!in_layer(), pal=deck.patterns.pal.pix, font=x.font||FONT_MENU;let b=x.size
 const fcol=l?13:x.show=='invert'?32:1, bcol=x.show=='invert'?1:32, scol=x.show=='invert'?32:1
 const sel=!l&&x.show!='none'&&x.style!='invisible'&&wid.active==wid.count
 const a=!l&&dover(b)&&over(b), cs=sel&&!func&&ev.action, cl=cs||((ev.md||ev.drag)&&a), cr=cs||(ev.mu&&a)
 if(func&&a){ev.callback=func,ev.callback_rect=rcopy(b)}
 if(!l&&over(b)&&!ev.drag)uicursor=cursor.point
 if(x.show=='none')return cr; let ar=inset(b,2)
 if(x.style=='round'){
  draw_boxr(b,fcol,bcol,x.show!='transparent')
  draw_textc(inset(b,3),x.text,font,fcol)
  if(sel)draw_box(ar,0,13);if(cl)draw_invert(pal,ar)
 }
 if(x.style=='rect'){
  if(cl){b=rect(b.x+1,b.y+1,b.w-1,b.h-1),ar=rect(ar.x+1,ar.y+1,ar.w-1,ar.h-1);if(x.show!='transparent')draw_rect(b,bcol);draw_box(b,0,fcol)}
  else  {b=rect(b.x  ,b.y  ,b.w-1,b.h-1),ar=rect(ar.x  ,ar.y  ,ar.w-1,ar.h-1);draw_shadow(b,fcol,bcol,x.show!='transparent')}
  draw_textc(inset(b,3),x.text,font,fcol);if(sel)draw_box(ar,0,13)
 }
 if(x.style=='check'||x.style=='radio'){
  if(x.show!='transparent')draw_rect(b,bcol)
  const ts=font_textsize(font,x.text), cdim=(x.style=='check'?CHECKS[0]:RADIOS[0]).size, bh=max(ts.y,cdim.y)
  const br=rect(b.x,b.y+(0|((b.h-bh)/2)),b.w,bh), to=rclip(b,rect(br.x+cdim.x,0|(br.y+(br.h-ts.y)/2),b.w-cdim.x,ts.y))
  draw_rect(rect(br.x+1,br.y+1,cdim.x-4,cdim.y-3),bcol)
  if(x.style=='check'){draw_icon(rect(br.x,br.y),CHECKS[(value^(cl||cr))+2*x.locked],scol)}
  else{const p=rect(br.x,br.y);draw_icon(p,RADIOS[3],bcol),draw_icon(p,RADIOS[cl||cr?1:0],fcol);if(value)draw_icon(p,RADIOS[2],fcol)}
  draw_text_fit(to,x.text,font,fcol);ar=to;if(sel)draw_box(rect(to.x-2,to.y-1,to.w+2,to.h+2),0,13);if(cl)draw_invert(pal,ar)
 }
 if(x.style=='invisible'){draw_textc(inset(b,3),x.text,font,fcol);if(cl)draw_invert(pal,ar)}
 if(target&&cr)msg.target_click=target
 if(!x.locked&&in_widgets())wid.count++
 return cr
}

widget_slider=(target,x)=>{
 const l=x.locked||!in_layer(), pal=deck.patterns.pal.pix, font=x.font||FONT_MENU
 let b=x.size, fcol=l?13:x.show=='invert'?32:1, bcol=x.show=='invert'?1:32, bpat=x.show=='invert'?9:12
 const sel=!l&&x.show!='none'&&wid.active==wid.count, ov=x.value
 if(x.show=='none')return
 const t=ls((x.style=='bar'||x.style=='compact')?dyad.format(lms(x.format),lmn(x.value)):lms(''))
 const oc=frame.clip; frame.clip=rclip(b,frame.clip)
 const hv_btn=(bb,dir,ba)=>{
  const a=!l&&over(bb), o=a&&(ev.mu||ev.drag)&&dover(bb)
  if(o&&ev.md)x.value+=(dir*x.step); if(a)uicursor=cursor.point
  draw_rect(bb,bcol),draw_box(bb,0,fcol),draw_icon(rint(rect(bb.x+(bb.w-12)/2,bb.y+(bb.h-12)/2)),ARROWS[ba+(o?2:0)],fcol)
 }
 const hv_tsz=(axis,tf,av,as)=>{
  let drag=(wid.thumbid==wid.scrolls++)&&dover(b),
  n=0|((x.max-x.min)/x.step), ts=0|max(16,axis/(1+n)), tp=0|(((x.value-x.min)/max(1,(x.max-x.min)))*(axis-ts)), thumb=rint(tf(tp,ts))
  if(!l){
   if(ev.md&&over(thumb))wid.thumbid=wid.scrolls-1,wid.thumbo=ev.dpos[av]-thumb[av],drag=1
   if(ev.drag&&drag){
    const capped=max(b[av],min(b[av]+b[as]-thumb[as],ev.pos[av]-wid.thumbo))-b[av]
    thumb[av]=capped+b[av],uicursor=cursor.drag,x.value=x.min+capped*((x.max-x.min)/(b[as]-ts))
   }if(ev.mu&&drag)wid.thumbid=-1
  }draw_rect(thumb,bcol),draw_box(thumb,0,fcol);return {drag,thumb}
 }
 const hv_gap=(drag,bb,dir)=>{if(!l&&!drag&&over(bb)){uicursor=cursor.point;if(ev.mu)draw_invert(pal,bb),x.value+=(dir*10*x.step);}}
 if(x.style=='horiz'||x.style=='vert'){if(x.show!='transparent')draw_rect(b,bpat);draw_box(b,0,sel?13:fcol)}
 if(x.style=='horiz'){
  hv_btn(rect(b.x,b.y,16,b.h),-1,4),hv_btn(rect(b.x+b.w-16,b.y,16,b.h),1,5),b=rect(b.x+16,b.y+1,b.w-32,b.h-2)
  const a=hv_tsz(b.w,(tp,ts)=>rect(b.x+tp,b.y,ts,b.h),'x','w'), drag=a.drag, thumb=a.thumb
  hv_gap(drag,rect(b.x,b.y,thumb.x-b.x,b.h),-1),hv_gap(drag,rect(thumb.x+thumb.w,b.y,b.w-(thumb.x+thumb.w-b.x),b.h),1)
 }
 if(x.style=='vert'){
  hv_btn(rect(b.x,b.y,b.w,16),-1,0);hv_btn(rect(b.x,b.y+b.h-16,b.w,16),1,1),b=rect(b.x+1,b.y+16,b.w-2,b.h-32)
  const a=hv_tsz(b.h,(tp,ts)=>rect(b.x,b.y+tp,b.w,ts),'y','h'), drag=a.drag, thumb=a.thumb
  hv_gap(drag,rect(b.x,b.y,b.w,thumb.y-b.y),-1),hv_gap(drag,rect(b.x,thumb.y+thumb.h,b.w,b.h-(thumb.y+thumb.h-b.y)),1)
 }
 if(x.style=='bar'){
  fcol=x.locked?(x.show=='invert'?32:1):fcol
  if(x.show!='transparent')draw_rect(b,bcol);draw_box(b,0,sel?13:fcol)
  b=inset(b,2),draw_textc(b,t,font,fcol);if(!l&&over(b))uicursor=cursor.point
  const f=(x.max==x.min)?0:((x.value-x.min)/(x.max-x.min))*b.w;draw_invert(pal,rect(b.x,b.y,0|f,b.h))
  if(!l&&dover(b)&&(ev.md||ev.drag)){x.value=x.min+(ev.pos.x-b.x)*((x.max-x.min)/b.w),uicursor=cursor.drag}
 }
 if(x.style=='compact'){
  if(x.show=='transparent')draw_rect(rect(b.x+1,b.y+1,13,b.h-2),bcol),draw_rect(rect(b.x+b.w-14,b.y+1,13,b.h-2),bcol)
  draw_boxr(b,fcol,bcol,x.show!='transparent'),draw_textc(rect(b.x+14,b.y,b.w-28,b.h),t,font,fcol)
  const comp_btn=(xo,dir,ba,li)=>{
   const bb=rect(b.x+xo,b.y,14,b.h), a=!l&&over(bb), o=a&&(ev.mu||ev.drag)&&dover(bb)
   if(o&&ev.md)x.value+=(dir*x.step); if(a)uicursor=cursor.point
   draw_icon(rect(bb.x+1,0|(b.y+(b.h-12)/2)),ARROWS[ba+(o?2:0)],fcol),draw_vline(bb.x+li,b.y+1,b.y+b.h-1,sel?13:fcol)
  };comp_btn(0,-1,4,13),comp_btn(b.w-14,1,5,0)
 }
 if(sel&&ev.dir=='up')x.value-=x.step;if(sel&&ev.dir=='down')x.value+=x.step
 if(in_layer()&&over(frame.clip)&&ev.scroll)x.value+=x.step*ev.scroll; x.value=slider_normalize(target,x.value)
 if(target&&Math.abs(ov-x.value)>(x.step/2)){msg.target_change=target,msg.arg_change=lmn(x.value);iwrite(target,lms('value'),msg.arg_change),mark_dirty()}
 if(!x.locked&&in_widgets())wid.count++
 frame.clip=oc
}

widget_canvas=(target,x,image)=>{
 if(x.show=='none')return; const b=x.size, pal=deck.patterns.pal.pix
 if(x.show=='solid'){if(image){draw_scaled(b,image,1)}else{draw_rect(b,0)}}
 if(image&&x.show=='transparent')draw_scaled(b,image,0)
 if(image&&x.show=='invert')draw_invert_scaled(pal,b,image)
 if(x.border){if(x.show=='invert'){draw_boxinv(pal,b)}else{draw_box(b,0,1)}}
 if(!target||!in_layer())return
 if(x.draggable){
  const sel=ob.sel.length&&ob.sel[0]==target
  if     (ev.md&&dover(b))msg.target_click  =target,msg.arg_click  =rect(b.x,b.y),ob.sel=[target],ob.prev=rint(rsub(ev.pos,b))
  else if(ev.mu     &&sel)msg.target_release=target,msg.arg_release=rsub(ev.dpos,ob.prev),ob.sel=[]
  else if(ev.drag   &&sel)msg.target_drag   =target,msg.arg_drag   =rsub(ev.dpos,ob.prev)
 }else if(dover(b)){
  const p=rint(rect((ev.pos.x-b.x)/x.scale,(ev.pos.y-b.y)/x.scale)), dp=p.x!=msg.lastdrag.x||p.y!=msg.lastdrag.y, im=over(b)
  if     (ev.md          )msg.target_click  =target,msg.arg_click  =p,msg.lastdrag=p
  else if(ev.mu          )msg.target_release=target,msg.arg_release=p
  else if(ev.drag&&dp&&im)msg.target_drag   =target,msg.arg_drag   =p,msg.lastdrag=p
 }
}

grid_exit=_=>{
 wid.ingrid=0,wid.gv=null,wid.gt=null
 if(wid.hist)wid.hist=[],wid.hist_cursor=0
}
widget_grid=(target,x,value)=>{
 if(x.show=='none')return 0; const hfnt=FONT_BODY, hsize=x.headers?font_h(hfnt)+5:0, showscroll=x.size.h<=(50+hsize)||x.size.w<16?0:x.scrollbar
 const fnt=x.font?x.font:FONT_MONO, os=value.scroll, or=value.row, files=x.headers==2, headers=files||x.size.h<=hsize?0:x.headers
 const tk=Object.keys(value.table.v), nr=count(value.table), nc=tk.length, rh=font_h(fnt)+(x.lines?5:3)
 const fcol=!in_layer()?13:x.show=='invert'?32:1, bcol=x.show=='invert'?1:32, b=x.size, pal=deck.patterns.pal.pix
 let sel=in_layer()&&x.show!='none'&&wid.active==wid.count
 if(in_layer()&&dover(b)&&(ev.md||ev.mu||ev.drag)){if(!sel&&wid.gv)grid_exit(); wid.active=wid.count,sel=1}
 if(sel&&in_layer()&&!over(b)&&ev.md)sel=0,wid.active=-1,grid_exit()
 if(sel){if(wid.fv)field_exit();wid.ingrid=1,wid.g=x,wid.gv=value,wid.gt=target}; if(x.show!='transparent')draw_rect(b,bcol)
 const bh=rect(b.x,b.y,b.w,headers?font_h(hfnt)+5:0), nrd=0|min(nr,((b.h-bh.h+1)/rh)), scrollmax=nr-nrd
 const sbar=scrollbar(rect(b.x,b.y+(headers?bh.h-1:0),b.w,b.h-(headers?bh.h-1:0)),scrollmax,1,nrd,value.scroll,showscroll,x.show=='invert')
 const bb=sbar.size; value.scroll=sbar.scroll, hwt=x.widths.reduce((x,y)=>x+y,0)
 draw_box(x.lines?b:rect(b.x,bb.y,b.w,b.h-(bb.y-b.y)),0,sel?13:fcol)
 const cw=n=>0|(n>=x.widths.length?((bb.w-hwt)/(nc-x.widths.length)):x.widths[n])
 if(x.lines)draw_rect(bh,fcol);if(nc<=0)draw_textc(inset(bb,1),'(no data)',hfnt,fcol)
 for(let z=0,cols=0,cx=0;z<nc&&cx+cw(cols)<=bb.w;z++){
  const hs=rect(bh.x+4+cx,bh.y+1,cw(cols)-5,bh.h-2)
  if(headers){
   draw_textc(hs,tk[z],hfnt,x.lines?bcol:fcol)
   const oa=target&&in_layer()&&over(hs)&&((ev.drag||ev.mu)?dover(hs):1)&&!wid.col_drag
   if(oa&&(ev.md||ev.drag))draw_invert(pal,hs); if(oa&&!ev.drag)uicursor=cursor.point
   if(oa&&ev.mu)msg.target_order=target,msg.arg_order=lms(tk[z])
  }
  if(cols&&x.lines)draw_invert(pal,rect(hs.x-3,b.y+1,1,b.h-2));cx+=cw(cols),cols++
  for(let y=0;y<nrd;y++){
   const cell=rect(hs.x-3,bb.y+rh*y+1,hs.w+5,rh-1), v=value.table.v[tk[z]][y+value.scroll]
   const cf=ls(dyad.format(lms(`%${x.format[z]=='L'?'s':(x.format[z]||'s')}`),v)), ip=rcenter(cell,ICONS[0].size)
   const oc=frame.clip; frame.clip=rclip(cell,frame.clip)
   if     (x.format[z]=='I'){const i=clamp(0,ln(v),8);if(i<8)draw_icon(ip,ICONS[i],fcol)}
   else if(x.format[z]=='B'){if(lb(v))draw_icon(ip,ICONS[ICON.chek],fcol)}
   else{draw_text_fit(rect(hs.x+1,bb.y+rh*y,hs.w-2,rh),cf,fnt,fcol)}
   frame.clip=oc
   if(sel&&ev.dclick&&!x.locked&&over(cell)){
    const f=x.format[z]||'s', tc=rect(z,y+value.scroll)
    if     (f=='I'||f=='L'){} // no editing allowed
    else if(f=='B'||f=='b'){grid_edit_cell(tc,lmn(!lb(v)))} // toggle
    else{wid.pending_grid_edit=1,ms.cell=tc,ms.text=fieldstr(lms(cf))}
   }
  }
 }
 if(!x.locked&&in_layer()&&target)for(let z=0,cx=bh.x;z<nc;cx+=cw(z),z++){
  const h=rect(cx+cw(z)-1,bh.y,5,bh.h);if(h.x+h.w>b.x+b.w)break
  if(over(h))draw_vline(h.x+2,h.y,h.y+h.h,13)
  if(ev.md&&dover(h))wid.col_drag=1,wid.col_num=z,wid.col_orig=cw(z)
  if(sel&&wid.col_drag&&wid.col_num==z&&ev.drag){
   const s=min(max(10,wid.col_orig+(ev.pos.x-ev.dpos.x)),bb.w-10),i=z;uicursor=cursor.drag
   iwrite(target,lms('widths'),lml(range(max(x.widths.length,i+1)).map(z=>lmn(i==z?s:cw(z))))),mark_dirty()
  }
 }
 const rowb=n=>rect(bb.x,bb.y+rh*n,bb.w,rh)
 const rowh=n=>inset(rect(bb.x+1,bb.y+rh*n+2,bb.w-2,rh-3),x.lines?0:-1)
 let clicked=0,rsel=0;for(let y=0;y<nrd;y++){
  if(y&&x.lines)draw_hline(bb.x,bb.x+bb.w,bb.y+rh*y,fcol); const ra=in_layer()&&over(bb)&&over(rowb(y))
  if(ra&&(ev.md||ev.drag))draw_invert(pal,rowh(y)),rsel=1; if(ra&&ev.mu)clicked=1,value.row=y+value.scroll; if(ra&&!ev.drag)uicursor=cursor.point
 }
 const rr=value.row-value.scroll;if(!rsel&&rr>=0&&rr<nrd)draw_invert(pal,rowh(rr))
 if(target&&os!=value.scroll)iwrite(target,lms('scroll'),lmn(value.scroll)),mark_dirty()
 if(target&&or!=value.row)iwrite(target,lms('row'),lmn(value.row)),mark_dirty()
 if(target&&clicked)msg.target_click=target,msg.arg_click=rect(0,value.row)
 if(in_widgets())wid.count++
 return files?((clicked&&ev.dclick)||(sel&&ev.action)): clicked
}
grid_format=_=>lms(wid.g.format.length?wid.g.format:'s'.repeat(Object.keys(wid.gv.table.v).length))
grid_apply=v=>{
 wid.gv.table=v,wid.gv.row=-1;if(!wid.gt)return
 iwrite(wid.gt,lms('value'),v),iwrite(wid.gt,lms('row'),lmn(-1)),mark_dirty()
 msg.target_change=wid.gt,msg.arg_change=v
}
grid_undo=_=>{const x=wid.hist[--(wid.hist_cursor)];grid_apply(x[0])}
grid_redo=_=>{const x=wid.hist[(wid.hist_cursor)++];grid_apply(x[1])}
grid_edit=v=>{wid.hist=wid.hist.slice(0,wid.hist_cursor),wid.hist.push([wid.gv.table,v]),grid_redo()}
grid_deleterow=_=>grid_edit(dyad.drop(lml([lmn(wid.gv.row)]),wid.gv.table))
grid_insertrow=_=>{
 const f=grid_format(), x=wid.gv.table.v, r={}, s=wid.gv.row+1
 Object.keys(x).map((k,col)=>{r[k]=range(x[k].length+1).map(i=>(i==s)?('sluro'.indexOf(f[col])>=0?lms(''):NONE): x[k][i-(i>=s?1:0)])})
 grid_edit(lmt(r))
}
grid_edit_cell=(cell,v)=>{
 const r={};Object.keys(wid.gv.table.v).map((k,i)=>{r[k]=wid.gv.table.v[k].slice(0);if(i==cell.x)r[k][cell.y]=v})
 grid_edit(lmt(r))
}
grid_keys=(code,shift)=>{
 const fnt=wid.g.font?wid.g.font:FONT_MONO, hfnt=FONT_BODY;let m=0, nr=count(wid.gv.table), r=wid.gv.row
 const rh=font_h(fnt)+5, bh=wid.g.headers?font_h(hfnt)+5:0, nrd=min(nr,0|((wid.g.size.h-bh+1)/rh))
 if(code=='ArrowUp'  ){m=1;if(r==-1){r=0}else{r-=1}}
 if(code=='ArrowDown'){m=1;if(r==-1){r=0}else{r+=1}}
 if(code=='PageUp'   ){m=1;if(r==-1)r=0;r-=nrd}
 if(code=='PageDown' ){m=1;if(r==-1)r=0;r+=nrd}
 if(code=='Home'     ){m=1,r=0}
 if(code=='End'      ){m=1,r=nr-1}
 if(code=='Backspace'||code=='Delete')grid_deleterow()
 if(!m)return
 wid.gv.row=r=max(0,min(r,nr-1));if(wid.gt){iwrite(wid.gt,lms('row'),lmn(r)),mark_dirty(),msg.target_click=wid.gt,msg.arg_click=rect(0,r)}
 const os=wid.gv.scroll;if(r-os<0)wid.gv.scroll=r;if(r-os>=nrd)wid.gv.scroll=r-(nrd-1)
 if(wid.gt&&os!=wid.gv.scroll)iwrite(wid.gt,lms('scroll'),lmn(wid.gv.scroll)),mark_dirty()
}

layout_index=(x,p)=>{
 for(let z=0;z<x.lines.length;z++){
  const l=x.lines[z].pos  ;if(p.y>l.y+l.h)continue
  const r=x.lines[z].range;if(p.y<l.y    )return r.x
  for(let i=r.x;i<=r.y;i++){const g=x.layout[i].pos;if(p.x<g.x+(g.w/2))return i;}
  return z==x.lines.length-1?x.layout.length: r.y
 }return x.layout.length
}
layout_last=(x,font)=>x.layout.length>0?last(x.layout): {pos:rect(0,0,1,font_h(font)),line:0,char:'\0',font,arg:NONE}
layout_cursor=(x,index,font,f)=>{
 const bw=f.size.w-5-(f.scrollbar?ARROWS[0].size.x+3:0), bx=f.align=='center'?0|(bw/2): f.align==ALIGN.right?bw: 0
 const r=x.layout.length>0?rcopy(x.layout[min(index,x.layout.length-1)].pos):rect(bx,0,1,font_h(font))
 if(index>=x.layout.length){if(layout_last(x,font).char=='\n'){r.x=0,r.y+=r.h}else{r.x+=r.w-1}}
 r.w=1;return r
}
field_change=_=>{
 if(!wid.field_dirty||!wid.ft)return
 iwrite(wid.ft,lms('value'),wid.fv.table),mark_dirty()
 msg.target_change=wid.ft, msg.arg_change=rtext_string(wid.fv.table)
}
field_exit=_=>{field_change();wid.infield=0,wid.fv=null,wid.ft=null,wid.cursor=rect(),wid.field_dirty=0,wid.change_timer=0}
widget_field=(target,x,value)=>{
 if(x.show=='none')return; if(x.size.h<=50||x.size.w<16)x.scrollbar=0
 const l=!in_layer(), fnt=x.font?x.font: x.style=='code'?FONT_MONO: FONT_BODY, b=x.size, pal=deck.patterns.pal.pix
 const fcol=(l&&!x.locked)?13:x.show=='invert'?32:1, bcol=x.show=='invert'?1:32, os=value.scroll
 if(x.show!='transparent')draw_rect(rclip(b,frame.clip),bcol); if(x.border)draw_box(b,0,fcol)
 let bi=inset(b,2);if(x.scrollbar)bi.w-=ARROWS[0].size.x+3
 if(!l&&!x.locked&&over(bi)&&(ev.drag?dover(bi):1))uicursor=cursor.ibeam
 const layout=layout_richtext(deck,value.table,fnt,x.align,bi.w), last=layout_last(layout,fnt), eol=last.char!='\n'?0: last.pos.h
 const sbar=scrollbar(b,max(0,(last.pos.y+last.pos.h+eol)-bi.h),10,bi.h,value.scroll,x.scrollbar,x.show=='invert');value.scroll=sbar.scroll
 let sel=!x.locked&&!l&&wid.active==wid.count
 // find active link (if any)
 let alink=null;if(x.locked&&!sel&&in_layer()&&x.locked&&(ev.md||ev.drag))for(let z=0;z<layout.layout.length;z++){
  const g=layout.layout[z], pos=rcopy(g.pos);if(pos.w<1)continue // skip squashed spaces/newlines
  pos.y-=value.scroll;if(pos.y+pos.h<0||pos.y>bi.h)continue; pos.x+=bi.x, pos.y+=bi.y // coarse clip
  if(lis(g.arg)&&count(g.arg)&&dover(pos)&&over(pos)){alink=g.arg;break}
 }
 if(!x.locked&&!l&&dover(bi)&&(ev.md||ev.mu||ev.drag)){
  const i=layout_index(layout,rect(ev.pos.x-bi.x,ev.pos.y-bi.y+value.scroll))
  if(ev.md){wid.cursor.x=wid.cursor.y=i}else{wid.cursor.y=i}
  if(ev.dclick){ // double-click to select a word or whitespace span:
   let a=0, w=layout.layout.length&&/\s/g.test(layout.layout[min(wid.cursor.y,layout.layout.length-1)].char)
   a=wid.cursor.y;while(a>=0&&a<layout.layout.length&&(w^!/\s/g.test(layout.layout[a].char)))a--;wid.cursor.x=a+1
   a=wid.cursor.y;while(      a<layout.layout.length&&(w^!/\s/g.test(layout.layout[a].char)))a++;wid.cursor.y=a
  }
  const c=layout_cursor(layout,wid.cursor.y,fnt,x);c.y-=value.scroll, ch=min(bi.h,c.h)
  if(c.y<0)value.scroll-=4;if(c.y+ch>bi.h)value.scroll+=clamp(1,(c.y+ch)-bi.h,4) // drag to scroll!
  if(!sel&&wid.fv)field_exit(); wid.active=wid.count,sel=1
 }
 if(sel&&in_layer()&&!over(b)&&ev.md)sel=0,wid.active=-1,field_exit()
 if(sel){if(wid.gv)grid_exit();wid.infield=1,wid.f=x,wid.fv=value,wid.ft=target}
 // render
 const bc=rclip(frame.clip,bi); const oc=frame.clip;frame.clip=bc
 for(let z=0;z<layout.layout.length;z++){
  const g=layout.layout[z], pos=rcopy(g.pos);if(pos.w<1)continue // skip squashed spaces/newlines
  pos.y-=value.scroll;if(pos.y+pos.h<0||pos.y>bc.h)continue; pos.x+=bi.x, pos.y+=bi.y // coarse clip
  if(lis(g.arg)&&count(g.arg)){
   draw_hline(pos.x,pos.x+pos.w,pos.y+pos.h-1,alink==g.arg?fcol:19)
   const a=x.locked&&in_layer()&&over(pos)&&target;if(a&&!ev.drag)uicursor=cursor.point
   if(a&&ev.mu&&dover(pos))msg.target_link=target,msg.arg_link=g.arg
  }
  const csel=sel&&wid.cursor.x!=wid.cursor.y&&z>=min(wid.cursor.x,wid.cursor.y)&&z<max(wid.cursor.x,wid.cursor.y)
  if(csel)draw_rect(rclip(pos,frame.clip),fcol)
  if(image_is(g.arg)){image_paste(pos,frame.clip,g.arg,frame.image,x.show!='transparent');if(csel)draw_invert(pal,pos)}
  else{draw_char(pos,g.font,g.char,csel?bcol:fcol)}
 }
 if(sel&&wid.cursor_timer<FIELD_CURSOR_DUTY){
  const c=layout_cursor(layout,wid.cursor.y,fnt,x);c.y-=value.scroll;c.y+=bi.y,c.x+=bi.x
  draw_invert(pal,rclip(c,frame.clip))
 }
 if(target&&os!=value.scroll)iwrite(target,lms('scroll'),lmn(value.scroll)),mark_dirty()
 frame.clip=oc;if(!x.locked&&in_widgets())wid.count++
}
field_showcursor=_=>{
 const b=wid.f.size, bi=inset(b,2);if(wid.f.scrollbar)bi.w-=ARROWS[0].size.x+3
 const fnt=wid.f.font?wid.f.font: wid.f.style=='code'?FONT_MONO: FONT_BODY
 const layout=layout_richtext(deck,wid.fv.table,fnt,wid.f.align,bi.w), os=wid.fv.scroll
 const c=layout_cursor(layout,wid.cursor.y,fnt,wid.f), ch=min(bi.h,c.h);c.y-=wid.fv.scroll
 if(c.y<0){wid.fv.scroll+=c.y}if(c.y+ch>=bi.h){wid.fv.scroll+=((c.y+ch)-bi.h)}
 if(wid.ft&&os!=wid.fv.scroll)iwrite(wid.ft,lms('scroll'),lmn(wid.fv.scroll)),mark_dirty()
 return layout
}
field_apply=(v,c)=>{
 wid.fv.table=v,wid.cursor=rect(c.x,c.y);if(wid.cursor.x<0)wid.cursor.x=0;if(wid.cursor.y<0)wid.cursor.y=0
 field_showcursor(),wid.field_dirty=1,wid.change_timer=FIELD_CHANGE_DELAY
}
field_undo=_=>{const x=wid.hist[--(wid.hist_cursor)];field_apply(x[0],x[1])}
field_redo=_=>{const x=wid.hist[(wid.hist_cursor)++];field_apply(x[2],x[3])}
field_edit=(font,arg,text,pos)=>{
 const c=rect(), spliced=rtext_splice(wid.fv.table,font,arg,text,pos,c); wid.hist=wid.hist.slice(0,wid.hist_cursor)
 wid.hist.push([
  wid.fv.table,rect(wid.cursor.x,wid.cursor.y), // before
  spliced     ,c                              , // after
 ]),field_redo()
}
field_sel_lines=_=>{
 let a=min(wid.cursor.x,wid.cursor.y),b=max(wid.cursor.x,wid.cursor.y),l=field_showcursor()
 while(a                &&l.layout[a-1].char!='\n')a--
 while(b<l.layout.length&&l.layout[b  ].char!='\n')b++
 return {layout:l,sel:rect(a,b)}
}
field_comment=_=>{
 const s=field_sel_lines(), p=s.sel, layout=s.layout.layout; let ac=1,z=p.x;while(z<p.y){
  while(z<p.y&&layout[z].char==' ')z++
  if   (z<p.y&&layout[z].char!='#')ac=0
  while(z<p.y&&layout[z].char!='\n')z++;z++
 }
 let r='';z=p.x;while(z<p.y){
  while(z<p.y&&layout[z].char==' ')r+=' ',z++
  if(ac){if(layout[z].char=='#'){z++;if(z<p.y&&layout[z].char==' ')z++}}else{r+='# '}
  while(z<p.y&&layout[z].char!='\n')r+=layout[z++].char
  if(z<p.y&&layout[z].char=='\n')r+='\n',z++
 }field_edit(lms(''),lms(''),r,p),wid.cursor=rect(p.x,wid.cursor.y)
}
field_indent=add=>{
 const s=field_sel_lines(), p=s.sel, layout=s.layout.layout; let r='',z=p.x;while(z<p.y){
  if(add){r+=' '}else{if(layout[z].char==' ')z++}
  while(z<p.y&&layout[z].char==' ')r+=' ',z++
  while(z<p.y&&layout[z].char!='\n')r+=layout[z++].char
  if(z<p.y&&layout[z].char=='\n')r+='\n',z++
 }field_edit(lms(''),lms(''),r,p);wid.cursor=rect(p.x,wid.cursor.y)
}
field_stylespan=(font,arg)=>field_edit(font,arg,ls(rtext_string(wid.fv.table,wid.cursor)),wid.cursor)
field_input=text=>{
 if(text=='\n'){if(ms.type=='save')ev.action=1;if(ms.type=='save'||ev.shift)return}
 const rtext_font=(table,x)=>{const i=rtext_get(table,x);return i<0?lms(''):table.v.font[i]}
 field_edit(rtext_font(wid.fv.table,wid.cursor.y),lms(''),clchars(text),wid.cursor)
}
field_keys=(code,shift)=>{
 const b=wid.f.size, bi=inset(b,2);if(wid.f.scrollbar)bi.w-=ARROWS[0].size.x+3
 const fnt=wid.f.font?wid.f.font: wid.f.style=='code'?FONT_MONO: FONT_BODY, layout=layout_richtext(deck,wid.fv.table,fnt,wid.f.align,bi.w)
 let m=0, s=wid.cursor.x!=wid.cursor.y
 const l=wid.cursor.y>=layout.layout.length?layout.lines.length-1:layout.layout[wid.cursor.y].line, c=layout_cursor(layout,wid.cursor.y,fnt,wid.f)
 if(code=='ArrowLeft'   ){m=1;if(s&&!shift){wid.cursor.x=wid.cursor.y=min(wid.cursor.x,wid.cursor.y)}else{wid.cursor.y--}}
 if(code=='ArrowRight'  ){m=1;if(s&&!shift){wid.cursor.x=wid.cursor.y=max(wid.cursor.x,wid.cursor.y)}else{wid.cursor.y++}}
 if(code=='ArrowUp'     ){m=1;if(l>=0)wid.cursor.y=layout_index(layout,rect(c.x-1,layout.lines[l].pos.y                      -1   ))}
 if(code=='ArrowDown'   ){m=1;if(l>=0)wid.cursor.y=layout_index(layout,rect(c.x-1,layout.lines[l].pos.y+layout.lines[l].pos.h+1   ))}
 if(code=='PageUp'      ){m=1;if(l>=0)wid.cursor.y=layout_index(layout,rect(c.x-1,layout.lines[l].pos.y                      -bi.h))}
 if(code=='PageDown'    ){m=1;if(l>=0)wid.cursor.y=layout_index(layout,rect(c.x-1,layout.lines[l].pos.y+layout.lines[l].pos.h+bi.h))}
 if(code=='Home'        ){m=1,wid.cursor.y=0}
 if(code=='End'         ){m=1,wid.cursor.y=layout.layout.length;}
 if(code=='Backspace'   ){field_edit(lms(''),lms(''),'',s?wid.cursor:rect(wid.cursor.y-1,wid.cursor.y))}
 if(code=='Delete'      ){field_edit(lms(''),lms(''),'',s?wid.cursor:rect(wid.cursor.y,wid.cursor.y+1))}
 if(code=='Enter'       ){
  if(shift&&wid.ft){field_change(),msg.target_run=wid.ft,msg.arg_run=rtext_string(wid.fv.table,s?wid.cursor:rect(0,RTEXT_END))}
  else{
   let i=0;if(wid.f.style=='code'){
    const sl=field_sel_lines(),s=sl.sel,layout=sl.layout.layout
    while(s.x<layout.length&&layout[s.x].char==' ')i++,s.x++
   }field_input('\n'+' '.repeat(i))
  }
 }
 if(code=='Tab'&&wid.f.style=='code'){if(!shift&&!s){field_input(' ')}else{field_indent(!shift)}}
 const nl=layout_richtext(deck,wid.fv.table,fnt,wid.f.align,bi.w)
 wid.cursor.y=clamp(0,wid.cursor.y,nl.layout.length); if(!m)return
 wid.cursor_timer=0; if(!shift)wid.cursor.x=wid.cursor.y; field_showcursor()
}

ui_button  =(r,label,    enable,func )=>widget_button(null,{text:label,size:r,font:FONT_MENU,style:'round',show:             'solid',locked:!enable},0,func)
ui_toggle  =(r,label,inv,enable,func )=>widget_button(null,{text:label,size:r,font:FONT_MENU,style:'round',show:inv?'invert':'solid',locked:!enable},0,func)
ui_radio   =(r,label,    enable,value)=>widget_button(null,{text:label,size:r,font:FONT_BODY,style:'radio',show:             'solid',locked:!enable},value)
ui_checkbox=(r,label,    enable,value)=>widget_button(null,{text:label,size:r,font:FONT_BODY,style:'check',show:             'solid',locked:!enable},value)
ui_field   =(r,       value)=>widget_field(null,{size:r,font:FONT_BODY,show:'solid',scrollbar:0,border:1,style:'plain',align:ALIGN.left,locked:0},value)
ui_textedit=(r,border,value)=>widget_field(null,{size:r,font:FONT_BODY,show:'solid',scrollbar:1,border  ,style:'plain',align:ALIGN.left,locked:0},value)
ui_codeedit=(r,border,value)=>widget_field(null,{size:r,font:FONT_MONO,show:'transparent',scrollbar:1,border  ,style:'code' ,align:ALIGN.left,locked:running()},value)
ui_table   =(r,widths,format,value)=>widget_grid(null,{size:r,font:FONT_BODY,widths   ,format   ,headers:2,scrollbar:1,lines:0,show:'solid',locked:1},value)
ui_list    =(r,              value)=>widget_grid(null,{size:r,font:FONT_BODY,widths:[],format:'',headers:0,scrollbar:1,lines:0,show:'solid',locked:1},value)

// The Listener

listen_show=(align,bare,x)=>{
 frame=context;while(li.hist.length>=LISTEN_LINES)li.hist.shift()
 li.hist.push([draw_lil(rsub(LISTEN_SIZE(),rect(18,5)),align,bare,x),x])
 li.scroll=RTEXT_END
}
n_show=(a)=>{if(a.length<2){listen_show(ALIGN.right,0,a[0])}else{listen_show(ALIGN.right,1,lms(a.map(show).join(' ')))};return a[0]}
n_print=(a)=>{if(a.length<2){listen_show(ALIGN.right,1,lms(ls(a[0])))}else{listen_show(ALIGN.right,1,a[0]=dyad.format(a[0],lml(a.slice(1))))}return a[0]}
n_pre_listen=([a])=>{
 const ev=getev();Object.keys(li.vars).map(name=>{if(!ev.v[name])ev.v[name]=li.vars[name]})
 if(ob.sel.length&&uimode=='object')ev.v.selected=lml(ob.sel.slice(0))
 return a
}
n_post_listen=([a])=>{
 const ev=getev();Object.keys(ev.v).map(name=>{li.vars[name]=ev.v[name]})
 li.vars['_']=a,listen_show(ALIGN.right,0,a);return a
}
n_post_query=([a])=>{ms.grid=gridtab(lt(a));return a}

// Audio

let audio=null, samples_playing=0, audio_loop=null, audio_loop_playing=null
const audioContext=window.AudioContext||window.webkitAudioContext, offline=window.OfflineAudioContext||window.webkitOfflineAudioContext
initaudio=_=>{if(!audio)audio=new audioContext({sampleRate:44100})}
load_sound=(file,after)=>{
 decode_sound=data=>{
  const r=[];for(let z=0;z<data.length&&r.length<10*SFX_RATE;z+=8)r.push(sample_to_byte(data[z]));
  if(after){after(sound_make(Uint8Array.from(r)));return;}
  au.target=deck_add(deck,sound_read(ln(0))),mark_dirty()
  sound_edit(sound_make(Uint8Array.from(r))),au.sel=rect(),au.head=0,modal_enter('recording')
 }
 import_sound=buffer=>{
  initaudio(),audio.decodeAudioData(buffer,payload=>{
   const conv=new offline(1,payload.length*64000/payload.sampleRate,64000),buff=conv.createBufferSource()
   conv.oncomplete=e=>{decode_sound(e.renderedBuffer.getChannelData(0))}
   buff.buffer=payload,buff.connect(conv.destination),buff.start(0),conv.startRendering()
  })
 }
 const r=new FileReader();r.onload=_=>import_sound(r.result),r.readAsArrayBuffer(file)
}
sfx_stoploop=_=>{audio_loop_playing.onended=null,audio_loop_playing.stop(),audio_loop=audio_loop_playing=null}
sfx_doloop=clear=>{
 const a=audio_loop||NONE,b=lmblk(),pp=pending_popstate;let r=NONE, quota=LOOP_QUOTA
 blk_get(b,lms('loop')),blk_lit(b,lml([a])),blk_op(b,op.CALL)
 fire_hunk_async(ifield(deck,'card'),b)
 while(quota>0&&running()){runop(),quota--}
 if(!running())r=arg();popstate(),pending_popstate=pp
 if(clear&&audio_loop)sfx_stoploop()
 n_play([r,lms('loop')]),msg.pending_loop=0
}
n_play=([x,hint])=>{
 const prepare=sfx=>{
  const playback=audio.createBuffer(1,sfx.data.length*8,64000),dest=playback.getChannelData(0)
  for(let z=0;z<sfx.data.length;z++)for(let b=0;b<8;b++)dest[z*8+b]=MASTER_VOLUME*byte_to_sample(sfx.data[z])
  const playing=audio.createBufferSource();playing.buffer=playback,playing.connect(audio.destination);return playing
 }
 if(hint&&ls(hint)=='loop'){
  if(lis(x))x=dget(ifield(deck,"sounds"),x)
  if(x&&audio_loop==x){} // don't re-trigger
  else if(sound_is(x)&&ln(ifield(x,'size'))>0){
   if(audio_loop)sfx_stoploop()
   audio_loop=x,audio_loop_playing=prepare(x)
   audio_loop_playing.onended=_=>{sfx_doloop(1)}
   audio_loop_playing.start()
  }
  else if(audio_loop){sfx_stoploop()}
  return NONE
 }
 const sfx=!x?x: sound_is(x)?x: dget(deck.sounds,lms(ls(x)));if(!sfx||ln(ifield(sfx,'size'))<1)return NONE;initaudio()
 const playing=prepare(sfx);playing.addEventListener('ended',_=>{samples_playing--,audio_playing=samples_playing>0})
 playing.start(),samples_playing++,audio_playing=1;return NONE
}
stop_sound_pump=_=>{
 if(au.clip)au.clip.stop();au.clip=null,clearInterval(au.tick),au.mode='stopped'
 au.head=au.sel.x==au.sel.y?0:au.sel.x
}
play_sound_pump=sfx=>{
 initaudio();if(sfx.data.length<1)return
 const playback=audio.createBuffer(1,sfx.data.length*8,64000),dest=playback.getChannelData(0)
 for(let z=0;z<sfx.data.length;z++)for(let b=0;b<8;b++)dest[z*8+b]=MASTER_VOLUME*byte_to_sample(sfx.data[z])
 const playing=audio.createBufferSource();playing.buffer=playback,playing.connect(audio.destination)
 playing.addEventListener('ended',_=>stop_sound_pump),au.clip=playing;let counter=0
 au.tick=setInterval(_=>{const d=0|(8000*0.05);au.head+=d,counter+=d;if(au.mode!='playing'||counter>=sfx.data.length)stop_sound_pump()},50)
 au.mode='playing',playing.start()
}
sfx_any=_=>samples_playing>0

sound_slice=range=>{const r=[];for(let z=range.x;z<range.y;z++)r.push(au.target.data[z]);return sound_make(Uint8Array.from(r))}
sound_selected=_=>sound_slice(au.sel.x==au.sel.y?rect(0,au.target.data.length):au.sel)
sound_apply=v=>{au.target.data=Uint8Array.from(v.data),mark_dirty()}
sound_undo=_=>{const x=au.hist[--(au.hist_cursor)];sound_apply(x[0])}
sound_redo=_=>{const x=au.hist[(au.hist_cursor)++];sound_apply(x[1])}
sound_edit=v=>{au.hist=au.hist.slice(0,au.hist_cursor),au.hist.push([sound_slice(rect(0,au.target.data.length)),v]),sound_redo()}
sound_delete=_=>{
 const len=au.target.data.length, sel=au.sel.x==au.sel.y?rect(0,len):rcopy(au.sel), r=[]
 for(let z=0;z<    sel.x;z++)r.push(au.target.data[z      ])
 for(let z=0;z<len-sel.y;z++)r.push(au.target.data[z+sel.y])
 sound_edit(sound_make(Uint8Array.from(r))),au.head=au.sel.y=au.sel.x
}
sound_replace=s=>{
 r=[]
 for(let z=0       ;z<au.sel.x                                     ;z++)r.push(au.target.data[z])
 for(let z=0       ;z<s        .data.length&&r.length<(10*SFX_RATE);z++)r.push(s        .data[z]);const a=r.length
 for(let z=au.sel.y;z<au.target.data.length&&r.length<(10*SFX_RATE);z++)r.push(au.target.data[z])
 au.sel.y=a,au.head=r.length;return sound_make(Uint8Array.from(r))
}
sound_finish=_=>{
 au.head=(au.sel.x!=au.sel.y)?au.sel.x:0
 sound_undo(),sound_redo(),au.mode='stopped'
}
sound_begin_record=_=>{
 stop_sound_pump(),sound_edit(sound_slice(rect(0,au.target.data.length)))
 if(au.sel.x!=au.sel.y)au.head=au.sel.x;au.mode='recording'
}
sound_record=_=>{
 initaudio();if(au.record_stream){sound_begin_record();return}
 function resample(input,after){
  // Safari refuses to downsample to or play low sample rates,
  // so convert to 64khz as an even multiple of 8khz
  // and discretize from that. messy, but better than nothing:
  const conv=new offline(1,input.length*64000/input.sampleRate,64000), buff=conv.createBufferSource()
  conv.oncomplete=event=>{after(event.renderedBuffer.getChannelData(0))}
  buff.buffer=input,buff.connect(conv.destination),buff.start(0),conv.startRendering()
 }
 navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
  try{
   const source=audio.createMediaStreamSource(stream)
   const scriptNode=audio.createScriptProcessor(4096,1,1)
   scriptNode.onaudioprocess=event=>{
    if(au.mode!='recording')return
    resample(event.inputBuffer,data=>{
     const r=[];for(let z=0;z<data.length;z+=8)r.push(sample_to_byte(data[z]))
     let h=au.head, end=(au.sel.x!=au.sel.y)?au.sel.y:(10*SFX_RATE), edit=au.hist[au.hist_cursor-1][1]
     const appended=min(max(au.target.data.length,h+r.length),end)
     if(appended>au.target.data.length){
      const a=new Uint8Array(appended), b=new Uint8Array(appended)
      for(let z=0;z<appended;z++)a[z]=b[z]=au.target.data[z]
      au.target.data=a,edit.data=b
     }
     for(let z=0;z<r.length&&h<end;z++){au.target.data[h]=edit.data[h]=r[z],h++}
     au.head=h;if(h>=end){sound_finish()}
    })
   }
   source.connect(scriptNode),scriptNode.connect(audio.destination)
   au.record_stream=stream,sound_begin_record()
  }catch(err){console.log(err),au.norecord=1}
 }).catch(err=>{console.log(err),au.norecord=1})
}

// Modal Helpers

table_decode=(text,format)=>ms.edit_json?monad.table(dyad.parse(lms('%j'),text)): n_readcsv(count(format)?[text,format]:[text])
transit_enumerate=_=>monad.table(monad.range(deck.transit))
sounds_enumerate=_=>{
 const r={icon:[],name:[],bytes:[],secs:[]};deck.sounds.v.map((sn,i)=>{
  r.icon .push(lmn(ICON.sound)),r.name.push(deck.sounds.k[i])
  r.bytes.push(dyad.format(lms('%.2fkb'),lmn(ln(ifield(sn,'size'))/1000.0*1.33)))
  r.secs .push(dyad.format(lms('%.2fs' ),ifield(sn,'duration')))
 });return lmt(r)
}
res_enumerate=(source)=>{
 const r={icon:[],name:[],value:[]}
 const pat=source.patterns,pp=patterns_write(pat),pa=anims_write(pat),da=dyad.parse(lms('%j'),lms(DEFAULT_ANIMS))
 if(!match(pa,da)||pp!=DEFAULT_PATTERNS)r.icon.push(lmn(ICON.pat)),r.name.push(lms('patterns')),r.value.push(pat)
 const fonts=dyad.drop(lms('mono'),dyad.drop(lms('menu'),dyad.drop(lms('body'),source.fonts)))
 fonts.v.map((font,i)=>{r.icon.push(lmn(ICON.font)),r.name.push(fonts.k[i]),r.value.push(font)})
 const sounds=source.sounds
 sounds.v.map((sound,i)=>{r.icon.push(lmn(ICON.sound)),r.name.push(sounds.k[i]),r.value.push(sound)})
 const modules=source.modules
 modules.v.map((mod,i)=>{r.icon.push(lmn(ICON.lil)),r.name.push(modules.k[i]),r.value.push(mod)})
 return lmt(r)
}

// Modal Dialogues

modal_enter=type=>{
 ev.md=ev.mu=ev.dclick=0,menus_clear()
 if(ms.type=='trans')return
 ms.from_listener=ms.type=='listen'
 ms.type=ms.subtype=type
 ms.old_wid=wid,wid=wid_state()
 if(type=='listen'){
  if(uimode=='script'){
   try{const text=ls(rtext_string(sc.f.table));parse(text),script_save(text)}
   catch(e){listen_show(align_right,1,lms('note: this script contains an error.\nexecuting under last saved version!'))}
  }
  ms.text=fieldstr(lms('')),li.scroll=RTEXT_END
 }
 if(type=='query')ms.grid=gridtab(ms.old_wid.gv.table),ms.text=fieldstr(lms('select from me.value'))
 if(type=='recording'){
  au.head=0,au.sel=rect(),au.mode='stopped',au.hist=[],au.hist_cursor=0
  ms.name=fieldstr(dkey(deck.sounds,au.target)||lms('unknown sound'))
 }
 if(type=='cards')ms.grid=gridtab(null)
 if(type=='sounds')ms.grid=gridtab(sounds_enumerate())
 if(type=='fonts'){
  const r=lmt({icon:[],name:[]});let fi=-1
  deck.fonts.v.map((font,z)=>{
   if(uimode=='object'){if(ob.sel.every(x=>ifield(x,'font')==font))fi=z}
   else if(ms.old_wid.ft){if(ifield(ms.old_wid.ft,'font')==font)fi=z}
   r.v.icon.push(lmn(ICON.font)),r.v.name.push(deck.fonts.k[z])
  }),ms.grid=gridtab(r,fi)
 }
 if(type=='resources')ms.message=null,ms.grid=gridtab(lmt({})),ms.grid2=gridtab(res_enumerate(deck))
 if(type=='link'){
  const t=ms.old_wid.fv.table,ol=t.v.arg[rtext_get(t,ms.old_wid.cursor.y)]
  ms.text=fieldstr(ol);if(count(ol))ms.old_wid.cursor=rtext_getr(t,ms.old_wid.cursor.y)
 }
 if(type=='grid'        )ms.name=fieldstr(lmn(dr.grid_size.x     )),ms.text=fieldstr(lmn(dr.grid_size.y       ))
 if(type=='deck_props'  )ms.name=fieldstr(ifield(deck     ,'name')),ms.text=fieldstr(ifield(deck     ,'author'))
 if(type=='button_props')ms.name=fieldstr(ifield(ob.sel[0],'name')),ms.text=fieldstr(ifield(ob.sel[0],'text'  ))
 if(type=='field_props' )ms.name=fieldstr(ifield(ob.sel[0],'name')),ms.text=fieldstr(ifield(ob.sel[0],'value' ))
 if(type=='grid_props'  )ms.name=fieldstr(ifield(ob.sel[0],'name')),ms.text=fieldstr(ifield(ob.sel[0],'format'))
 if(type=='grid_props'  )ms.form0=fieldstr(lms(fjson(monad.cols(ifield(ob.sel[0],'value'))))),ms.edit_json=1
 if(type=='canvas_props')ms.name=fieldstr(ifield(ob.sel[0],'name')),ms.text=fieldstr(ifield(ob.sel[0],'scale' ))
 if(type=='slider_props'){
  ms.name =fieldstr(   ifield(ob.sel[0],'name'    )    )
  ms.text =fieldstr(   ifield(ob.sel[0],'format'  )    )
  ms.form0=fieldstr(ll(ifield(ob.sel[0],'interval'))[0])
  ms.form1=fieldstr(ll(ifield(ob.sel[0],'interval'))[1])
  ms.form2=fieldstr(   ifield(ob.sel[0],'step'    )    )
 }
 if(type=='action'){
  sc.target=ob.sel[0],sc.others=[]
  ms.act_go=1,ms.act_gomode=4,ms.act_trans=0,ms.act_sound=0,ms.act_card=ln(ifield(ifield(deck,'card'),'index'))
  ms.verb   =lms('') // card name
  ms.message=lms('') // sound name
  ms.grid=gridtab(transit_enumerate())
 }
 const dname=(x,e)=>{x=x||'untitled';return lms(/\.(deck|html)$/.test(x)?x:x+e)}
 if(type=='card_props')ms.name=fieldstr(ifield(ifield(deck,'card'),'name'))
 if(type=='link'||type=='gridcell'||type=='query')wid.cursor=rect(0,RTEXT_END)
 if(type=='alert_lil'     )ms.type=type='alert'
 if(type=='confirm_lil'   )ms.type=type='confirm'
 if(type=='input_lil'     )ms.type=type='input'
 if(type=='confirm_new'   )ms.type=type='confirm'
 if(type=='confirm_script')ms.type=type='confirm'
 if(type=='multiscript'   )ms.type=type='confirm'
 if(type=='save_deck'     )ms.type=type='save',ms.text=fieldstr(dname(deck.name,'.deck')),ms.desc='Save a .deck or .html file.'
 if(type=='save_locked'   )ms.type=type='save',ms.text=fieldstr(dname(deck.name,'.html')),ms.desc='Save locked standalone deck as an .html file.'
 if(type=='export_table'  )ms.type=type='save',ms.text=fieldstr(lms(ls(ifield(ms.old_wid.gt,'name'))+'.csv')),ms.desc='Save table as a .csv file.'
 if(type=='export_script' )ms.type=type='save',ms.text=fieldstr(lms('script.lil'  )),ms.desc='Save script as a .lil file.'
 if(type=='export_image'  )ms.type=type='save',ms.text=fieldstr(lms('image.gif'   )),ms.desc='Save a .gif image file.'
 if(type=='save_lil'      )ms.type=type='save',ms.text=fieldstr(lms('untitled.txt')),ms.desc='Save a text file.'
 if(type=='input'         )ms.text=fieldstr(lms(''))
}
modal_exit=value=>{
 wid=ms.old_wid
 if(ms.type=='gridcell'&&value)grid_edit_cell(ms.cell,dyad.parse(lms(`%${ls(grid_format())[ms.cell.x]||'s'}`),rtext_string(ms.text.table)))
 if(ms.type=='card_props'){iwrite(ifield(deck,'card'),lms('name'),rtext_string(ms.name.table)),mark_dirty()}
 if(ms.type=='grid_props'){
  const t=table_decode(rtext_string(ms.form0.table),rtext_string(ms.text.table))
  if(!match(t,ifield(ob.sel[0],'value')))ob_edit_prop('value',t)
 }
 if(ms.type=='action'&&value){
  let r='on click do\n'
  if(ms.act_sound)r+=`  play[${show(ms.message)}]\n`
  if(ms.act_go){
   r+='  go['
   r+=ms.act_gomode==0?'"First"': ms.act_gomode==1?'"Prev"': ms.act_gomode==2?'"Next"': ms.act_gomode==3?'"Last"': show(ms.verb)
   if(ms.act_trans)r+=` ${show(ms.grid.table.v.value[ms.grid.row])}`
   r+=']\n'
  }r+='end',script_save(lms(r))
 }
 if(ms.type=='recording'){
  const name=rtext_string(ms.name.table);rename_sound(deck,au.target,name)
  au.mode='stopped',modal_enter('sounds'),ms.grid.row=dkix(deck.sounds,name);return
 }
 if(ms.subtype=='confirm_new'   &&value)load_deck(deck_read(''))
 if(ms.subtype=='confirm_script'&&value)finish_script()
 if(ms.subtype=='multiscript'   &&value)setscript(ob.sel)
 if(ms.subtype=='alert_lil'  )arg(),ret(lmn(value))
 if(ms.subtype=='confirm_lil')arg(),ret(lmn(value))
 if(ms.subtype=='input_lil'  )arg(),ret(rtext_string(ms.text.table))
 if(ms.subtype=='choose_lil' )arg(),ret(ms.verb.v[ms.grid.row])
 ms.type=null
 if(ms.from_listener)modal_enter('listen')
 if(ms.type==null&&uimode=='interact')msg.next_view=1
}
modals=_=>{
 ms.in_modal=1
 const pal=deck.patterns.pal.pix
 if(ms.type=='about'){
  const b=draw_modalbox(rect(190,70))
  if(ui_button(rect(b.x+b.w-60,b.y+b.h-20,60,20),'OK',1)||ev.exit)modal_exit(0)
  draw_text(b,`Decker v${VERSION}`,FONT_MENU,1),b.y+=15
  draw_text(b,'by John Earnest',FONT_BODY,1),b.y+=12
 }
 else if(ms.type=='listen'){
  const size=LISTEN_SIZE(), th=li.hist.reduce((x,y)=>x+y[0].size.y+5,0), h=min(th,size.y)
  const esize=rect(0|((frame.size.x-size.x)/2),frame.size.y-49,size.x,50), tsize=rect(esize.x,esize.y-(h?h+5:0),esize.w,h)
  const bsize=rect(esize.x-5,esize.y-5-(h?tsize.h+5:0),esize.w+10,(h?tsize.h+5:0)+esize.h+20)
  draw_shadow(bsize,1,32,1),ui_codeedit(esize,1,ms.text)
  if(h){
   const sbar=scrollbar(tsize,max(0,th-size.y),10,tsize.h,li.scroll,h>=size.y,0), b=sbar.size; li.scroll=sbar.scroll
   let cy=0;li.hist.map(x=>{
    const l=x[0], t=x[1], s=l.size; let lb=rect(b.x,b.y+cy-li.scroll,s.x,s.y)
    image_paste(lb,b,l,frame.image,0),cy+=s.y+5
    lb=rclip(b,lb);const v=lis(t)&&over(lb), a=v&&dover(lb)
    if(v)uicursor=cursor.point,draw_box(inset(lb,-1),0,13); if(a&&(ev.md||ev.drag))draw_invert(pal,lb)
    if(a&&ev.mu)ms.text=fieldstr(t)
   })
  }
  if(ev.eval){
   const str=rtext_string(ms.text.table);if(count(str)<1)return
   try{
    const prog=parse(ls(str)), b=lmblk(); ms.text=fieldstr(lms('')),listen_show(ALIGN.left,1,str)
    const target=uimode=='script'?sc.target: ob.sel.length==1?ob.sel[0]: ifield(deck,'card')
    blk_opa(b,op.BUND,1),blk_lit(b,lmnat(n_pre_listen )),blk_lit(b,NONE   ),blk_op(b,op.CALL),blk_op(b,op.DROP),blk_cat(b,prog)
    blk_opa(b,op.BUND,1),blk_lit(b,lmnat(n_post_listen)),blk_op (b,op.SWAP),blk_op(b,op.CALL),blk_op(b,op.DROP),fire_hunk_async(target,b)
   }catch(e){listen_show(ALIGN.right,1,lms(`error: ${e.x}`));return}
  }if(ev.exit)modal_exit(0)
 }
 else if(ms.type=='cards'){
  const b=draw_modalbox(rect(210,frame.size.y-46)), gsize=rect(b.x,b.y+15,b.w,b.h-20-20)
  const slot=30,ch=slot*count(deck.cards); let m=0,props=0,gutter=-1,curr=ifield(deck,'card')
  draw_textc(rect(b.x,b.y-5,b.w,20),'Cards',FONT_MENU,1),draw_box(gsize,0,1)
  const sbar=scrollbar(gsize,max(0,ch-(gsize.h-2)),10,gsize.h,ms.grid.scroll,ch>=gsize.h,0),bb=sbar.size;ms.grid.scroll=sbar.scroll,bb.y++
  const oc=frame.clip;frame.clip=bb;for(let z=0;z<count(deck.cards);z++){
   const c=rect(bb.x,bb.y+(z*slot)-ms.grid.scroll,bb.w,slot), card=deck.cards.v[z]
   if(c.y>bb.y+bb.h||c.y+c.h<bb.y)continue; const cb=rclip(c,bb) // coarse clip
   const p=rect(c.x+2,c.y+1,40,28), t=rect(p.x+p.w+5,p.y,bb.w-(2+p.w+5+5),font_h(FONT_MENU)), s=rect(t.x,t.y+t.h+2,t.w,font_h(FONT_BODY))
   if(ev.md&&dover(cb)){m=1,n_go([card],deck),curr=card,ms.grid.row=z}if(ev.dclick&&over(cb))props=1
   const col=ev.drag&&ms.grid.row==z?13:1
   draw_text_fit(t,ls(ifield(card,'name')),FONT_MENU,col),draw_text_fit(s,`${count(card.widgets)} widgets`,FONT_BODY,col),draw_box(p,0,col)
   if(card==curr&&col==1)draw_invert(pal,c);draw_thumbnail(card,p)
   if((ev.drag||ev.mu)&&ms.grid.row!=-1){
    {const g=rect(c.x,c.y-3    ,c.w,7);if(over(g)){draw_hline(c.x,c.x+c.w,c.y      ,13),gutter=z  }}
    {const g=rect(c.x,c.y-3+c.h,c.w,7);if(over(g)){draw_hline(c.x,c.x+c.w,c.y+c.h-1,13),gutter=z+1}}
   }
  };frame.clip=oc
  if(ui_button(rect(b.x+b.w-60,b.y+b.h-20,60,20),'OK',1)||ev.exit||ev.action)modal_exit(0)
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'New',1)){
   const c=deck_add(deck,lms('card')),n=ln(ifield(curr,'index'))
   iwrite(c,lms('index'),lmn(n+1)),m=1,n_go([c],deck)
  }c.x+=65
  if(ev.mu){
   if(ms.grid.row!=-1&&gutter!=-1){
    const s=deck.cards.v[ms.grid.row], oi=ln(ifield(s,'index'))
    iwrite(s,lms('index'),lmn(gutter>oi?gutter-1:gutter)),m=1,n_go([s],deck)
   }ms.grid.row=-1
  }
  else if(ev.drag&&ms.grid.row!=-1){const r=rect(ev.pos.x-5,ev.pos.y-5,10,10);draw_rect(r,0),draw_box(r,0,1),uicursor=cursor.drag}
  else if(ev.dir=='up'  &&ev.shift){iwrite(curr,lms('index'),lmn(ln(ifield(curr,'index'))-1)),m=1,n_go([curr],deck)}
  else if(ev.dir=='down'&&ev.shift){iwrite(curr,lms('index'),lmn(ln(ifield(curr,'index'))+1)),m=1,n_go([curr],deck)}
  else if(ev.dir=='left' ||ev.dir=='up'  ){m=1,n_go([lms('Prev')],deck)}
  else if(ev.dir=='right'||ev.dir=='down'){m=1,n_go([lms('Next')],deck)}
  if(m){
   curr=ifield(deck,'card');const y=(ln(ifield(curr,'index'))*slot)-ms.grid.scroll
   if(y<0){ms.grid.scroll+=y}if(y+slot>=bb.h){ms.grid.scroll+=(y+slot)-bb.h}
  }if(props)modal_enter('card_props')
 }
 else if(ms.type=='sounds'){
  const b=draw_modalbox(rect(250,frame.size.y-16-30)), gsize=rect(b.x,b.y+15,b.w,b.h-16-(2*25))
  draw_textc(rect(b.x,b.y-5,b.w,20),'Sounds',FONT_MENU,1)
  const s=ms.grid.row>=0?dget(deck.sounds,ms.grid.table.v.name[ms.grid.row]):null
  if(ui_table(gsize,[16,130],'Isss',ms.grid))n_play([s])
  if(ui_button(rect(b.x+b.w-60,b.y+b.h-20,60,20),'OK',1)||ev.exit){
   if(ms.from_action){
    if(ms.grid.row>=0)ms.message=deck.sounds.k[ms.grid.row]
    ms.grid=gridtab(transit_enumerate(),ms.act_transno),ms.type='action',ms.from_action=0
   }else{modal_exit(1)}
  }
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'Edit...',s!=null))au.target=s,modal_enter('recording')
  if(ui_button(rect(c.x,c.y-25,60,20),'New...',1))au.target=deck_add(deck,lms('sound')),mark_dirty(),modal_enter('recording');c.x+=65
  if(ui_button(rect(c.x,c.y,60,20),"Delete",s!=null))deck_remove(deck,s),mark_dirty(),ms.grid=gridtab(sounds_enumerate())
 }
 else if(ms.type=='recording'){
  const b=draw_modalbox(rect(frame.size.x-50,130)), samples=max(1,ln(ifield(au.target,'size')))
  draw_textc(rect(b.x,b.y-5,b.w,20),'Audio Editor',FONT_MENU,1)
  au.head=clamp(0,au.head,samples), au.sel.x=clamp(0,au.sel.x,samples), au.sel.y=clamp(0,au.sel.y,samples)
  const gsize=rect(b.x,b.y+15,b.w,64), lsize=rint(rect(b.x,gsize.y+gsize.h+2,b.w/2,font_h(FONT_BODY)))
  const sndpos=x=>0|(x*((gsize.w*1.0)/samples))
  const possnd=x=>0|max(0,min(samples-1,((x/gsize.w)*samples)))
  if((ev.mu||ev.drag)&&dover(gsize)&&au.mode=='stopped'){
   const x=possnd(ev.dpos.x-gsize.x),y=possnd(ev.pos.x-gsize.x);field_exit()
   if(ev.mu)au.head=y;if(ev.drag)au.sel=rect(min(x,y),max(x,y)),au.head=au.sel.x
  }
  const sel=au.sel, sc=sel.y-sel.x, oc=frame.clip
  frame.clip=gsize;for(let z=0;z<gsize.w;z++){
   let v=0,base=possnd(z);for(let d=-1;d<=1;d++){
    if(base+d<0||base+d>=samples)continue;let s=byte_to_sample(au.target.data[base+d]);if(Math.abs(s)>Math.abs(v))v=s
   }let vp=0|(v*64);draw_vline(gsize.x+z,gsize.y+32,gsize.y+32+vp,1),draw_vline(gsize.x+z,gsize.y+32-vp,gsize.y+32,1)
  }frame.clip=oc
  if(sc)draw_invert(pal,rect(gsize.x+sndpos(sel.x),gsize.y,sndpos(sel.y)-sndpos(sel.x),gsize.h))
  draw_invert(pal,rect(gsize.x+sndpos(au.head)-1,gsize.y,3,gsize.h)),draw_box(gsize,0,1)
  const t=sc==0?ls(dyad.format(lms('%0.2fkb, %0.2fs'         ),lml([lmn(samples/1000.0*1.33),ifield(au.target,'duration')]))):
                ls(dyad.format(lms('%0.2fkb, %0.2fs selected'),lml([lmn(sc     /1000.0*1.33),lmn(sc/SFX_RATE            )])))
  draw_text_fit(lsize,t,FONT_BODY,1)
  if(ui_button(rect(b.x+b.w-60,b.y+b.h-20,60,20),'OK',1)||ev.exit)modal_exit(0)
  const c=rect(b.x,b.y+b.h-20)
  if(ui_toggle(rect(c.x,c.y,60,20),'Play',au.mode=='playing',1)){
   if(au.mode=='recording')sound_finish()
   au.head=sc?au.sel.x:0;if(au.mode=='playing'){stop_sound_pump()}else{play_sound_pump(sound_selected())}
  };c.x+=65
  if(ui_toggle(rect(c.x,c.y,60,20),'Record',au.mode=='recording',!au.norecord)){
   if(au.mode=='recording'){sound_finish()}else{sound_record()}
  };c.x+=65
  if(ui_button(rect(c.x,c.y,60,20),'Crop',sc&&au.mode=='stopped'))sound_edit(sound_slice(au.sel)),au.sel=rect(),au.head=0
  draw_text(rect(b.x+(b.w/2),gsize.y+gsize.h+9,37,20),'Name',FONT_MENU,1)
  ui_field(rint(rect(b.x+(b.w/2)+37,gsize.y+gsize.h+5,(b.w/2)-37,20)),ms.name)
 }
 else if(ms.type=='fonts'){
  const b=draw_modalbox(rect(170,170))
  draw_textc(rect(b.x,b.y-5,b.w,20),'Fonts',FONT_MENU,1)
  const gsize=rect(b.x,b.y+15,b.w,b.h-20-50-25), choose=ui_table(gsize,[16],'Is',ms.grid)
  let psize=rect(b.x,gsize.y+gsize.h+5,b.w,50);draw_box(psize,0,1),psize=inset(psize,2)
  if(ms.grid.row>=0){
   const l=layout_plaintext(PANGRAM,deck.fonts.v[ms.grid.row],ALIGN.left,rect(psize.w,psize.h));draw_text_wrap(psize,l,1)}
  const c=rect(b.x+b.w-60,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'OK',ms.grid.row>=0)||choose){
   const nf=ms.grid.table.v.name[ms.grid.row];modal_exit(1)
   if(uimode=='object'){ob_edit_prop('font',nf)}
   else if(wid.ft&&wid.cursor.x!=wid.cursor.y){const c=wid.cursor;field_stylespan(nf,lms('')),wid.cursor=c,mark_dirty()}
   else if(wid.ft){iwrite(wid.ft,lms('font'),nf),wid.f=unpack_field(ms.old_wid.ft),wid.fv=unpack_field_value(ms.old_wid.ft),mark_dirty()}
  };c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='resources'){
  const b=draw_modalbox(rect(280,190))
  draw_textc(rect(b.x,b.y-5,b.w,20),'Font/Deck Accessory Mover',FONT_MENU,1)
  const lgrid=rect(b.x            ,b.y+15 ,100    ,b.h-(15+15+5+20))
  const rgrid=rect(b.x+b.w-lgrid.w,lgrid.y,lgrid.w,lgrid.h         )
  if(ui_button(rect(rgrid.x+(rgrid.w-80)/2,b.y+b.h-20,80,20),'OK',1)||ev.exit)modal_exit(0)
  ui_table(lgrid,[16,lgrid.w-38],'Is',ms.grid );if(ms.grid .row>-1)ms.grid2.row=-1
  ui_table(rgrid,[16,rgrid.w-38],'Is',ms.grid2);if(ms.grid2.row>-1)ms.grid .row=-1
  draw_vline(lgrid.x+lgrid.w,lgrid.y+lgrid.h+5,b.y+b.h,18)
  draw_vline(rgrid.x        ,rgrid.y+rgrid.h+5,b.y+b.h,18)
  draw_textc(rect(lgrid.x,lgrid.y+lgrid.h+3,lgrid.w,15),ms.message?ls(ifield(ms.message,'name')):'(Choose a Deck)',FONT_BODY,1)
  draw_textc(rect(rgrid.x,rgrid.y+rgrid.h+3,rgrid.w,15),ls(ifield(deck,'name')),FONT_BODY,1)
  const cb=rect(lgrid.x+lgrid.w+5,lgrid.y+5,b.w-(lgrid.w+5+5+rgrid.w),20)
  const rvalue=(g,k)=>g.table.v[k][g.row]
  const sel=(ms.grid.table&&ms.grid.row>-1)?rvalue(ms.grid,'value'): ms.grid2.row>-1?rvalue(ms.grid2,'value'): null
  if(ui_button(cb,'>> Copy >>',ms.grid.row>-1)){
   if(patterns_is(sel)){const dst=ifield(deck,'patterns');for(let z=2;z<=31;z++)iindex(dst,z,iindex(sel,z))}
   else{deck_add(deck,sel,rvalue(ms.grid,'name'))}
   ms.grid2=gridtab(res_enumerate(deck)),mark_dirty();if(module_is(sel))validate_modules()
  }cb.y+=25
  if(ui_button(cb,'Remove',ms.grid2.row>-1)){
   if(patterns_is(sel)){deck.patterns=patterns_read(lmd())}
   else{deck_remove(deck,rvalue(ms.grid2,'value'))}
   ms.grid2=gridtab(res_enumerate(deck)),mark_dirty()
  }cb.y+=25
  const pre=rect(cb.x,cb.y,cb.w,b.h-(cb.y-b.y))
  if(sel&&font_is(sel)){const l=layout_plaintext(PANGRAM,sel,ALIGN.center,rect(pre.w,pre.h));draw_text_wrap(pre,l,1)}
  if(sel&&module_is(sel)){const l=layout_plaintext(ls(ifield(sel,'description')),FONT_BODY,ALIGN.center,rect(pre.w,pre.h));draw_text_wrap(pre,l,1)}
  if(sel&&sound_is(sel)){if(ui_button(cb,'Play',1))n_play([sel])}
  if(sel&&patterns_is(sel)){
   const c=frame.clip,pal=sel.pal.pix;frame.clip=pre;
   const anim_ants   =(x,y)=>(0|((x+y+(0|(frame_count/2)))/3))%2?15:0
   const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal_pat(pal,pix,x,y)&1
   const draw_color  =(pix,x,y)=>pix==ANTS?anim_ants(x,y): pix>47?0: pix>31?pix-32: draw_pattern(pix,x,y)?15:0
   for(let z=0;z<32;z++)for(let y=0;y<16;y++)for(let x=0;x<16;x++){
    const h=rect(3+x+pre.x+16*(z%(0|(pre.w/16))), y+pre.y+16*(0|(z/(0|(pre.w/16)))))
    if(inclip(h))pix(h,32+draw_color(z,x,y))
   }frame.clip=c
  }
  ui_button(rint(rect(lgrid.x+(lgrid.w-80)/2,b.y+b.h-20,80,20)),'Choose...',1,_=>open_text('.html,.deck',text=>{
   ms.message=deck_read(text),ms.grid=gridtab(res_enumerate(ms.message))
  }))
 }
 else if(ms.type=='query'){
  const b=draw_modalbox(rect(frame.size.x-30,frame.size.y-16-30)),t=ms.grid.table
  const desc=t?`${Object.keys(t.v).length} column${Object.keys(t.v).length==1?'':'s'}, ${count(t)} row${count(t)==1?'':'s'}.`:'Executing Query.'
  let compiles=0,error=' ';try{parse(ls(rtext_string(ms.text.table))),compiles=1}catch(e){error=e.x}
  const dsize=font_textsize(FONT_BODY,desc);draw_text(b,desc,FONT_BODY,1)
  const msize=font_textsize(FONT_BODY,error), gsize=rint(rect(b.x,b.y+dsize.y,b.w,(b.h-(2*5)-dsize.y-20)/2))
  const esize=rect(b.x,gsize.y+gsize.h+5,b.w,gsize.h-msize.y);ui_codeedit(esize,1,ms.text)
  if(!compiles)draw_text_fit(rect(b.x,esize.y+esize.h,b.w,msize.y),error,FONT_BODY,1)
  const c=rect(b.x+b.w-60,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'Run',compiles)||ev.eval){
   try{
    const prog=parse(ls(rtext_string(ms.text.table)))
    blk_opa(prog,op.BUND,1),blk_lit(prog,lmnat(n_post_query)),blk_op(prog,op.SWAP),blk_op(prog,op.CALL)
    fire_hunk_async(ms.old_wid.gt,prog),ms.grid=gridtab(null)
   }catch(e){console.log(e)}
  }c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Apply',ms.grid.table!=null&&ms.grid.table!=ms.old_wid.gv.table&&!ms.old_wid.g.locked)){
   const t=ms.grid.table;modal_exit(0),grid_edit(t)
   listen_show(ALIGN.right,1,lms('applied table query:')),listen_show(ALIGN.left,1,rtext_string(ms.text.table))
  }c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Close',1)||ev.exit)modal_exit(0)
  if(ms.grid.table){widget_grid(null,{size:gsize,font:FONT_MONO,widths:[],format:'',headers:1,scrollbar:1,lines:1,show:'solid',locked:1},ms.grid)}
  else{draw_box(gsize,0,1),draw_textc(gsize,'Working...',FONT_BODY,1)}
 }
 else if(ms.type=='url'){
  const b=draw_modalbox(rect(170,90))
  draw_textc(rect(b.x,b.y,b.w,20),'Do you wish to open this URL?',FONT_BODY,1)
  ui_textedit(rect(b.x,b.y+20+5,b.w,40),1,ms.text)
  const c=rect(b.x+b.w-(b.w-(2*60+5))/2-60,b.y+b.h-20)
  ui_button(rect(c.x,c.y,60,20),'Open',1,_=>{open_url(ls(rtext_string(ms.text.table)));modal_exit(0)});c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='link'){
  const b=draw_modalbox(rect(170,70))
  draw_textc(rect(b.x,b.y,b.w,20),'Enter a link string for\nthe selected text span:',FONT_BODY,1)
  ui_field(rect(b.x,b.y+20+5,b.w,20),ms.text)
  const c=rint(rect(b.x+b.w-(b.w-(2*60+5))/2-60,b.y+b.h-20))
  if(ui_button(rect(c.x,c.y,60,20),'OK',1)){
   const l=rtext_string(ms.text.table);modal_exit(0)
   const c=rcopy(wid.cursor);field_stylespan(lms(''),l),wid.cursor=c
  };c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='gridcell'){
  const b=draw_modalbox(rect(170,70))
  draw_textc(rect(b.x,b.y,b.w,20),'Enter a new value for\nthe selected cell:',FONT_BODY,1)
  ui_field(rect(b.x,b.y+20+5,b.w,20),ms.text)
  const c=rect(b.x+b.w-(b.w-(2*60+5))/2-60,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'OK',1))modal_exit(1);c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='save'){
  const l=layout_plaintext(ms.desc,FONT_BODY,ALIGN.center,rect(250,100))
  const b=draw_modalbox(radd(l.size,rect(0,20+5+20+5+20))), tbox=rect(b.x,b.y+20,b.w,l.size.y)
  draw_textc(rect(b.x,b.y-5,b.w,20),'Save File',FONT_MENU,1),draw_text_wrap(tbox,l,1)
  draw_text(rect(b.x   ,tbox.y+tbox.h+7,    56,20),'Filename',FONT_MENU,1)
  ui_field (rect(b.x+56,tbox.y+tbox.h+5,b.w-56,18),ms.text)
  const c=rect(b.x+b.w-60,b.y+b.h-20),subtype=ms.subtype
  const grid=ms.old_wid.gv, format=subtype!='export_table'?null:lms(ms.old_wid.g.format.length?ms.old_wid.g.format:'s'.repeat(Object.keys(grid.table.v).length))
  if(ui_button(rect(c.x,c.y,60,20),'Save',1,_=>{
   const name=ls(rtext_string(ms.text.table))
   const savedeck=_=>{
    let d=deck_write(deck)
    if(/\.html$/i.test(name)){q('script[language="decker"]').innerHTML='\n'+d,d=`<body>${q('body').innerHTML}</body>`}
    dirty=0,save_text(name,d)
   }
   const save_image=_=>{
    if(bg_has_sel()){const s=rcopy(dr.sel_here);bg_end_selection(),dr.sel_here=s}
    let i=draw_card(ifield(deck,'card'),1),off=rect(),f=1,a=0, bg=dr.trans?0:32, frames=[]
    const anim=deck.patterns.anim
    const anim_pattern=(pix,x,y,f)=>pix<28||pix>31?pix: anim[pix-28][f%max(1,anim[pix-28].length)]
    const draw_pattern=(pix,x,y  )=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal[(x%8)+(8*(y%8))+(8*8*pix)]&1
    if(bg_has_sel()||bg_has_lasso())i=image_copy(i,dr.sel_here),off=rcopy(dr.sel_here)
    for(let z=0;z<4&&dr.show_anim;z++){const c=anim[z].length;if(c)f=lcm(f,c)}
    for(let z=0;z<f;z++){
     const frame=image_copy(i)
     for(let y=0;y<i.size.y;y++)for(let x=0;x<i.size.x;x++){
      const v=frame.pix[x+(i.size.x*y)];if(v>=28&&v<=31)a=1
      const c=anim_pattern(v,x,y,z),p=draw_pattern(c,x+off.x,y+off.y)
      frame.pix[x+(i.size.x*y)]=c>=32?c: p?1:bg
     }frames.push(bg_has_lasso()?image_mask(frame,dr.mask):frame)
    }save_bin(name,writegif(a?frames:[frames[0]]))
   }
   if(subtype=='save_deck'    )savedeck()
   if(subtype=='save_locked'  )iwrite(deck,lms('locked'),ONE),savedeck(),iwrite(deck,lms('locked'),NONE)
   if(subtype=='export_script')save_text(name,ls(rtext_string(sc.f.table)))
   if(subtype=='export_table' )field_exit(),save_text(name,ls(n_writecsv([grid.table,format])))
   if(subtype=='export_image' )save_image()
   if(subtype=='save_lil'){
    let x=ms.verb;ret(ONE);if(image_is(x))x=lml([x])
    if(lil(x)&&ll(x).some(image_is)&&count(x)>0){save_bin(name,writegif(ll(x).filter(image_is)))}
    else if(sound_is(x))                        {save_bin(name,writewav(x))}
    else if(array_is(x))                        {save_bin(name,writearray(x))}
    else                                        {save_text(name,ls(x))}
   }
  }))modal_exit(1);c.x-=65;
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='alert'){
  const b=draw_modal_rtext(rect(0,5+20))
  if(ui_button(rect(b.x+b.w-60,b.y+b.h-20,60,20),'OK',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='confirm'){
  const b=draw_modal_rtext(rect(0,5+20)),v=ms.verb?ls(ms.verb):'OK'
  const vs=font_textsize(FONT_MENU,v);vs.x=min(max(60,vs.x+10),200-65);const c=rect(b.x+b.w-vs.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,vs.x,20),v,1))modal_exit(1);c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='input'){
  const b=draw_modal_rtext(rect(0,5+20+5+20))
  ui_field(rect(b.x,b.y+b.h-(20+5+20),b.w,20),ms.text)
  if(ui_button(rect(b.x+b.w-60,b.y+b.h-20,60,20),'OK',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='choose_lil'){
  const b=draw_modal_rtext(rect(0,5+60+5+20))
  const choose=ui_table(rect(b.x,b.y+b.h-(20+5+60),b.w,60),[],'s',ms.grid)
  if(ui_button(rect(b.x+b.w-60,b.y+b.h-20,60,20),'OK',ms.grid.row>=0)||choose)modal_exit(1)
 }
 else if(ms.type=='open_lil'){
  const b=draw_modalbox(rect(125,45))
  draw_textc(rect(b.x,b.y,b.w,16),'Click to open a file:',FONT_BODY,1)
  const c=rect(b.x+b.w-60,b.y+b.h-20)
  ui_button(rect(c.x,c.y,60,20),'Open',1,_=>{
   if     (ls(ms.verb)=='array'  )open_file(ms.filter,file=>{load_array(file,        array=>{arg(),ret(array)    ,modal_exit(1)})})
   else if(ms.filter=='image/*'  )open_file(ms.filter,file=>{load_image(file,ms.verb,image=>{arg(),ret(image)    ,modal_exit(1)})})
   else if(ms.filter=='audio/*'  )open_file(ms.filter,file=>{load_sound(file,        sound=>{arg(),ret(sound)    ,modal_exit(1)})})
   else if(ms.filter=='.csv,.txt')open_text(ms.filter,                               text =>{arg(),ret(lms(text)),modal_exit(1)  })
   else                           open_text(''       ,                               text =>{arg(),ret(lms(text)),modal_exit(1)  })
  }),c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='fullscreen_lil'){
  const b=draw_modalbox(rect(150,45))
  draw_textc(rect(b.x,b.y,b.w,16),'Click to enter fullscreen mode:',FONT_BODY,1)
  const c=rect(b.x+b.w-80,b.y+b.h-20)
  ui_button(rect(c.x,c.y,80,20),'Fullscreen',1,_=>{toggle_fullscreen(),modal_exit(1)}),c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
 }
 else if(ms.type=='brush'){
  const grid=rect(6,4), ss=25, gs=ss+4, m=5, lh=font_h(FONT_BODY)
  const b=draw_modalbox(rect(m+(grid.x*gs)+m,m+(grid.y*gs)+lh+m))
  draw_textc(rect(b.x,b.y+b.h-lh,b.w,lh),'Choose a brush shape.',FONT_BODY,1)
  for(let z=0;z<grid.x*grid.y;z++){
   const s=rect(b.x+m+2+gs*(z%grid.x),b.y+m+2+gs*(0|(z/grid.x)),ss,ss);
   const c=rint(rect(s.x+s.w/2,s.y+s.h/2));draw_line(rpair(c,c),z,1)
   if(z==dr.brush)draw_box(inset(s,-2),0,1)
   const a=dover(s)&&over(s), cs=(z==dr.brush&&ev.action), cl=cs||((ev.md||ev.drag)&&a), cr=cs||(ev.mu&&a)
   if(cl)draw_invert(pal,inset(s,-1)); if(cr){dr.brush=z,modal_exit(z);break}
  }
  if(ev.exit||(ev.mu&&!dover(b)&&!over(b)))modal_exit(-1),ev.mu=0
  if(ev.dir=='left' )dr.brush=((0|(dr.brush/grid.x))*grid.x)+((dr.brush+grid.x-1)%grid.x)
  if(ev.dir=='right')dr.brush=((0|(dr.brush/grid.x))*grid.x)+((dr.brush+       1)%grid.x)
  if(ev.dir=='up'   )dr.brush=(dr.brush+(grid.x*(grid.y-1)))%(grid.x*grid.y)
  if(ev.dir=='down' )dr.brush=(dr.brush+grid.x             )%(grid.x*grid.y)
 }
 else if(ms.type=='pattern'||ms.type=='fill'){
  const grid=rect(8,4), ss=25, gs=ss+4, m=5, lh=font_h(FONT_BODY), v=ms.type=='pattern'?dr.pattern:dr.fill
  const setv=x=>ms.type=='pattern'?dr.pattern=x:dr.fill=x
  const b=draw_modalbox(rect(m+(grid.x*gs)+m,m+(grid.y*gs)+lh+m))
  draw_textc(rect(b.x,b.y+b.h-lh,b.w,lh),`Choose a ${ms.type=='fill'?'fill':'stroke'} pattern.`,FONT_BODY,1)
  for(let z=0;z<grid.x*grid.y;z++){
   const s=rint(rect(b.x+m+2+gs*(z%grid.x),b.y+m+2+gs*(0|(z/grid.x)),ss,ss))
   draw_rect(s,z); if(z==v)draw_box(inset(s,-2),0,1)
   const a=dover(s)&&over(s), cs=(z==v&&ev.action), cl=cs||((ev.md||ev.drag)&&a), cr=cs||(ev.mu&&a)
   if(cl)draw_invert(pal,inset(s,-1)); if(cr){setv(z),modal_exit(z);break}
  }
  if(ev.exit||(ev.mu&&!dover(b)&&!over(b)))modal_exit(-1),ev.mu=0
  if(ev.dir=='left' )setv(((0|(v/grid.x))*grid.x)+((v+grid.x-1)%grid.x))
  if(ev.dir=='right')setv(((0|(v/grid.x))*grid.x)+((v+       1)%grid.x))
  if(ev.dir=='up'   )setv((v+(grid.x*(grid.y-1)))%(grid.x*grid.y))
  if(ev.dir=='down' )setv((v+grid.x             )%(grid.x*grid.y))
 }
 else if(ms.type=='grid'){
  const b=draw_modalbox(rect(120,100))
  draw_textc(rect(b.x,b.y-5,b.w,20),'Grid Size',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,42,20),'Width' ,FONT_MENU,1)
  draw_text(rect(b.x,b.y+42,42,20),'Height',FONT_MENU,1)
  ui_field(rect(b.x+42,b.y+20,b.w-42,18),ms.name)
  ui_field(rect(b.x+42,b.y+40,b.w-42,18),ms.text)
  dr.grid_size.x=ln(rtext_string(ms.name.table)),dr.grid_size.x=0|max(1,dr.grid_size.x)
  dr.grid_size.y=ln(rtext_string(ms.text.table)),dr.grid_size.y=0|max(1,dr.grid_size.y)
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='deck_props'){
  const b=draw_modalbox(rect(220,100))
  draw_textc(rect(b.x,b.y-5,b.w,20),'Deck Properties',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,42,20),'Name',FONT_MENU,1)
  draw_text(rect(b.x,b.y+42,42,20),'Author',FONT_MENU,1)
  ui_field(rect(b.x+42,b.y+20,b.w-42,18),ms.name)
  ui_field(rect(b.x+42,b.y+40,b.w-42,18),ms.text)
  iwrite(deck,lms('name'  ),rtext_string(ms.name.table))
  iwrite(deck,lms('author'),rtext_string(ms.text.table)),mark_dirty()
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'Script...',1))setscript(deck),modal_exit(0);c.x+=65
  if(ui_button(rect(c.x,c.y,60,20),'Protect...',1))modal_enter('save_locked')
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='card_props'){
  const b=draw_modalbox(rect(220,100)),card=ifield(deck,'card')
  draw_textc(rect(b.x,b.y-5,b.w,20),'Card Properties',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,42,20),'Name',FONT_MENU,1),ui_field(rect(b.x+42,b.y+20,b.w-42,18),ms.name)
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'Script...',1))setscript(card),modal_exit(0)
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='button_props'){
  const b=draw_modalbox(rect(220,170)),button=ob.sel[0]
  draw_textc(rect(b.x,b.y-5,b.w,20),'Button Properties',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,42,20),'Name',FONT_MENU,1)
  draw_text(rect(b.x,b.y+42,42,20),'Text',FONT_MENU,1)
  ui_field(rect(b.x+42,b.y+20,b.w-42,18),ms.name)
  ui_field(rect(b.x+42,b.y+40,b.w-42,18),ms.text)
  iwrite(button,lms('name'),rtext_string(ms.name.table))
  iwrite(button,lms('text'),rtext_string(ms.text.table)),mark_dirty()
  const style=ls(ifield(button,'style')), sb=rect(b.x,b.y+70)
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Round'    ,1,style=='round'    )){iwrite(button,lms('style'),lms('round'    )),mark_dirty()}sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Rectangle',1,style=='rect'     )){iwrite(button,lms('style'),lms('rect'     )),mark_dirty()}sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Checkbox' ,1,style=='check'    )){iwrite(button,lms('style'),lms('check'    )),mark_dirty()}sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Invisible',1,style=='invisible')){iwrite(button,lms('style'),lms('invisible')),mark_dirty()}sb.y+=16
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'Script...',1))setscript(button),modal_exit(0); c.x+=65
  if(ui_button(rect(c.x,c.y,60,20),'Action...',1))modal_enter('action')
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='field_props'){
  const b=draw_modalbox(rect(220,170+60)),f=ob.sel[0], p=unpack_field(f)
  draw_textc(rect(b.x,b.y-5,b.w,20),'Field Properties',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,42,20),'Name',FONT_MENU,1)
  draw_text(rect(b.x,b.y+42,42,60),'Text',FONT_MENU,1)
  ui_field(rect(b.x+42,b.y+20,b.w-42,18),ms.name)
  widget_field(null,{size:rect(b.x+42,b.y+40,b.w-42,58),font:p.font,show:'solid',scrollbar:1,border:1,style:'plain',align:p.align,locked:0},ms.text)
  iwrite(f,lms('name' ),rtext_string(ms.name.table))
  iwrite(f,lms('value'),ms.text.table),mark_dirty()
  let border=lb(ifield(f,'border')), scrollbar=lb(ifield(f,"scrollbar")), cb=rect(b.x,b.y+50+60)
  if(ui_checkbox(rect(cb.x,cb.y,b.w,16),'Border'   ,1,border   )){border   ^=1,iwrite(f,lms('border'   ),lmn(border   )),mark_dirty()}cb.y+=16
  if(ui_checkbox(rect(cb.x,cb.y,b.w,16),'Scrollbar',1,scrollbar)){scrollbar^=1,iwrite(f,lms('scrollbar'),lmn(scrollbar)),mark_dirty()}cb.y+=16
  const style=ls(ifield(f,'style')), sb=rect(b.x,cb.y+10);let cp=0
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Rich Text' ,1,style=='rich' )){iwrite(f,lms('style'),lms('rich' )),mark_dirty()     }sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Plain Text',1,style=='plain')){iwrite(f,lms('style'),lms('plain')),mark_dirty(),cp=1}sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Code'      ,1,style=='code' )){iwrite(f,lms('style'),lms('code' )),mark_dirty(),cp=1}sb.y+=16
  if(cp&&!rtext_is_plain(ms.text.table))ms.text.table=rtext_cast(rtext_string(ms.text.table))
  const align=ls(ifield(f,'align')), ab=rect(b.x+(b.w/2),cb.y+10)
  if(ui_radio(rint(rect(ab.x,ab.y,b.w/2,16)),'Align Left' ,1,align=='left'  )){iwrite(f,lms('align'),lms('left'  )),mark_dirty()}ab.y+=16
  if(ui_radio(rint(rect(ab.x,ab.y,b.w/2,16)),'Center'     ,1,align=='center')){iwrite(f,lms('align'),lms('center')),mark_dirty()}ab.y+=16
  if(ui_radio(rint(rect(ab.x,ab.y,b.w/2,16)),'Align Right',1,align=='right' )){iwrite(f,lms('align'),lms('right' )),mark_dirty()}ab.y+=16
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'Script...',1))setscript(f),modal_exit(0)
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='slider_props'){
  const b=draw_modalbox(rect(220,170)),f=ob.sel[0]
  draw_textc(rect(b.x,b.y-5,b.w,20),'Slider Properties',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,42,20),'Name'  ,FONT_MENU,1)
  draw_text(rect(b.x,b.y+42,42,20),'Format',FONT_MENU,1)
  ui_field(rect(b.x+50,b.y+20,b.w-50,18),ms.name)
  ui_field(rect(b.x+50,b.y+40,b.w-50,18),ms.text)
  iwrite(f,lms('name'  ),rtext_string(ms.name.table))
  iwrite(f,lms('format'),rtext_string(ms.text.table)),mark_dirty()
  const style=ls(ifield(f,'style')), sb=rect(b.x,b.y+70)
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Horizontal',1,style=='horiz'  )){iwrite(f,lms('style'),lms('horiz'  )),mark_dirty()}sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Vertical'  ,1,style=='vert'   )){iwrite(f,lms('style'),lms('vert'   )),mark_dirty()}sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Bar'       ,1,style=='bar'    )){iwrite(f,lms('style'),lms('bar'    )),mark_dirty()}sb.y+=16
  if(ui_radio(rint(rect(sb.x,sb.y,b.w/2,16)),'Compact'   ,1,style=='compact')){iwrite(f,lms('style'),lms('compact')),mark_dirty()}sb.y+=16
  const ib=rint(rect(b.x+b.w/2,b.y+70))
  draw_text(rect(ib.x+5,ib.y+2,40,20),'Min' ,FONT_MENU,1),ui_field(rint(rect(ib.x+40,ib.y,b.w/2-40,18)),ms.form0),ib.y+=20
  draw_text(rect(ib.x+5,ib.y+2,40,20),'Max' ,FONT_MENU,1),ui_field(rint(rect(ib.x+40,ib.y,b.w/2-40,18)),ms.form1),ib.y+=20
  draw_text(rect(ib.x+5,ib.y+2,40,20),'Step',FONT_MENU,1),ui_field(rint(rect(ib.x+40,ib.y,b.w/2-40,18)),ms.form2),ib.y+=20
  const c=rect(b.x,b.y+b.h-20)
  iwrite(f,lms('interval'),lml([rtext_string(ms.form0.table),rtext_string(ms.form1.table)]))
  iwrite(f,lms('step'),rtext_string(ms.form2.table)),mark_dirty()
  if(ui_button(rect(c.x,c.y,60,20),'Script...',1))setscript(f),modal_exit(0)
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='canvas_props'){
  const b=draw_modalbox(rect(220,141)),canvas=ob.sel[0]
  draw_textc(rect(b.x,b.y-5,b.w,20),'Canvas Properties',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,42,20),'Name' ,FONT_MENU,1)
  draw_text(rect(b.x,b.y+42,42,20),'Scale',FONT_MENU,1)
  ui_field(rect(b.x+42,b.y+20,b.w-42,18),ms.name)
  ui_field(rect(b.x+42,b.y+40,b.w-42,18),ms.text)
  iwrite(canvas,lms('name' ),rtext_string(ms.name.table))
  iwrite(canvas,lms('scale'),rtext_string(ms.text.table)),mark_dirty()
  let border=lb(ifield(canvas,'border')),draggable=lb(ifield(canvas,'draggable')),cb=rect(b.x,b.y+50+20)
  if(ui_checkbox(rect(cb.x,cb.y,b.w,16),'Border'   ,1,border   ))border   ^=1,iwrite(canvas,lms('border'   ),lmn(border   )),mark_dirty();cb.y+=16
  if(ui_checkbox(rect(cb.x,cb.y,b.w,16),'Draggable',1,draggable))draggable^=1,iwrite(canvas,lms('draggable'),lmn(draggable)),mark_dirty()
  const c=rect(b.x,b.y+b.h-20)
  if(ui_button(rect(c.x,c.y,60,20),'Script...',1))setscript(canvas),modal_exit(0)
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='grid_props'){
  const b=draw_modalbox(rect(220,140+70)),grid=ob.sel[0]
  draw_textc(rect(b.x,b.y-5,b.w,20),'Grid Properties',FONT_MENU,1)
  draw_text(rect(b.x,b.y+22,47,20),'Name'  ,FONT_MENU,1)
  draw_text(rect(b.x,b.y+42,47,20),'Format',FONT_MENU,1)
  draw_text(rect(b.x,b.y+62,47,20),'Value' ,FONT_MENU,1)
  ui_field   (rect(b.x+47,b.y+20,b.w-47,18),ms.name)
  ui_field   (rect(b.x+47,b.y+40,b.w-47,18),ms.text)
  ui_codeedit(rect(b.x+47,b.y+60,b.w-47,58),1,ms.form0)
  const etext=rtext_string(ms.form0.table),format=rtext_string(ms.text.table),val=table_decode(etext,format),cn=Object.keys(val.v).length,rn=count(val)
  draw_text(rect(b.x+47,b.y+60+60,b.w-47,18),`${cn} column${cn==1?'':'s'}, ${rn} row${rn==1?'':'s'}.`,FONT_BODY,1)
  iwrite(grid,lms('name'  ),rtext_string(ms.name.table))
  iwrite(grid,lms('format'),format),mark_dirty()
  let headers=lb(ifield(grid,'headers')), scrollbar=lb(ifield(grid,'scrollbar')), lines=lb(ifield(grid,'lines')), cb=rect(b.x,b.y+70+70)
  if(ui_checkbox(rint(rect(cb.x,cb.y,b.w/2,16)),'Column Headers',1,headers  )){headers  ^=1,iwrite(grid,lms('headers'  ),lmn(headers  )),mark_dirty()}cb.y+=16
  if(ui_checkbox(rint(rect(cb.x,cb.y,b.w/2,16)),'Scrollbar'     ,1,scrollbar)){scrollbar^=1,iwrite(grid,lms('scrollbar'),lmn(scrollbar)),mark_dirty()}cb.y+=16
  if(ui_checkbox(rint(rect(cb.x,cb.y,b.w/2,16)),'Grid Lines'    ,1,lines    )){lines    ^=1,iwrite(grid,lms('lines'    ),lmn(lines    )),mark_dirty()}cb.y+=16
  const eb=rint(rect(b.x+(b.w/2),b.y+70+70))
  if(ui_radio(rint(rect(eb.x,eb.y,b.w/2,16)),'Edit as JSON',1,ms.edit_json==1)){ms.form0=fieldstr(lms(fjson(monad.cols(val)))),ms.edit_json=1}eb.y+=16
  if(ui_radio(rint(rect(eb.x,eb.y,b.w/2,16)),'Edit as CSV' ,1,ms.edit_json==0))ms.form0=fieldstr(n_writecsv(count(format)?[val,format]:[val])),ms.edit_json=0
  const c=rect(b.x,b.y+b.h-20), w=ll(ifield(grid,'widths'))
  if(ui_button(rect(c.x,c.y,60,20),'Script...',1))modal_exit(0),setscript(grid);c.x+=65
  if(ui_button(rect(c.x,c.y,90,20),'Reset Widths',w.length))iwrite(grid,lms('widths'),lml([])),mark_dirty()
  if(ui_button(rect(b.x+b.w-60,c.y,60,20),'OK',1)||ev.exit)modal_exit(1)
 }
 else if(ms.type=='action'){
  const b=draw_modalbox(rect(220,180))
  draw_textc(rect(b.x,b.y-5,b.w,20),'Button Action',FONT_MENU,1)
  const c=rect(b.x+b.w-60,b.y+b.h-20), cr=rect(b.x,b.y+36)
  const ready=(ms.act_go||ms.act_sound)&&(ms.act_go?(ms.act_gomode!=4||count(ms.verb)):1)&&(ms.act_sound?count(ms.message):1)
  if(ui_button(rect(c.x,c.y,60,20),'OK',ready))modal_exit(1);c.x-=65
  if(ui_button(rect(c.x,c.y,60,20),'Cancel',1)||ev.exit)modal_exit(0)
  if(ui_checkbox(rint(rect(b.x,b.y+20,b.w/2,16)),'Go to Card',1,ms.act_go))ms.act_go^=1
  if(ui_radio(rect(cr.x+5,cr.y,80,16),'First'   ,ms.act_go,ms.act_gomode==0))ms.act_gomode=0;cr.y+=16
  if(ui_radio(rect(cr.x+5,cr.y,80,16),'Previous',ms.act_go,ms.act_gomode==1))ms.act_gomode=1;cr.y+=16
  if(ui_radio(rect(cr.x+5,cr.y,80,16),'Next'    ,ms.act_go,ms.act_gomode==2))ms.act_gomode=2;cr.y+=16
  if(ui_radio(rect(cr.x+5,cr.y,80,16),'Last'    ,ms.act_go,ms.act_gomode==3))ms.act_gomode=3;cr.y+=16
  if(ui_radio(rect(cr.x+5,cr.y,45,16),'Pick:'   ,ms.act_go,ms.act_gomode==4))ms.act_gomode=4
  if(ms.act_go&&ms.act_gomode==4){
   const l=rect(cr.x+5+45,cr.y,b.w-5-45-5-60,16)
   draw_hline(l.x,l.x+l.w,l.y+l.h,13),draw_text_fit(inset(l,1),ls(ms.verb),FONT_BODY,1)
   if(ui_button(rect(b.x+b.w-60,cr.y,60,20),'Choose...',ms.act_go&&ms.act_gomode==4))ms.type='pick_card'
  }cr.y+=26;
  if(ui_checkbox(rect(cr.x,cr.y,80,16),'Play a Sound',1,ms.act_sound))ms.act_sound^=1
  if(ms.act_sound){
   const l=rect(cr.x+5+75,cr.y,b.w-5-75-5-60,16)
   draw_hline(l.x,l.x+l.w,l.y+l.h,13),draw_text_fit(inset(l,1),ls(ms.message),FONT_BODY,1)
   if(ui_button(rect(b.x+b.w-60,cr.y,60,20),'Choose...',ms.act_sound)){
    ms.act_transno=ms.grid.row,ms.grid=gridtab(sounds_enumerate()),ms.from_action=1,ms.type='sounds'
   }
  }
  if(ms.act_go){
   if(ui_checkbox(rint(rect(b.x+b.w/2,b.y+20,b.w/2,16)),'With Transition',1,ms.act_trans))ms.act_trans^=1
   if(ms.act_trans)ui_list(rect(b.x+b.w/2,b.y+36,b.w/2,55),ms.grid)
  }
 }
 else if(ms.type=='pick_card'){
  const b=draw_modalbox(rect(220,45))
  draw_textc(rect(b.x,b.y,b.w,16),'Pick a card- any card.',FONT_BODY,1)
  const c=rint(rect(b.x+(b.w-60-5-60-5-60)/2,b.y+b.h-20))
  if(ui_button(rect(c.x,c.y,60,20),'Previous',1)||ev.dir=='left')n_go([lms('Prev')],deck);c.x+=65
  if(ui_button(rect(c.x,c.y,60,20),'Choose',1))ms.verb=ifield(ifield(deck,'card'),'name'),n_go([lmn(ms.act_card)],deck),ms.type='action';c.x+=65
  if(ui_button(rect(c.x,c.y,60,20),'Next',1)||ev.dir=='right')n_go([lms('Next')],deck)
 }
 else if(ms.type=='trans'){
  const now=new Date().getTime()/1000
  const sofar=ms.time_start==-1?0:now-ms.time_start;if(ms.time_start==-1)ms.time_start=now
  let f=frame, tween=min(sofar*(ms.time_end/15),1.0)
  ms.canvas.image.pix=frame.image.pix;frame.image.pix.fill(0)
  const a=lml([ms.canvas,ms.carda,ms.cardb,lmn(tween)]), p=lmblk();blk_lit(p,ms.trans),blk_lit(p,a),blk_op(p,op.CALL)
  const e=lmenv();pushstate(e),issue(e,p);let quota=TRANS_QUOTA;while(quota&&running())runop(),quota--
  if(running()){listen_show(ALIGN.right,1,lms(`warning: transition ${ms.trans.n} exceeded quota and was halted.`)),tween=2}
  popstate(),frame=f,sleep_play=0,sleep_frames=0;if(tween>=1)modal_exit(0)
 }
 ms.in_modal=0
}
n_open=([type,hint])=>{
 modal_enter('open_lil');let t=type?ls(type):'',r=lms('');ms.filter=''
 if(t=='array')r=array_make(0,'u8',0)
 if(t=='sound')ms.filter='audio/*',r=sound_make(new Uint8Array(0))
 if(t=='image')ms.filter='image/*',r=image_make(rect())
 if(t=='text')ms.filter='.csv,.txt'
 ms.verb=t=='array'?lms(t): hint?ls(hint):'';return r
}
n_save=([x])=>{
 modal_enter('save_lil');x=x||NONE
 if(array_is(x)                              )ms.desc='Save a binary file.'    ,ms.text=fieldstr(lms('untitled.bin'))
 if(sound_is(x)                              )ms.desc='Save a .wav sound file.',ms.text=fieldstr(lms('sound.wav'))
 if(image_is(x)||(lil(x)&&x.v.some(image_is)))ms.desc='Save a .gif image file.',ms.text=fieldstr(lms('image.gif'))
 ms.verb=x;return NONE
}
n_alert=([t,p,x,y])=>{
 if(ls(p)=='bool'){modal_enter('confirm_lil'),ms.verb=x?lms(ls(x)):null}
 else if(ls(p)=='string'){modal_enter('input_lil');if(x)ms.text=fieldstr(x)}
 else if(ls(p)=='choose'){
  modal_enter('choose_lil')
  ms.verb=!x?ld(NONE): lil(x)?dyad.dict(x,x): ld(x); if(count(ms.verb)<1)ms.verb=ld(monad.list(NONE))
  ms.grid=gridtab(lt(monad.range(ms.verb)), y?dvix(ms.verb,y):-1)
 }else{modal_enter('alert_lil')}
 ms.message=plain_or_rich(t);return NONE
}
free_canvas=deck=>{ // make a drawing surface that isn't attached to the parent deck, but is aware of its resources:
 const d=deck_read('{deck}\n{card:home}\n{widgets}\nc:{"type":"canvas"}')
 const c=d.cards.v[0], r=c.widgets.v[0]
 iwrite(r,lms('size'),lmpair(deck.size)),d.fonts=deck.fonts,d.patterns=deck.patterns,r.free=1
 canvas_image(r,1);return r
}
go_notify=(deck,x,t,url)=>{
 if(url&&/(http|https|ftp|gopher|gemini):\/\//.test(url))modal_enter('url'),ms.text=fieldstr(lms(url))
 if(ms.type!='trans'&&x>=0&&t&&dget(deck.transit,lms(t))){
  modal_enter('trans'),ms.time_curr=0,ms.time_end=30,ms.time_start=-1;
  ms.trans=dget(deck.transit,lms(t)), ms.canvas=free_canvas(deck)
  ms.carda=draw_card(ifield(deck,'card')), ms.cardb=draw_card(ifield(deck,'cards').v[x])
 }
 const moved=x!=ln(ifield(ifield(deck,'card'),'index'))
 if(moved&&uimode=='interact')msg.pending_loop=1
 if(moved||t){
  grid_exit(),field_exit(),bg_end_selection(),bg_end_lasso(),ob.sel=[],wid.active=ms.type=='listen'?0:-1,mark_dirty()
 }
 if(uimode=='interact')msg.next_view=1
}

// General Purpose Edit History

let doc_hist=[], doc_hist_cursor=0
has_undo=_=>doc_hist_cursor>0
has_redo=_=>doc_hist_cursor<doc_hist.length
undo=_=>{const x=doc_hist[--(doc_hist_cursor)];apply(0,x)}
redo=_=>{const x=doc_hist[(doc_hist_cursor)++];apply(1,x)}
edit=x=>{doc_hist=doc_hist.slice(0,doc_hist_cursor),doc_hist.push(x),redo()}
apply=(fwd,x)=>{
 let card=ifield(deck,'card'), cn=ln(ifield(card,'index')), tn=x.card, t=x.type
 if(cn!=tn)n_go([lmn(tn)],deck),card=ifield(deck,'card')
 const wids=card.widgets
 if(t=='ob_create'){fwd=!fwd,t='ob_destroy'}
 if(t=='bg_block'){
  if(uimode!='draw')setmode('draw')
  const r=x.pos, p=x[fwd?'after':'before']
  let bg=canvas_image(card,1), s=bg.size
  const cs=getpair(ifield(card,'size'))
  if(s.x!=cs.x||s.y!=cs.y){bg=image_resize(bg,cs),iwrite(card,lms('image'),bg),s=cs}
  const cb=x.clr_before, ca=x.clr_after, clip=rect(0,0,s.x,s.y)
  if(fwd&&ca)image_paste(x.clr_pos,clip,ca,bg,1)
  image_paste(r,clip,p,bg,1)
  if(!fwd&&cb)image_paste(x.clr_pos,clip,cb,bg,1)
 }
 else if(t=='ob_props'){
  if(uimode!='object')setmode('object')
  const p=x[fwd?'after':'before']
  Object.keys(p).map(k=>{const d=p[k], w=dget(wids,lms(k));if(w)Object.keys(d).map(i=>iwrite(w,lms(i),d[i]))})
 }
 else if(t=='ob_destroy'){
  if(uimode!='object')setmode('object')
  if(fwd){
   const w=x.props.map(z=>dget(wids,dget(z,lms('name')))).filter(x=>x!=null)
   x.props=card_copy_raw(card,w),w.map(z=>card_remove(card,z))
  }
  else{
   ob.sel=[];const w=card_paste_raw(card,x.props);w.map((z,i)=>{
    dset(x.props[i],lms('name'),ifield(z,'name')),ob.sel.push(z)
    if(!dget(x.props[i],lms('pos')))iwrite(z,lms('pos'),lmpair(rcenter(frame.clip,getpair(ifield(z,'size')))))
   })
  }
 }mark_dirty()
}

// Draw Mode

image_overlay=(dst,src,mask)=>{for(let z=0;z<src.pix.length;z++)if(src.pix[z]!=mask)dst.pix[z]=src.pix[z]}
image_mask=(src,mask)=>{const r=image_copy(src);for(let z=0;z<mask.pix.length;z++)if(!mask.pix[z])r.pix[z]=0;return r}
bg_scratch_clear=_=>dr.scratch.pix.fill(BG_MASK)
bg_scratch=_=>{
 if(!dr.scratch)dr.scratch=image_make(frame.size)
 const s=dr.scratch.size;if(s.x!=frame.size.x||s.y!=frame.size.y)dr.scratch=image_make(frame.size)
 bg_scratch_clear()
}
bg_edit=_=>{
 const s=dr.scratch.size, d=rcopy(s)
 for(let z=0;z<dr.scratch.pix.length;z++){
  if(dr.scratch.pix[z]==BG_MASK)continue;const x=z%s.x, y=0|(z/s.x)
  d.x=min(d.x,x), d.y=min(d.y,y), d.w=max(d.w,x), d.h=max(d.h,y)
 }d.w-=d.x,d.h-=d.y,d.w++,d.h++
 const card=ifield(deck,'card'), back=ifield(card,'image')
 const after=image_copy(back,d);image_overlay(after,image_copy(dr.scratch,d),BG_MASK)
 edit({type:'bg_block',card:ln(ifield(card,'index')),pos:d,before:image_copy(back,d),after})
}
draw_limbo=(clip,scale)=>{
 if(!dr.limbo){/*nothing*/}
 else if(scale&&dr.limbo_dither){draw_rect      (card_to_fat(clip),21)}
 else if(scale                 ){draw_fat_scaled(clip,dr.limbo,!dr.trans,deck.patterns.pal.pix,frame_count,FAT,dr.offset)}
 else if(       dr.limbo_dither){draw_dithered  (clip,dr.limbo,!dr.trans,dr.omask,dr.dither_threshold)}
 else                           {draw_scaled    (clip,dr.limbo,!dr.trans)}
}
bg_scaled_limbo=_=>{
 const d=dr.sel_here, card=ifield(deck,'card'), back=ifield(card,'image')
 const r=dr.trans||dr.omask?image_copy(back,d):image_make(rect(d.w,d.h)), s=r.size, t=frame;frame=draw_frame(r)
 if(dr.trans){const c=dr.sel_start;draw_rect(rect(c.x-d.x,c.y-d.y,c.w,c.h),dr.fill)}
 draw_limbo(frame.clip,0),frame=t;return r
}
bg_edit_sel=_=>{
 if(!dr.limbo)return
 const d=rcopy(dr.sel_here), card=ifield(deck,'card'), back=ifield(card,'image')
 const r={type:'bg_block',card:ln(ifield(card,'index')),pos:d,before:image_copy(back,d),after:bg_scaled_limbo()}
 dr.limbo=null,dr.limbo_dither=0
 if(dr.sel_start.w>0||dr.sel_start.h>0){
  const after=image_make(rect(dr.sel_start.w,dr.sel_start.h));for(let z=0;z<after.pix.length;z++)after.pix[z]=dr.fill
  r.clr_pos=rcopy(dr.sel_start), r.clr_before=image_copy(back,dr.sel_start), r.clr_after=after, dr.sel_start=rect()
 }edit(r)
}
bg_copy_selection=s=>image_copy(canvas_image(ifield(deck,'card'),1),s)
bg_scoop_selection=_=>{if(dr.limbo)return;dr.sel_start=rcopy(dr.sel_here);dr.limbo=bg_copy_selection(dr.sel_start),dr.limbo_dither=0}
bg_draw_lasso=(r,show_ants,fill)=>{
 const o=dr.sel_start
 if(dr.omask)for(let a=0;a<o.h;a++)for(let b=0;b<o.w;b++){const h=rect(b+o.x,a+o.y);if(inclip(h)&&dr.omask.pix[b+a*o.w])pix(h,fill)}
 if(dr.mask)for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++){const h=rect(b+r.x,a+r.y);if(inclip(h)&&dr.mask.pix[b+a*r.w]){
  const c=show_ants&&ANTS==(0xFF&dr.mask.pix[b+a*r.w]),p=c?ANTS:dr.limbo.pix[b+a*r.w];if(p||!dr.trans)pix(h,p)
 }}
}
bg_lasso_preview=_=>{
 if(!bg_has_lasso())return
 const pos=dr.fatbits?fat_to_card(ev.pos):ev.pos, dpos=dr.fatbits?fat_to_card(ev.dpos):ev.dpos
 const d=rect(pos.x-dpos.x,pos.y-dpos.y), dh=rect(dr.sel_here.x+d.x,dr.sel_here.y+d.y,dr.sel_here.w,dr.sel_here.h)
 const dd=rect(pos.x-dh.x,pos.y-dh.y), insel=dr.mask!=null&&rin(dh,pos)&&dr.mask.pix[dd.x+dd.y*dh.w], r=ev.drag&&insel?dh:dr.sel_here
 if(!dr.fatbits){bg_draw_lasso(r,1,dr.fill);return}
 const o=dr.sel_start, anim=deck.patterns.anim, pal=deck.patterns.pal.pix
 const anim_pattern=(pix,x,y)=>pix<28||pix>31?pix: anim[pix-28][(0|(frame_count/4))%max(1,anim[pix-28].length)]
 const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal_pat(pal,pix,x,y)&1
 for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++){
  if(!dr.omask.pix[b+a*o.w])continue
  draw_rect(rmul(rect(b+o.x-dr.offset.x,a+o.y-dr.offset.y,1,1),FAT),dr.fill)
 }
 for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++){
  if(!dr.mask.pix[b+a*r.w])continue
  const v=dr.limbo.pix[b+a*r.w],c=anim_pattern(v,r.x+b,r.y+a),pat=draw_pattern(c,r.x+b,r.y+a)
  if(c||!dr.trans)draw_rect(rmul(rect(b+r.x-dr.offset.x,a+r.y-dr.offset.y,1,1),FAT),c>=32?c: c==0?c: pat?1:32)
 }
 for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++){
  if((0xFF&dr.mask.pix[b+a*r.w])!=ANTS)continue
  const p=rmul(rect(b+r.x-dr.offset.x,a+r.y-dr.offset.y),FAT)
  if(b<=    0||!dr.mask.pix[(b-1)+a*r.w])draw_vline(p.x      ,p.y,p.y+FAT-1,ANTS)
  if(b>=r.w-1||!dr.mask.pix[(b+1)+a*r.w])draw_vline(p.x+FAT-1,p.y,p.y+FAT-1,ANTS)
  if(a<=    0||!dr.mask.pix[b+(a-1)*r.w])draw_hline(p.x,p.x+FAT-1,p.y      ,ANTS)
  if(a>=r.h-1||!dr.mask.pix[b+(a+1)*r.w])draw_hline(p.x,p.x+FAT-1,p.y+FAT-1,ANTS)
 }
}
bg_tools=_=>{
 if     (!dr.fatbits&&ev.mu&&ev.alt){dr.fatbits=1,fat_offset(ev.pos);return}
 else if( dr.fatbits&&ev.mu&&ev.alt){dr.fatbits=0;return}if(ev.alt)return
 if(ev.md)pointer.prev=ev.pos
 const pp=rcopy(pointer.prev), te=copy_object(ev)
 if(!dover(frame.clip))ev.md=ev.mu=ev.drag=0
 if(dr.fatbits){ev.pos=fat_to_card(ev.pos),ev.dpos=fat_to_card(ev.dpos),pointer.prev=fat_to_card(pointer.prev)}
 if(dr.tool=='pencil'||dr.tool=='line'||dr.tool=='rect'||dr.tool=='fillrect'||dr.tool=='ellipse'||dr.tool=='fillellipse'){
  let clear=0;if(!dr.scratch)bg_scratch()
  if(ev.md){bg_scratch(),dr.erasing=ev.rdown||ev.shift}
  else if(ev.mu||ev.drag){
   const t=frame;frame=draw_frame(dr.scratch)
   if(dr.tool=='pencil'||dr.erasing){
    draw_line(rpair(pointer.prev,ev.pos),dr.brush,dr.erasing?0:bg_pat())
   }
   else if(dr.tool=='line'){
    let b=rcopy(snap(ev.dpos)),t=rcopy(snap(ev.pos));if(ev.shift){ // snap to isometric angles
     const d=rsub(t,b);t=b
     if     (Math.abs(d.x)*4<Math.abs(d.y)){t.y+=d.y;}
     else if(Math.abs(d.y)*4<Math.abs(d.x)){t.x+=d.x;}
     else if(Math.abs(d.x)*2<Math.abs(d.y)){t.x+=sign(d.x)*Math.abs(d.y)/2,t.y+=d.y}
     else if(Math.abs(d.y)*2<Math.abs(d.x)){t.y+=sign(d.y)*Math.abs(d.x)/2,t.x+=d.x}
     else {t.x+=sign(d.x)*Math.abs(max(d.x,d.y)),t.y+=sign(d.y)*Math.abs(max(d.x,d.y))}
    }bg_scratch_clear(),draw_line(rpair(rint(b),rint(t)),dr.brush,bg_pat())
   }
   else if(dr.tool=='rect'||dr.tool=='fillrect'){
    const b=snap(ev.dpos),a=snap(ev.pos),t=rsub(a,b);if(ev.shift){t.x=t.y=max(t.x,t.y)} // snap to square
    bg_scratch_clear();const r=rnorm(rpair(b,t));r.w++,r.h++
    if(dr.tool=='fillrect')draw_rect(r,bg_fill());draw_box(r,dr.brush,bg_pat())
   }
   else if(dr.tool=='ellipse'||dr.tool=='fillellipse'){
    const b=snap(ev.dpos),a=snap(ev.pos),t=rsub(a,b);if(ev.shift){t.x=t.y=max(t.x,t.y)} // snap to circle
    bg_scratch_clear();const r=rnorm(rpair(radd(b,rect(1,1)),t));r.w--,r.h--
    const c=rect(r.x+(r.w/2.0),r.y+(r.h/2.0)), divs=100, poly=range(divs).map(z=>{
     const a=z*(2*Math.PI)/divs;return rint(rect(c.x+(0.5+r.w/2.0)*Math.cos(a),c.y+(0.5+r.h/2.0)*Math.sin(a)))
    });poly.push(poly[0])
    if(dr.tool=='fillellipse')draw_poly(poly,bg_fill());draw_lines(poly,dr.brush,bg_pat())
   }
   frame=t;if(ev.mu)bg_edit(),clear=1
  }
  if(dr.scratch){
   if(dr.fatbits){draw_fat(dr.scratch,deck.patterns.pal.pix,frame_count,BG_MASK,FAT,dr.offset)}
   else{image_overlay(frame.image,dr.scratch,BG_MASK);}
  }
  if(clear)bg_scratch_clear()
 }
 if(dr.tool=='lasso'){
  const d=rect(ev.pos.x-ev.dpos.x,ev.pos.y-ev.dpos.y)
  const dh=rect(dr.sel_here.x+d.x,dr.sel_here.y+d.y,dr.sel_here.w,dr.sel_here.h)
  const dd=rect(ev.pos.x-dh.x,ev.pos.y-dh.y), insel=dr.mask!=null&&over(dh)&&dr.mask.pix[dd.x+dd.y*dh.w]
  if(ev.md&&!insel){bg_lasso_preview(),bg_end_lasso(),dr.poly.push(rcopy(ev.dpos))}
  else if(ev.drag&&!insel&&dr.poly.length>0){const l=last(dr.poly);if(ev.pos.x!=l.x||ev.pos.y!=l.y)dr.poly.push(rcopy(ev.pos))}
  else if(ev.mu&&insel){dr.sel_here=radd(dr.sel_here,d)}
  else if(ev.mu){
   const r=poly_bounds(dr.poly);if(r.w>1&&r.h>1){
    dr.mask=image_make(rect(r.w,r.h))
    const t=frame;frame=draw_frame(dr.mask)
    for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++)if(poly_in(dr.poly,rect(b+r.x,a+r.y)))pix(rect(b,a),1); dr.omask=image_copy(dr.mask)
    if(dr.poly.length>0)draw_lines(dr.poly.concat(dr.poly[0]).map(p=>rsub(p,rect(r.x,r.y))),0,ANTS)
    frame=t,dr.sel_here=rcopy(r),dr.sel_start=rcopy(r),bg_scoop_selection()
   }dr.poly=[]
  }
  if(dr.mask&&dr.limbo){
   if(ev.dir=='left' ){ev.dir=0,dr.sel_here.x--}
   if(ev.dir=='up'   ){ev.dir=0,dr.sel_here.y--}
   if(ev.dir=='right'){ev.dir=0,dr.sel_here.x++}
   if(ev.dir=='down' ){ev.dir=0,dr.sel_here.y++}
   if(ev.exit){dr.limbo=dr.mask=dr.omask=null,bg_end_lasso()}
  }
 }
 if(dr.tool=='poly'){
  if(ev.md){dr.poly=[rect(ev.dpos.x,ev.dpos.y)]}
  else if(ev.drag&&dr.poly.length>0){const l=last(dr.poly);if(ev.pos.x!=l.x||ev.pos.y!=l.y)dr.poly.push(rcopy(ev.pos))}
  else if(ev.mu){
   dr.poly.push(rcopy(ev.dpos)),bg_scratch();const t=frame;frame=draw_frame(dr.scratch)
   draw_poly(dr.poly,bg_fill()),draw_lines(dr.poly,dr.brush,bg_pat()),frame=t,bg_edit(),bg_scratch_clear(),dr.poly=[]
  }
 }
 if(dr.tool=='lasso'||dr.tool=='poly'){
  const o=rsub(dr.sel_here,dr.sel_start)
  draw_lines(dr.poly.map(p=>radd(o,card_to_fat(p))),dr.tool=='lasso'?0:dr.brush,dr.tool=='lasso'?ANTS:bg_pat())
 }
 if(dr.tool=='fill'&&ev.mu){
  const bg=canvas_image(ifield(deck,'card'),1), t=frame;bg_scratch(),frame=draw_frame(dr.scratch)
  draw_fill(ev.pos,ev.rup?bg_fill():bg_pat(),bg),frame=t,bg_edit(),bg_scratch_clear()
 }
 if(!bg_has_sel()&&!bg_has_lasso()){
  if(dr.fatbits){
   if(ev.dir=='left' )dr.offset.x-=ev.shift?dr.grid_size.x:1
   if(ev.dir=='right')dr.offset.x+=ev.shift?dr.grid_size.x:1
   if(ev.dir=='up'   )dr.offset.y-=ev.shift?dr.grid_size.y:1
   if(ev.dir=='down' )dr.offset.y+=ev.shift?dr.grid_size.y:1
   dr.offset=rint(rect(max(0,min(dr.offset.x,frame.size.x-(frame.size.x/8))),max(0,min(dr.offset.y,frame.size.y-(frame.size.y/8)))))
   if(ev.exit)dr.fatbits=0
  }
  else{
   if(ev.dir=='left' )n_go([lms('Prev')],deck)
   if(ev.dir=='right')n_go([lms('Next')],deck)
  }
 }
 ev=te,pointer.prev=pp
}
bg_end_lasso=_=>{
 if(uimode!='draw'||dr.tool!='lasso')return
 const data=dr.mask&&dr.limbo, diffrect=!requ(dr.sel_here,dr.sel_start);let diffmask=dr.omask==null;
 if(dr.omask)for(let z=0;data&&z<dr.mask.pix.length;z++)if((dr.mask.pix[z]>0)!=(dr.omask.pix[z]>0)){diffmask=1;break}
 if(data&&(diffrect||diffmask)){
  bg_scratch();const t=frame;frame=draw_frame(dr.scratch),bg_draw_lasso(dr.sel_here,0,dr.fill),frame=t,bg_edit(),bg_scratch_clear()
 }dr.poly=[],dr.mask=null,dr.omask=null,dr.limbo=null,dr.sel_here=rect(),dr.sel_start=rect()
}
bg_end_selection=_=>{
 if(uimode!='draw'||dr.tool!='select')return
 if(dr.sel_here.w<=0&&dr.sel_here.h<=0)return
 bg_edit_sel(),dr.sel_start=rcopy(ev.dpos),dr.sel_here=rcopy(ev.dpos)
}
bg_delete_selection=_=>{
 if(bg_has_lasso()){
  dr.mask=null,bg_scratch();const t=frame;frame=draw_frame(dr.scratch),bg_draw_lasso(dr.sel_here,0,dr.fill),frame=t
  bg_edit(),bg_scratch_clear(),bg_end_lasso();return
 }
 if(!bg_has_sel())return
 if(dr.limbo!=null&&dr.sel_start.w<=0&&dr.sel_start.h<=0){dr.sel_here=rect(),dr.limbo=null,dr.limbo_dither=0;return}
 if(dr.sel_start.w<=0&&dr.sel_start.h<=0)dr.sel_start=rcopy(dr.sel_here)
 dr.sel_here=rect(),dr.limbo=image_make(rect(1,1)),dr.limbo_dither=0,bg_edit_sel(),dr.sel_start=rcopy(ev.dpos),dr.sel_here=rcopy(ev.dpos)
}
bg_paste=image=>{
 const clip=fat_clip(), f=rect(clip.w*.75,clip.h*.75);let s=image.size
 if(s.x>f.x||s.y>f.y){const scale=min(f.x/s.x,f.y/s.y);s=rect(s.x*scale,s.y*scale)}if(!s.x)return
 if(bg_has_sel()){bg_scoop_selection(),dr.limbo=image,dr.limbo_dither=0}
 else{settool('select'),dr.sel_start=rect(),dr.sel_here=rcenter(clip,s),dr.limbo=image,dr.limbo_dither=0}
}
draw_handles=r=>{
 const h=5, pal=deck.patterns.pal.pix
 const x0=r.x+1-h, x2=r.x+r.w-1, y0=r.y+1-h, y2=r.y+r.h-1, x1=0|((x2-x0)/2+x0), y1=0|((y2-y0)/2+y0)
 draw_invert(pal,rclip(rect(x0,y0,h,h),frame.clip))
 draw_invert(pal,rclip(rect(x0,y2,h,h),frame.clip))
 draw_invert(pal,rclip(rect(x2,y0,h,h),frame.clip))
 draw_invert(pal,rclip(rect(x2,y2,h,h),frame.clip))
 draw_invert(pal,rclip(rect(x2,y1,h,h),frame.clip))
 draw_invert(pal,rclip(rect(x1,y2,h,h),frame.clip))
 draw_invert(pal,rclip(rect(x1,y0,h,h),frame.clip))
 draw_invert(pal,rclip(rect(x0,y1,h,h),frame.clip))
}
in_handle=r=>{
 const h=5, x0=r.x+1-h, x2=r.x+r.w-1, y0=r.y+1-h, y2=r.y+r.h-1, x1=0|((x2-x0)/2+x0), y1=0|((y2-y0)/2+y0)
 if(over(rect(x0,y0,h,h)))return 4
 if(over(rect(x0,y2,h,h)))return 6
 if(over(rect(x2,y0,h,h)))return 2
 if(over(rect(x2,y2,h,h)))return 0
 if(over(rect(x2,y1,h,h)))return 1
 if(over(rect(x1,y0,h,h)))return 3
 if(over(rect(x0,y1,h,h)))return 5
 if(over(rect(x1,y2,h,h)))return 7;return -1
}
bg_select=_=>{
 if(uimode!='draw'||dr.tool!='select')return rect(0,0,0,0)
 const te=copy_object(ev)
 if(dr.fatbits){ev.pos=fat_to_card(ev.pos),ev.dpos=fat_to_card(ev.dpos),pointer.prev=fat_to_card(pointer.prev)}
 let s=rcopy(dr.sel_here), has_sel=s.w>0||s.h>0, in_sel=has_sel&&dover(s)
 const ax=min(ev.dpos.x,ev.pos.x), bx=max(ev.dpos.x,ev.pos.x), ay=min(ev.dpos.y,ev.pos.y), by=max(ev.dpos.y,ev.pos.y), h=5
 const x0=s.x+1-h, x2=s.x+s.w-1, y0=s.y+1-h, y2=s.y+s.h-1, x1=0|((x2-x0)/2+x0), y1=0|((y2-y0)/2+y0), dx=ev.pos.x-ev.dpos.x, dy=ev.pos.y-ev.dpos.y
 const sz=dr.limbo?dr.limbo.size:rect(dr.sel_start.w,dr.sel_start.h)
 handle=(rw,rh,ox,oy,ow,oh)=>{if(has_sel&&(ev.mu||ev.drag)&&dover(rect(rw,rh,h,h))){
  s=rnorm(keep_ratio(rect(s.x+ox,s.y+oy,s.w+ow,s.h+oh),sz))
  if(ev.mu)dr.sel_here=snapr(s);bg_scoop_selection(),uicursor=cursor.drag;return 1
 };return 0}
 if(in_layer()){
  if     (handle(x2,y2,  0, 0, dx, dy)){} // se
  else if(handle(x0,y2, dx, 0,-dx, dy)){} // sw
  else if(handle(x2,y0,  0,dy, dx,-dy)){} // ne
  else if(handle(x0,y0, dx,dy,-dx,-dy)){} // nw
  else if(handle(x2,y1,  0, 0, dx,  0)){} // e
  else if(handle(x1,y0,  0,dy,  0,-dy)){} // n
  else if(handle(x0,y1, dx, 0,-dx,  0)){} // w
  else if(handle(x1,y2,  0, 0,  0, dy)){} // s
  else if(ev.md&&in_sel){bg_scoop_selection()} // begin move
  else if((ev.mu||ev.drag)&&in_sel){s.x+=dx, s.y+=dy;if(ev.mu)dr.sel_here=snap(s)} // move/finish
  else if(ev.md&&!in_sel){if(has_sel){draw_limbo(card_to_fat(s),dr.fatbits),bg_end_selection(),has_sel=0}s=rcopy(dr.sel_here)} // begin create
  else if(ev.mu||ev.drag){s=snapr(rect(ax,ay,bx-ax,by-ay));if(ev.mu)dr.sel_here=s} // size/finish
 }
 if(has_sel)draw_limbo(s,dr.fatbits)
 if(in_layer()){
  let nudge=0
  if(has_sel&&ev.dir=='left' ){ev.dir=0,bg_scoop_selection(),dr.sel_here.x-=ev.shift?dr.grid_size.x:1,nudge=1}
  if(has_sel&&ev.dir=='up'   ){ev.dir=0,bg_scoop_selection(),dr.sel_here.y-=ev.shift?dr.grid_size.y:1,nudge=1}
  if(has_sel&&ev.dir=='right'){ev.dir=0,bg_scoop_selection(),dr.sel_here.x+=ev.shift?dr.grid_size.x:1,nudge=1}
  if(has_sel&&ev.dir=='down' ){ev.dir=0,bg_scoop_selection(),dr.sel_here.y+=ev.shift?dr.grid_size.y:1,nudge=1}
  if(nudge&&ev.shift)dr.sel_here=snap(dr.sel_here)
  if(ev.exit){dr.limbo=null,dr.limbo_dither=0,bg_end_selection()}
 }
 ev=te;return card_to_fat(s)
}
bg_tighten=_=>{
 const r=dr.sel_here
 const set=(p,v)=>dr.mask.pix[p.x+p.y*dr.sel_here.w]=v
 const get=p=>(p.x<0||p.y<0||p.x>=dr.sel_here.w||p.y>=dr.sel_here.h)?0:dr.mask.pix[p.x+p.y*dr.sel_here.w]
 if(dr.tool=='select'){ // convert box selections into masked lasso selections
  dr.tool='lasso',bg_scoop_selection();const s=dr.sel_start, l=dr.limbo, t=frame
  dr.limbo=image_make(rect(r.w,r.h)),frame=draw_frame(dr.limbo)
  if(dr.limbo_dither){draw_dithered(frame.clip,l,1,dr.omask,dr.dither_threshold),dr.limbo_dither=0}else{draw_scaled(frame.clip,l,1)}frame=t
  dr.mask=image_make(rect(r.w,r.h)),dr.mask.pix.fill(1)
  if(s.w>0&&s.h>0){dr.omask=image_make(rect(s.w,s.h)),dr.omask.pix.fill(1)}else{dr.omask=null}
 }
 let changed=1,background=bg_fill();while(changed){changed=0 // erode the mask, iterating to a fixed point
  for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++)if(get(rect(b,a))&&dr.limbo.pix[b+a*r.w]==background){
   const n=get(rect(b-1,a))&&get(rect(b,a-1))&&get(rect(b+1,a))&&get(rect(b,a+1));if(!n)set(rect(b,a),0),changed=1
  }
 }
 for(let a=0;a<r.h;a++)for(let b=0;b<r.w;b++)if(get(rect(b,a))){ // regenerate the ANTS outline
  const n=get(rect(b-1,a))&&get(rect(b,a-1))&&get(rect(b+1,a))&&get(rect(b,a+1));if(!n)set(rect(b,a),ANTS)
 }
}

// Object Edit Mode

ob_order=_=>{ob.sel.sort((av,bv)=>ln(ifield(av,'index'))-ln(ifield(bv,'index')))}
ob_edit_prop=(key,value)=>{
 const before={}, after={}
 ob.sel.map(w=>{const n=ls(ifield(w,'name')),bp={},ap={}; bp[key]=ifield(w,key),ap[key]=value,before[n]=bp,after[n]=ap})
 edit({type:'ob_props',card:ln(ifield(ifield(deck,'card'),'index')),before,after})
}
ob_create=props=>{
 edit({type:'ob_create',card:ln(ifield(ifield(deck,'card'),'index')),props})
}
ob_destroy=_=>{
 if(ob.sel.length<1)return
 const props=ob.sel.map(w=>lmd([lms('name')],[ifield(w,'name')]))
 edit({type:'ob_destroy',card:ln(ifield(ifield(deck,'card'),'index')),props}),ob.sel=[]
}
can_coalesce=move=>{
 if(has_redo()||doc_hist.length==0)return false
 const prev=doc_hist[doc_hist_cursor-1];if(prev.type!='ob_props')return false
 if(Object.keys(prev.after).length!=ob.sel.length)return false
 for(let z=0;z<ob.sel.length;z++){
  const key=Object.keys(prev.after)[z], val=prev.after[key]
  if(ls(ifield(ob.sel[z],'name'))!=key)return false
  if(Object.keys(val).length!=(move?1:2))return false
  const keys=Object.keys(val)
  if(keys[0]!='pos')return false
  if(!move&&keys[1]!='size')return false
 }return true
}
ob_move=(delta,coalesce)=>{
 if(ob.sel.length<1)return
 if(coalesce&&can_coalesce(1)){
  const r=doc_hist[doc_hist_cursor-1];
  Object.values(r.after).map(z=>z.pos=lmpair(radd(getpair(z.pos),delta))),undo(),redo()
 }else{
  const before={},after={};ob.sel.map(w=>{
   const n=ls(ifield(w,'name')),f=ifield(w,'pos'),fv=getpair(f)
   before[n]={pos:f},after[n]={pos:lmpair(radd(fv,delta))}
  }),edit({type:'ob_props',card:ln(ifield(ifield(deck,'card'),'index')),before,after})
 }
}
ob_resize=(size,coalesce)=>{
 if(ob.sel.length!=1)return;const w=ob.sel[0]
 if(coalesce&&can_coalesce(0)){
  const r=doc_hist[doc_hist_cursor-1],after=Object.values(r.after)[0]
  after.pos =lmpair(rect(size.x,size.y))
  after.size=lmpair(rect(size.w,size.h)),undo(),redo()
 }else{
  const bp={pos:ifield(w,'pos')            ,size:ifield(w,'size')           }
  const ap={pos:lmpair(rect(size.x,size.y)),size:lmpair(rect(size.w,size.h))}
  const before={},after={},n=ls(ifield(w,'name'));before[n]=bp,after[n]=ap
  edit({type:'ob_props',card:ln(ifield(ifield(deck,'card'),'index')),before,after})
 }
}
object_properties=x=>{
 ob.sel=[x]
 if(button_is(x))modal_enter('button_props')
 if(field_is (x))modal_enter('field_props' )
 if(slider_is(x))modal_enter('slider_props')
 if(canvas_is(x))modal_enter('canvas_props')
 if(grid_is  (x))modal_enter('grid_props'  )
}
object_editor=_=>{
 const card=ifield(deck,'card'), wids=ifield(card,'widgets'), pal=deck.patterns.pal.pix
 if(ob.sel.length==0&&in_layer()){
  if(ev.dir=='left' )n_go([lms('Prev')],deck)
  if(ev.dir=='right')n_go([lms('Next')],deck)
 }
 wids.v.map(wid=>{
  const w=unpack_widget(wid), sel=ob.sel.some(x=>x==wid)
  if(sel){draw_box(inset(w.size,-1),0,ANTS)}else if(ob.show_bounds){draw_boxinv(pal,inset(w.size,-1))}
  if(sel&&ob.sel.length==1){draw_handles(w.size)}
  if(w.locked&&ob.show_bounds){draw_rect(rect(w.size.x+w.size.w-10,w.size.y,10,10),1),draw_icon(rect(w.size.x+w.size.w-8,w.size.y+1),LOCK,32)}
 })
 if(!in_layer())return
 if(ob.sel.length>0){
  let nudge=0
  if(ev.dir=='left' )ob_move(rect(-1*(ev.shift?dr.grid_size.x:1), 0),1),nudge=1
  if(ev.dir=='right')ob_move(rect( 1*(ev.shift?dr.grid_size.x:1), 0),1),nudge=1
  if(ev.dir=='up'   )ob_move(rect( 0,-1*(ev.shift?dr.grid_size.y:1)),1),nudge=1
  if(ev.dir=='down' )ob_move(rect( 0, 1*(ev.shift?dr.grid_size.y:1)),1),nudge=1
  if(nudge&&ev.shift&&ob.sel.length==1)ob_move(snap_delta(getpair(ifield(ob.sel[0],'pos'))),1)
 }
 const ish=ob.sel.length==1?in_handle(unpack_widget(ob.sel[0]).size):-1
 const isw=wids.v.some(w=>over(unpack_widget(w).size)&&ob.sel.some(x=>x==w))
 const a=ev.pos,b=ob.prev,dragged=a.x!=b.x||a.y!=b.y
 const sr=rnorm(rect(ev.dpos.x,ev.dpos.y,ev.pos.x-ev.dpos.x,ev.pos.y-ev.dpos.y)), box=sr.w>1||sr.h>1;
 if(isw&&ev.dclick){
  for(let z=count(wids)-1;z>=0;z--){
   const wid=wids.v[z], w=unpack_widget(wid)
   if(over(w.size)){object_properties(wid);break}
  }
 }
 else if(isw&&ev.mu&&!box){
  for(let z=ob.sel.length-1;z>=0;z--){
   const wid=ob.sel[z], w=unpack_widget(wid)
   if(over(w.size)){if(ev.shift){ob.sel=ob.sel.filter(x=>x!=wid)}else{ob.sel=[wid]};break}
  }
 }
 else if(ish!=-1&&ev.md){ob.resize=1,ob.resize_first=1,ob.handle=ish,ob.prev=rcopy(ev.pos),ob.orig=unpack_widget(ob.sel[0]).size}
 else if(isw    &&ev.md){ob.move  =1,ob.move_first  =1,ob.prev=rcopy(ev.pos)}
 else if(ob.resize&&(!ev.drag||!ob.sel.length)){ob.resize=0,ob.resize_first=0}
 else if(ob.move&&(!ev.drag||!ob.sel.length)){
  if(ob.sel.length==1)ob_move(snap_delta(getpair(ifield(ob.sel[0],'pos'))),!ob.move_first)
  ob.move=0,ob.move_first=0
 }
 else if(ob.resize){
  let delta=rsub(ev.pos,ev.dpos), r=rcopy(ob.orig)
  if(ob.handle==0){r.w+=delta.x, r.h+=delta.y}
  if(ob.handle==2){r.w+=delta.x, r.h-=delta.y, r.y+=delta.y}
  if(ob.handle==6){r.w-=delta.x, r.h+=delta.y, r.x+=delta.x}
  if(ob.handle==4){r.w-=delta.x, r.h-=delta.y, r.x+=delta.x, r.y+=delta.y}
  if(ob.handle==1){r.w+=delta.x}
  if(ob.handle==3){r.h-=delta.y, r.y+=delta.y}
  if(ob.handle==5){r.w-=delta.x, r.x+=delta.x}
  if(ob.handle==7){r.h+=delta.y}
  r=snapr(r), r.w=max(8,r.w), r.h=max(8,r.h)
  if(dragged)ob_resize(r,!ob.resize_first),ob.resize_first=0,ob.prev=rcopy(ev.pos)
 }
 else if(ob.move){
  const delta=rsub(a,b)
  if(dragged)ob_move(delta,!ob.move_first),ob.move_first=0,ob.prev=rcopy(ev.pos)
 }else{
  if(box&&ev.drag)draw_box(sr,0,ANTS); if(box&&(ev.drag||ev.mu))ob.sel=[]
  let f=0;for(let z=count(wids)-1;z>=0;z--){ // backward pass for selection priority(!)
   const wid=wids.v[z], w=unpack_widget(wid), sel=ob.sel.some(x=>x==wid), overlap=rclip(w.size,sr)
   const insel=box?overlap.w>=1&&overlap.h>=1: over(w.size)&&dover(w.size), c=ev.mu&insel
   if(c)f=1; if(!c)continue; if(box){ob.sel.push(wid);continue}
   if(!sel){if(!ev.shift)ob.sel=[];ob.sel.push(wid);break}
  }if(ev.mu&&!f)ob.sel=[]
 }
}

// Toolbars

let toolbars_enable=0, tzoom=1 // should be off by default?
const tcellw=22, tcellh=19, tgap=1, toolsize=rect(tcellw*2+1,tcellh*18+tgap+1), tfb=image_make(toolsize), tid=new ImageData(toolsize.x,toolsize.y)
const tooltypes=['select','pencil','lasso','line','fill','poly','rect','fillrect','ellipse','fillellipse']
const patorder=[0,1,4,5,8,9,16,17,12,13,18,19,20,21,22,23,24,25,26,27,2,6,3,7,10,11,14,15,28,29,30,31] // pleasing visual ramps for 2 columns

toolbars=_=>{
 if(!toolbars_enable)return
 const toolbar=(element,render,behavior)=>{
  const c=element.getBoundingClientRect()
  const pos =rint(rect((ev.rawpos .x-c.x)/tzoom,(ev.rawpos .y-c.y)/tzoom))
  const dpos=rint(rect((ev.rawdpos.x-c.x)/tzoom,(ev.rawdpos.y-c.y)/tzoom))
  tfb.pix.fill(0),frame=draw_frame(tfb),draw_box(rpair(rect(),toolsize),0,1),behavior(pos,dpos)
  const anim=deck.patterns.anim, pal=deck.patterns.pal.pix
  const animated=rin(rect(c.x,c.y,c.width,c.height),ev.rawpos)&&dr.show_anim?(0|(frame_count/4)):0
  const anim_pattern=(pix,x,y)=>pix<28||pix>31?pix: anim[pix-28][animated%max(1,anim[pix-28].length)]
  const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal_pat(pal,pix,x,y)&1
  const draw_color  =(pix,x,y)=>pix>47?0: pix>31?pix-32: draw_pattern(pix,x,y)?15:0
  const data=tid.data;for(let z=0,d=0,y=0;y<tid.height;y++)for(let x=0;x<tid.width;x++,z++){
   const pix=tfb.pix[z], a=anim_pattern(pix,x,y), c=draw_color(a,x,y), cv=COLORS[c]
   data[d++]=0xFF&(cv>>16),data[d++]=0xFF&(cv>>8),data[d++]=0xFF&(cv),data[d++]=0xFF
  }
  render.getContext('2d').putImageData(tid,0,0)
  const g=element.getContext('2d');g.imageSmoothingEnabled=tzoom!=(0|tzoom),g.save(),g.scale(tzoom,tzoom),g.drawImage(render,0,0),g.restore()
 }
 const toolbtn=(pos,dn,b,icon,active)=>{
  const i=rcenter(b,rect(16,16))
  draw_box(b,0,1);if(active)draw_rect(b,1);draw_icon(i,TOOLS[icon],active?0:1)
  if(rin(b,pos))uicursor=cursor.point;return rin(b,pos)&&rin(b,dn)&&ev.mu
 }
 const modebtn=(pos,dn,b,text,active)=>{
  draw_box(b,0,1);if(active)draw_rect(inset(b,2),1);draw_textc(b,text,FONT_BODY,active?0:1)
  if(rin(b,pos))uicursor=cursor.point;return rin(b,pos)&&rin(b,dn)&&ev.mu
 }
 const brushbtn=(pos,dn,b,brush)=>{
  const i=rint(rect(b.x+(b.w/2),b.y+(b.h/2)))
  draw_box(b,0,1),draw_line(rect(i.x,i.y,i.x,i.y),brush,1)
  if(dr.brush==brush)draw_box(inset(b,2),0,1); if(!rin(b,pos))return
  uicursor=cursor.point;if(!ev.mu||!rin(b,dn))return
  setmode('draw');if(dr.tool=='select'||dr.tool=='lasso'||dr.tool=='fill')settool('pencil');dr.brush=brush
 }
 const palbtn=(pos,dn,b,pattern)=>{
  if((dr.pickfill?dr.fill:dr.pattern)==pattern){draw_rect(inset(b,3),pattern),draw_box(inset(b,3),0,1)}else{draw_rect(b,pattern)}
  if(rin(b,pos)){uicursor=cursor.point;if(ev.mu&&rin(b,dn)){if(dr.pickfill){dr.fill=pattern}else{dr.pattern=pattern}}}draw_box(b,0,1)
 }
 toolbar(q('#ltools'),q('#lrender'),(pos,dn)=>{
  draw_rect(rect(0,6*tcellh,toolsize.x,tgap),1)
  if(toolbtn(pos,dn,rect(0     ,0,tcellw+1,tcellh+1),0,uimode=='interact'))setmode('interact'),ev.mu=ev.md=0
  if(toolbtn(pos,dn,rect(tcellw,0,tcellw+1,tcellh+1),1,uimode=='object'  ))setmode('object'  ),ev.mu=ev.md=0
  for(let z=0;z<2*12;z++)brushbtn(pos,dn,rect((z%2)*tcellw,(6+(0|(z/2)))*tcellh+tgap,tcellw+1,tcellh+1),((z*12)+(0|(z/2)))%24)
  for(let z=0;z<10;z++){
   if(toolbtn(pos,dn,rect((z%2)*tcellw,(1+(0|(z/2)))*tcellh,tcellw+1,tcellh+1),z+2,uimode=='draw'&&dr.tool==tooltypes[z])){
    settool(tooltypes[z]),ev.mu=ev.md=0
   }
  }
 })
 toolbar(q('#rtools'),q('#rrender'),(pos,dn)=>{
  draw_rect(rect(0,16*tcellh,toolsize.x,tgap),1)
  if(modebtn(pos,dn,rect(0,0     ,tcellw*2+1,tcellh+1),'Stroke',dr.pickfill==0))dr.pickfill=0
  if(modebtn(pos,dn,rect(0,tcellh,tcellw*2+1,tcellh+1),'Fill'  ,dr.pickfill==1))dr.pickfill=1
  for(let z=0;z<4*8;z++)palbtn(pos,dn,rect((z%2)*tcellw,(2+(0|(z/2)))*tcellh+(z>=28?tgap:0),tcellw+1,tcellh+1),patorder[z])
 })
}

// Script Editor

setscript=x=>{
 if(uimode!='script')sc.prev_mode=uimode;setmode('script')
 sc.status='', sc.target=lii(x)?x:x[0], sc.others=lii(x)?[]: x.slice(1)
 let v=ifield(sc.target,'script'), p=0
 if(!count(v))v=card_is  (sc.target)?(p=1,lms('on view do\n \nend')):
                button_is(sc.target)?(p=1,lms('on click do\n \nend')):
                grid_is  (sc.target)?(p=1,lms('on click row do\n \nend')):
                field_is (sc.target)?(p=1,lms('on change val do\n \nend')):
                slider_is(sc.target)?(p=1,lms('on change val do\n \nend')):
                canvas_is(sc.target)?(p=1,lms('on click pos do\n \nend\n\non drag pos do\n \nend\n\non release pos do\n \nend')):v
 sc.status=p?'No existing script; populated a template.':'',sc.f=fieldstr(v)
}
finish_script=_=>{if(sc.next){setscript(sc.next),sc.next=null}else{setmode(sc.prev_mode)}}
close_script=next=>{
 sc.next=next,field_exit()
 try{const text=ls(rtext_string(sc.f.table));parse(text),script_save(lms(text)),finish_script()}
 catch(e){
  modal_enter('confirm_script')
  ms.message=lms(`The current script contains errors:\n\n${e.x}\n\nDo you wish to discard your changes?`),ms.verb=lms('Discard')
 }
}
script_editor=_=>{
 const field_position=(x,cursor)=>{
  if(x.layout.length<1)return rect(1,1);cursor=max(0,min(cursor,x.layout.length+1))
  const e=cursor>=x.layout.length?1:0, i=cursor-e, l=x.layout[i].line, c=i-x.lines[l].range.x
  return rect(l+1,c+1+e)
 }
 const mh=3+font_h(FONT_MENU), bb=rect(0,mh,frame.size.x+1,frame.size.y-2*mh)
 let overw=null;if(sc.xray){
  const card=ifield(deck,'card'),wids=ifield(card,'widgets');
  for(let z=0;z<wids.v.length;z++){
   const wid=wids.v[z],size=unpack_widget(wid).size, o=ev.alt&&over(size), col=o?(overw=wid,13):44
   draw_textc(size,ls(ifield(wid,'name')),FONT_BODY,o?-1:col),draw_box(size,0,col)
   if(count(ifield(wid,'script')))draw_icon(rect(size.x-1,size.y),ICONS[ICON.lil],o?1:col)
   if(ev.alt&&ev.mu&&over(size)&&dover(size)){close_script(wid),ev.md=ev.mu=0;break}
  }if(ev.alt&&ev.mu)close_script(card),ev.md=ev.mu=0
 }
 ui_codeedit(bb,0,sc.f),draw_hline(0,frame.size.x,frame.size.y-mh-1,1)
 if(overw){uicursor=cursor.point;draw_textc(unpack_widget(overw).size,ls(ifield(overw,'name')),FONT_BODY,-1)}
 if(sc.status.length){draw_text_fit(rect(3,frame.size.y-mh+3,frame.size.x,mh-6),sc.status,FONT_BODY,1)}
 else{
  let stat='';if(in_layer()&&wid.infield){
   const x=layout_richtext(deck,sc.f.table,FONT_MONO,ALIGN.left,bb.w)
   let a=min(wid.cursor.x,wid.cursor.y), b=max(wid.cursor.x,wid.cursor.y)
   if(a!=b&&a<x.layout.length){
    a=max(0,min(a,x.layout.length)), b=max(0,min(b,x.layout.length))
    const ap=field_position(x,a),bp=field_position(x,b), l=(bp.x-ap.x)+1, c=b-a
    stat=`${l} line${l==1?'':'s'}, ${c} character${c==1?'':'s'} selected`
   }else{const p=field_position(x,min(a,b));stat=`Line ${p.x}, Column ${p.y}`}
  }
  const l=font_textsize(FONT_BODY,stat);draw_text(rect(3,frame.size.y-mh+3,l.x,l.y),stat,FONT_BODY,1)
  stat=`script of ${sc.target.n}  '${ls(ifield(sc.target,'name'))}'${sc.others.length?` and ${sc.others.length} more`:''}`
  const t=layout_plaintext(stat,FONT_BODY,ALIGN.right,rect(frame.size.x-6-20-l.x,font_h(FONT_BODY)))
  draw_text_wrap(rect(3+l.x+20,frame.size.y-mh+3,t.size.x,t.size.y),t,1)
 }if(in_layer()&&ev.exit)close_script(),ev.exit=0
}

// Runtime

interpret=_=>{
 if(msg.overshoot&&!running()&&!msg.pending_view&&!msg.next_view)msg.overshoot=0
 if(msg.pending_halt){if(running())halt();sleep_frames=0,sleep_play=0,msg.pending_view=0,msg.next_view=0}
 if(sleep_play&&sfx_any())return 0;sleep_play=0
 if(sleep_frames){sleep_frames--;return 0}
 const nomodal=_=>(ms.type==null||ms.type=='query'||ms.type=='listen')
 let quota=FRAME_QUOTA;while(1){
  while(nomodal()&&running()&&sleep_frames==0&&sleep_play==0&&quota>0){runop(),quota--,mark_dirty()}frame=context
  if(quota<=0&&running())msg.overshoot=1
  if(!nomodal()||quota<=0||sleep_frames||sleep_play){if(sleep_frames)sleep_frames--;break}
  if(!running()&&pending_popstate)popstate(),pending_popstate=0
  if(msg.pending_halt||pending_popstate){/*suppress other new events until this one finishes*/}
  else if(msg.pending_view){fire_event_async(ifield(deck,'card'),'view',NONE),msg.pending_view=0}
  else if(msg.target_click){
   const arg=grid_is(msg.target_click)?lmn(msg.arg_click.y): canvas_is(msg.target_click)?lmpair(msg.arg_click): NONE
   fire_event_async(msg.target_click,'click',arg),msg.target_click=null
  }
  else if(msg.target_drag    ){fire_event_async(msg.target_drag    ,'drag'    ,lmpair(msg.arg_drag   )),msg.target_drag    =null}
  else if(msg.target_release ){fire_event_async(msg.target_release ,'release' ,lmpair(msg.arg_release)),msg.target_release =null}
  else if(msg.target_run     ){fire_event_async(msg.target_run     ,'run'     ,msg.arg_run            ),msg.target_run     =null}
  else if(msg.target_link    ){fire_event_async(msg.target_link    ,'link'    ,msg.arg_link           ),msg.target_link    =null}
  else if(msg.target_order   ){fire_event_async(msg.target_order   ,'order'   ,msg.arg_order          ),msg.target_order   =null}
  else if(msg.target_change  ){fire_event_async(msg.target_change  ,'change'  ,msg.arg_change         ),msg.target_change  =null}
  else if(msg.target_navigate){fire_event_async(msg.target_navigate,'navigate',msg.arg_navigate       ),msg.target_navigate=null}
  if(!running())break // not running, and no remaining events to process, so we're done for this frame
 }if(msg.next_view&&ms.type!='listen')msg.pending_view=1,msg.next_view=0 // no more than one view[] event per frame!
 return FRAME_QUOTA-quota
}

text_edit_menu=_=>{
 const selection=wid.fv!=null&&wid.cursor.x!=wid.cursor.y
 if(menu_item('Undo',wid.hist_cursor>0              ,'z'))field_undo()
 if(menu_item('Redo',wid.hist_cursor<wid.hist.length,'Z'))field_redo()
 menu_separator()
 if(menu_item('Cut',selection,'x',menucut)){}
 if(menu_item('Copy',selection,'c',menucopy)){}
 if(menu_item('Paste',wid.fv!=null,'v',menupaste)){}
 if(menu_item('Clear',wid.fv!=null))wid.cursor=rect(0,RTEXT_END),field_keys('Delete',0)
 menu_separator()
 if(menu_item('Select All',wid.fv!=null,'a'))wid.cursor=rect(0,RTEXT_END)
}
all_menus=_=>{
 const blocked=running()||msg.overshoot
 const canlisten=!blocked&&(ms.type=='listen'||ms.type==null)
 menu_bar('Decker',canlisten)
 if(menu_item('About...',1))modal_enter('about')
 if(menu_check('Listener',canlisten,ms.type=='listen','l')){if(ms.type!='listen'){modal_enter('listen')}else{modal_exit(0)}}
 menu_separator()
 menu_check('Fullscreen',1,is_fullscreen(),null,toggle_fullscreen)
 if(menu_check('Nav Gestures',1,enable_gestures))enable_gestures^=1
 if(menu_check('Script Profiler',1,profiler))profiler^=1
 if(menu_check('Toolbars',tzoom>0,toolbars_enable))toolbars_enable^=1,resize()
 if(blocked){
  menu_bar('Script',1)
  if(menu_item('Stop',1)){msg.pending_halt=1;if(ms.type!=null&&ms.type!='query'&&ms.type!='listen')modal_exit(0)}
  menu_bar('Edit',(ms.type=='input'||ms.type=='save')&&wid.fv)
  text_edit_menu()
  return
 }
 menu_bar('File',ms.type==null||ms.type=='recording')
 if(uimode=='script'){
  if(menu_item('Close Script',1))close_script()
  if(menu_item('Save Script',1,'s')){
   try{const text=ls(rtext_string(sc.f.table));parse(text),script_save(lms(text));sc.status='Saved.'}
   catch(e){sc.status=`Error: ${e.x}`,wid.cursor=rect(e.i,e.i)}
  }
  menu_separator()
  menu_item('Import Script...',1,0,_=>open_text('.lil,.txt',text=>{field_exit(),sc.f=fieldstr(lms(text))}))
  if(menu_item('Export Script...',1))modal_enter('export_script')
  menu_separator()
  if(menu_item('Go to Deck',!deck_is(sc.target)           ))close_script(deck)
  if(menu_item('Go to Card',sc.target!=ifield(deck,'card')))close_script(ifield(deck,'card'))
  if(menu_check('X-Ray Specs',1,sc.xray))sc.xray^=1
 }
 else if(ms.type=='recording'){
  menu_item('Import Sound...',1,0,_=>open_file('audio/*',load_sound))
  menu_separator();
  if(menu_item('Close Sound',1))modal_exit(0)
 }
 else{
  if(menu_item('New Deck...',1)){
   if(dirty){
    modal_enter('confirm_new')
    ms.message=lms('The current deck has unsaved changes.\nAre you sure you want to discard it?')
    ms.verb=lms('Discard')
   }else{load_deck(deck_read(''))}
  }
  if(menu_item('New Card',1)){const c=deck_add(deck,lms('card')), n=ln(ifield(ifield(deck,'card'),'index'));iwrite(c,lms('index'),lmn(n+1)),n_go([c],deck)}
  menu_separator()
  menu_item('Open...',1,0,_=>open_text('.html,.deck',text=>{load_deck(deck_read(text))}))
  if(menu_item('Save As...',1))modal_enter('save_deck')
  menu_separator()
  if(wid.gv){
   menu_item('Import Table...',!wid.g.locked,0,_=>open_text('.csv',text=>{
    const a=[lms(text)];if(wid.g.format.length)a.push(lms(wid.g.format))
    grid_edit(n_readcsv(a))
   }))
   if(menu_item('Export Table...',1))modal_enter('export_table')
  }
  else{
   menu_item("Import Image...",1,0,_=>{open_file('image/*',load_image)})
   if(menu_item("Export Image...",1))modal_enter('export_image')
  }
  menu_separator()
  if(menu_item('Cards...'     ,1,'C'))modal_enter('cards')
  if(menu_item('Sounds...'    ,1,'S'))modal_enter('sounds')
  if(menu_item('Resources...' ,1,   ))modal_enter('resources')
  if(menu_item('Properties...',1,   ))modal_enter('deck_props')
 }
 if(ms.type==null||wid.gv||wid.fv){
  menu_bar("Edit",wid.gv||wid.fv||(ms.type==null&&uimode=='interact')||uimode=='draw'||uimode=='object')
  if(wid.gv){
   const mutable=!wid.g.locked&&ms.type==null
   if(menu_item('Undo',wid.hist_cursor>0              ,'z'))grid_undo()
   if(menu_item('Redo',wid.hist_cursor<wid.hist.length,'Z'))grid_redo()
   menu_separator()
   if(menu_item('Copy Table',1,'c',menucopy)){}
   if(menu_item('Paste Table',mutable,'v',menupaste)){}
   menu_separator()
   if(menu_item('Delete Row',mutable&&wid.gv.row!=-1))grid_deleterow()
   if(menu_item('Add Row',mutable))grid_insertrow()
   if(menu_item('Query...',ms.type==null,'u'))modal_enter('query')
  }
  if(wid.fv)text_edit_menu()
  if(ms.type==null&&uimode=='interact'){
   if(menu_item('Undo',has_undo(),'z'))undo()
   if(menu_item('Redo',has_redo(),'Z'))redo()
   menu_separator()
   if(menu_item('Paste',1,'v',menupaste)){}
  }
  if(ms.type==null&&uimode=='draw'){
   const sel=bg_has_sel()||bg_has_lasso()
   if(menu_item('Undo',(!sel)&&has_undo(),'z'))undo()
   if(menu_item('Redo',(!sel)&&has_redo(),'Z'))redo()
   menu_separator()
   if(menu_item('Cut Image',sel,0,menucut)){}
   if(menu_item('Copy Image',sel,0,menucopy)){}
   if(menu_item('Paste',1,'v',menupaste)){}
   if(menu_item('Clear',1)){const t=dr.tool;if(!sel){settool('select'),dr.sel_here=rcopy(frame.clip)}bg_delete_selection(),settool(t)}
   menu_separator()
   if(menu_item('Select All',1,'a')){settool('select'),dr.sel_here=rcopy(frame.clip)}
   if(menu_item('Tight Selection',sel,'g'))bg_tighten()
   if(menu_item("Resize to Original",sel&&dr.tool=='select',0)){bg_scoop_selection();const s=dr.limbo.size;dr.sel_here.w=s.x,dr.sel_here.h=s.y}
   if(menu_item("Resize to Card"    ,sel&&dr.tool=='select',0)){bg_scoop_selection(),dr.sel_here=rect(0,0,frame.size.x,frame.size.y)}
   menu_separator()
   if(menu_item('Invert',sel&&!dr.limbo_dither,'i')){
    if(bg_has_sel())bg_scoop_selection()
    const s=dr.limbo.size, pal=deck.patterns.pal.pix
    for(let z=0;z<dr.limbo.pix.length;z++)dr.limbo.pix[z]=1^draw_pattern(dr.limbo.pix[z],(z%s.x),0|(z/s.x))
   }
   if(menu_item('Flip Horizontal',sel)){
    if(bg_has_sel())bg_scoop_selection()
    image_flip_h(dr.limbo);if(dr.mask)image_flip_h(dr.mask);if(dr.omask&&dr.limbo_dither)image_flip_h(dr.omask);
   }
   if(menu_item('Flip Vertical'  ,sel)){
    if(bg_has_sel())bg_scoop_selection()
    image_flip_v(dr.limbo);if(dr.mask)image_flip_v(dr.mask);if(dr.omask&&dr.limbo_dither)image_flip_v(dr.omask);
   }
   if(menu_item('Rotate Left',sel,',')){
    const s=rect(dr.sel_here.w,dr.sel_here.h)
    if(bg_has_sel())bg_scoop_selection()
    image_flip_h(dr.limbo),image_flip(dr.limbo)
    if(dr.mask)image_flip_h(dr.mask),image_flip(dr.mask)
    if(dr.omask&&dr.limbo_dither)image_flip_h(dr.omask),image_flip(dr.omask)
    dr.sel_here.w=s.y,dr.sel_here.h=s.x
   }
   if(menu_item('Rotate Right',sel,'.')){
    const s=rect(dr.sel_here.w,dr.sel_here.h)
    if(bg_has_sel())bg_scoop_selection()
    image_flip(dr.limbo),image_flip_h(dr.limbo)
    if(dr.mask)image_flip(dr.mask),image_flip_h(dr.mask)
    if(dr.omask&&dr.limbo_dither)image_flip(dr.omask),image_flip_h(dr.omask)
    dr.sel_here.w=s.y,dr.sel_here.h=s.x
   }
   if(dr.limbo_dither&&sel){
    menu_separator()
    if(menu_item('Lighten Image',dr.dither_threshold>-2.0))dr.dither_threshold-=.1
    if(menu_item('Darken  Image',dr.dither_threshold< 2.0))dr.dither_threshold+=.1
   }
  }
  const card=ifield(deck,'card')
  if(ms.type==null&&uimode=='object'){
   if(menu_item('Undo',has_undo(),'z'))undo()
   if(menu_item('Redo',has_redo(),'Z'))redo()
   menu_separator()
   if(menu_item('Cut Widgets',ob.sel.length,'x',menucut)){}
   if(menu_item('Copy Widgets',ob.sel.length,'c',menucopy)){}
   if(menu_item('Copy Image',ob.sel.length==1,0,copywidgetimg)){}
   if(menu_item('Paste',1,'v',menupaste)){}
   menu_separator()
   if(menu_item('Paste as new Canvas',1,0,pasteascanvas)){}
   if(menu_item('Paste into Canvas',ob.sel.length==1&&canvas_is(ob.sel[0]),0,pasteintocanvas)){}
   menu_separator()
   if(menu_item('Select All',1,'a'))ob.sel=card.widgets.v.slice(0)
   if(menu_item('Move to Front',ob.sel.length))ob_order(),ob.sel                   .map(w=>iwrite(w,lms('index'),lmn(RTEXT_END))),mark_dirty()
   if(menu_item('Move to Back' ,ob.sel.length))ob_order(),ob.sel.slice(0).reverse().map(w=>iwrite(w,lms('index'),NONE          )),mark_dirty()
  }
  if(wid.fv&&wid.f){
   const selection=wid.fv!=null&&wid.cursor.x!=wid.cursor.y
   menu_bar('Text',ms.type!='field_props')
   if(wid.f.style=='rich'){
    if(menu_item('Heading'    ,selection))field_stylespan(lms('menu'),lms(''))
    if(menu_item('Body'       ,selection))field_stylespan(lms(''    ),lms(''))
    if(menu_item('Fixed Width',selection))field_stylespan(lms('mono'),lms(''))
    if(menu_item('Link...'    ,selection))modal_enter('link')
   }
   else if(wid.f.style=='code'){
    if(menu_item('Indent'        ,1    ))field_indent(1)
    if(menu_item('Unindent'      ,1    ))field_indent(0)
    if(menu_item('Toggle Comment',1,'/'))field_comment()
   }
   if(wid.f&&wid.f.style!='code'){
    if(menu_item('Font...',wid.f.style!='plain'))modal_enter('fonts')
   }
  }
 }
 if(ms.type=='recording'&&!wid.fv){
  menu_bar('Edit',au.mode=='stopped')
  if(menu_item('Undo',au.hist_cursor>0             ,'z'))sound_undo()
  if(menu_item('Redo',au.hist_cursor<au.hist.length,'Z'))sound_redo()
  menu_separator()
  if(menu_item('Cut Sound'  ,1,'x',menucut)){}
  if(menu_item('Copy Sound' ,1,'c',menucopy)){}
  if(menu_item('Paste Sound',1,'v',menupaste)){}
  if(menu_item('Clear',1,0))sound_delete()
  menu_separator()
  if(menu_item('Select All',1,'a'))au.head=0,au.sel=rect(0,au.target.data.length-1)
 }
 if(uimode=='interact'||uimode=='draw'||uimode=='object'){
  menu_bar('Card',ms.type==null)
  const card=ifield(deck,'card')
  if(menu_item('Go to First'   ,1))n_go([lms('First')],deck)
  if(menu_item('Go to Previous',1))n_go([lms('Prev' )],deck)
  if(menu_item('Go to Next'    ,1))n_go([lms('Next' )],deck)
  if(menu_item('Go to Last'    ,1))n_go([lms('Last' )],deck)
  menu_separator()
  if(menu_item('Cut Card',1,0,cutcard)){}
  if(menu_item('Copy Card',1,0,copycard)){}
  menu_separator()
  if(menu_item('Script...'    ,1))setscript(card)
  if(menu_item('Properties...',1))modal_enter('card_props')
  menu_bar('Tool',ms.type==null)
  if(menu_check('Interact',1,uimode=='interact',0))setmode('interact')
  if(menu_check('Widgets' ,1,uimode=='object'  ,0))setmode('object')
  menu_separator()
  if(menu_check('Select'     ,1,uimode=='draw'&&dr.tool=='select'     ))settool('select'     )
  if(menu_check('Lasso'      ,1,uimode=='draw'&&dr.tool=='lasso'      ))settool('lasso'      )
  if(menu_check('Pencil'     ,1,uimode=='draw'&&dr.tool=='pencil'     ))settool('pencil'     )
  if(menu_check('Line'       ,1,uimode=='draw'&&dr.tool=='line'       ))settool('line'       )
  if(menu_check('Flood'      ,1,uimode=='draw'&&dr.tool=='fill'       ))settool('fill'       )
  if(menu_check('Box'        ,1,uimode=='draw'&&dr.tool=='rect'       ))settool('rect'       )
  if(menu_check('Filled Box' ,1,uimode=='draw'&&dr.tool=='fillrect'   ))settool('fillrect'   )
  if(menu_check('Oval'       ,1,uimode=='draw'&&dr.tool=='ellipse'    ))settool('ellipse'    )
  if(menu_check('Filled Oval',1,uimode=='draw'&&dr.tool=='fillellipse'))settool('fillellipse')
  if(menu_check('Polygon'    ,1,uimode=='draw'&&dr.tool=='poly'       ))settool('poly'       )
 }
 if(uimode=='draw'||uimode=='object'){
  menu_bar('View',ms.type==null)
  if(menu_check('Show Widgets'      ,1,dr.show_widgets))dr.show_widgets^=1
  if(menu_check('Show Widget Bounds',1,ob.show_bounds ))ob.show_bounds ^=1
  if(menu_check('Show Widget Names' ,1,ob.show_names  ))ob.show_names  ^=1
  if(menu_check('Show Cursor Info'  ,1,ob.show_cursor ))ob.show_cursor ^=1
  menu_separator()
  if(menu_check('Show Grid Overlay',1,dr.show_grid))dr.show_grid^=1
  if(menu_check('Snap to Grid'     ,1,dr.snap     ))dr.snap     ^=1
  if(menu_item('Grid Size...',1))modal_enter('grid')
  menu_separator()
  if(menu_check('Show Animation'   ,1,dr.show_anim ))dr.show_anim ^=1
  if(menu_check('Transparency Mask',1,dr.trans_mask))dr.trans_mask^=1
  if(menu_check('Fat Bits'         ,1,dr.fatbits   )){
   if(uimode!='draw')setmode('draw')
   dr.fatbits^=1;if(dr.fatbits)fat_offset(rcenter(bg_has_sel()||bg_has_lasso()?dr.sel_here:frame.clip,rect()))
  }
 }
 if(uimode=='draw'){
  menu_bar('Style',ms.type==null)
  if(menu_item('Stroke...',1))modal_enter('pattern')
  if(menu_item('Fill...'  ,1))modal_enter('fill'   )
  if(menu_item('Brush...' ,1))modal_enter('brush'  )
  menu_separator()
  if(menu_check('Transparency',1,dr.trans))dr.trans^=1
 }
 if(uimode=='object'){
  menu_bar('Widgets',ms.type==null)
  if(menu_item('New Button...',1))ob_create([lmd([lms('type')],[lms('button')])])
  if(menu_item('New Field...' ,1))ob_create([lmd([lms('type')],[lms('field' )])])
  if(menu_item('New Slider...',1))ob_create([lmd([lms('type')],[lms('slider')])])
  if(menu_item('New Canvas...',1))ob_create([lmd([lms('type')],[lms('canvas')])])
  if(menu_item('New Grid...'  ,1))ob_create([lmd([lms('type')],[lms('grid'  )])])
  menu_separator()
  let al=1,as=1,at=1,ai=1,an=1
  ob.sel.map(unpack_widget).map(w=>{al&=w.locked, as&=w.show=='solid', at&=w.show=='transparent', ai&=w.show=='invert', an&=w.show=='none'})
  if(menu_check('Locked'          ,ob.sel.length,ob.sel.length&&al))ob_edit_prop('locked',lmn(!al))
  if(menu_check('Show Solid'      ,ob.sel.length,ob.sel.length&&as))ob_edit_prop('show',lms('solid'      ))
  if(menu_check('Show Transparent',ob.sel.length,ob.sel.length&&at))ob_edit_prop('show',lms('transparent'))
  if(menu_check('Show Inverted'   ,ob.sel.length,ob.sel.length&&ai))ob_edit_prop('show',lms('invert'     ))
  if(menu_check('Show None'       ,ob.sel.length,ob.sel.length&&an))ob_edit_prop('show',lms('none'       ))
  menu_separator()
  if(menu_item('Font...'  ,ob.sel.length))modal_enter('fonts')
  if(menu_item('Script...',ob.sel.length)){
   if(ob.sel.reduce((m,v)=>m&&ob.sel[0].script==v.script,1)){setscript(ob.sel)}else{
    modal_enter('multiscript')
     ms.message=lms('Not all of the selected widgets\nhave the same script.\nEdit them all together anyway?')
     ms.verb=lms('Edit')
   }
  }
  if(menu_item('Properties...',ob.sel.length==1)||(ob.sel.length==1&&ev.action&&ms.type==null))object_properties(ob.sel[0])
 }
 if(ms.type=='listen'){
  menu_bar('Listener',1)
  if(menu_item('Clear History',1))li.hist=[],li.scroll=0
  if(menu_item('Clear Locals' ,1))li.vars={}
  menu_separator()
  if(menu_item('Show Locals',1))listen_show(ALIGN.right,0,lmd(Object.keys(li.vars).map(lms),Object.values(li.vars)))
 }
}

main_view=_=>{
 const card=ifield(deck,'card'), back=ifield(card,'image'), wids=ifield(card,'widgets'), pal=deck.patterns.pal.pix
 if(back.size.x>0&&back.size.y>0&&ms.type!='trans'){
  if(dr.fatbits){draw_fat(back,pal,frame_count,0,FAT,dr.offset)}
  else{image_paste(rpair(rect(),back.size),frame.clip,back,frame.image,1)}
 }
 if(uimode=='draw'&&in_layer())bg_tools()
 if(dr.tool=='select'&&(dr.sel_start.w>0||dr.sel_start.h>0))draw_rect(card_to_fat(dr.sel_start),dr.fill)
 bg_lasso_preview()
 const livesel=bg_select()
 if(((uimode=='object'||uimode=='draw')&&dr.show_grid)||ms.type=='grid'){
  for(let x=0;x<frame.size.x;x++){const r=card_to_fat(rect(x*dr.grid_size.x,0,1,frame.size.y));draw_vline(r.x,r.y,r.y+r.h,44)}
  for(let y=0;y<frame.size.y;y++){const r=card_to_fat(rect(0,y*dr.grid_size.y,frame.size.x,1));draw_hline(r.x,r.x+r.w,r.y,44)}
 }
 const eb=ev;if(uimode!='interact')ev=event_state()
 if(uimode=='interact'||(dr.show_widgets&&!dr.fatbits))wids.v.map(w=>{
  if(button_is(w)){
   const v=lb(ifield(w,'value')), p=unpack_button(w)
   if(widget_button(w,p,v)&&p.style=='check')iwrite(w,lms('value'),lmn(!v)),mark_dirty()
  }
  if(slider_is(w)){widget_slider(w,unpack_slider(w))}
  if(canvas_is(w)){const v=canvas_image(w,0);widget_canvas(w,unpack_canvas(w),v)}
  if(grid_is(w)){
   const p=unpack_grid(w),v=unpack_grid_value(w);widget_grid(w,p,v)
   if(wid.gt==w)wid.gv=v
  }
  if(field_is(w)){
   if(wid.ft==w){widget_field(w,wid.f,wid.fv)}
   else{const p=unpack_field(w),v=unpack_field_value(w);widget_field(w,p,v);if(wid.ft==w)wid.fv=v}
  }
 })
 else if(dr.show_widgets&&dr.fatbits)wids.v.map(w=>{draw_boxinv(pal,card_to_fat(unpack_widget(w).size))})
 ev=eb
 if(uimode=='draw'){if(bg_has_sel())draw_handles(livesel);draw_box(livesel,0,ANTS)}
 if(wid.pending_grid_edit){wid.pending_grid_edit=0;modal_enter('gridcell')}
 if(uimode=='object')object_editor()
 if((uimode=='object'&&ob.show_names)||(uimode=='draw'&&dr.show_widgets&&dr.fatbits)||ms.type=='listen'){
  wids.v.map(wid=>{
   const size=card_to_fat(unpack_widget(wid).size)
   const n=ls(ifield(wid,'name')),s=font_textsize(FONT_BODY,n)
   draw_text_outlined(rect(size.x,size.y-s.y,s.x,s.y),n,FONT_BODY)
  })
 }
 if(ob.show_cursor&&ms.type==null&&uimode in {draw:1,object:1}){
  if(uimode=='draw'&&bg_has_sel()){
   let r=livesel,l=r;if(dr.fatbits){const p=fat_to_card(r);l=rint(rect(p.x,p.y,r.w/FAT,r.h/FAT))}
   const t=ls(dyad.format(lms('(%3i,%3i,%3i,%3i)'),lml([l.x,l.y,l.w,l.h].map(lmn)))),s=font_textsize(FONT_BODY,t)
   draw_text_outlined(rect(r.x,r.y-s.y,s.x,s.y),t,FONT_BODY)
  }
  else if(ev.drag){
   const a=dr.fatbits?fat_to_card(ev.dpos):ev.dpos, b=dr.fatbits?fat_to_card(ev.pos):ev.pos, r=rect(b.x,b.y,b.x-a.x,b.y-a.y)
   const t=ls(dyad.format(lms('(%3i,%3i,%3i,%3i)'),lml([r.x,r.y,r.w,r.h].map(lmn)))),s=font_textsize(FONT_BODY,t)
   draw_text_outlined(rect(ev.pos.x,ev.pos.y-s.y,s.x,s.y),t,FONT_BODY)
  }
  else{
   const c=dr.fatbits?fat_to_card(ev.pos):ev.pos
   const t=ls(dyad.format(lms('(%3i,%3i)'),lml([c.x,c.y].map(lmn)))),s=font_textsize(FONT_BODY,t)
   draw_text_outlined(rect(ev.pos.x,ev.pos.y-s.y,s.x,s.y),t,FONT_BODY)
  }
 }
}
gestures=_=>{
 if(!enable_gestures)return
 const card=ifield(deck,'card')
 if(!in_layer()||uimode!='interact'||(!ev.drag&&!ev.mu))return          // must be in the right state of mind
 if(ev.drag&&ob.sel.length&&lb(ifield(ob.sel[0],'draggable')))return    // must not be dragging a canvas
 if(card.widgets.v.some(x=>dover(unpack_widget(x).size)))return         // must touch grass
 const d=rsub(ev.pos,ev.dpos);if(Math.sqrt(d.x*d.x+d.y*d.y)<50)return   // must be emphatic
 if(Math.abs(d.x)<2*Math.abs(d.y)&&Math.abs(d.y)<2*Math.abs(d.x))return // must be highly directional
 const dir=Math.abs(d.x)>2*Math.abs(d.y)?(d.x<0?'left':'right'):(d.y<0?'up':'down')
 image_paste(rect(ev.pos.x-8,ev.pos.y-8,16,16),frame.clip,GESTURES[dir],frame.image,0)
 if(ev.mu)msg.target_navigate=card,msg.arg_navigate=lms(dir)
}

validate_modules=_=>{
 for(let z=0;z<count(deck.modules);z++){
  const err=ifield(deck.modules.v[z],'error');if(!count(err))continue
  modal_enter('alert'),ms.message=rtext_cast(lms(`The module "${ls(deck.modules.k[z])}" failed to initialize: ${ls(err)}`));break
 }
}
load_deck=d=>{
 deck=d, dirty=0, wid.active=-1, wid.hist=[], au.hist=[], doc_hist=[], doc_hist_cursor=0, dr=draw_state()
 FONT_BODY=dget(deck.fonts,lms('body')),FONT_MENU=dget(deck.fonts,lms('menu')),FONT_MONO=dget(deck.fonts,lms('mono'))
 fb=image_make(getpair(ifield(ifield(deck,'card'),'size'))),context=frame=draw_frame(fb),validate_modules(),setmode('interact'),msg.next_view=1
 seed=0|(new Date().getTime()/1000),n_play([NONE,lms('loop')])
}
tick=_=>{
 msg.pending_drag=0,msg.pending_halt=0,frame=context,uicursor=0,fb.pix.fill(0)
 menu_setup(),all_menus(),widget_setup()
 if(uimode=='script'){script_editor()}else{main_view()}
 modals(),gestures(),menu_finish()
 if(uimode=='draw'&&dr.fatbits)draw_icon(rect(frame.size.x-14,2),ZOOM,1)
 if(uimode=='interact'&&ev.drag&&ob.sel.length&&lb(ifield(ob.sel[0],'draggable')))iwrite(ob.sel[0],lms('pos'),lmpair(rsub(ev.pos,ob.prev))),mark_dirty()
 q('#display').style.cursor=uicursor||'default'
 for(let x=0;x<=1;x++)for(let y=0;y<=1;y++)draw_icon(rect(x*(context.size.x-5),y*(context.size.y-5)),CORNERS[x+y*2],1)
 const used=interpret()
 if(uimode=='interact'&&profiler){
  const r=rect(frame.size.x-60,2,50,12)
  draw_text(inset(r,2),ls(dyad.format(lms('%0.2f%%'),lmn(100*used/FRAME_QUOTA))),FONT_BODY,1)
  draw_invert(deck.patterns.pal.pix,rect(r.x+1,r.y,ceil((r.w-2)*(used/FRAME_QUOTA)),r.h)),draw_box(r,0,1)
 }
 if(msg.pending_loop)sfx_doloop()
}

let id=null
sync=_=>{
 toolbars()
 ev.shortcuts={}
 ev.mu=ev.md=ev.click=ev.dclick=ev.tab=ev.action=ev.dir=ev.exit=ev.eval=ev.scroll=ev.rdown=ev.rup=0
 if(ev.clicktime)ev.clicktime--;if(ev.clicklast)ev.clicklast--
 if(ev.pos.x!=ev.dpos.x||ev.pos.y!=ev.dpos.y)ev.clicklast=0
 wid.cursor_timer=(wid.cursor_timer+1)%(2*FIELD_CURSOR_DUTY)
 if(wid.change_timer){wid.change_timer--;if(wid.change_timer==0)field_change()}
 const anim=deck.patterns.anim, pal=deck.patterns.pal.pix, mask=dr.trans_mask&&uimode=='draw'
 const anim_ants   =(x,y)=>(0|((x+y+(0|(frame_count/2)))/3))%2?15:0
 const anim_pattern=(pix,x,y)=>pix<28||pix>31?pix: anim[pix-28][(0|(frame_count/4))%max(1,anim[pix-28].length)]
 const draw_pattern=(pix,x,y)=>pix<2?(pix?1:0): pix>31?(pix==32?0:1): pal_pat(pal,pix,x,y)&1
 const draw_color  =(pix,x,y)=>pix==ANTS?anim_ants(x,y): pix>47?0: pix>31?pix-32: draw_pattern(pix,x,y)?15:0
 if(!id||id.width!=fb.size.x||id.height!=fb.size.y)id=new ImageData(fb.size.x,fb.size.y)
 for(let z=0,d=0,y=0;y<id.height;y++)for(let x=0;x<id.width;x++,z++,d+=4){
  const pix=fb.pix[z], a=anim_pattern(pix,x,y), c=(a==0&&mask)?13:draw_color(a,x,y), cv=COLORS[c]
  id.data[d  ]=0xFF&(cv>>16)
  id.data[d+1]=0xFF&(cv>> 8)
  id.data[d+2]=0xFF&(cv    )
  id.data[d+3]=0xFF
 }
 const r=q('#render');r.getContext('2d').putImageData(id,0,0)
 const g=q('#display').getContext('2d');g.imageSmoothingEnabled=zoom!=(0|zoom),g.save(),g.scale(zoom,zoom),g.drawImage(r,0,0),g.restore()
 pending_tick=1,frame_count++
}

move=(x,y)=>{if(!msg.pending_drag)pointer.prev=pointer.pos;pointer.pos=ev.pos=rect(x,y);if(pointer.held)msg.pending_drag=1}
down=(x,y,alt)=>{
 ev.rawdpos=ev.rawpos
 move(x,y),pointer.held=ev.drag=1;pointer.start=ev.dpos=pointer.pos,ev.md=1,ev.clicktime=10;if(alt)ev.rdown=1;initaudio()}
up=(x,y,alt)=>{
 move(x,y),pointer.held=ev.drag=0,pointer.end=pointer.pos,ev.mu=1;if(alt)ev.rup=1
 if(ev.clicktime)ev.click=1;ev.clicktime=0;if(ev.clicklast)ev.dclick=1;ev.clicklast=DOUBLE_CLICK_DELAY
 if(ev.callback&&ev.callback_rect&&over(ev.callback_rect)&&(ev.callback_drag||dover(ev.callback_rect)))ev.callback()
 ev.callback=null,ev.callback_rect=null,ev.callback_drag=0;if(audio)audio.resume()
}
mouse=(e,f)=>{
 ev.rawpos=rect(e.pageX,e.pageY);const c=q('#display').getBoundingClientRect()
 f(0|((e.pageX-c.x)/zoom),0|((e.pageY-c.y)/zoom),e.button!=0)
}
touch=(e,f)=>{const t=e.targetTouches[0]||{}; mouse({pageX:t.clientX, pageY:t.clientY, button:0},f)}
loop=_=>{tick(),sync(),pump=setTimeout(loop,1000/60)} // 60fps
resize=_=>{
 const b=q('body'), screen=rect(b.clientWidth,b.clientHeight), fs=min(screen.x/fb.size.x,screen.y/fb.size.y)
 zoom=max(1,is_fullscreen()?fs:(0|fs))
 tzoom=0|min((screen.x-(zoom*fb.size.x))/(2*toolsize.x),screen.y/toolsize.y)
 const tz=tzoom*toolbars_enable
 const c =q('#display');c .width=fb.size .x*zoom,c.height =fb.size .y*zoom
 const tl=q('#ltools' );tl.width=toolsize.x*tz  ,tl.height=toolsize.y*tz
 const tr=q('#rtools' );tr.width=toolsize.x*tz  ,tr.height=toolsize.y*tz
 const r =q('#render' );r .width=fb.size .x     ,r .height=fb.size .y
 const rl=q('#lrender');rl.width=toolsize.x     ,rl.height=toolsize.y
 const rr=q('#rrender');rr.width=toolsize.x     ,rr.height=toolsize.y
}
window.onresize=_=>{resize(),sync()}
q('body').addEventListener('mousedown'  ,e=>mouse(e,down))
q('body').addEventListener('mouseup'    ,e=>mouse(e,up  ))
q('body').addEventListener('mousemove'  ,e=>mouse(e,move))
q('body').addEventListener('contextmenu',e=>e.preventDefault())
q('body').addEventListener('touchstart' ,e=>{e.preventDefault(),touch(e,down)},{passive:false})
q('body').addEventListener('touchend'   ,e=>touch({targetTouches:e.changedTouches},up))
q('body').addEventListener('touchmove'  ,e=>touch(e,move))
q('body').onwheel=e=>ev.scroll=e.deltaY<0?-1:e.deltaY>0?1:0
q('body').onkeydown=e=>{
 initaudio()
 if(e.shiftKey)ev.shift=1
 if(e.key=='ArrowUp'   )ev.dir='up'
 if(e.key=='ArrowDown' )ev.dir='down'
 if(e.key=='ArrowLeft' )ev.dir='left'
 if(e.key=='ArrowRight')ev.dir='right'
 if(e.metaKey||e.ctrlKey)ev.alt=1,ev.shortcuts[e.shiftKey?(e.key.toUpperCase()):e.key]=1
 else if(e.key.length==1&&wid.infield)field_input(e.key)
 else if(uimode=='draw'&&ms.type==null){if(e.key=='Backspace'||e.key=='Delete')bg_delete_selection()}
 else if(uimode=='object'&&ms.type==null){if(e.key=='Backspace'||e.key=='Delete')ob_destroy()}
 else if(ms.type=='recording'&&!wid.infield&&au.mode=='stopped'){if(e.key=='Backspace'||e.key=='Delete')sound_delete()}
 if     (wid.ingrid )grid_keys (e.key,e.shiftKey)
 else if(wid.infield)field_keys(e.key,e.shiftKey)
 if(uimode=='script')sc.status=''
 if(e.key==' '&&!wid.infield)ev.action=1
 if(e.key=='Enter')ev.action=1
 if(e.key=='Tab')ev.tab=1
 if(e.key=='l'&&ms.type==null&&!wid.ingrid&&!wid.infield)ev.shortcuts['l']=1
 if(e.key=='f'&&ms.type==null&&!wid.ingrid&&!wid.infield)toggle_fullscreen
 if(e.key=='j'&&ms.type==null&&dr.limbo_dither&&dr.dither_threshold>-2.0)dr.dither_threshold-=.1
 if(e.key=='k'&&ms.type==null&&dr.limbo_dither&&dr.dither_threshold< 2.0)dr.dither_threshold+=.1
 if((e.metaKey||e.ctrlKey)&&e.key in {c:1,x:1,v:1}){}
 else{e.preventDefault()}
}
q('body').onkeyup=e=>{
 if(e.key=='Meta'||e.key=='Control'||e.metaKey||e.ctrlKey)ev.alt=0
 if(e.key=='Enter'&&e.shiftKey)ev.eval=1
 if(e.key=='Shift'||e.shiftKey)ev.shift=0
 if(e.key=='m'&&uimode=='draw'&&in_layer())ev.hidemenu^=1
 if(e.key=='t'&&uimode=='draw'&&in_layer())dr.trans^=1
 if(e.key=='Escape')ev.exit=1
 if(!wid.infield&&uimode=='interact'){
  if(e.key=='ArrowUp'   )msg.target_navigate=ifield(deck,'card'),msg.arg_navigate=lms('up'   )
  if(e.key=='ArrowDown' )msg.target_navigate=ifield(deck,'card'),msg.arg_navigate=lms('down' )
  if(e.key=='ArrowLeft' )msg.target_navigate=ifield(deck,'card'),msg.arg_navigate=lms('left' )
  if(e.key=='ArrowRight')msg.target_navigate=ifield(deck,'card'),msg.arg_navigate=lms('right')
 }
 e.preventDefault()
}
let local_clipboard=''
getclipboard=after=>{
 const t=document.createElement('textarea');t.style.top='0',t.style.left='0',t.position='fixed',t.onpaste=e=>{e.stopPropagation()}
 document.body.appendChild(t),t.focus(),t.select();const success=document.execCommand('paste');const x=t.value;document.body.removeChild(t)
 if(success){after(x);return}                                       // this approach seems to work fine for Safari
 try{navigator.clipboard.readText().then(text=>{after(text)},_=>_)} // this works in Chrome, but *explicitly* does not work in Firefox
 catch(e){after(local_clipboard)}                                   // so Firefox gets to use a baby-jail local clipboard
}
setclipboard=x=>{
 local_clipboard=x
 const t=document.createElement('textarea');t.value=x,t.style.top='0',t.style.left='0',t.position='fixed',t.oncopy=e=>{e.stopPropagation()}
 document.body.appendChild(t),t.focus(),t.select();const success=document.execCommand('copy');document.body.removeChild(t);if(success)return;
 try{navigator.clipboard.writeText(x).then(_=>_,_=>_)}catch(e){console.log(e)} // generally not necessary, but worth having as a last resort
}
docut=_=>{
 if(wid.fv){
  const s=rtext_span(wid.fv.table,wid.cursor),i=rtext_is_image(s);field_keys('Delete',0)
  return i?image_write(i):ls(rtext_string(s))
 }
 else if(ms.type=='recording'&&au.mode=='stopped'){const r=sound_write(sound_selected());sound_delete();return r}
 else if(ms.type==null&&uimode=='draw'&&(bg_has_sel()||bg_has_lasso())){
  const i=bg_has_lasso()?image_mask(dr.limbo,dr.mask): dr.limbo?bg_scaled_limbo():bg_copy_selection(dr.sel_here)
  bg_scoop_selection(),bg_delete_selection();return image_write(i)
 }
 else if(ms.type==null&&uimode=='object'&&ob.sel.length){ob_order();const r=ls(card_copy(ifield(deck,'card'),lml(ob.sel)));ob_destroy();return r}
 return null
}
docopy=_=>{
 if(wid.gv){return ls(n_writecsv([wid.gv.table,grid_format()]))}
 else if(wid.fv){
  const s=rtext_span(wid.fv.table,wid.cursor),i=rtext_is_image(s)
  return i?image_write(i):ls(rtext_string(s))
 }
 else if(ms.type=='recording'&&au.mode=='stopped'){return sound_write(sound_selected())}
 else if(ms.type==null&&uimode=='draw'&&(bg_has_sel()||bg_has_lasso())){
  const i=bg_has_lasso()?image_mask(dr.limbo,dr.mask): dr.limbo?bg_scaled_limbo():bg_copy_selection(dr.sel_here);return image_write(i)
 }
 else if(ms.type==null&&uimode=='object'&&ob.sel.length){ob_order();return ls(card_copy(ifield(deck,'card'),lml(ob.sel)))}
 return null
}
dopaste=x=>{
 if(ms.type==null&&/^%%IMG[012]/.test(x)){
  const i=image_read(x);if(i.size.x==0||i.size.y==0)return
  if(wid.fv){
   if(wid.f.style!='rich'){field_input(x)}
   else{field_edit(lms(''),i,'i',wid.cursor)}
  }else{setmode('draw'),bg_paste(i)}
 }
 else if(ms.type=='recording'&&au.mode=='stopped'&&/^%%SND0/.test(x)){sound_edit(sound_replace(sound_read(x)))}
 else if(ms.type==null&&/^%%WGT0/.test(x)){setmode('object'),card_paste(ifield(deck,'card'),lms(x))}
 else if(ms.type==null&&/^%%CRD0/.test(x)){
  const c=deck_paste(deck,lms(x))
  const card=ifield(deck,'card'), n=ln(ifield(card,'index'));iwrite(c,lms('index'),lmn(n+1)),n_go([c],deck)
 }
 else if(wid.gv&&!wid.g.locked&&ms.type==null){grid_edit(n_readcsv([lms(x),lms(wid.g.format)]))}
 else if(wid.fv){field_input(x)}
}
cutcard=_=>{const c=ifield(deck,'card');setclipboard(ls(deck_copy(deck,c))),deck_remove(deck,c),mark_dirty()}
copycard=_=>{const c=ifield(deck,'card');setclipboard(ls(deck_copy(deck,c)))}
copywidgetimg=_=>{setclipboard(image_write(draw_widget(ob.sel[0]))),frame=context}
pasteascanvas=_=>getclipboard(t=>{ob_create([lmd([lms('type'),lms('locked'),lms('image')],[lms('canvas'),ONE,lms(t)])]),frame=context})
pasteintocanvas=_=>getclipboard(t=>{const i=image_read(t),c=ob.sel[0];iwrite(c,lms('size'),ifield(i,'size')),c.image=i})
menucut=_=>{const r=docut();if(r)setclipboard(r)}
menucopy=_=>{const r=docopy();if(r)setclipboard(r)}
menupaste=_=>getclipboard(t=>{if(t.length)dopaste(t)})
document.oncut=e=>{const r=docut();if(r)e.clipboardData.setData('text/plain',r),local_clipboard=r;e.preventDefault()}
document.oncopy=e=>{const r=docopy();if(r)e.clipboardData.setData('text/plain',r),local_clipboard=r;e.preventDefault()}
document.onpaste=e=>{
 const src=e.clipboardData||e.originalEvent.clipboardData
 if(src.items[0]){
  const file=src.items[0].getAsFile()
  if(file&&/^image\//.test(file.type)){load_image(file);return}
  if(file&&/^audio\//.test(file.type)){load_sound(file);return}
 }
 dopaste(src.getData('text/plain')),e.preventDefault()
}
q('body').ondragover=e=>e.preventDefault()
q('body').ondrop=e=>{
 e.preventDefault();const file=e.dataTransfer.files.item(0);if(!file)return
 if(/\.(psv|csv)$/i.test(file.name)){
  file.text().then(t=>{
   const data=n_readcsv([lms(t),NONE,lms(file.type=='text/csv'?',':'|')])
   setmode('object'),ob_create([lmd([lms('type'),lms('value')],[lms('grid'),monad.cols(data)])])
  })
 }
 if(/\.(html|deck)$/i.test(file.name)){
  file.text().then(t=>{
   modal_enter('resources'),ms.message=deck_read(t),ms.grid=gridtab(res_enumerate(ms.message))
  })
 }
 if(/^image\//.test(file.type)){load_image(file)}
 if(/^audio\//.test(file.type)){load_sound(file)}
}

pushstate(lmenv()),load_deck(deck_read(q('script[language="decker"]').innerText))
const tag=decodeURI(document.URL.split('#')[1]||'');if(tag.length)iwrite(deck,lms('card'),lms(tag))
resize(),(pump&&clearTimeout(pump)),loop()
</script></body>
